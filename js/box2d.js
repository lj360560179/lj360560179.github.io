/* 
 * Box2Djs (port of Box2DFlash 1.4.3.1) - http://box2d-js.sourceforge.net/
 * Single-filed and jsmined ( http://code.google.com/p/jsmin-php/ ) by Mr.doob
 */

var b2Settings=Class.create();b2Settings.prototype={initialize:function(){}}
b2Settings.USHRT_MAX=0x0000ffff;b2Settings.b2_pi=Math.PI;b2Settings.b2_massUnitsPerKilogram=1.0;b2Settings.b2_timeUnitsPerSecond=1.0;b2Settings.b2_lengthUnitsPerMeter=30.0;b2Settings.b2_maxManifoldPoints=2;b2Settings.b2_maxShapesPerBody=64;b2Settings.b2_maxPolyVertices=8;b2Settings.b2_maxProxies=1024;b2Settings.b2_maxPairs=8*b2Settings.b2_maxProxies;b2Settings.b2_linearSlop=0.005*b2Settings.b2_lengthUnitsPerMeter;b2Settings.b2_angularSlop=2.0/180.0*b2Settings.b2_pi;b2Settings.b2_velocityThreshold=1.0*b2Settings.b2_lengthUnitsPerMeter/b2Settings.b2_timeUnitsPerSecond;b2Settings.b2_maxLinearCorrection=0.2*b2Settings.b2_lengthUnitsPerMeter;b2Settings.b2_maxAngularCorrection=8.0/180.0*b2Settings.b2_pi;b2Settings.b2_contactBaumgarte=0.2;b2Settings.b2_timeToSleep=0.5*b2Settings.b2_timeUnitsPerSecond;b2Settings.b2_linearSleepTolerance=0.01*b2Settings.b2_lengthUnitsPerMeter/b2Settings.b2_timeUnitsPerSecond;b2Settings.b2_angularSleepTolerance=2.0/180.0/b2Settings.b2_timeUnitsPerSecond;b2Settings.b2Assert=function(a)
{if(!a){var nullVec;nullVec.x++;}};
var b2Vec2=Class.create();b2Vec2.prototype={initialize:function(x_,y_){this.x=x_;this.y=y_;},SetZero:function(){this.x=0.0;this.y=0.0;},Set:function(x_,y_){this.x=x_;this.y=y_;},SetV:function(v){this.x=v.x;this.y=v.y;},Negative:function(){return new b2Vec2(-this.x,-this.y);},Copy:function(){return new b2Vec2(this.x,this.y);},Add:function(v)
{this.x+=v.x;this.y+=v.y;},Subtract:function(v)
{this.x-=v.x;this.y-=v.y;},Multiply:function(a)
{this.x*=a;this.y*=a;},MulM:function(A)
{var tX=this.x;this.x=A.col1.x*tX+A.col2.x*this.y;this.y=A.col1.y*tX+A.col2.y*this.y;},MulTM:function(A)
{var tX=b2Math.b2Dot(this,A.col1);this.y=b2Math.b2Dot(this,A.col2);this.x=tX;},CrossVF:function(s)
{var tX=this.x;this.x=s*this.y;this.y=-s*tX;},CrossFV:function(s)
{var tX=this.x;this.x=-s*this.y;this.y=s*tX;},MinV:function(b)
{this.x=this.x<b.x?this.x:b.x;this.y=this.y<b.y?this.y:b.y;},maxv:function(b) {this.x="this.x">b.x?this.x:b.x;this.y=this.y>b.y?this.y:b.y;},Abs:function()
{this.x=Math.abs(this.x);this.y=Math.abs(this.y);},Length:function()
{return Math.sqrt(this.x*this.x+this.y*this.y);},Normalize:function()
{var length=this.Length();if(length<number.min_value) {return="" 0.0;}="" var="" invlength="1.0/length;this.x*=invLength;this.y*=invLength;return" length;},isvalid:function()="" b2math.b2isvalid(this.x)&&b2math.b2isvalid(this.y);},x:null,y:null};b2vec2.make="function(x_,y_)" new="" b2vec2(x_,y_);};="" b2mat22="Class.create();b2Mat22.prototype={initialize:function(angle,c1,c2)" {if(angle="=null)angle=0;this.col1=new" b2vec2();this.col2="new" b2vec2();if(c1!="null&&c2!=null){this.col1.SetV(c1);this.col2.SetV(c2);}" else{var="" c="Math.cos(angle);var" s="Math.sin(angle);this.col1.x=c;this.col2.x=-s;this.col1.y=s;this.col2.y=c;}},Set:function(angle)" {var="" {this.col1.setv(c1);this.col2.setv(c2);},copy:function(){return="" b2mat22(0,this.col1,this.col2);},setm:function(m)="" {this.col1.setv(m.col1);this.col2.setv(m.col2);},addm:function(m)="" {this.col1.x+="m.col1.x;this.col1.y+=m.col1.y;this.col2.x+=m.col2.x;this.col2.y+=m.col2.y;},SetIdentity:function()" {this.col1.x="1.0;this.col2.x=0.0;this.col1.y=0.0;this.col2.y=1.0;},SetZero:function()" a="this.col1.x;var" b="this.col2.x;var" d="this.col2.y;var" det="a*d-b*c;det=1.0/det;out.col1.x=det*d;out.col2.x=-det*b;out.col1.y=-det*c;out.col2.y=det*a;return" out;},solve:function(out,bx,by)="" a11="this.col1.x;var" a12="this.col2.x;var" a21="this.col1.y;var" a22="this.col2.y;var" out;},abs:function()="" {this.col1.abs();this.col2.abs();},col1:new="" b2vec2(),col2:new="" b2vec2()};="" b2math="Class.create();b2Math.prototype={initialize:function(){}}" b2math.b2isvalid="function(x)" isfinite(x);};b2math.b2dot="function(a,b)" a.x*b.x+a.y*b.y;};b2math.b2crossvv="function(a,b)" a.x*b.y-a.y*b.x;};b2math.b2crossvf="function(a,s)" v="new" b2vec2(s*a.y,-s*a.x);return="" v;};b2math.b2crossfv="function(s,a)" b2vec2(-s*a.y,s*a.x);return="" v;};b2math.b2mulmv="function(A,v)" u="new" b2vec2(a.col1.x*v.x+a.col2.x*v.y,a.col1.y*v.x+a.col2.y*v.y);return="" u;};b2math.b2multmv="function(A,v)" b2vec2(b2math.b2dot(v,a.col1),b2math.b2dot(v,a.col2));return="" u;};b2math.addvv="function(a,b)" b2vec2(a.x+b.x,a.y+b.y);return="" v;};b2math.subtractvv="function(a,b)" b2vec2(a.x-b.x,a.y-b.y);return="" v;};b2math.mulfv="function(s,a)" b2vec2(s*a.x,s*a.y);return="" v;};b2math.addmm="function(A,B)" b2mat22(0,b2math.addvv(a.col1,b.col1),b2math.addvv(a.col2,b.col2));return="" c;};b2math.b2mulmm="function(A,B)" b2mat22(0,b2math.b2mulmv(a,b.col1),b2math.b2mulmv(a,b.col2));return="" c;};b2math.b2multmm="function(A,B)" c1="new" b2vec2(b2math.b2dot(a.col1,b.col1),b2math.b2dot(a.col2,b.col1));var="" c2="new" b2vec2(b2math.b2dot(a.col1,b.col2),b2math.b2dot(a.col2,b.col2));var="" b2mat22(0,c1,c2);return="" c;};b2math.b2abs="function(a)">0.0?a:-a;};b2Math.b2AbsV=function(a)
{var b=new b2Vec2(b2Math.b2Abs(a.x),b2Math.b2Abs(a.y));return b;};b2Math.b2AbsM=function(A)
{var B=new b2Mat22(0,b2Math.b2AbsV(A.col1),b2Math.b2AbsV(A.col2));return B;};b2Math.b2Min=function(a,b)
{return a<b?a:b;};b2math.b2minv=function(a,b) {var="" c="new" b2vec2(b2math.b2min(a.x,b.x),b2math.b2min(a.y,b.y));return="" c;};b2math.b2max="function(a,b)" {return="" a="">b?a:b;};b2Math.b2MaxV=function(a,b)
{var c=new b2Vec2(b2Math.b2Max(a.x,b.x),b2Math.b2Max(a.y,b.y));return c;};b2Math.b2Clamp=function(a,low,high)
{return b2Math.b2Max(low,b2Math.b2Min(a,high));};b2Math.b2ClampV=function(a,low,high)
{return b2Math.b2MaxV(low,b2Math.b2MinV(a,high));};b2Math.b2Swap=function(a,b)
{var tmp=a[0];a[0]=b[0];b[0]=tmp;};b2Math.b2Random=function()
{return Math.random()*2-1;};b2Math.b2NextPowerOfTwo=function(x)
{x|=(x>>1)&0x7FFFFFFF;x|=(x>>2)&0x3FFFFFFF;x|=(x>>4)&0x0FFFFFFF;x|=(x>>8)&0x00FFFFFF;x|=(x>>16)&0x0000FFFF;return x+1;};b2Math.b2IsPowerOfTwo=function(x)
{var result=x>0&&(x&(x-1))==0;return result;};b2Math.tempVec2=new b2Vec2();b2Math.tempVec3=new b2Vec2();b2Math.tempVec4=new b2Vec2();b2Math.tempVec5=new b2Vec2();b2Math.tempMat=new b2Mat22();
var b2AABB=Class.create();b2AABB.prototype={IsValid:function(){var dX=this.maxVertex.x;var dY=this.maxVertex.y;dX=this.maxVertex.x;dY=this.maxVertex.y;dX-=this.minVertex.x;dY-=this.minVertex.y;var valid=dX>=0.0&&dY>=0.0;valid=valid&&this.minVertex.IsValid()&&this.maxVertex.IsValid();return valid;},minVertex:new b2Vec2(),maxVertex:new b2Vec2(),initialize:function(){this.minVertex=new b2Vec2();this.maxVertex=new b2Vec2();}};
var b2Bound=Class.create();b2Bound.prototype={IsLower:function(){return(this.value&1)==0;},IsUpper:function(){return(this.value&1)==1;},Swap:function(b){var tempValue=this.value;var tempProxyId=this.proxyId;var tempStabbingCount=this.stabbingCount;this.value=b.value;this.proxyId=b.proxyId;this.stabbingCount=b.stabbingCount;b.value=tempValue;b.proxyId=tempProxyId;b.stabbingCount=tempStabbingCount;},value:0,proxyId:0,stabbingCount:0,initialize:function(){}}

var b2BoundValues=Class.create();b2BoundValues.prototype={lowerValues:[0,0],upperValues:[0,0],initialize:function(){this.lowerValues=[0,0];this.upperValues=[0,0];}}

var b2Pair=Class.create();b2Pair.prototype={SetBuffered:function(){this.status|=b2Pair.e_pairBuffered;},ClearBuffered:function(){this.status&=~b2Pair.e_pairBuffered;},IsBuffered:function(){return(this.status&b2Pair.e_pairBuffered)==b2Pair.e_pairBuffered;},SetRemoved:function(){this.status|=b2Pair.e_pairRemoved;},ClearRemoved:function(){this.status&=~b2Pair.e_pairRemoved;},IsRemoved:function(){return(this.status&b2Pair.e_pairRemoved)==b2Pair.e_pairRemoved;},SetFinal:function(){this.status|=b2Pair.e_pairFinal;},IsFinal:function(){return(this.status&b2Pair.e_pairFinal)==b2Pair.e_pairFinal;},userData:null,proxyId1:0,proxyId2:0,next:0,status:0,initialize:function(){}};b2Pair.b2_nullPair=b2Settings.USHRT_MAX;b2Pair.b2_nullProxy=b2Settings.USHRT_MAX;b2Pair.b2_tableCapacity=b2Settings.b2_maxPairs;b2Pair.b2_tableMask=b2Pair.b2_tableCapacity-1;b2Pair.e_pairBuffered=0x0001;b2Pair.e_pairRemoved=0x0002;b2Pair.e_pairFinal=0x0004;
var b2PairCallback=Class.create();b2PairCallback.prototype={PairAdded:function(proxyUserData1,proxyUserData2){return null},PairRemoved:function(proxyUserData1,proxyUserData2,pairUserData){},initialize:function(){}};
var b2BufferedPair=Class.create();b2BufferedPair.prototype={proxyId1:0,proxyId2:0,initialize:function(){}}

var b2PairManager=Class.create();b2PairManager.prototype={initialize:function(){var i=0;this.m_hashTable=new Array(b2Pair.b2_tableCapacity);for(i=0;i<b2pair.b2_tablecapacity;++i) {this.m_hashtable[i]="b2Pair.b2_nullPair;}" this.m_pairs="new" array(b2settings.b2_maxpairs);for(i="0;i<b2Settings.b2_maxPairs;++i)" {this.m_pairs[i]="new" b2pair();}="" this.m_pairbuffer="new" {this.m_pairbuffer[i]="new" b2bufferedpair();}="" for(i="0;i<b2Settings.b2_maxPairs;++i)" {this.m_pairs[i].proxyid1="b2Pair.b2_nullProxy;this.m_pairs[i].proxyId2=b2Pair.b2_nullProxy;this.m_pairs[i].userData=null;this.m_pairs[i].status=0;this.m_pairs[i].next=(i+1);}" this.m_pairs[b2settings.b2_maxpairs-1].next="b2Pair.b2_nullPair;this.m_pairCount=0;},Initialize:function(broadPhase,callback){this.m_broadPhase=broadPhase;this.m_callback=callback;},AddBufferedPair:function(proxyId1,proxyId2){var" pair="this.AddPair(proxyId1,proxyId2);if(pair.IsBuffered()==false)" {pair.setbuffered();this.m_pairbuffer[this.m_pairbuffercount].proxyid1="pair.proxyId1;this.m_pairBuffer[this.m_pairBufferCount].proxyId2=pair.proxyId2;++this.m_pairBufferCount;}" pair.clearremoved();if(b2broadphase.s_validate)="" {this.validatebuffer();}},removebufferedpair:function(proxyid1,proxyid2){var="" {return;}="" if(pair.isbuffered()="=false)" pair.setremoved();if(b2broadphase.s_validate)="" {this.validatebuffer();}},commit:function(){var="" i="0;var" removecount="0;var" proxies="this.m_broadPhase.m_proxyPool;for(i=0;i<this.m_pairBufferCount;++i)" {var="" proxy1="proxies[pair.proxyId1];var" proxy2="proxies[pair.proxyId2];if(pair.IsRemoved())" {if(pair.isfinal()="=true)" {this.m_callback.pairremoved(proxy1.userdata,proxy2.userdata,pair.userdata);}="" this.m_pairbuffer[removecount].proxyid1="pair.proxyId1;this.m_pairBuffer[removeCount].proxyId2=pair.proxyId2;++removeCount;}" else="" {pair.userdata="this.m_callback.PairAdded(proxy1.userData,proxy2.userData);pair.SetFinal();}}}" {this.removepair(this.m_pairbuffer[i].proxyid1,this.m_pairbuffer[i].proxyid2);}="" this.m_pairbuffercount="0;if(b2BroadPhase.s_validate)" {this.validatetable();}},addpair:function(proxyid1,proxyid2){if(proxyid1="">proxyId2){var temp=proxyId1;proxyId1=proxyId2;proxyId2=temp;}
var hash=b2PairManager.Hash(proxyId1,proxyId2)&b2Pair.b2_tableMask;var pair=pair=this.FindHash(proxyId1,proxyId2,hash);if(pair!=null)
{return pair;}
var pIndex=this.m_freePair;pair=this.m_pairs[pIndex];this.m_freePair=pair.next;pair.proxyId1=proxyId1;pair.proxyId2=proxyId2;pair.status=0;pair.userData=null;pair.next=this.m_hashTable[hash];this.m_hashTable[hash]=pIndex;++this.m_pairCount;return pair;},RemovePair:function(proxyId1,proxyId2){if(proxyId1>proxyId2){var temp=proxyId1;proxyId1=proxyId2;proxyId2=temp;}
var hash=b2PairManager.Hash(proxyId1,proxyId2)&b2Pair.b2_tableMask;var node=this.m_hashTable[hash];var pNode=null;while(node!=b2Pair.b2_nullPair)
{if(b2PairManager.Equals(this.m_pairs[node],proxyId1,proxyId2))
{var index=node;if(pNode){pNode.next=this.m_pairs[node].next;}
else{this.m_hashTable[hash]=this.m_pairs[node].next;}
var pair=this.m_pairs[index];var userData=pair.userData;pair.next=this.m_freePair;pair.proxyId1=b2Pair.b2_nullProxy;pair.proxyId2=b2Pair.b2_nullProxy;pair.userData=null;pair.status=0;this.m_freePair=index;--this.m_pairCount;return userData;}
else
{pNode=this.m_pairs[node];node=pNode.next;}}
return null;},Find:function(proxyId1,proxyId2){if(proxyId1>proxyId2){var temp=proxyId1;proxyId1=proxyId2;proxyId2=temp;}
var hash=b2PairManager.Hash(proxyId1,proxyId2)&b2Pair.b2_tableMask;return this.FindHash(proxyId1,proxyId2,hash);},FindHash:function(proxyId1,proxyId2,hash){var index=this.m_hashTable[hash];while(index!=b2Pair.b2_nullPair&&b2PairManager.Equals(this.m_pairs[index],proxyId1,proxyId2)==false)
{index=this.m_pairs[index].next;}
if(index==b2Pair.b2_nullPair)
{return null;}
return this.m_pairs[index];},ValidateBuffer:function(){},ValidateTable:function(){},m_broadPhase:null,m_callback:null,m_pairs:null,m_freePair:0,m_pairCount:0,m_pairBuffer:null,m_pairBufferCount:0,m_hashTable:null};b2PairManager.Hash=function(proxyId1,proxyId2)
{var key=((proxyId2<<16)&0xffff0000)|proxyid1;key=~key+((key<<15)&0xffff8000);key=key^((key>>12)&0x000fffff);key=key+((key<<2)&0xfffffffc);key=key^((key>>4)&0x0fffffff);key=key*2057;key=key^((key>>16)&0x0000ffff);return key;};b2PairManager.Equals=function(pair,proxyId1,proxyId2)
{return(pair.proxyId1==proxyId1&&pair.proxyId2==proxyId2);};b2PairManager.EqualsPair=function(pair1,pair2)
{return pair1.proxyId1==pair2.proxyId1&&pair1.proxyId2==pair2.proxyId2;};
var b2BroadPhase=Class.create();b2BroadPhase.prototype={initialize:function(worldAABB,callback){this.m_pairManager=new b2PairManager();this.m_proxyPool=new Array(b2Settings.b2_maxPairs);this.m_bounds=new Array(2*b2Settings.b2_maxProxies);this.m_queryResults=new Array(b2Settings.b2_maxProxies);this.m_quantizationFactor=new b2Vec2();var i=0;this.m_pairManager.Initialize(this,callback);this.m_worldAABB=worldAABB;this.m_proxyCount=0;for(i=0;i<b2settings.b2_maxproxies;i++){this.m_queryresults[i]=0;} this.m_bounds="new" array(2);for(i="0;i<2;i++){this.m_bounds[i]=new" array(2*b2settings.b2_maxproxies);for(var="" j="0;j<2*b2Settings.b2_maxProxies;j++){this.m_bounds[i][j]=new" b2bound();}}="" var="" dx="worldAABB.maxVertex.x;var" dy="worldAABB.maxVertex.y;dX-=worldAABB.minVertex.x;dY-=worldAABB.minVertex.y;this.m_quantizationFactor.x=b2Settings.USHRT_MAX/dX;this.m_quantizationFactor.y=b2Settings.USHRT_MAX/dY;var" tproxy;for(i="0;i<b2Settings.b2_maxProxies-1;++i)" {tproxy="new" b2proxy();this.m_proxypool[i]="tProxy;tProxy.SetNext(i+1);tProxy.timeStamp=0;tProxy.overlapCount=b2BroadPhase.b2_invalid;tProxy.userData=null;}" tproxy="new" b2proxy();this.m_proxypool[b2settings.b2_maxproxies-1]="tProxy;tProxy.SetNext(b2Pair.b2_nullProxy);tProxy.timeStamp=0;tProxy.overlapCount=b2BroadPhase.b2_invalid;tProxy.userData=null;this.m_freeProxy=0;this.m_timeStamp=1;this.m_queryResultCount=0;},InRange:function(aabb){var" dx;var="" dy;var="" d2x;var="" d2y;dx="aabb.minVertex.x;dY=aabb.minVertex.y;dX-=this.m_worldAABB.maxVertex.x;dY-=this.m_worldAABB.maxVertex.y;d2X=this.m_worldAABB.minVertex.x;d2Y=this.m_worldAABB.minVertex.y;d2X-=aabb.maxVertex.x;d2Y-=aabb.maxVertex.y;dX=b2Math.b2Max(dX,d2X);dY=b2Math.b2Max(dY,d2Y);return" b2math.b2max(dx,dy)<0.0;},getproxy:function(proxyid){if(proxyid="=b2Pair.b2_nullProxy||this.m_proxyPool[proxyId].IsValid()==false)" {return="" null;}="" return="" this.m_proxypool[proxyid];},createproxy:function(aabb,userdata){var="" index="0;var" proxy;var="" proxyid="this.m_freeProxy;proxy=this.m_proxyPool[proxyId];this.m_freeProxy=proxy.GetNext();proxy.overlapCount=0;proxy.userData=userData;var" boundcount="2*this.m_proxyCount;var" lowervalues="new" array();var="" uppervalues="new" array();this.computebounds(lowervalues,uppervalues,aabb);for(var="" axis="0;axis<2;++axis)" {var="" bounds="this.m_bounds[axis];var" lowerindex="0;var" upperindex="0;var" lowerindexout="[lowerIndex];var" upperindexout="[upperIndex];this.Query(lowerIndexOut,upperIndexOut,lowerValues[axis],upperValues[axis],bounds,boundCount,axis);lowerIndex=lowerIndexOut[0];upperIndex=upperIndexOut[0];var" tarr="new" tend="boundCount-upperIndex" tbound1;var="" tbound2;for(j="0;j<tEnd;j++){tArr[j]=new" b2bound();tbound1="tArr[j];tBound2=bounds[upperIndex+j];tBound1.value=tBound2.value;tBound1.proxyId=tBound2.proxyId;tBound1.stabbingCount=tBound2.stabbingCount;}" tindex="upperIndex+2;for(j=0;j<tEnd;j++){tBound2=tArr[j];tBound1=bounds[tIndex+j]" tbound1.value="tBound2.value;tBound1.proxyId=tBound2.proxyId;tBound1.stabbingCount=tBound2.stabbingCount;}" array();tend="upperIndex-lowerIndex;for(j=0;j<tEnd;j++){tArr[j]=new" ++upperindex;bounds[lowerindex].value="lowerValues[axis];bounds[lowerIndex].proxyId=proxyId;bounds[upperIndex].value=upperValues[axis];bounds[upperIndex].proxyId=proxyId;bounds[lowerIndex].stabbingCount=lowerIndex==0?0:bounds[lowerIndex-1].stabbingCount;bounds[upperIndex].stabbingCount=bounds[upperIndex-1].stabbingCount;for(index=lowerIndex;index<upperIndex;++index)" {bounds[index].stabbingcount++;}="" for(index="lowerIndex;index<boundCount+2;++index)" proxy2="this.m_proxyPool[bounds[index].proxyId];if(bounds[index].IsLower())" {proxy2.lowerbounds[axis]="index;}" else="" {proxy2.upperbounds[axis]="index;}}}" ++this.m_proxycount;for(var="" i="0;i<this.m_queryResultCount;++i)" {this.m_pairmanager.addbufferedpair(proxyid,this.m_queryresults[i]);}="" this.m_pairmanager.commit();this.m_queryresultcount="0;this.IncrementTimeStamp();return" proxyid;},destroyproxy:function(proxyid){var="" proxy="this.m_proxyPool[proxyId];var" lowervalue="bounds[lowerIndex].value;var" uppervalue="bounds[upperIndex].value;var" index2="lowerIndex;index2<tEnd;++index2)" {bounds[index2].stabbingcount--;}="" this.query([0],[0],lowervalue,uppervalue,bounds,boundcount-2,axis);}="" for(var="" {this.m_pairmanager.removebufferedpair(proxyid,this.m_queryresults[i]);}="" bound;var="" prevbound="" nextbound="" nextproxyid="0;var" nextproxy;if(proxyid="=b2Pair.b2_nullProxy||b2Settings.b2_maxProxies<=proxyId)" {return;}="" if(aabb.isvalid()="=false)" newvalues="new" b2boundvalues();this.computebounds(newvalues.lowervalues,newvalues.uppervalues,aabb);var="" oldvalues="new" b2boundvalues();for(axis="0;axis<2;++axis)" {oldvalues.lowervalues[axis]="this.m_bounds[axis][proxy.lowerBounds[axis]].value;oldValues.upperValues[axis]=this.m_bounds[axis][proxy.upperBounds[axis]].value;}" for(axis="0;axis<2;++axis)" deltalower="lowerValue-bounds[lowerIndex].value;var" deltaupper="upperValue-bounds[upperIndex].value;bounds[lowerIndex].value=lowerValue;bounds[upperIndex].value=upperValue;if(deltaLower<0)" {index="lowerIndex;while(index">0&&lowerValue<bounds[index-1].value) {bound="bounds[index];prevBound=bounds[index-1];var" prevproxyid="prevBound.proxyId;var" prevproxy="this.m_proxyPool[prevBound.proxyId];prevBound.stabbingCount++;if(prevBound.IsUpper()==true)" {if(this.testoverlap(newvalues,prevproxy))="" {this.m_pairmanager.addbufferedpair(proxyid,prevproxyid);}="" prevproxy.upperbounds[axis]++;bound.stabbingcount++;}="" else="" {prevproxy.lowerbounds[axis]++;bound.stabbingcount--;}="" proxy.lowerbounds[axis]--;bound.swap(prevbound);--index;}}="" if(deltaupper="">0)
{index=upperIndex;while(index<boundcount-1&&bounds[index+1].value<=uppervalue) {bound="bounds[index];nextBound=bounds[index+1];nextProxyId=nextBound.proxyId;nextProxy=this.m_proxyPool[nextProxyId];nextBound.stabbingCount++;if(nextBound.IsLower()==true)" {if(this.testoverlap(newvalues,nextproxy))="" {this.m_pairmanager.addbufferedpair(proxyid,nextproxyid);}="" nextproxy.lowerbounds[axis]--;bound.stabbingcount++;}="" else="" {nextproxy.upperbounds[axis]--;bound.stabbingcount--;}="" proxy.upperbounds[axis]++;bound.swap(nextbound);index++;}}="" if(deltalower="">0)
{index=lowerIndex;while(index<boundcount-1&&bounds[index+1].value<=lowervalue) {bound="bounds[index];nextBound=bounds[index+1];nextProxyId=nextBound.proxyId;nextProxy=this.m_proxyPool[nextProxyId];nextBound.stabbingCount--;if(nextBound.IsUpper())" {if(this.testoverlap(oldvalues,nextproxy))="" {this.m_pairmanager.removebufferedpair(proxyid,nextproxyid);}="" nextproxy.upperbounds[axis]--;bound.stabbingcount--;}="" else="" {nextproxy.lowerbounds[axis]--;bound.stabbingcount++;}="" proxy.lowerbounds[axis]++;bound.swap(nextbound);index++;}}="" if(deltaupper<0)="" {index="upperIndex;while(index">0&&upperValue<bounds[index-1].value) {bound="bounds[index];prevBound=bounds[index-1];prevProxyId=prevBound.proxyId;prevProxy=this.m_proxyPool[prevProxyId];prevBound.stabbingCount--;if(prevBound.IsLower()==true)" {if(this.testoverlap(oldvalues,prevproxy))="" {this.m_pairmanager.removebufferedpair(proxyid,prevproxyid);}="" prevproxy.lowerbounds[axis]++;bound.stabbingcount--;}="" else="" {prevproxy.upperbounds[axis]++;bound.stabbingcount++;}="" proxy.upperbounds[axis]--;bound.swap(prevbound);index--;}}}},commit:function(){this.m_pairmanager.commit();},queryaabb:function(aabb,userdata,maxcount){var="" lowervalues="new" array();var="" uppervalues="new" array();this.computebounds(lowervalues,uppervalues,aabb);var="" lowerindex="0;var" upperindex="0;var" lowerindexout="[lowerIndex];var" upperindexout="[upperIndex];this.Query(lowerIndexOut,upperIndexOut,lowerValues[0],upperValues[0],this.m_bounds[0],2*this.m_proxyCount,0);this.Query(lowerIndexOut,upperIndexOut,lowerValues[1],upperValues[1],this.m_bounds[1],2*this.m_proxyCount,1);var" count="0;for(var" i="0;i<this.m_queryResultCount&&count<maxCount;++i,++count)" {var="" proxy="this.m_proxyPool[this.m_queryResults[i]];userData[i]=proxy.userData;}" this.m_queryresultcount="0;this.IncrementTimeStamp();return" count;},validate:function(){var="" pair;var="" proxy1;var="" proxy2;var="" overlap;for(var="" axis="0;axis<2;++axis)" bounds="this.m_bounds[axis];var" boundcount="2*this.m_proxyCount;var" stabbingcount="0;for(var" bound="bounds[i];if(bound.IsLower()==true)" {stabbingcount++;}="" {stabbingcount--;}}}},computebounds:function(lowervalues,uppervalues,aabb)="" minvertexx="aabb.minVertex.x;var" minvertexy="aabb.minVertex.y;minVertexX=b2Math.b2Min(minVertexX,this.m_worldAABB.maxVertex.x);minVertexY=b2Math.b2Min(minVertexY,this.m_worldAABB.maxVertex.y);minVertexX=b2Math.b2Max(minVertexX,this.m_worldAABB.minVertex.x);minVertexY=b2Math.b2Max(minVertexY,this.m_worldAABB.minVertex.y);var" maxvertexx="aabb.maxVertex.x;var" maxvertexy="aabb.maxVertex.y;maxVertexX=b2Math.b2Min(maxVertexX,this.m_worldAABB.maxVertex.x);maxVertexY=b2Math.b2Min(maxVertexY,this.m_worldAABB.maxVertex.y);maxVertexX=b2Math.b2Max(maxVertexX,this.m_worldAABB.minVertex.x);maxVertexY=b2Math.b2Max(maxVertexY,this.m_worldAABB.minVertex.y);lowerValues[0]=(this.m_quantizationFactor.x*(minVertexX-this.m_worldAABB.minVertex.x))&(b2Settings.USHRT_MAX-1);upperValues[0]=((this.m_quantizationFactor.x*(maxVertexX-this.m_worldAABB.minVertex.x))&0x0000ffff)|1;lowerValues[1]=(this.m_quantizationFactor.y*(minVertexY-this.m_worldAABB.minVertex.y))&(b2Settings.USHRT_MAX-1);upperValues[1]=((this.m_quantizationFactor.y*(maxVertexY-this.m_worldAABB.minVertex.y))&0x0000ffff)|1;},TestOverlapValidate:function(p1,p2){for(var">bounds[p2.upperBounds[axis]].value)
return false;if(bounds[p1.upperBounds[axis]].value<bounds[p2.lowerbounds[axis]].value) return="" false;}="" true;},testoverlap:function(b,p)="" {for(var="" axis="0;axis<2;++axis)" {var="" bounds="this.m_bounds[axis];if(b.lowerValues[axis]">bounds[p.upperBounds[axis]].value)
return false;if(b.upperValues[axis]<bounds[p.lowerbounds[axis]].value) return="" false;}="" true;},query:function(lowerqueryout,upperqueryout,lowervalue,uppervalue,bounds,boundcount,axis){var="" lowerquery="b2BroadPhase.BinarySearch(bounds,boundCount,lowerValue);var" upperquery="b2BroadPhase.BinarySearch(bounds,boundCount,upperValue);for(var" j="lowerQuery;j<upperQuery;++j)" {if(bounds[j].islower())="" {this.incrementoverlapcount(bounds[j].proxyid);}}="" if(lowerquery="">0)
{var i=lowerQuery-1;var s=bounds[i].stabbingCount;while(s)
{if(bounds[i].IsLower())
{var proxy=this.m_proxyPool[bounds[i].proxyId];if(lowerQuery<=proxy.upperbounds[axis]) {this.incrementoverlapcount(bounds[i].proxyid);--s;}}="" --i;}}="" lowerqueryout[0]="lowerQuery;upperQueryOut[0]=upperQuery;},IncrementOverlapCount:function(proxyId){var" proxy="this.m_proxyPool[proxyId];if(proxy.timeStamp<this.m_timeStamp)" {proxy.timestamp="this.m_timeStamp;proxy.overlapCount=1;}" else="" {proxy.overlapcount="2;this.m_queryResults[this.m_queryResultCount]=proxyId;++this.m_queryResultCount;}},IncrementTimeStamp:function(){if(this.m_timeStamp==b2Settings.USHRT_MAX)" {for(var="" i="0;i<b2Settings.b2_maxProxies;++i)" {this.m_proxypool[i].timestamp="0;}" this.m_timestamp="1;}" {++this.m_timestamp;}},m_pairmanager:new="" b2pairmanager(),m_proxypool:new="" array(b2settings.b2_maxpairs),m_freeproxy:0,m_bounds:new="" array(2*b2settings.b2_maxproxies),m_queryresults:new="" array(b2settings.b2_maxproxies),m_queryresultcount:0,m_worldaabb:null,m_quantizationfactor:new="" b2vec2(),m_proxycount:0,m_timestamp:0};b2broadphase.s_validate="false;b2BroadPhase.b2_invalid=b2Settings.USHRT_MAX;b2BroadPhase.b2_nullEdge=b2Settings.USHRT_MAX;b2BroadPhase.BinarySearch=function(bounds,count,value)" {var="" low="0;var" high="count-1;while(low<=high)" mid="Math.floor((low+high)/2);if(bounds[mid].value">value)
{high=mid-1;}
else if(bounds[mid].value<value) {low="mid+1;}" else="" {return(mid);}}="" return(low);};="" var="" b2collision="Class.create();b2Collision.prototype={initialize:function(){}}" b2collision.b2_nullfeature="0x000000ff;b2Collision.ClipSegmentToLine=function(vOut,vIn,normal,offset)" {var="" numout="0;var" vin0="vIn[0].v;var" vin1="vIn[1].v;var" distance0="b2Math.b2Dot(normal,vIn[0].v)-offset;var" distance1="b2Math.b2Dot(normal,vIn[1].v)-offset;if(distance0<=0.0)vOut[numOut++]=vIn[0];if(distance1<=0.0)vOut[numOut++]=vIn[1];if(distance0*distance1<0.0)" interp="distance0/(distance0-distance1);var" tvec="vOut[numOut].v;tVec.x=vIn0.x+interp*(vIn1.x-vIn0.x);tVec.y=vIn0.y+interp*(vIn1.y-vIn0.y);if(distance0">0.0)
{vOut[numOut].id=vIn[0].id;}
else
{vOut[numOut].id=vIn[1].id;}
++numOut;}
return numOut;};b2Collision.EdgeSeparation=function(poly1,edge1,poly2)
{var vert1s=poly1.m_vertices;var count2=poly2.m_vertexCount;var vert2s=poly2.m_vertices;var normalX=poly1.m_normals[edge1].x;var normalY=poly1.m_normals[edge1].y;var tX=normalX;var tMat=poly1.m_R;normalX=tMat.col1.x*tX+tMat.col2.x*normalY;normalY=tMat.col1.y*tX+tMat.col2.y*normalY;var normalLocal2X=normalX;var normalLocal2Y=normalY;tMat=poly2.m_R;tX=normalLocal2X*tMat.col1.x+normalLocal2Y*tMat.col1.y;normalLocal2Y=normalLocal2X*tMat.col2.x+normalLocal2Y*tMat.col2.y;normalLocal2X=tX;var vertexIndex2=0;var minDot=Number.MAX_VALUE;for(var i=0;i<count2;++i) {var="" tvec="vert2s[i];var" dot="tVec.x*normalLocal2X+tVec.y*normalLocal2Y;if(dot<minDot)" {mindot="dot;vertexIndex2=i;}}" tmat="poly1.m_R;var" v1x="poly1.m_position.x+(tMat.col1.x*vert1s[edge1].x+tMat.col2.x*vert1s[edge1].y)" var="" v1y="poly1.m_position.y+(tMat.col1.y*vert1s[edge1].x+tMat.col2.y*vert1s[edge1].y)" v2x="poly2.m_position.x+(tMat.col1.x*vert2s[vertexIndex2].x+tMat.col2.x*vert2s[vertexIndex2].y)" v2y="poly2.m_position.y+(tMat.col1.y*vert2s[vertexIndex2].x+tMat.col2.y*vert2s[vertexIndex2].y)" v2x-="v1X;v2Y-=v1Y;var" separation="v2X*normalX+v2Y*normalY;return" separation;};b2collision.findmaxseparation="function(edgeIndex,poly1,poly2,conservative)" count1="poly1.m_vertexCount;var" dx="poly2.m_position.x-poly1.m_position.x;var" dy="poly2.m_position.y-poly1.m_position.y;var" dlocal1x="(dX*poly1.m_R.col1.x+dY*poly1.m_R.col1.y);var" dlocal1y="(dX*poly1.m_R.col2.x+dY*poly1.m_R.col2.y);var" edge="0;var" maxdot="-Number.MAX_VALUE;for(var" i="0;i<count1;++i)">maxDot)
{maxDot=dot;edge=i;}}
var s=b2Collision.EdgeSeparation(poly1,edge,poly2);if(s>0.0&&conservative==false)
{return s;}
var prevEdge=edge-1>=0?edge-1:count1-1;var sPrev=b2Collision.EdgeSeparation(poly1,prevEdge,poly2);if(sPrev>0.0&&conservative==false)
{return sPrev;}
var nextEdge=edge+1<count1?edge+1:0;var snext="b2Collision.EdgeSeparation(poly1,nextEdge,poly2);if(sNext">0.0&&conservative==false)
{return sNext;}
var bestEdge=0;var bestSeparation;var increment=0;if(sPrev>s&&sPrev>sNext)
{increment=-1;bestEdge=prevEdge;bestSeparation=sPrev;}
else if(sNext>s)
{increment=1;bestEdge=nextEdge;bestSeparation=sNext;}
else
{edgeIndex[0]=edge;return s;}
while(true)
{if(increment==-1)
edge=bestEdge-1>=0?bestEdge-1:count1-1;else
edge=bestEdge+1<count1?bestedge+1:0;s=b2collision.edgeseparation(poly1,edge,poly2);if(s>0.0&&conservative==false)
{return s;}
if(s>bestSeparation)
{bestEdge=edge;bestSeparation=s;}
else
{break;}}
edgeIndex[0]=bestEdge;return bestSeparation;};b2Collision.FindIncidentEdge=function(c,poly1,edge1,poly2)
{var count1=poly1.m_vertexCount;var vert1s=poly1.m_vertices;var count2=poly2.m_vertexCount;var vert2s=poly2.m_vertices;var vertex11=edge1;var vertex12=edge1+1==count1?0:edge1+1;var tVec=vert1s[vertex12];var normal1Local1X=tVec.x;var normal1Local1Y=tVec.y;tVec=vert1s[vertex11];normal1Local1X-=tVec.x;normal1Local1Y-=tVec.y;var tX=normal1Local1X;normal1Local1X=normal1Local1Y;normal1Local1Y=-tX;var invLength=1.0/Math.sqrt(normal1Local1X*normal1Local1X+normal1Local1Y*normal1Local1Y);normal1Local1X*=invLength;normal1Local1Y*=invLength;var normal1X=normal1Local1X;var normal1Y=normal1Local1Y;tX=normal1X;var tMat=poly1.m_R;normal1X=tMat.col1.x*tX+tMat.col2.x*normal1Y;normal1Y=tMat.col1.y*tX+tMat.col2.y*normal1Y;var normal1Local2X=normal1X;var normal1Local2Y=normal1Y;tMat=poly2.m_R;tX=normal1Local2X*tMat.col1.x+normal1Local2Y*tMat.col1.y;normal1Local2Y=normal1Local2X*tMat.col2.x+normal1Local2Y*tMat.col2.y;normal1Local2X=tX;var vertex21=0;var vertex22=0;var minDot=Number.MAX_VALUE;for(var i=0;i<count2;++i) {var="" i1="i;var" i2="i+1<count2?i+1:0;tVec=vert2s[i2];var" normal2local2x="tVec.x;var" normal2local2y="tVec.y;tVec=vert2s[i1];normal2Local2X-=tVec.x;normal2Local2Y-=tVec.y;tX=normal2Local2X;normal2Local2X=normal2Local2Y;normal2Local2Y=-tX;invLength=1.0/Math.sqrt(normal2Local2X*normal2Local2X+normal2Local2Y*normal2Local2Y);normal2Local2X*=invLength;normal2Local2Y*=invLength;var" dot="normal2Local2X*normal1Local2X+normal2Local2Y*normal1Local2Y;if(dot<minDot)" {mindot="dot;vertex21=i1;vertex22=i2;}}" var="" tclip;tclip="c[0];tVec=tClip.v;tVec.SetV(vert2s[vertex21]);tVec.MulM(poly2.m_R);tVec.Add(poly2.m_position);tClip.id.features.referenceFace=edge1;tClip.id.features.incidentEdge=vertex21;tClip.id.features.incidentVertex=vertex21;tClip=c[1];tVec=tClip.v;tVec.SetV(vert2s[vertex22]);tVec.MulM(poly2.m_R);tVec.Add(poly2.m_position);tClip.id.features.referenceFace=edge1;tClip.id.features.incidentEdge=vertex21;tClip.id.features.incidentVertex=vertex22;};b2Collision.b2CollidePolyTempVec=new" b2vec2();b2collision.b2collidepoly="function(manifold,polyA,polyB,conservative)" {manifold.pointcount="0;var" edgea="0;var" edgeaout="[edgeA];var" separationa="b2Collision.FindMaxSeparation(edgeAOut,polyA,polyB,conservative);edgeA=edgeAOut[0];if(separationA">0.0&&conservative==false)
return;var edgeB=0;var edgeBOut=[edgeB];var separationB=b2Collision.FindMaxSeparation(edgeBOut,polyB,polyA,conservative);edgeB=edgeBOut[0];if(separationB>0.0&&conservative==false)
return;var poly1;var poly2;var edge1=0;var flip=0;var k_relativeTol=0.98;var k_absoluteTol=0.001;if(separationB>k_relativeTol*separationA+k_absoluteTol)
{poly1=polyB;poly2=polyA;edge1=edgeB;flip=1;}
else
{poly1=polyA;poly2=polyB;edge1=edgeA;flip=0;}
var incidentEdge=[new ClipVertex(),new ClipVertex()];b2Collision.FindIncidentEdge(incidentEdge,poly1,edge1,poly2);var count1=poly1.m_vertexCount;var vert1s=poly1.m_vertices;var v11=vert1s[edge1];var v12=edge1+1<count1?vert1s[edge1+1]:vert1s[0];var dvx="v12.x-v11.x;var" dvy="v12.y-v11.y;var" sidenormalx="v12.x-v11.x;var" sidenormaly="v12.y-v11.y;var" tx="sideNormalX;var" tmat="poly1.m_R;sideNormalX=tMat.col1.x*tX+tMat.col2.x*sideNormalY;sideNormalY=tMat.col1.y*tX+tMat.col2.y*sideNormalY;var" invlength="1.0/Math.sqrt(sideNormalX*sideNormalX+sideNormalY*sideNormalY);sideNormalX*=invLength;sideNormalY*=invLength;var" frontnormalx="sideNormalX;var" frontnormaly="sideNormalY;tX=frontNormalX;frontNormalX=frontNormalY;frontNormalY=-tX;var" v11x="v11.x;var" v11y="v11.y;tX=v11X;tMat=poly1.m_R;v11X=tMat.col1.x*tX+tMat.col2.x*v11Y;v11Y=tMat.col1.y*tX+tMat.col2.y*v11Y;v11X+=poly1.m_position.x;v11Y+=poly1.m_position.y;var" v12x="v12.x;var" v12y="v12.y;tX=v12X;tMat=poly1.m_R;v12X=tMat.col1.x*tX+tMat.col2.x*v12Y;v12Y=tMat.col1.y*tX+tMat.col2.y*v12Y;v12X+=poly1.m_position.x;v12Y+=poly1.m_position.y;var" frontoffset="frontNormalX*v11X+frontNormalY*v11Y;var" sideoffset1="-(sideNormalX*v11X+sideNormalY*v11Y);var" sideoffset2="sideNormalX*v12X+sideNormalY*v12Y;var" clippoints1="[new" clipvertex(),new="" clipvertex()];var="" clippoints2="[new" np="0;b2Collision.b2CollidePolyTempVec.Set(-sideNormalX,-sideNormalY);np=b2Collision.ClipSegmentToLine(clipPoints1,incidentEdge,b2Collision.b2CollidePolyTempVec,sideOffset1);if(np<2)" return;b2collision.b2collidepolytempvec.set(sidenormalx,sidenormaly);np="b2Collision.ClipSegmentToLine(clipPoints2,clipPoints1,b2Collision.b2CollidePolyTempVec,sideOffset2);if(np<2)" return;if(flip){manifold.normal.set(-frontnormalx,-frontnormaly);}="" else{manifold.normal.set(frontnormalx,frontnormaly);}="" var="" pointcount="0;for(var" i="0;i<b2Settings.b2_maxManifoldPoints;++i)" {var="" tvec="clipPoints2[i].v;var" separation="(frontNormalX*tVec.x+frontNormalY*tVec.y)-frontOffset;if(separation<=0.0||conservative==true)" cp="manifold.points[pointCount];cp.separation=separation;cp.position.SetV(clipPoints2[i].v);cp.id.Set(clipPoints2[i].id);cp.id.features.flip=flip;++pointCount;}}" manifold.pointcount="pointCount;};b2Collision.b2CollideCircle=function(manifold,circle1,circle2,conservative)" {manifold.pointcount="0;var" dx="circle2.m_position.x-circle1.m_position.x;var" dy="circle2.m_position.y-circle1.m_position.y;var" distsqr="dX*dX+dY*dY;var" radiussum="circle1.m_radius+circle2.m_radius;if(distSqr">radiusSum*radiusSum&&conservative==false)
{return;}
var separation;if(distSqr<number.min_value) {separation="-radiusSum;manifold.normal.Set(0.0,1.0);}" else="" {var="" dist="Math.sqrt(distSqr);separation=dist-radiusSum;var" a="1.0/dist;manifold.normal.x=a*dX;manifold.normal.y=a*dY;}" manifold.pointcount="1;var" tpoint="manifold.points[0];tPoint.id.set_key(0);tPoint.separation=separation;tPoint.position.x=circle2.m_position.x-(circle2.m_radius*manifold.normal.x);tPoint.position.y=circle2.m_position.y-(circle2.m_radius*manifold.normal.y);};b2Collision.b2CollidePolyAndCircle=function(manifold,poly,circle,conservative)" {manifold.pointcount="0;var" tpoint;var="" dx;var="" dy;var="" xlocalx="circle.m_position.x-poly.m_position.x;var" xlocaly="circle.m_position.y-poly.m_position.y;var" tmat="poly.m_R;var" tx="xLocalX*tMat.col1.x+xLocalY*tMat.col1.y;xLocalY=xLocalX*tMat.col2.x+xLocalY*tMat.col2.y;xLocalX=tX;var" dist;var="" normalindex="0;var" separation="-Number.MAX_VALUE;var" radius="circle.m_radius;for(var" i="0;i<poly.m_vertexCount;++i)" s="poly.m_normals[i].x*(xLocalX-poly.m_vertices[i].x)+poly.m_normals[i].y*(xLocalY-poly.m_vertices[i].y);if(s">radius)
{return;}
if(s>separation)
{separation=s;normalIndex=i;}}
if(separation<number.min_value) {manifold.pointcount="1;var" tvec="poly.m_normals[normalIndex];manifold.normal.x=tMat.col1.x*tVec.x+tMat.col2.x*tVec.y;manifold.normal.y=tMat.col1.y*tVec.x+tMat.col2.y*tVec.y;tPoint=manifold.points[0];tPoint.id.features.incidentEdge=normalIndex;tPoint.id.features.incidentVertex=b2Collision.b2_nullFeature;tPoint.id.features.referenceFace=b2Collision.b2_nullFeature;tPoint.id.features.flip=0;tPoint.position.x=circle.m_position.x-radius*manifold.normal.x;tPoint.position.y=circle.m_position.y-radius*manifold.normal.y;tPoint.separation=separation-radius;return;}" var="" vertindex1="normalIndex;var" vertindex2="vertIndex1+1<poly.m_vertexCount?vertIndex1+1:0;var" ex="poly.m_vertices[vertIndex2].x-poly.m_vertices[vertIndex1].x;var" ey="poly.m_vertices[vertIndex2].y-poly.m_vertices[vertIndex1].y;var" length="Math.sqrt(eX*eX+eY*eY);eX/=length;eY/=length;if(length<Number.MIN_VALUE)" {dx="xLocalX-poly.m_vertices[vertIndex1].x;dY=xLocalY-poly.m_vertices[vertIndex1].y;dist=Math.sqrt(dX*dX+dY*dY);dX/=dist;dY/=dist;if(dist">radius)
{return;}
manifold.pointCount=1;manifold.normal.Set(tMat.col1.x*dX+tMat.col2.x*dY,tMat.col1.y*dX+tMat.col2.y*dY);tPoint=manifold.points[0];tPoint.id.features.incidentEdge=b2Collision.b2_nullFeature;tPoint.id.features.incidentVertex=vertIndex1;tPoint.id.features.referenceFace=b2Collision.b2_nullFeature;tPoint.id.features.flip=0;tPoint.position.x=circle.m_position.x-radius*manifold.normal.x;tPoint.position.y=circle.m_position.y-radius*manifold.normal.y;tPoint.separation=dist-radius;return;}
var u=(xLocalX-poly.m_vertices[vertIndex1].x)*eX+(xLocalY-poly.m_vertices[vertIndex1].y)*eY;tPoint=manifold.points[0];tPoint.id.features.incidentEdge=b2Collision.b2_nullFeature;tPoint.id.features.incidentVertex=b2Collision.b2_nullFeature;tPoint.id.features.referenceFace=b2Collision.b2_nullFeature;tPoint.id.features.flip=0;var pX,pY;if(u<=0.0) {px="poly.m_vertices[vertIndex1].x;pY=poly.m_vertices[vertIndex1].y;tPoint.id.features.incidentVertex=vertIndex1;}" else="" if(u="">=length)
{pX=poly.m_vertices[vertIndex2].x;pY=poly.m_vertices[vertIndex2].y;tPoint.id.features.incidentVertex=vertIndex2;}
else
{pX=eX*u+poly.m_vertices[vertIndex1].x;pY=eY*u+poly.m_vertices[vertIndex1].y;tPoint.id.features.incidentEdge=vertIndex1;}
dX=xLocalX-pX;dY=xLocalY-pY;dist=Math.sqrt(dX*dX+dY*dY);dX/=dist;dY/=dist;if(dist>radius)
{return;}
manifold.pointCount=1;manifold.normal.Set(tMat.col1.x*dX+tMat.col2.x*dY,tMat.col1.y*dX+tMat.col2.y*dY);tPoint.position.x=circle.m_position.x-radius*manifold.normal.x;tPoint.position.y=circle.m_position.y-radius*manifold.normal.y;tPoint.separation=dist-radius;};b2Collision.b2TestOverlap=function(a,b)
{var t1=b.minVertex;var t2=a.maxVertex;var d1X=t1.x-t2.x;var d1Y=t1.y-t2.y;t1=a.minVertex;t2=b.maxVertex;var d2X=t1.x-t2.x;var d2Y=t1.y-t2.y;if(d1X>0.0||d1Y>0.0)
return false;if(d2X>0.0||d2Y>0.0)
return false;return true;};
var Features=Class.create();Features.prototype={set_referenceFace:function(value){this._referenceFace=value;this._m_id._key=(this._m_id._key&0xffffff00)|(this._referenceFace&0x000000ff)},get_referenceFace:function(){return this._referenceFace;},_referenceFace:0,set_incidentEdge:function(value){this._incidentEdge=value;this._m_id._key=(this._m_id._key&0xffff00ff)|((this._incidentEdge<<8)&0x0000ff00)},get_incidentedge:function(){return this._incidentedge;},_incidentedge:0,set_incidentvertex:function(value){this._incidentvertex="value;this._m_id._key=(this._m_id._key&0xff00ffff)|((this._incidentVertex<<16)&0x00ff0000)},get_incidentVertex:function(){return" this._incidentvertex;},_incidentvertex:0,set_flip:function(value){this._flip="value;this._m_id._key=(this._m_id._key&0x00ffffff)|((this._flip<<24)&0xff000000)},get_flip:function(){return" this._flip;},_flip:0,_m_id:null,initialize:function(){}};="" var="" b2contactid="Class.create();b2ContactID.prototype={initialize:function(){this.features=new" features();this.features._m_id="this;},Set:function(id){this.set_key(id._key);},Copy:function(){var" id="new" b2contactid();id.set_key(this._key);return="" id;},get_key:function(){return="" this._key;},set_key:function(value){this._key="value;this.features._referenceFace=this._key&0x000000ff;this.features._incidentEdge=((this._key&0x0000ff00)">>8)&0x000000ff;this.features._incidentVertex=((this._key&0x00ff0000)>>16)&0x000000ff;this.features._flip=((this._key&0xff000000)>>24)&0x000000ff;},features:new Features(),_key:0};
var b2ContactPoint=Class.create();b2ContactPoint.prototype={position:new b2Vec2(),separation:null,normalImpulse:null,tangentImpulse:null,id:new b2ContactID(),initialize:function(){this.position=new b2Vec2();this.id=new b2ContactID();}};var b2Distance=Class.create();b2Distance.prototype={initialize:function(){}};b2Distance.ProcessTwo=function(p1Out,p2Out,p1s,p2s,points)
{var rX=-points[1].x;var rY=-points[1].y;var dX=points[0].x-points[1].x;var dY=points[0].y-points[1].y;var length=Math.sqrt(dX*dX+dY*dY);dX/=length;dY/=length;var lambda=rX*dX+rY*dY;if(lambda<=0.0||length<number.min_value) {p1out.setv(p1s[1]);p2out.setv(p2s[1]);p1s[0].setv(p1s[1]);p2s[0].setv(p2s[1]);points[0].setv(points[1]);return="" 1;}="" lambda="" =length;p1out.x="p1s[1].x+lambda*(p1s[0].x-p1s[1].x);p1Out.y=p1s[1].y+lambda*(p1s[0].y-p1s[1].y);p2Out.x=p2s[1].x+lambda*(p2s[0].x-p2s[1].x);p2Out.y=p2s[1].y+lambda*(p2s[0].y-p2s[1].y);return" 2;};b2distance.processthree="function(p1Out,p2Out,p1s,p2s,points)" {var="" ax="points[0].x;var" ay="points[0].y;var" bx="points[1].x;var" by="points[1].y;var" cx="points[2].x;var" cy="points[2].y;var" abx="bX-aX;var" aby="bY-aY;var" acx="cX-aX;var" acy="cY-aY;var" bcx="cX-bX;var" bcy="cY-bY;var" sn="-(aX*abX+aY*abY);var" sd="(bX*abX+bY*abY);var" tn="-(aX*acX+aY*acY);var" td="(cX*acX+cY*acY);var" un="-(bX*bcX+bY*bcY);var" ud="(cX*bcX+cY*bcY);if(td<=0.0&&ud<=0.0)" {p1out.setv(p1s[2]);p2out.setv(p2s[2]);p1s[0].setv(p1s[2]);p2s[0].setv(p2s[2]);points[0].setv(points[2]);return="" var="" n="abX*acY-abY*acX;var" vc="n*(aX*bY-aY*bX);var" va="n*(bX*cY-bY*cX);if(va<=0.0&&un">=0.0&&ud>=0.0)
{var lambda=un/(un+ud);p1Out.x=p1s[1].x+lambda*(p1s[2].x-p1s[1].x);p1Out.y=p1s[1].y+lambda*(p1s[2].y-p1s[1].y);p2Out.x=p2s[1].x+lambda*(p2s[2].x-p2s[1].x);p2Out.y=p2s[1].y+lambda*(p2s[2].y-p2s[1].y);p1s[0].SetV(p1s[2]);p2s[0].SetV(p2s[2]);points[0].SetV(points[2]);return 2;}
var vb=n*(cX*aY-cY*aX);if(vb<=0.0&&tn>=0.0&&td>=0.0)
{var lambda=tn/(tn+td);p1Out.x=p1s[0].x+lambda*(p1s[2].x-p1s[0].x);p1Out.y=p1s[0].y+lambda*(p1s[2].y-p1s[0].y);p2Out.x=p2s[0].x+lambda*(p2s[2].x-p2s[0].x);p2Out.y=p2s[0].y+lambda*(p2s[2].y-p2s[0].y);p1s[1].SetV(p1s[2]);p2s[1].SetV(p2s[2]);points[1].SetV(points[2]);return 2;}
var denom=va+vb+vc;denom=1.0/denom;var u=va*denom;var v=vb*denom;var w=1.0-u-v;p1Out.x=u*p1s[0].x+v*p1s[1].x+w*p1s[2].x;p1Out.y=u*p1s[0].y+v*p1s[1].y+w*p1s[2].y;p2Out.x=u*p2s[0].x+v*p2s[1].x+w*p2s[2].x;p2Out.y=u*p2s[0].y+v*p2s[1].y+w*p2s[2].y;return 3;};b2Distance.InPoinsts=function(w,points,pointCount)
{for(var i=0;i<pointcount;++i) {if(w.x="=points[i].x&&w.y==points[i].y)" {return="" true;}}="" return="" false;};b2distance.distance="function(p1Out,p2Out,shape1,shape2)" {var="" p1s="new" array(3);var="" p2s="new" points="new" pointcount="0;p1Out.SetV(shape1.m_position);p2Out.SetV(shape2.m_position);var" vsqr="0.0;var" maxiterations="20;for(var" iter="0;iter<maxIterations;++iter)" vx="p2Out.x-p1Out.x;var" vy="p2Out.y-p1Out.y;var" w1="shape1.Support(vX,vY);var" w2="shape2.Support(-vX,-vY);vSqr=(vX*vX+vY*vY);var" wx="w2.x-w1.x;var" wy="w2.y-w1.y;var" vw="(vX*wX+vY*wY);if(vSqr-b2Dot(vX*wX+vY*wY)<=0.01*vSqr)" {if(pointcount="=0)" {p1out.setv(w1);p2out.setv(w2);}="" b2distance.g_gjk_iterations="iter;return" math.sqrt(vsqr);}="" switch(pointcount)="" {case="" 0:p1s[0].setv(w1);p2s[0].setv(w2);points[0]="w;p1Out.SetV(p1s[0]);p2Out.SetV(p2s[0]);++pointCount;break;case" 1:p1s[1].setv(w1);p2s[1].setv(w2);points[1].x="wX;points[1].y=wY;pointCount=b2Distance.ProcessTwo(p1Out,p2Out,p1s,p2s,points);break;case" 2:p1s[2].setv(w1);p2s[2].setv(w2);points[2].x="wX;points[2].y=wY;pointCount=b2Distance.ProcessThree(p1Out,p2Out,p1s,p2s,points);break;}" if(pointcount="=3)" {b2distance.g_gjk_iterations="iter;return" 0.0;}="" var="" maxsqr="-Number.MAX_VALUE;for(var" i="0;i<pointCount;++i)" {maxsqr="b2Math.b2Max(maxSqr,(points[i].x*points[i].x+points[i].y*points[i].y));}" math.sqrt(vsqr);}}="" math.sqrt(vsqr);};b2distance.g_gjk_iterations="0;" b2manifold="Class.create();b2Manifold.prototype={initialize:function(){this.points=new" array(b2settings.b2_maxmanifoldpoints);for(var="" b2contactpoint();}="" this.normal="new" b2vec2();},points:null,normal:null,pointcount:0};="" b2obb="Class.create();b2OBB.prototype={R:new" b2mat22(),center:new="" b2vec2(),extents:new="" b2vec2(),initialize:function(){this.r="new" b2mat22();this.center="new" b2vec2();this.extents="new" b2vec2();}};="" b2proxy="Class.create();b2Proxy.prototype={GetNext:function(){return" this.lowerbounds[0];},setnext:function(next){this.lowerbounds[0]="next;},IsValid:function(){return" this.overlapcount!="b2BroadPhase.b2_invalid;},lowerBounds:[(0),(0)],upperBounds:[(0),(0)],overlapCount:0,timeStamp:0,userData:null,initialize:function(){this.lowerBounds=[(0),(0)];this.upperBounds=[(0),(0)];}}" clipvertex="Class.create();ClipVertex.prototype={v:new" b2vec2(),id:new="" b2contactid(),initialize:function(){this.v="new" b2vec2();this.id="new" b2contactid();}};var="" b2shape="Class.create();b2Shape.prototype={TestPoint:function(p){return" false},getuserdata:function(){return="" this.m_userdata;},gettype:function(){return="" this.m_type;},getbody:function(){return="" this.m_body;},getposition:function(){return="" this.m_position;},getrotationmatrix:function(){return="" this.m_r;},resetproxy:function(broadphase){},getnext:function(){return="" this.m_next;},initialize:function(def,body){this.m_r="new" b2mat22();this.m_position="new" b2vec2();this.m_userdata="def.userData;this.m_friction=def.friction;this.m_restitution=def.restitution;this.m_body=body;this.m_proxyId=b2Pair.b2_nullProxy;this.m_maxRadius=0.0;this.m_categoryBits=def.categoryBits;this.m_maskBits=def.maskBits;this.m_groupIndex=def.groupIndex;},DestroyProxy:function()" {if(this.m_proxyid!="b2Pair.b2_nullProxy)" {this.m_body.m_world.m_broadphase.destroyproxy(this.m_proxyid);this.m_proxyid="b2Pair.b2_nullProxy;}},Synchronize:function(position1,R1,position2,R2){},QuickSync:function(position,R){},Support:function(dX,dY,out){},GetMaxRadius:function(){return" this.m_maxradius;},m_next:null,m_r:new="" b2mat22(),m_position:new="" b2vec2(),m_type:0,m_userdata:null,m_body:null,m_friction:null,m_restitution:null,m_maxradius:null,m_proxyid:0,m_categorybits:0,m_maskbits:0,m_groupindex:0};b2shape.create="function(def,body,center){switch(def.type)" b2shape.e_circleshape:{return="" new="" b2circleshape(def,body,center);}="" case="" b2shape.e_boxshape:case="" b2shape.e_polyshape:{return="" b2polyshape(def,body,center);}}="" null;};b2shape.destroy="function(shape)" {if(shape.m_proxyid!="b2Pair.b2_nullProxy)" shape.m_body.m_world.m_broadphase.destroyproxy(shape.m_proxyid);};b2shape.e_unknownshape="-1;b2Shape.e_circleShape=0;b2Shape.e_boxShape=1;b2Shape.e_polyShape=2;b2Shape.e_meshShape=3;b2Shape.e_shapeTypeCount=4;b2Shape.PolyMass=function(massData,vs,count,rho)" center="new" b2vec2();center.setzero();var="" area="0.0;var" pref="new" b2vec2(0.0,0.0);var="" inv3="1.0/3.0;for(var" p1="pRef;var" p2="vs[i];var" p3="i+1<count?vs[i+1]:vs[0];var" e1="b2Math.SubtractVV(p2,p1);var" e2="b2Math.SubtractVV(p3,p1);var" d="b2Math.b2CrossVV(e1,e2);var" trianglearea="0.5*D;area+=triangleArea;var" tvec="new" b2vec2();tvec.setv(p1);tvec.add(p2);tvec.add(p3);tvec.multiply(inv3*trianglearea);center.add(tvec);var="" px="p1.x;var" py="p1.y;var" ex1="e1.x;var" ey1="e1.y;var" ex2="e2.x;var" ey2="e2.y;var" intx2="inv3*(0.25*(ex1*ex1+ex2*ex1+ex2*ex2)+(px*ex1+px*ex2))+0.5*px*px;var" inty2="inv3*(0.25*(ey1*ey1+ey2*ey1+ey2*ey2)+(py*ey1+py*ey2))+0.5*py*py;I+=D*(intx2+inty2);}" massdata.mass="rho*area;center.Multiply(1.0/area);massData.center=center;I=rho*(I-area*b2Math.b2Dot(center,center));massData.I=I;};b2Shape.PolyCentroid=function(vs,count,out)" cx="0.0;var" cy="0.0;var" prefx="0.0;var" prefy="0.0;var" p1x="pRefX;var" p1y="pRefY;var" p2x="vs[i].x;var" p2y="vs[i].y;var" p3x="i+1<count?vs[i+1].x:vs[0].x;var" p3y="i+1<count?vs[i+1].y:vs[0].y;var" e1x="p2X-p1X;var" e1y="p2Y-p1Y;var" e2x="p3X-p1X;var" e2y="p3Y-p1Y;var" cx*="1.0/area;cY*=1.0/area;out.Set(cX,cY);};" b2shapedef="Class.create();b2ShapeDef.prototype={initialize:function()" {this.type="b2Shape.e_unknownShape;this.userData=null;this.localPosition=new" b2vec2(0.0,0.0);this.localrotation="0.0;this.friction=0.2;this.restitution=0.0;this.density=0.0;this.categoryBits=0x0001;this.maskBits=0xFFFF;this.groupIndex=0;},ComputeMass:function(massData)" {massdata.center="new" b2vec2(0.0,0.0)="" if(this.density="=0.0)" {massdata.mass="0.0;massData.center.Set(0.0,0.0);massData.I=0.0;};switch(this.type)" b2shape.e_circleshape:{var="" circle="this;massData.mass=this.density*b2Settings.b2_pi*circle.radius*circle.radius;massData.center.Set(0.0,0.0);massData.I=0.5*(massData.mass)*circle.radius*circle.radius;}" break;case="" b2shape.e_boxshape:{var="" box="this;massData.mass=4.0*this.density*box.extents.x*box.extents.y;massData.center.Set(0.0,0.0);massData.I=massData.mass/3.0*b2Math.b2Dot(box.extents,box.extents);}" b2shape.e_polyshape:{var="" poly="this;b2Shape.PolyMass(massData,poly.vertices,poly.vertexCount,this.density);}" break;default:massdata.mass="0.0;massData.center.Set(0.0,0.0);massData.I=0.0;break;}},type:0,userData:null,localPosition:null,localRotation:null,friction:null,restitution:null,density:null,categoryBits:0,maskBits:0,groupIndex:0};" b2boxdef="Class.create();Object.extend(b2BoxDef.prototype,b2ShapeDef.prototype);Object.extend(b2BoxDef.prototype,{initialize:function()" b2vec2(1.0,1.0);},extents:null});="" b2circledef="Class.create();Object.extend(b2CircleDef.prototype,b2ShapeDef.prototype);Object.extend(b2CircleDef.prototype,{initialize:function()" b2circleshape="Class.create();Object.extend(b2CircleShape.prototype,b2Shape.prototype);Object.extend(b2CircleShape.prototype,{TestPoint:function(p){var" b2vec2();d.setv(p);d.subtract(this.m_position);return="" b2math.b2dot(d,d)<="this.m_radius*this.m_radius;},initialize:function(def,body,localCenter){this.m_R=new" b2vec2();var="" rx="this.m_R.col1.x*this.m_localPosition.x+this.m_R.col2.x*this.m_localPosition.y;var" ry="this.m_R.col1.y*this.m_localPosition.x+this.m_R.col2.y*this.m_localPosition.y;this.m_position.x=this.m_body.m_position.x+rX;this.m_position.y=this.m_body.m_position.y+rY;this.m_maxRadius=Math.sqrt(rX*rX+rY*rY)+this.m_radius;var" aabb="new" b2aabb();aabb.minvertex.set(this.m_position.x-this.m_radius,this.m_position.y-this.m_radius);aabb.maxvertex.set(this.m_position.x+this.m_radius,this.m_position.y+this.m_radius);var="" broadphase="this.m_body.m_world.m_broadPhase;if(broadPhase.InRange(aabb))" {this.m_proxyid="broadPhase.CreateProxy(aabb,this);}" else="" if(this.m_proxyid="=b2Pair.b2_nullProxy)" {this.m_body.freeze();}},synchronize:function(position1,r1,position2,r2){this.m_r.setm(r2);this.m_position.x="(R2.col1.x*this.m_localPosition.x+R2.col2.x*this.m_localPosition.y)+position2.x;this.m_position.y=(R2.col1.y*this.m_localPosition.x+R2.col2.y*this.m_localPosition.y)+position2.y;if(this.m_proxyId==b2Pair.b2_nullProxy)" {return;}="" lowerx="Math.min(p1X,this.m_position.x);var" lowery="Math.min(p1Y,this.m_position.y);var" upperx="Math.max(p1X,this.m_position.x);var" uppery="Math.max(p1Y,this.m_position.y);var" b2aabb();aabb.minvertex.set(lowerx-this.m_radius,lowery-this.m_radius);aabb.maxvertex.set(upperx+this.m_radius,uppery+this.m_radius);var="" {broadphase.moveproxy(this.m_proxyid,aabb);}="" {this.m_body.freeze();}},quicksync:function(position,r){this.m_r.setm(r);this.m_position.x="(R.col1.x*this.m_localPosition.x+R.col2.x*this.m_localPosition.y)+position.x;this.m_position.y=(R.col1.y*this.m_localPosition.x+R.col2.y*this.m_localPosition.y)+position.y;},ResetProxy:function(broadPhase)" {if(this.m_proxyid="=b2Pair.b2_nullProxy)" proxy="broadPhase.GetProxy(this.m_proxyId);broadPhase.DestroyProxy(this.m_proxyId);proxy=null;var" b2aabb();aabb.minvertex.set(this.m_position.x-this.m_radius,this.m_position.y-this.m_radius);aabb.maxvertex.set(this.m_position.x+this.m_radius,this.m_position.y+this.m_radius);if(broadphase.inrange(aabb))="" {this.m_body.freeze();}},support:function(dx,dy,out)="" len="Math.sqrt(dX*dX+dY*dY);dX/=len;dY/=len;out.Set(this.m_position.x+this.m_radius*dX,this.m_position.y+this.m_radius*dY);},m_localPosition:new" b2vec2(),m_radius:null});="" b2massdata="Class.create();b2MassData.prototype={mass:0.0,center:new" b2vec2(0,0),i:0.0,initialize:function(){this.center="new" b2vec2(0,0);}}="" b2polydef="Class.create();Object.extend(b2PolyDef.prototype,b2ShapeDef.prototype);Object.extend(b2PolyDef.prototype,{initialize:function()" array(b2settings.b2_maxpolyvertices);this.type="b2Shape.e_polyShape;this.vertexCount=0;for(var" b2vec2();}},vertices:new="" array(b2settings.b2_maxpolyvertices),vertexcount:0});var="" b2polyshape="Class.create();Object.extend(b2PolyShape.prototype,b2Shape.prototype);Object.extend(b2PolyShape.prototype,{TestPoint:function(p){var" plocal="new" b2vec2();plocal.setv(p);plocal.subtract(this.m_position);plocal.multm(this.m_r);for(var="" b2vec2();tvec.setv(plocal);tvec.subtract(this.m_vertices[i]);var="" dot="b2Math.b2Dot(this.m_normals[i],tVec);if(dot">0.0)
{return false;}}
return true;},initialize:function(def,body,newOrigin){this.m_R=new b2Mat22();this.m_position=new b2Vec2();this.m_userData=def.userData;this.m_friction=def.friction;this.m_restitution=def.restitution;this.m_body=body;this.m_proxyId=b2Pair.b2_nullProxy;this.m_maxRadius=0.0;this.m_categoryBits=def.categoryBits;this.m_maskBits=def.maskBits;this.m_groupIndex=def.groupIndex;this.syncAABB=new b2AABB();this.syncMat=new b2Mat22();this.m_localCentroid=new b2Vec2();this.m_localOBB=new b2OBB();var i=0;var hX;var hY;var tVec;var aabb=new b2AABB();this.m_vertices=new Array(b2Settings.b2_maxPolyVertices);this.m_coreVertices=new Array(b2Settings.b2_maxPolyVertices);this.m_normals=new Array(b2Settings.b2_maxPolyVertices);this.m_type=b2Shape.e_polyShape;var localR=new b2Mat22(def.localRotation);if(def.type==b2Shape.e_boxShape)
{this.m_localCentroid.x=def.localPosition.x-newOrigin.x;this.m_localCentroid.y=def.localPosition.y-newOrigin.y;var box=def;this.m_vertexCount=4;hX=box.extents.x;hY=box.extents.y;var hcX=Math.max(0.0,hX-2.0*b2Settings.b2_linearSlop);var hcY=Math.max(0.0,hY-2.0*b2Settings.b2_linearSlop);tVec=this.m_vertices[0]=new b2Vec2();tVec.x=localR.col1.x*hX+localR.col2.x*hY;tVec.y=localR.col1.y*hX+localR.col2.y*hY;tVec=this.m_vertices[1]=new b2Vec2();tVec.x=localR.col1.x*-hX+localR.col2.x*hY;tVec.y=localR.col1.y*-hX+localR.col2.y*hY;tVec=this.m_vertices[2]=new b2Vec2();tVec.x=localR.col1.x*-hX+localR.col2.x*-hY;tVec.y=localR.col1.y*-hX+localR.col2.y*-hY;tVec=this.m_vertices[3]=new b2Vec2();tVec.x=localR.col1.x*hX+localR.col2.x*-hY;tVec.y=localR.col1.y*hX+localR.col2.y*-hY;tVec=this.m_coreVertices[0]=new b2Vec2();tVec.x=localR.col1.x*hcX+localR.col2.x*hcY;tVec.y=localR.col1.y*hcX+localR.col2.y*hcY;tVec=this.m_coreVertices[1]=new b2Vec2();tVec.x=localR.col1.x*-hcX+localR.col2.x*hcY;tVec.y=localR.col1.y*-hcX+localR.col2.y*hcY;tVec=this.m_coreVertices[2]=new b2Vec2();tVec.x=localR.col1.x*-hcX+localR.col2.x*-hcY;tVec.y=localR.col1.y*-hcX+localR.col2.y*-hcY;tVec=this.m_coreVertices[3]=new b2Vec2();tVec.x=localR.col1.x*hcX+localR.col2.x*-hcY;tVec.y=localR.col1.y*hcX+localR.col2.y*-hcY;}
else
{var poly=def;this.m_vertexCount=poly.vertexCount;b2Shape.PolyCentroid(poly.vertices,poly.vertexCount,b2PolyShape.tempVec);var centroidX=b2PolyShape.tempVec.x;var centroidY=b2PolyShape.tempVec.y;this.m_localCentroid.x=def.localPosition.x+(localR.col1.x*centroidX+localR.col2.x*centroidY)-newOrigin.x;this.m_localCentroid.y=def.localPosition.y+(localR.col1.y*centroidX+localR.col2.y*centroidY)-newOrigin.y;for(i=0;i<this.m_vertexcount;++i) {this.m_vertices[i]="new" b2vec2();this.m_corevertices[i]="new" b2vec2();hx="poly.vertices[i].x-centroidX;hY=poly.vertices[i].y-centroidY;this.m_vertices[i].x=localR.col1.x*hX+localR.col2.x*hY;this.m_vertices[i].y=localR.col1.y*hX+localR.col2.y*hY;var" ux="this.m_vertices[i].x;var" uy="this.m_vertices[i].y;var" length="Math.sqrt(uX*uX+uY*uY);if(length">Number.MIN_VALUE)
{uX*=1.0/length;uY*=1.0/length;}
this.m_coreVertices[i].x=this.m_vertices[i].x-2.0*b2Settings.b2_linearSlop*uX;this.m_coreVertices[i].y=this.m_vertices[i].y-2.0*b2Settings.b2_linearSlop*uY;}}
var minVertexX=Number.MAX_VALUE;var minVertexY=Number.MAX_VALUE;var maxVertexX=-Number.MAX_VALUE;var maxVertexY=-Number.MAX_VALUE;this.m_maxRadius=0.0;for(i=0;i<this.m_vertexcount;++i) {var="" v="this.m_vertices[i];minVertexX=Math.min(minVertexX,v.x);minVertexY=Math.min(minVertexY,v.y);maxVertexX=Math.max(maxVertexX,v.x);maxVertexY=Math.max(maxVertexY,v.y);this.m_maxRadius=Math.max(this.m_maxRadius,v.Length());}" this.m_localobb.r.setidentity();this.m_localobb.center.set((minvertexx+maxvertexx)*0.5,(minvertexy+maxvertexy)*0.5);this.m_localobb.extents.set((maxvertexx-minvertexx)*0.5,(maxvertexy-minvertexy)*0.5);var="" i1="0;var" i2="0;for(i=0;i<this.m_vertexCount;++i)" {this.m_normals[i]="new" b2vec2();i1="i;i2=i+1<this.m_vertexCount?i+1:0;this.m_normals[i].x=this.m_vertices[i2].y-this.m_vertices[i1].y;this.m_normals[i].y=-(this.m_vertices[i2].x-this.m_vertices[i1].x);this.m_normals[i].Normalize();}" for(i="0;i<this.m_vertexCount;++i)" {i1="i;i2=i+1<this.m_vertexCount?i+1:0;}" this.m_r.setm(this.m_body.m_r);this.m_position.x="this.m_body.m_position.x+(this.m_R.col1.x*this.m_localCentroid.x+this.m_R.col2.x*this.m_localCentroid.y);this.m_position.y=this.m_body.m_position.y+(this.m_R.col1.y*this.m_localCentroid.x+this.m_R.col2.y*this.m_localCentroid.y);b2PolyShape.tAbsR.col1.x=this.m_R.col1.x*this.m_localOBB.R.col1.x+this.m_R.col2.x*this.m_localOBB.R.col1.y;b2PolyShape.tAbsR.col1.y=this.m_R.col1.y*this.m_localOBB.R.col1.x+this.m_R.col2.y*this.m_localOBB.R.col1.y;b2PolyShape.tAbsR.col2.x=this.m_R.col1.x*this.m_localOBB.R.col2.x+this.m_R.col2.x*this.m_localOBB.R.col2.y;b2PolyShape.tAbsR.col2.y=this.m_R.col1.y*this.m_localOBB.R.col2.x+this.m_R.col2.y*this.m_localOBB.R.col2.y;b2PolyShape.tAbsR.Abs()" hx="b2PolyShape.tAbsR.col1.x*this.m_localOBB.extents.x+b2PolyShape.tAbsR.col2.x*this.m_localOBB.extents.y;hY=b2PolyShape.tAbsR.col1.y*this.m_localOBB.extents.x+b2PolyShape.tAbsR.col2.y*this.m_localOBB.extents.y;var" positionx="this.m_position.x+(this.m_R.col1.x*this.m_localOBB.center.x+this.m_R.col2.x*this.m_localOBB.center.y);var" positiony="this.m_position.y+(this.m_R.col1.y*this.m_localOBB.center.x+this.m_R.col2.y*this.m_localOBB.center.y);aabb.minVertex.x=positionX-hX;aabb.minVertex.y=positionY-hY;aabb.maxVertex.x=positionX+hX;aabb.maxVertex.y=positionY+hY;var" broadphase="this.m_body.m_world.m_broadPhase;if(broadPhase.InRange(aabb))" {this.m_proxyid="broadPhase.CreateProxy(aabb,this);}" else="" if(this.m_proxyid="=b2Pair.b2_nullProxy)" {this.m_body.freeze();}},syncaabb:new="" b2aabb(),syncmat:new="" b2mat22(),synchronize:function(position1,r1,position2,r2){this.m_r.setm(r2);this.m_position.x="this.m_body.m_position.x+(R2.col1.x*this.m_localCentroid.x+R2.col2.x*this.m_localCentroid.y);this.m_position.y=this.m_body.m_position.y+(R2.col1.y*this.m_localCentroid.x+R2.col2.y*this.m_localCentroid.y);if(this.m_proxyId==b2Pair.b2_nullProxy)" {return;}="" var="" hx;var="" hy;var="" v1="R1.col1;var" v2="R1.col2;var" v3="this.m_localOBB.R.col1;var" v4="this.m_localOBB.R.col2;this.syncMat.col1.x=v1.x*v3.x+v2.x*v3.y;this.syncMat.col1.y=v1.y*v3.x+v2.y*v3.y;this.syncMat.col2.x=v1.x*v4.x+v2.x*v4.y;this.syncMat.col2.y=v1.y*v4.x+v2.y*v4.y;this.syncMat.Abs();hX=this.m_localCentroid.x+this.m_localOBB.center.x;hY=this.m_localCentroid.y+this.m_localOBB.center.y;var" centerx="position1.x+(R1.col1.x*hX+R1.col2.x*hY);var" centery="position1.y+(R1.col1.y*hX+R1.col2.y*hY);hX=this.syncMat.col1.x*this.m_localOBB.extents.x+this.syncMat.col2.x*this.m_localOBB.extents.y;hY=this.syncMat.col1.y*this.m_localOBB.extents.x+this.syncMat.col2.y*this.m_localOBB.extents.y;this.syncAABB.minVertex.x=centerX-hX;this.syncAABB.minVertex.y=centerY-hY;this.syncAABB.maxVertex.x=centerX+hX;this.syncAABB.maxVertex.y=centerY+hY;v1=R2.col1;v2=R2.col2;v3=this.m_localOBB.R.col1;v4=this.m_localOBB.R.col2;this.syncMat.col1.x=v1.x*v3.x+v2.x*v3.y;this.syncMat.col1.y=v1.y*v3.x+v2.y*v3.y;this.syncMat.col2.x=v1.x*v4.x+v2.x*v4.y;this.syncMat.col2.y=v1.y*v4.x+v2.y*v4.y;this.syncMat.Abs();hX=this.m_localCentroid.x+this.m_localOBB.center.x;hY=this.m_localCentroid.y+this.m_localOBB.center.y;centerX=position2.x+(R2.col1.x*hX+R2.col2.x*hY);centerY=position2.y+(R2.col1.y*hX+R2.col2.y*hY);hX=this.syncMat.col1.x*this.m_localOBB.extents.x+this.syncMat.col2.x*this.m_localOBB.extents.y;hY=this.syncMat.col1.y*this.m_localOBB.extents.x+this.syncMat.col2.y*this.m_localOBB.extents.y;this.syncAABB.minVertex.x=Math.min(this.syncAABB.minVertex.x,centerX-hX);this.syncAABB.minVertex.y=Math.min(this.syncAABB.minVertex.y,centerY-hY);this.syncAABB.maxVertex.x=Math.max(this.syncAABB.maxVertex.x,centerX+hX);this.syncAABB.maxVertex.y=Math.max(this.syncAABB.maxVertex.y,centerY+hY);var" {broadphase.moveproxy(this.m_proxyid,this.syncaabb);}="" {this.m_body.freeze();}},quicksync:function(position,r){this.m_r.setm(r);this.m_position.x="position.x+(R.col1.x*this.m_localCentroid.x+R.col2.x*this.m_localCentroid.y);this.m_position.y=position.y+(R.col1.y*this.m_localCentroid.x+R.col2.y*this.m_localCentroid.y);},ResetProxy:function(broadPhase){if(this.m_proxyId==b2Pair.b2_nullProxy)" proxy="broadPhase.GetProxy(this.m_proxyId);broadPhase.DestroyProxy(this.m_proxyId);proxy=null;var" r="b2Math.b2MulMM(this.m_R,this.m_localOBB.R);var" absr="b2Math.b2AbsM(R);var" h="b2Math.b2MulMV(absR,this.m_localOBB.extents);var" position="b2Math.b2MulMV(this.m_R,this.m_localOBB.center);position.Add(this.m_position);var" aabb="new" b2aabb();aabb.minvertex.setv(position);aabb.minvertex.subtract(h);aabb.maxvertex.setv(position);aabb.maxvertex.add(h);if(broadphase.inrange(aabb))="" {this.m_body.freeze();}},support:function(dx,dy,out)="" dlocalx="(dX*this.m_R.col1.x+dY*this.m_R.col1.y);var" dlocaly="(dX*this.m_R.col2.x+dY*this.m_R.col2.y);var" bestindex="0;var" bestvalue="(this.m_coreVertices[0].x*dLocalX+this.m_coreVertices[0].y*dLocalY);for(var" i="1;i<this.m_vertexCount;++i)" value="(this.m_coreVertices[i].x*dLocalX+this.m_coreVertices[i].y*dLocalY);if(value">bestValue)
{bestIndex=i;bestValue=value;}}
out.Set(this.m_position.x+(this.m_R.col1.x*this.m_coreVertices[bestIndex].x+this.m_R.col2.x*this.m_coreVertices[bestIndex].y),this.m_position.y+(this.m_R.col1.y*this.m_coreVertices[bestIndex].x+this.m_R.col2.y*this.m_coreVertices[bestIndex].y));},m_localCentroid:new b2Vec2(),m_localOBB:new b2OBB(),m_vertices:null,m_coreVertices:null,m_vertexCount:0,m_normals:null});b2PolyShape.tempVec=new b2Vec2();b2PolyShape.tAbsR=new b2Mat22();
var b2Body=Class.create();b2Body.prototype={SetOriginPosition:function(position,rotation){if(this.IsFrozen())
{return;}
this.m_rotation=rotation;this.m_R.Set(this.m_rotation);this.m_position=b2Math.AddVV(position,b2Math.b2MulMV(this.m_R,this.m_center));this.m_position0.SetV(this.m_position);this.m_rotation0=this.m_rotation;for(var s=this.m_shapeList;s!=null;s=s.m_next)
{s.Synchronize(this.m_position,this.m_R,this.m_position,this.m_R);}
this.m_world.m_broadPhase.Commit();},GetOriginPosition:function(){return b2Math.SubtractVV(this.m_position,b2Math.b2MulMV(this.m_R,this.m_center));},SetCenterPosition:function(position,rotation){if(this.IsFrozen())
{return;}
this.m_rotation=rotation;this.m_R.Set(this.m_rotation);this.m_position.SetV(position);this.m_position0.SetV(this.m_position);this.m_rotation0=this.m_rotation;for(var s=this.m_shapeList;s!=null;s=s.m_next)
{s.Synchronize(this.m_position,this.m_R,this.m_position,this.m_R);}
this.m_world.m_broadPhase.Commit();},GetCenterPosition:function(){return this.m_position;},GetRotation:function(){return this.m_rotation;},GetRotationMatrix:function(){return this.m_R;},SetLinearVelocity:function(v){this.m_linearVelocity.SetV(v);},GetLinearVelocity:function(){return this.m_linearVelocity;},SetAngularVelocity:function(w){this.m_angularVelocity=w;},GetAngularVelocity:function(){return this.m_angularVelocity;},ApplyForce:function(force,point)
{if(this.IsSleeping()==false)
{this.m_force.Add(force);this.m_torque+=b2Math.b2CrossVV(b2Math.SubtractVV(point,this.m_position),force);}},ApplyTorque:function(torque)
{if(this.IsSleeping()==false)
{this.m_torque+=torque;}},ApplyImpulse:function(impulse,point)
{if(this.IsSleeping()==false)
{this.m_linearVelocity.Add(b2Math.MulFV(this.m_invMass,impulse));this.m_angularVelocity+=(this.m_invI*b2Math.b2CrossVV(b2Math.SubtractVV(point,this.m_position),impulse));}},GetMass:function(){return this.m_mass;},GetInertia:function(){return this.m_I;},GetWorldPoint:function(localPoint){return b2Math.AddVV(this.m_position,b2Math.b2MulMV(this.m_R,localPoint));},GetWorldVector:function(localVector){return b2Math.b2MulMV(this.m_R,localVector);},GetLocalPoint:function(worldPoint){return b2Math.b2MulTMV(this.m_R,b2Math.SubtractVV(worldPoint,this.m_position));},GetLocalVector:function(worldVector){return b2Math.b2MulTMV(this.m_R,worldVector);},IsStatic:function(){return(this.m_flags&b2Body.e_staticFlag)==b2Body.e_staticFlag;},IsFrozen:function()
{return(this.m_flags&b2Body.e_frozenFlag)==b2Body.e_frozenFlag;},IsSleeping:function(){return(this.m_flags&b2Body.e_sleepFlag)==b2Body.e_sleepFlag;},AllowSleeping:function(flag)
{if(flag)
{this.m_flags|=b2Body.e_allowSleepFlag;}
else
{this.m_flags&=~b2Body.e_allowSleepFlag;this.WakeUp();}},WakeUp:function(){this.m_flags&=~b2Body.e_sleepFlag;this.m_sleepTime=0.0;},GetShapeList:function(){return this.m_shapeList;},GetContactList:function()
{return this.m_contactList;},GetJointList:function()
{return this.m_jointList;},GetNext:function(){return this.m_next;},GetUserData:function(){return this.m_userData;},initialize:function(bd,world){this.sMat0=new b2Mat22();this.m_position=new b2Vec2();this.m_R=new b2Mat22(0);this.m_position0=new b2Vec2();var i=0;var sd;var massData;this.m_flags=0;this.m_position.SetV(bd.position);this.m_rotation=bd.rotation;this.m_R.Set(this.m_rotation);this.m_position0.SetV(this.m_position);this.m_rotation0=this.m_rotation;this.m_world=world;this.m_linearDamping=b2Math.b2Clamp(1.0-bd.linearDamping,0.0,1.0);this.m_angularDamping=b2Math.b2Clamp(1.0-bd.angularDamping,0.0,1.0);this.m_force=new b2Vec2(0.0,0.0);this.m_torque=0.0;this.m_mass=0.0;var massDatas=new Array(b2Settings.b2_maxShapesPerBody);for(i=0;i<b2settings.b2_maxshapesperbody;i++){massdatas[i]=new b2massdata();}="" this.m_shapecount="0;this.m_center=new" b2vec2(0.0,0.0);for(i="0;i<b2Settings.b2_maxShapesPerBody;++i)" {sd="bd.shapes[i];if(sd==null)break;massData=massDatas[i];sd.ComputeMass(massData);this.m_mass+=massData.mass;this.m_center.x+=massData.mass*(sd.localPosition.x+massData.center.x);this.m_center.y+=massData.mass*(sd.localPosition.y+massData.center.y);++this.m_shapeCount;}" if(this.m_mass="">0.0)
{this.m_center.Multiply(1.0/this.m_mass);this.m_position.Add(b2Math.b2MulMV(this.m_R,this.m_center));}
else
{this.m_flags|=b2Body.e_staticFlag;}
this.m_I=0.0;for(i=0;i<this.m_shapecount;++i) {sd="bd.shapes[i];massData=massDatas[i];this.m_I+=massData.I;var" r="b2Math.SubtractVV(b2Math.AddVV(sd.localPosition,massData.center),this.m_center);this.m_I+=massData.mass*b2Math.b2Dot(r,r);}" if(this.m_mass="">0.0)
{this.m_invMass=1.0/this.m_mass;}
else
{this.m_invMass=0.0;}
if(this.m_I>0.0&&bd.preventRotation==false)
{this.m_invI=1.0/this.m_I;}
else
{this.m_I=0.0;this.m_invI=0.0;}
this.m_linearVelocity=b2Math.AddVV(bd.linearVelocity,b2Math.b2CrossFV(bd.angularVelocity,this.m_center));this.m_angularVelocity=bd.angularVelocity;this.m_jointList=null;this.m_contactList=null;this.m_prev=null;this.m_next=null;this.m_shapeList=null;for(i=0;i<this.m_shapecount;++i) {sd="bd.shapes[i];var" shape="b2Shape.Create(sd,this,this.m_center);shape.m_next=this.m_shapeList;this.m_shapeList=shape;}" this.m_sleeptime="0.0;if(bd.allowSleep)" {this.m_flags|="b2Body.e_allowSleepFlag;}" if(bd.issleeping)="" if((this.m_flags&b2body.e_sleepflag)||this.m_invmass="=0.0)" {this.m_linearvelocity.set(0.0,0.0);this.m_angularvelocity="0.0;}" this.m_userdata="bd.userData;},Destroy:function(){var" s="this.m_shapeList;while(s)" {var="" s0="s;s=s.m_next;b2Shape.Destroy(s0);}},sMat0:new" b2mat22(),synchronizeshapes:function(){this.smat0.set(this.m_rotation0);for(var="" {s.synchronize(this.m_position0,this.smat0,this.m_position,this.m_r);}},quicksyncshapes:function(){for(var="" {s.quicksync(this.m_position,this.m_r);}},isconnected:function(other){for(var="" jn="this.m_jointList;jn!=null;jn=jn.next)" {if(jn.other="=other)" return="" jn.joint.m_collideconnected="=false;}" false;},freeze:function(){this.m_flags|="b2Body.e_frozenFlag;this.m_linearVelocity.SetZero();this.m_angularVelocity=0.0;for(var" {s.destroyproxy();}},m_flags:0,m_position:new="" b2vec2(),m_rotation:null,m_r:new="" b2mat22(0),m_position0:new="" b2vec2(),m_rotation0:null,m_linearvelocity:null,m_angularvelocity:null,m_force:null,m_torque:null,m_center:null,m_world:null,m_prev:null,m_next:null,m_shapelist:null,m_shapecount:0,m_jointlist:null,m_contactlist:null,m_mass:null,m_invmass:null,m_i:null,m_invi:null,m_lineardamping:null,m_angulardamping:null,m_sleeptime:null,m_userdata:null};b2body.e_staticflag="0x0001;b2Body.e_frozenFlag=0x0002;b2Body.e_islandFlag=0x0004;b2Body.e_sleepFlag=0x0008;b2Body.e_allowSleepFlag=0x0010;b2Body.e_destroyFlag=0x0020;" var="" b2bodydef="Class.create();b2BodyDef.prototype={initialize:function()" {this.shapes="new" array();this.userdata="null;for(var" i="0;i<b2Settings.b2_maxShapesPerBody;i++){this.shapes[i]=null;}" this.position="new" b2vec2(0.0,0.0);this.rotation="0.0;this.linearVelocity=new" b2vec2(0.0,0.0);this.angularvelocity="0.0;this.linearDamping=0.0;this.angularDamping=0.0;this.allowSleep=true;this.isSleeping=false;this.preventRotation=false;},userData:null,shapes:new" array(),position:null,rotation:null,linearvelocity:null,angularvelocity:null,lineardamping:null,angulardamping:null,allowsleep:null,issleeping:null,preventrotation:null,addshape:function(shape)="" {for(var="" {if(this.shapes[i]="=null)" {this.shapes[i]="shape;break;}}}};" b2collisionfilter="Class.create();b2CollisionFilter.prototype={ShouldCollide:function(shape1,shape2){if(shape1.m_groupIndex==shape2.m_groupIndex&&shape1.m_groupIndex!=0)" {return="" shape1.m_groupindex="">0;}
var collide=(shape1.m_maskBits&shape2.m_categoryBits)!=0&&(shape1.m_categoryBits&shape2.m_maskBits)!=0;return collide;},initialize:function(){}};b2CollisionFilter.b2_defaultFilter=new b2CollisionFilter;
var b2Island=Class.create();b2Island.prototype={initialize:function(bodyCapacity,contactCapacity,jointCapacity,allocator)
{var i=0;this.m_bodyCapacity=bodyCapacity;this.m_contactCapacity=contactCapacity;this.m_jointCapacity=jointCapacity;this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0;this.m_bodies=new Array(bodyCapacity);for(i=0;i<bodycapacity;i++) this.m_bodies[i]="null;this.m_contacts=new" array(contactcapacity);for(i="0;i<contactCapacity;i++)" this.m_contacts[i]="null;this.m_joints=new" array(jointcapacity);for(i="0;i<jointCapacity;i++)" this.m_joints[i]="null;this.m_allocator=allocator;},Clear:function()" {this.m_bodycount="0;this.m_contactCount=0;this.m_jointCount=0;},Solve:function(step,gravity)" {var="" i="0;var" b;for(i="0;i<this.m_bodyCount;++i)" {b="this.m_bodies[i];if(b.m_invMass==0.0)" continue;b.m_linearvelocity.add(b2math.mulfv(step.dt,b2math.addvv(gravity,b2math.mulfv(b.m_invmass,b.m_force))));b.m_angularvelocity+="step.dt*b.m_invI*b.m_torque;b.m_linearVelocity.Multiply(b.m_linearDamping);b.m_angularVelocity*=b.m_angularDamping;b.m_position0.SetV(b.m_position);b.m_rotation0=b.m_rotation;}" var="" contactsolver="new" b2contactsolver(this.m_contacts,this.m_contactcount,this.m_allocator);contactsolver.presolve();for(i="0;i<this.m_jointCount;++i)" {this.m_joints[i].preparevelocitysolver();}="" for(i="0;i<step.iterations;++i)" {contactsolver.solvevelocityconstraints();for(var="" j="0;j<this.m_jointCount;++j)" {this.m_joints[j].solvevelocityconstraints(step);}}="" continue;b.m_position.x+="step.dt*b.m_linearVelocity.x;b.m_position.y+=step.dt*b.m_linearVelocity.y;b.m_rotation+=step.dt*b.m_angularVelocity;b.m_R.Set(b.m_rotation);}" {this.m_joints[i].preparepositionsolver();}="" if(b2world.s_enablepositioncorrection)="" {for(b2island.m_positioniterationcount="0;b2Island.m_positionIterationCount<step.iterations;++b2Island.m_positionIterationCount)" contactsokay="contactSolver.SolvePositionConstraints(b2Settings.b2_contactBaumgarte);var" jointsokay="true;for(i=0;i<this.m_jointCount;++i)" jointokay="this.m_joints[i].SolvePositionConstraints();jointsOkay=jointsOkay&&jointOkay;}" if(contactsokay&&jointsokay)="" {break;}}}="" contactsolver.postsolve();for(i="0;i<this.m_bodyCount;++i)" continue;b.m_r.set(b.m_rotation);b.synchronizeshapes();b.m_force.set(0.0,0.0);b.m_torque="0.0;}},UpdateSleep:function(dt)" b;var="" minsleeptime="Number.MAX_VALUE;var" lintolsqr="b2Settings.b2_linearSleepTolerance*b2Settings.b2_linearSleepTolerance;var" angtolsqr="b2Settings.b2_angularSleepTolerance*b2Settings.b2_angularSleepTolerance;for(i=0;i<this.m_bodyCount;++i)" {continue;}="" if((b.m_flags&b2body.e_allowsleepflag)="=0)" {b.m_sleeptime="0.0;minSleepTime=0.0;}">angTolSqr||b2Math.b2Dot(b.m_linearVelocity,b.m_linearVelocity)>linTolSqr)
{b.m_sleepTime=0.0;minSleepTime=0.0;}
else
{b.m_sleepTime+=dt;minSleepTime=b2Math.b2Min(minSleepTime,b.m_sleepTime);}}
if(minSleepTime>=b2Settings.b2_timeToSleep)
{for(i=0;i<this.m_bodycount;++i) {b="this.m_bodies[i];b.m_flags|=b2Body.e_sleepFlag;}}},AddBody:function(body)" {this.m_bodies[this.m_bodycount++]="body;},AddContact:function(contact)" {this.m_contacts[this.m_contactcount++]="contact;},AddJoint:function(joint)" {this.m_joints[this.m_jointcount++]="joint;},m_allocator:null,m_bodies:null,m_contacts:null,m_joints:null,m_bodyCount:0,m_jointCount:0,m_contactCount:0,m_bodyCapacity:0,m_contactCapacity:0,m_jointCapacity:0,m_positionError:null};b2Island.m_positionIterationCount=0;" var="" b2timestep="Class.create();b2TimeStep.prototype={dt:null,inv_dt:null,iterations:0,initialize:function(){}};" b2contactnode="Class.create();b2ContactNode.prototype={other:null,contact:null,prev:null,next:null,initialize:function(){}};" b2contact="Class.create();b2Contact.prototype={GetManifolds:function(){return" null},getmanifoldcount:function()="" {return="" this.m_manifoldcount;},getnext:function(){return="" this.m_next;},getshape1:function(){return="" this.m_shape1;},getshape2:function(){return="" this.m_shape2;},initialize:function(s1,s2)="" {this.m_node1="new" b2contactnode();this.m_node2="new" b2contactnode();this.m_flags="0;if(!s1||!s2){this.m_shape1=null;this.m_shape2=null;return;}" this.m_shape1="s1;this.m_shape2=s2;this.m_manifoldCount=0;this.m_friction=Math.sqrt(this.m_shape1.m_friction*this.m_shape2.m_friction);this.m_restitution=b2Math.b2Max(this.m_shape1.m_restitution,this.m_shape2.m_restitution);this.m_prev=null;this.m_next=null;this.m_node1.contact=null;this.m_node1.prev=null;this.m_node1.next=null;this.m_node1.other=null;this.m_node2.contact=null;this.m_node2.prev=null;this.m_node2.next=null;this.m_node2.other=null;},Evaluate:function(){},m_flags:0,m_prev:null,m_next:null,m_node1:new" b2contactnode(),m_node2:new="" b2contactnode(),m_shape1:null,m_shape2:null,m_manifoldcount:0,m_friction:null,m_restitution:null};b2contact.e_islandflag="0x0001;b2Contact.e_destroyFlag=0x0002;b2Contact.AddType=function(createFcn,destroyFcn,type1,type2)" {b2contact.s_registers[type1][type2].createfcn="createFcn;b2Contact.s_registers[type1][type2].destroyFcn=destroyFcn;b2Contact.s_registers[type1][type2].primary=true;if(type1!=type2)" {b2contact.s_registers[type2][type1].createfcn="createFcn;b2Contact.s_registers[type2][type1].destroyFcn=destroyFcn;b2Contact.s_registers[type2][type1].primary=false;}};b2Contact.InitializeRegisters=function(){b2Contact.s_registers=new" array(b2shape.e_shapetypecount);for(var="" i="0;i<b2Shape.e_shapeTypeCount;i++){b2Contact.s_registers[i]=new" j="0;j<b2Shape.e_shapeTypeCount;j++){b2Contact.s_registers[i][j]=new" b2contactregister();}}="" b2contact.addtype(b2circlecontact.create,b2circlecontact.destroy,b2shape.e_circleshape,b2shape.e_circleshape);b2contact.addtype(b2polyandcirclecontact.create,b2polyandcirclecontact.destroy,b2shape.e_polyshape,b2shape.e_circleshape);b2contact.addtype(b2polycontact.create,b2polycontact.destroy,b2shape.e_polyshape,b2shape.e_polyshape);};b2contact.create="function(shape1,shape2,allocator){if(b2Contact.s_initialized==false)" {b2contact.initializeregisters();b2contact.s_initialized="true;}" type1="shape1.m_type;var" type2="shape2.m_type;var" createfcn="b2Contact.s_registers[type1][type2].createFcn;if(createFcn)" {if(b2contact.s_registers[type1][type2].primary)="" createfcn(shape1,shape2,allocator);}="" else="" {var="" c="createFcn(shape2,shape1,allocator);for(var" m="c.GetManifolds()[i];m.normal=m.normal.Negative();}" return="" c;}}="" null;}};b2contact.destroy="function(contact,allocator){if(contact.GetManifoldCount()">0)
{contact.m_shape1.m_body.WakeUp();contact.m_shape2.m_body.WakeUp();}
var type1=contact.m_shape1.m_type;var type2=contact.m_shape2.m_type;var destroyFcn=b2Contact.s_registers[type1][type2].destroyFcn;destroyFcn(contact,allocator);};b2Contact.s_registers=null;b2Contact.s_initialized=false;
var b2ContactConstraint=Class.create();b2ContactConstraint.prototype={initialize:function(){this.normal=new b2Vec2();this.points=new Array(b2Settings.b2_maxManifoldPoints);for(var i=0;i<b2settings.b2_maxmanifoldpoints;i++){this.points[i]=new b2contactconstraintpoint();}},points:null,normal:new="" b2vec2(),manifold:null,body1:null,body2:null,friction:null,restitution:null,pointcount:0};="" var="" b2contactconstraintpoint="Class.create();b2ContactConstraintPoint.prototype={localAnchor1:new" b2vec2(),localanchor2:new="" b2vec2(),normalimpulse:null,tangentimpulse:null,positionimpulse:null,normalmass:null,tangentmass:null,separation:null,velocitybias:null,initialize:function(){this.localanchor1="new" b2vec2();this.localanchor2="new" b2vec2();}};="" b2contactregister="Class.create();b2ContactRegister.prototype={createFcn:null,destroyFcn:null,primary:null,initialize:function(){}};" b2contactsolver="Class.create();b2ContactSolver.prototype={initialize:function(contacts,contactCount,allocator){this.m_constraints=new" array();this.m_allocator="allocator;var" i="0;var" tvec;var="" tmat;this.m_constraintcount="0;for(i=0;i<contactCount;++i)" {this.m_constraintcount+="contacts[i].GetManifoldCount();}" for(i="0;i<this.m_constraintCount;i++){this.m_constraints[i]=new" b2contactconstraint();}="" count="0;for(i=0;i<contactCount;++i)" {var="" contact="contacts[i];var" b1="contact.m_shape1.m_body;var" b2="contact.m_shape2.m_body;var" manifoldcount="contact.GetManifoldCount();var" manifolds="contact.GetManifolds();var" friction="contact.m_friction;var" restitution="contact.m_restitution;var" v1x="b1.m_linearVelocity.x;var" v1y="b1.m_linearVelocity.y;var" v2x="b2.m_linearVelocity.x;var" v2y="b2.m_linearVelocity.y;var" w1="b1.m_angularVelocity;var" w2="b2.m_angularVelocity;for(var" j="0;j<manifoldCount;++j)" manifold="manifolds[j];var" normalx="manifold.normal.x;var" normaly="manifold.normal.y;var" c="this.m_constraints[count];c.body1=b1;c.body2=b2;c.manifold=manifold;c.normal.x=normalX;c.normal.y=normalY;c.pointCount=manifold.pointCount;c.friction=friction;c.restitution=restitution;for(var" k="0;k<c.pointCount;++k)" cp="manifold.points[k];var" ccp="c.points[k];ccp.normalImpulse=cp.normalImpulse;ccp.tangentImpulse=cp.tangentImpulse;ccp.separation=cp.separation;var" r1x="cp.position.x-b1.m_position.x;var" r1y="cp.position.y-b1.m_position.y;var" r2x="cp.position.x-b2.m_position.x;var" r2y="cp.position.y-b2.m_position.y;tVec=ccp.localAnchor1;tMat=b1.m_R;tVec.x=r1X*tMat.col1.x+r1Y*tMat.col1.y;tVec.y=r1X*tMat.col2.x+r1Y*tMat.col2.y;tVec=ccp.localAnchor2;tMat=b2.m_R;tVec.x=r2X*tMat.col1.x+r2Y*tMat.col1.y;tVec.y=r2X*tMat.col2.x+r2Y*tMat.col2.y;var" r1sqr="r1X*r1X+r1Y*r1Y;var" r2sqr="r2X*r2X+r2Y*r2Y;var" rn1="r1X*normalX+r1Y*normalY;var" rn2="r2X*normalX+r2Y*normalY;var" knormal="b1.m_invMass+b2.m_invMass;kNormal+=b1.m_invI*(r1Sqr-rn1*rn1)+b2.m_invI*(r2Sqr-rn2*rn2);ccp.normalMass=1.0/kNormal;var" tangentx="normalY" tangenty="-normalX;var" rt1="r1X*tangentX+r1Y*tangentY;var" rt2="r2X*tangentX+r2Y*tangentY;var" ktangent="b1.m_invMass+b2.m_invMass;kTangent+=b1.m_invI*(r1Sqr-rt1*rt1)+b2.m_invI*(r2Sqr-rt2*rt2);ccp.tangentMass=1.0/kTangent;ccp.velocityBias=0.0;if(ccp.separation">0.0)
{ccp.velocityBias=-60.0*ccp.separation;}
var tX=v2X+(-w2*r2Y)-v1X-(-w1*r1Y);var tY=v2Y+(w2*r2X)-v1Y-(w1*r1X);var vRel=c.normal.x*tX+c.normal.y*tY;if(vRel<-b2settings.b2_velocitythreshold) {ccp.velocitybias+="-c.restitution*vRel;}}" ++count;}}},presolve:function(){var="" tvec;var="" tvec2;var="" tmat;for(var="" i="0;i<this.m_constraintCount;++i)" {var="" c="this.m_constraints[i];var" b1="c.body1;var" b2="c.body2;var" invmass1="b1.m_invMass;var" invi1="b1.m_invI;var" invmass2="b2.m_invMass;var" invi2="b2.m_invI;var" normalx="c.normal.x;var" normaly="c.normal.y;var" tangentx="normalY;var" tangenty="-normalX;var" j="0;var" tcount="0;if(b2World.s_enableWarmStarting)" {tcount="c.pointCount;for(j=0;j<tCount;++j)" ccp="c.points[j];var" px="ccp.normalImpulse*normalX+ccp.tangentImpulse*tangentX;var" py="ccp.normalImpulse*normalY+ccp.tangentImpulse*tangentY;tMat=b1.m_R;tVec=ccp.localAnchor1;var" r1x="tMat.col1.x*tVec.x+tMat.col2.x*tVec.y;var" r1y="tMat.col1.y*tVec.x+tMat.col2.y*tVec.y;tMat=b2.m_R;tVec=ccp.localAnchor2;var" r2x="tMat.col1.x*tVec.x+tMat.col2.x*tVec.y;var" r2y="tMat.col1.y*tVec.x+tMat.col2.y*tVec.y;b1.m_angularVelocity-=invI1*(r1X*PY-r1Y*PX);b1.m_linearVelocity.x-=invMass1*PX;b1.m_linearVelocity.y-=invMass1*PY;b2.m_angularVelocity+=invI2*(r2X*PY-r2Y*PX);b2.m_linearVelocity.x+=invMass2*PX;b2.m_linearVelocity.y+=invMass2*PY;ccp.positionImpulse=0.0;}}" else{tcount="c.pointCount;for(j=0;j<tCount;++j)" ccp2="c.points[j];ccp2.normalImpulse=0.0;ccp2.tangentImpulse=0.0;ccp2.positionImpulse=0.0;}}}},SolveVelocityConstraints:function(){var" ccp;var="" r1x;var="" r1y;var="" r2x;var="" r2y;var="" dvx;var="" dvy;var="" lambda;var="" newimpulse;var="" px;var="" py;var="" tmat;var="" tvec;for(var="" b1_angularvelocity="b1.m_angularVelocity;var" b1_linearvelocity="b1.m_linearVelocity;var" b2_angularvelocity="b2.m_angularVelocity;var" b2_linearvelocity="b2.m_linearVelocity;var" {ccp="c.points[j];tMat=b1.m_R;tVec=ccp.localAnchor1;r1X=tMat.col1.x*tVec.x+tMat.col2.x*tVec.y" tmat="b2.m_R;tVec=ccp.localAnchor2;r2X=tMat.col1.x*tVec.x+tMat.col2.x*tVec.y" dvx="b2_linearVelocity.x+(-b2_angularVelocity*r2Y)-b1_linearVelocity.x-(-b1_angularVelocity*r1Y);dvY=b2_linearVelocity.y+(b2_angularVelocity*r2X)-b1_linearVelocity.y-(b1_angularVelocity*r1X);var" vn="dvX*normalX+dvY*normalY;lambda=-ccp.normalMass*(vn-ccp.velocityBias);newImpulse=b2Math.b2Max(ccp.normalImpulse+lambda,0.0);lambda=newImpulse-ccp.normalImpulse;PX=lambda*normalX;PY=lambda*normalY;b1_linearVelocity.x-=invMass1*PX;b1_linearVelocity.y-=invMass1*PY;b1_angularVelocity-=invI1*(r1X*PY-r1Y*PX);b2_linearVelocity.x+=invMass2*PX;b2_linearVelocity.y+=invMass2*PY;b2_angularVelocity+=invI2*(r2X*PY-r2Y*PX);ccp.normalImpulse=newImpulse;dvX=b2_linearVelocity.x+(-b2_angularVelocity*r2Y)-b1_linearVelocity.x-(-b1_angularVelocity*r1Y);dvY=b2_linearVelocity.y+(b2_angularVelocity*r2X)-b1_linearVelocity.y-(b1_angularVelocity*r1X);var" vt="dvX*tangentX+dvY*tangentY;lambda=ccp.tangentMass*(-vt);var" maxfriction="c.friction*ccp.normalImpulse;newImpulse=b2Math.b2Clamp(ccp.tangentImpulse+lambda,-maxFriction,maxFriction);lambda=newImpulse-ccp.tangentImpulse;PX=lambda*tangentX;PY=lambda*tangentY;b1_linearVelocity.x-=invMass1*PX;b1_linearVelocity.y-=invMass1*PY;b1_angularVelocity-=invI1*(r1X*PY-r1Y*PX);b2_linearVelocity.x+=invMass2*PX;b2_linearVelocity.y+=invMass2*PY;b2_angularVelocity+=invI2*(r2X*PY-r2Y*PX);ccp.tangentImpulse=newImpulse;}" b1.m_angularvelocity="b1_angularVelocity;b2.m_angularVelocity=b2_angularVelocity;}},SolvePositionConstraints:function(beta){var" minseparation="0.0;var" b1_position="b1.m_position;var" b1_rotation="b1.m_rotation;var" b2_position="b2.m_position;var" b2_rotation="b2.m_rotation;var" var="" p1x="b1_position.x+r1X;var" p1y="b1_position.y+r1Y;var" p2x="b2_position.x+r2X;var" p2y="b2_position.y+r2Y;var" dpx="p2X-p1X;var" dpy="p2Y-p1Y;var" separation="(dpX*normalX+dpY*normalY)+ccp.separation;minSeparation=b2Math.b2Min(minSeparation,separation);var" dimpulse="-ccp.normalMass*C;var" impulse0="ccp.positionImpulse;ccp.positionImpulse=b2Math.b2Max(impulse0+dImpulse,0.0);dImpulse=ccp.positionImpulse-impulse0;var" impulsex="dImpulse*normalX;var" impulsey="dImpulse*normalY;b1_position.x-=invMass1*impulseX;b1_position.y-=invMass1*impulseY;b1_rotation-=invI1*(r1X*impulseY-r1Y*impulseX);b1.m_R.Set(b1_rotation);b2_position.x+=invMass2*impulseX;b2_position.y+=invMass2*impulseY;b2_rotation+=invI2*(r2X*impulseY-r2Y*impulseX);b2.m_R.Set(b2_rotation);}" b1.m_rotation="b1_rotation;b2.m_rotation=b2_rotation;}" return="">=-b2Settings.b2_linearSlop;},PostSolve:function(){for(var i=0;i<this.m_constraintcount;++i) {var="" c="this.m_constraints[i];var" m="c.manifold;for(var" j="0;j<c.pointCount;++j)" mpoint="m.points[j];var" cpoint="c.points[j];mPoint.normalImpulse=cPoint.normalImpulse;mPoint.tangentImpulse=cPoint.tangentImpulse;}}},m_allocator:null,m_constraints:new" array(),m_constraintcount:0};="" var="" b2circlecontact="Class.create();Object.extend(b2CircleContact.prototype,b2Contact.prototype);Object.extend(b2CircleContact.prototype,{initialize:function(s1,s2){this.m_node1=new" b2contactnode();this.m_node2="new" b2contactnode();this.m_flags="0;if(!s1||!s2){this.m_shape1=null;this.m_shape2=null;return;}" this.m_shape1="s1;this.m_shape2=s2;this.m_manifoldCount=0;this.m_friction=Math.sqrt(this.m_shape1.m_friction*this.m_shape2.m_friction);this.m_restitution=b2Math.b2Max(this.m_shape1.m_restitution,this.m_shape2.m_restitution);this.m_prev=null;this.m_next=null;this.m_node1.contact=null;this.m_node1.prev=null;this.m_node1.next=null;this.m_node1.other=null;this.m_node2.contact=null;this.m_node2.prev=null;this.m_node2.next=null;this.m_node2.other=null;this.m_manifold=[new" b2manifold()];this.m_manifold[0].pointcount="0;this.m_manifold[0].points[0].normalImpulse=0.0;this.m_manifold[0].points[0].tangentImpulse=0.0;},Evaluate:function(){b2Collision.b2CollideCircle(this.m_manifold[0],this.m_shape1,this.m_shape2,false);if(this.m_manifold[0].pointCount">0)
{this.m_manifoldCount=1;}
else
{this.m_manifoldCount=0;}},GetManifolds:function()
{return this.m_manifold;},m_manifold:[new b2Manifold()]});b2CircleContact.Create=function(shape1,shape2,allocator){return new b2CircleContact(shape1,shape2);};b2CircleContact.Destroy=function(contact,allocator){};
var b2Conservative=Class.create();b2Conservative.prototype={initialize:function(){}}
b2Conservative.R1=new b2Mat22();b2Conservative.R2=new b2Mat22();b2Conservative.x1=new b2Vec2();b2Conservative.x2=new b2Vec2();b2Conservative.Conservative=function(shape1,shape2){var body1=shape1.GetBody();var body2=shape2.GetBody();var v1X=body1.m_position.x-body1.m_position0.x;var v1Y=body1.m_position.y-body1.m_position0.y;var omega1=body1.m_rotation-body1.m_rotation0;var v2X=body2.m_position.x-body2.m_position0.x;var v2Y=body2.m_position.y-body2.m_position0.y;var omega2=body2.m_rotation-body2.m_rotation0;var r1=shape1.GetMaxRadius();var r2=shape2.GetMaxRadius();var p1StartX=body1.m_position0.x;var p1StartY=body1.m_position0.y;var a1Start=body1.m_rotation0;var p2StartX=body2.m_position0.x;var p2StartY=body2.m_position0.y;var a2Start=body2.m_rotation0;var p1X=p1StartX;var p1Y=p1StartY;var a1=a1Start;var p2X=p2StartX;var p2Y=p2StartY;var a2=a2Start;b2Conservative.R1.Set(a1);b2Conservative.R2.Set(a2);shape1.QuickSync(p1,b2Conservative.R1);shape2.QuickSync(p2,b2Conservative.R2);var s1=0.0;var maxIterations=10;var dX;var dY;var invRelativeVelocity=0.0;var hit=true;for(var iter=0;iter<maxiterations;++iter) {var="" distance="b2Distance.Distance(b2Conservative.x1,b2Conservative.x2,shape1,shape2);if(distance<b2Settings.b2_linearSlop)" {if(iter="=0)" {hit="false;}" else="" break;}="" if(iter="=0)" {dx="b2Conservative.x2.x-b2Conservative.x1.x;dY=b2Conservative.x2.y-b2Conservative.x1.y;var" dlen="Math.sqrt(dX*dX+dY*dY);var" relativevelocity="(dX*(v1X-v2X)+dY*(v1Y-v2Y))+Math.abs(omega1)*r1+Math.abs(omega2)*r2;if(Math.abs(relativeVelocity)<Number.MIN_VALUE)" invrelativevelocity="1.0/relativeVelocity;}" var="" ds="distance*invRelativeVelocity;var" s2="s1+ds;if(s2<0.0||1.0<s2)" if(s2<(1.0+100.0*number.min_value)*s1)="" s1="s2;p1X=p1StartX+s1*v1.x;p1Y=p1StartY+s1*v1.y;a1=a1Start+s1*omega1;p2X=p2StartX+s1*v2.x;p2Y=p2StartY+s1*v2.y;a2=a2Start+s1*omega2;b2Conservative.R1.Set(a1);b2Conservative.R2.Set(a2);shape1.QuickSync(p1,b2Conservative.R1);shape2.QuickSync(p2,b2Conservative.R2);}" if(hit)="" length="Math.sqrt(dX*dX+dY*dY);if(length">FLT_EPSILON)
{d*=b2_linearSlop/length;}
if(body1.IsStatic())
{body1.m_position.x=p1X;body1.m_position.y=p1Y;}
else
{body1.m_position.x=p1X-dX;body1.m_position.y=p1Y-dY;}
body1.m_rotation=a1;body1.m_R.Set(a1);body1.QuickSyncShapes();if(body2.IsStatic())
{body2.m_position.x=p2X;body2.m_position.y=p2Y;}
else
{body2.m_position.x=p2X+dX;body2.m_position.y=p2Y+dY;}
body2.m_position.x=p2X+dX;body2.m_position.y=p2Y+dY;body2.m_rotation=a2;body2.m_R.Set(a2);body2.QuickSyncShapes();return true;}
shape1.QuickSync(body1.m_position,body1.m_R);shape2.QuickSync(body2.m_position,body2.m_R);return false;};
var b2NullContact=Class.create();Object.extend(b2NullContact.prototype,b2Contact.prototype);Object.extend(b2NullContact.prototype,{initialize:function(s1,s2){this.m_node1=new b2ContactNode();this.m_node2=new b2ContactNode();this.m_flags=0;if(!s1||!s2){this.m_shape1=null;this.m_shape2=null;return;}
this.m_shape1=s1;this.m_shape2=s2;this.m_manifoldCount=0;this.m_friction=Math.sqrt(this.m_shape1.m_friction*this.m_shape2.m_friction);this.m_restitution=b2Math.b2Max(this.m_shape1.m_restitution,this.m_shape2.m_restitution);this.m_prev=null;this.m_next=null;this.m_node1.contact=null;this.m_node1.prev=null;this.m_node1.next=null;this.m_node1.other=null;this.m_node2.contact=null;this.m_node2.prev=null;this.m_node2.next=null;this.m_node2.other=null;},Evaluate:function(){},GetManifolds:function(){return null;}});
var b2PolyAndCircleContact=Class.create();Object.extend(b2PolyAndCircleContact.prototype,b2Contact.prototype);Object.extend(b2PolyAndCircleContact.prototype,{initialize:function(s1,s2){this.m_node1=new b2ContactNode();this.m_node2=new b2ContactNode();this.m_flags=0;if(!s1||!s2){this.m_shape1=null;this.m_shape2=null;return;}
this.m_shape1=s1;this.m_shape2=s2;this.m_manifoldCount=0;this.m_friction=Math.sqrt(this.m_shape1.m_friction*this.m_shape2.m_friction);this.m_restitution=b2Math.b2Max(this.m_shape1.m_restitution,this.m_shape2.m_restitution);this.m_prev=null;this.m_next=null;this.m_node1.contact=null;this.m_node1.prev=null;this.m_node1.next=null;this.m_node1.other=null;this.m_node2.contact=null;this.m_node2.prev=null;this.m_node2.next=null;this.m_node2.other=null;this.m_manifold=[new b2Manifold()];b2Settings.b2Assert(this.m_shape1.m_type==b2Shape.e_polyShape);b2Settings.b2Assert(this.m_shape2.m_type==b2Shape.e_circleShape);this.m_manifold[0].pointCount=0;this.m_manifold[0].points[0].normalImpulse=0.0;this.m_manifold[0].points[0].tangentImpulse=0.0;},Evaluate:function(){b2Collision.b2CollidePolyAndCircle(this.m_manifold[0],this.m_shape1,this.m_shape2,false);if(this.m_manifold[0].pointCount>0)
{this.m_manifoldCount=1;}
else
{this.m_manifoldCount=0;}},GetManifolds:function()
{return this.m_manifold;},m_manifold:[new b2Manifold()]})
b2PolyAndCircleContact.Create=function(shape1,shape2,allocator){return new b2PolyAndCircleContact(shape1,shape2);};b2PolyAndCircleContact.Destroy=function(contact,allocator){};
var b2PolyContact=Class.create();Object.extend(b2PolyContact.prototype,b2Contact.prototype);Object.extend(b2PolyContact.prototype,{initialize:function(s1,s2){this.m_node1=new b2ContactNode();this.m_node2=new b2ContactNode();this.m_flags=0;if(!s1||!s2){this.m_shape1=null;this.m_shape2=null;return;}
this.m_shape1=s1;this.m_shape2=s2;this.m_manifoldCount=0;this.m_friction=Math.sqrt(this.m_shape1.m_friction*this.m_shape2.m_friction);this.m_restitution=b2Math.b2Max(this.m_shape1.m_restitution,this.m_shape2.m_restitution);this.m_prev=null;this.m_next=null;this.m_node1.contact=null;this.m_node1.prev=null;this.m_node1.next=null;this.m_node1.other=null;this.m_node2.contact=null;this.m_node2.prev=null;this.m_node2.next=null;this.m_node2.other=null;this.m0=new b2Manifold();this.m_manifold=[new b2Manifold()];this.m_manifold[0].pointCount=0;},m0:new b2Manifold(),Evaluate:function(){var tMani=this.m_manifold[0];var tPoints=this.m0.points;for(var k=0;k<tmani.pointcount;k++){var tpoint="tPoints[k];var" tpoint0="tMani.points[k];tPoint.normalImpulse=tPoint0.normalImpulse;tPoint.tangentImpulse=tPoint0.tangentImpulse;tPoint.id=tPoint0.id.Copy();}" this.m0.pointcount="tMani.pointCount;b2Collision.b2CollidePoly(tMani,this.m_shape1,this.m_shape2,false);if(tMani.pointCount">0)
{var match=[false,false];for(var i=0;i<tmani.pointcount;++i) {var="" cp="tMani.points[i];cp.normalImpulse=0.0;cp.tangentImpulse=0.0;var" idkey="cp.id.key;for(var" j="0;j<this.m0.pointCount;++j)" {if(match[j]="=true)" continue;var="" cp0="this.m0.points[j];var" id0="cp0.id;if(id0.key==idKey)" {match[j]="true;cp.normalImpulse=cp0.normalImpulse;cp.tangentImpulse=cp0.tangentImpulse;break;}}}" this.m_manifoldcount="1;}" else="" {this.m_manifoldcount="0;}},GetManifolds:function()" {return="" this.m_manifold;},m_manifold:[new="" b2manifold()]});b2polycontact.create="function(shape1,shape2,allocator){return" new="" b2polycontact(shape1,shape2);};b2polycontact.destroy="function(contact,allocator){};" var="" b2contactmanager="Class.create();Object.extend(b2ContactManager.prototype,b2PairCallback.prototype);Object.extend(b2ContactManager.prototype,{initialize:function(){this.m_nullContact=new" b2nullcontact();this.m_world="null;this.m_destroyImmediate=false;},PairAdded:function(proxyUserData1,proxyUserData2){var" shape1="proxyUserData1;var" shape2="proxyUserData2;var" body1="shape1.m_body;var" body2="shape2.m_body;if(body1.IsStatic()&&body2.IsStatic())" this.m_nullcontact;}="" if(shape1.m_body="=shape2.m_body)" if(body2.isconnected(body1))="" if(this.m_world.m_filter!="null&&this.m_world.m_filter.ShouldCollide(shape1,shape2)==false)" if(body2.m_invmass="=0.0)" tempshape="shape1;shape1=shape2;shape2=tempShape;var" tempbody="body1;body1=body2;body2=tempBody;}" contact="b2Contact.Create(shape1,shape2,this.m_world.m_blockAllocator);if(contact==null)" {contact.m_prev="null;contact.m_next=this.m_world.m_contactList;if(this.m_world.m_contactList!=null)" {this.m_world.m_contactlist.m_prev="contact;}" this.m_world.m_contactlist="contact;this.m_world.m_contactCount++;}" return="" contact;},pairremoved:function(proxyuserdata1,proxyuserdata2,pairuserdata){if(pairuserdata="=null)" {return;}="" c="pairUserData;if(c!=this.m_nullContact)" {if(this.m_destroyimmediate="=true)" {this.destroycontact(c);c="null;}" {c.m_flags|="b2Contact.e_destroyFlag;}}},DestroyContact:function(c)" {if(c.m_prev)="" {c.m_prev.m_next="c.m_next;}" if(c.m_next)="" {c.m_next.m_prev="c.m_prev;}" if(c="=this.m_world.m_contactList)" {this.m_world.m_contactlist="c.m_next;}" if(c.getmanifoldcount()="">0)
{var body1=c.m_shape1.m_body;var body2=c.m_shape2.m_body;var node1=c.m_node1;var node2=c.m_node2;body1.WakeUp();body2.WakeUp();if(node1.prev)
{node1.prev.next=node1.next;}
if(node1.next)
{node1.next.prev=node1.prev;}
if(node1==body1.m_contactList)
{body1.m_contactList=node1.next;}
node1.prev=null;node1.next=null;if(node2.prev)
{node2.prev.next=node2.next;}
if(node2.next)
{node2.next.prev=node2.prev;}
if(node2==body2.m_contactList)
{body2.m_contactList=node2.next;}
node2.prev=null;node2.next=null;}
b2Contact.Destroy(c,this.m_world.m_blockAllocator);--this.m_world.m_contactCount;},CleanContactList:function()
{var c=this.m_world.m_contactList;while(c!=null)
{var c0=c;c=c.m_next;if(c0.m_flags&b2Contact.e_destroyFlag)
{this.DestroyContact(c0);c0=null;}}},Collide:function()
{var body1;var body2;var node1;var node2;for(var c=this.m_world.m_contactList;c!=null;c=c.m_next)
{if(c.m_shape1.m_body.IsSleeping()&&c.m_shape2.m_body.IsSleeping())
{continue;}
var oldCount=c.GetManifoldCount();c.Evaluate();var newCount=c.GetManifoldCount();if(oldCount==0&&newCount>0)
{body1=c.m_shape1.m_body;body2=c.m_shape2.m_body;node1=c.m_node1;node2=c.m_node2;node1.contact=c;node1.other=body2;node1.prev=null;node1.next=body1.m_contactList;if(node1.next!=null)
{node1.next.prev=c.m_node1;}
body1.m_contactList=c.m_node1;node2.contact=c;node2.other=body1;node2.prev=null;node2.next=body2.m_contactList;if(node2.next!=null)
{node2.next.prev=node2;}
body2.m_contactList=node2;}
else if(oldCount>0&&newCount==0)
{body1=c.m_shape1.m_body;body2=c.m_shape2.m_body;node1=c.m_node1;node2=c.m_node2;if(node1.prev)
{node1.prev.next=node1.next;}
if(node1.next)
{node1.next.prev=node1.prev;}
if(node1==body1.m_contactList)
{body1.m_contactList=node1.next;}
node1.prev=null;node1.next=null;if(node2.prev)
{node2.prev.next=node2.next;}
if(node2.next)
{node2.next.prev=node2.prev;}
if(node2==body2.m_contactList)
{body2.m_contactList=node2.next;}
node2.prev=null;node2.next=null;}}},m_world:null,m_nullContact:new b2NullContact(),m_destroyImmediate:null});
var b2World=Class.create();b2World.prototype={initialize:function(worldAABB,gravity,doSleep){this.step=new b2TimeStep();this.m_contactManager=new b2ContactManager();this.m_listener=null;this.m_filter=b2CollisionFilter.b2_defaultFilter;this.m_bodyList=null;this.m_contactList=null;this.m_jointList=null;this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0;this.m_bodyDestroyList=null;this.m_allowSleep=doSleep;this.m_gravity=gravity;this.m_contactManager.m_world=this;this.m_broadPhase=new b2BroadPhase(worldAABB,this.m_contactManager);var bd=new b2BodyDef();this.m_groundBody=this.CreateBody(bd);},SetListener:function(listener){this.m_listener=listener;},SetFilter:function(filter){this.m_filter=filter;},CreateBody:function(def){var b=new b2Body(def,this);b.m_prev=null;b.m_next=this.m_bodyList;if(this.m_bodyList)
{this.m_bodyList.m_prev=b;}
this.m_bodyList=b;++this.m_bodyCount;return b;},DestroyBody:function(b)
{if(b.m_flags&b2Body.e_destroyFlag)
{return;}
if(b.m_prev)
{b.m_prev.m_next=b.m_next;}
if(b.m_next)
{b.m_next.m_prev=b.m_prev;}
if(b==this.m_bodyList)
{this.m_bodyList=b.m_next;}
b.m_flags|=b2Body.e_destroyFlag;--this.m_bodyCount;b.m_prev=null;b.m_next=this.m_bodyDestroyList;this.m_bodyDestroyList=b;},CleanBodyList:function()
{this.m_contactManager.m_destroyImmediate=true;var b=this.m_bodyDestroyList;while(b)
{var b0=b;b=b.m_next;var jn=b0.m_jointList;while(jn)
{var jn0=jn;jn=jn.next;if(this.m_listener)
{this.m_listener.NotifyJointDestroyed(jn0.joint);}
this.DestroyJoint(jn0.joint);}
b0.Destroy();}
this.m_bodyDestroyList=null;this.m_contactManager.m_destroyImmediate=false;},CreateJoint:function(def){var j=b2Joint.Create(def,this.m_blockAllocator);j.m_prev=null;j.m_next=this.m_jointList;if(this.m_jointList)
{this.m_jointList.m_prev=j;}
this.m_jointList=j;++this.m_jointCount;j.m_node1.joint=j;j.m_node1.other=j.m_body2;j.m_node1.prev=null;j.m_node1.next=j.m_body1.m_jointList;if(j.m_body1.m_jointList)j.m_body1.m_jointList.prev=j.m_node1;j.m_body1.m_jointList=j.m_node1;j.m_node2.joint=j;j.m_node2.other=j.m_body1;j.m_node2.prev=null;j.m_node2.next=j.m_body2.m_jointList;if(j.m_body2.m_jointList)j.m_body2.m_jointList.prev=j.m_node2;j.m_body2.m_jointList=j.m_node2;if(def.collideConnected==false)
{var b=def.body1.m_shapeCount<def.body2.m_shapecount?def.body1:def.body2;for(var s="b.m_shapeList;s;s=s.m_next)" {s.resetproxy(this.m_broadphase);}}="" return="" j;},destroyjoint:function(j)="" {var="" collideconnected="j.m_collideConnected;if(j.m_prev)" {j.m_prev.m_next="j.m_next;}" if(j.m_next)="" {j.m_next.m_prev="j.m_prev;}" if(j="=this.m_jointList)" {this.m_jointlist="j.m_next;}" var="" body1="j.m_body1;var" body2="j.m_body2;body1.WakeUp();body2.WakeUp();if(j.m_node1.prev)" {j.m_node1.prev.next="j.m_node1.next;}" if(j.m_node1.next)="" {j.m_node1.next.prev="j.m_node1.prev;}" if(j.m_node1="=body1.m_jointList)" {body1.m_jointlist="j.m_node1.next;}" j.m_node1.prev="null;j.m_node1.next=null;if(j.m_node2.prev)" {j.m_node2.prev.next="j.m_node2.next;}" if(j.m_node2.next)="" {j.m_node2.next.prev="j.m_node2.prev;}" if(j.m_node2="=body2.m_jointList)" {body2.m_jointlist="j.m_node2.next;}" j.m_node2.prev="null;j.m_node2.next=null;b2Joint.Destroy(j,this.m_blockAllocator);--this.m_jointCount;if(collideConnected==false)" b="body1.m_shapeCount<body2.m_shapeCount?body1:body2;for(var" {s.resetproxy(this.m_broadphase);}}},getgroundbody:function(){return="" this.m_groundbody;},step:new="" b2timestep(),step:function(dt,iterations){var="" b;var="" other;this.step.dt="dt;this.step.iterations=iterations;if(dt">0.0)
{this.step.inv_dt=1.0/dt;}
else
{this.step.inv_dt=0.0;}
this.m_positionIterationCount=0;this.m_contactManager.CleanContactList();this.CleanBodyList();this.m_contactManager.Collide();var island=new b2Island(this.m_bodyCount,this.m_contactCount,this.m_jointCount,this.m_stackAllocator);for(b=this.m_bodyList;b!=null;b=b.m_next)
{b.m_flags&=~b2Body.e_islandFlag;}
for(var c=this.m_contactList;c!=null;c=c.m_next)
{c.m_flags&=~b2Contact.e_islandFlag;}
for(var j=this.m_jointList;j!=null;j=j.m_next)
{j.m_islandFlag=false;}
var stackSize=this.m_bodyCount;var stack=new Array(this.m_bodyCount);for(var k=0;k<this.m_bodycount;k++) stack[k]="null;for(var" seed="this.m_bodyList;seed!=null;seed=seed.m_next)" {if(seed.m_flags&(b2body.e_staticflag|b2body.e_islandflag|b2body.e_sleepflag|b2body.e_frozenflag))="" {continue;}="" island.clear();var="" stackcount="0;stack[stackCount++]=seed;seed.m_flags|=b2Body.e_islandFlag;;while(stackCount">0)
{b=stack[--stackCount];island.AddBody(b);b.m_flags&=~b2Body.e_sleepFlag;if(b.m_flags&b2Body.e_staticFlag)
{continue;}
for(var cn=b.m_contactList;cn!=null;cn=cn.next)
{if(cn.contact.m_flags&b2Contact.e_islandFlag)
{continue;}
island.AddContact(cn.contact);cn.contact.m_flags|=b2Contact.e_islandFlag;other=cn.other;if(other.m_flags&b2Body.e_islandFlag)
{continue;}
stack[stackCount++]=other;other.m_flags|=b2Body.e_islandFlag;}
for(var jn=b.m_jointList;jn!=null;jn=jn.next)
{if(jn.joint.m_islandFlag==true)
{continue;}
island.AddJoint(jn.joint);jn.joint.m_islandFlag=true;other=jn.other;if(other.m_flags&b2Body.e_islandFlag)
{continue;}
stack[stackCount++]=other;other.m_flags|=b2Body.e_islandFlag;}}
island.Solve(this.step,this.m_gravity);this.m_positionIterationCount=b2Math.b2Max(this.m_positionIterationCount,b2Island.m_positionIterationCount);if(this.m_allowSleep)
{island.UpdateSleep(dt);}
for(var i=0;i<island.m_bodycount;++i) {b="island.m_bodies[i];if(b.m_flags&b2Body.e_staticFlag)" {b.m_flags&="~b2Body.e_islandFlag;}" if(b.isfrozen()&&this.m_listener)="" {var="" response="this.m_listener.NotifyBoundaryViolated(b);if(response==b2WorldListener.b2_destroyBody)" {this.destroybody(b);b="null;island.m_bodies[i]=null;}}}}" this.m_broadphase.commit();},query:function(aabb,shapes,maxcount){var="" results="new" array();var="" count="this.m_broadPhase.QueryAABB(aabb,results,maxCount);for(var" i="0;i<count;++i)" {shapes[i]="results[i];}" return="" count;},getbodylist:function(){return="" this.m_bodylist;},getjointlist:function(){return="" this.m_jointlist;},getcontactlist:function(){return="" this.m_contactlist;},m_blockallocator:null,m_stackallocator:null,m_broadphase:null,m_contactmanager:new="" b2contactmanager(),m_bodylist:null,m_contactlist:null,m_jointlist:null,m_bodycount:0,m_contactcount:0,m_jointcount:0,m_bodydestroylist:null,m_gravity:null,m_allowsleep:null,m_groundbody:null,m_listener:null,m_filter:null,m_positioniterationcount:0};b2world.s_enablepositioncorrection="1;b2World.s_enableWarmStarting=1;" var="" b2worldlistener="Class.create();b2WorldListener.prototype={NotifyJointDestroyed:function(joint){},NotifyBoundaryViolated:function(body)" {return="" b2worldlistener.b2_freezebody;},initialize:function(){}};b2worldlistener.b2_freezebody="0;b2WorldListener.b2_destroyBody=1;" b2jointnode="Class.create();b2JointNode.prototype={other:null,joint:null,prev:null,next:null,initialize:function(){}}" b2joint="Class.create();b2Joint.prototype={GetType:function(){return" this.m_type;},getanchor1:function(){return="" null},getanchor2:function(){return="" null},getreactionforce:function(invtimestep){return="" null},getreactiontorque:function(invtimestep){return="" 0.0},getbody1:function()="" this.m_body1;},getbody2:function()="" this.m_body2;},getnext:function(){return="" this.m_next;},getuserdata:function(){return="" this.m_userdata;},initialize:function(def){this.m_node1="new" b2jointnode();this.m_node2="new" b2jointnode();this.m_type="def.type;this.m_prev=null;this.m_next=null;this.m_body1=def.body1;this.m_body2=def.body2;this.m_collideConnected=def.collideConnected;this.m_islandFlag=false;this.m_userData=def.userData;},PrepareVelocitySolver:function(){},SolveVelocityConstraints:function(step){},PreparePositionSolver:function(){},SolvePositionConstraints:function(){return" false},m_type:0,m_prev:null,m_next:null,m_node1:new="" b2jointnode(),m_node2:new="" b2jointnode(),m_body1:null,m_body2:null,m_islandflag:null,m_collideconnected:null,m_userdata:null};b2joint.create="function(def,allocator){var" joint="null;switch(def.type)" {case="" b2joint.e_distancejoint:{joint="new" b2distancejoint(def);}="" break;case="" b2joint.e_mousejoint:{joint="new" b2mousejoint(def);}="" b2joint.e_prismaticjoint:{joint="new" b2prismaticjoint(def);}="" b2joint.e_revolutejoint:{joint="new" b2revolutejoint(def);}="" b2joint.e_pulleyjoint:{joint="new" b2pulleyjoint(def);}="" b2joint.e_gearjoint:{joint="new" b2gearjoint(def);}="" break;default:break;}="" joint;};b2joint.destroy="function(joint,allocator){};b2Joint.e_unknownJoint=0;b2Joint.e_revoluteJoint=1;b2Joint.e_prismaticJoint=2;b2Joint.e_distanceJoint=3;b2Joint.e_pulleyJoint=4;b2Joint.e_mouseJoint=5;b2Joint.e_gearJoint=6;b2Joint.e_inactiveLimit=0;b2Joint.e_atLowerLimit=1;b2Joint.e_atUpperLimit=2;b2Joint.e_equalLimits=3;" b2jointdef="Class.create();b2JointDef.prototype={initialize:function()" {this.type="b2Joint.e_unknownJoint;this.userData=null;this.body1=null;this.body2=null;this.collideConnected=false;},type:0,userData:null,body1:null,body2:null,collideConnected:null}" b2distancejoint="Class.create();Object.extend(b2DistanceJoint.prototype,b2Joint.prototype);Object.extend(b2DistanceJoint.prototype,{initialize:function(def){this.m_node1=new" b2vec2();this.m_localanchor2="new" b2vec2();this.m_u="new" b2vec2();var="" tmat;var="" tx;var="" ty;tmat="this.m_body1.m_R;tX=def.anchorPoint1.x-this.m_body1.m_position.x;tY=def.anchorPoint1.y-this.m_body1.m_position.y;this.m_localAnchor1.x=tX*tMat.col1.x+tY*tMat.col1.y;this.m_localAnchor1.y=tX*tMat.col2.x+tY*tMat.col2.y;tMat=this.m_body2.m_R;tX=def.anchorPoint2.x-this.m_body2.m_position.x;tY=def.anchorPoint2.y-this.m_body2.m_position.y;this.m_localAnchor2.x=tX*tMat.col1.x+tY*tMat.col1.y;this.m_localAnchor2.y=tX*tMat.col2.x+tY*tMat.col2.y;tX=def.anchorPoint2.x-def.anchorPoint1.x;tY=def.anchorPoint2.y-def.anchorPoint1.y;this.m_length=Math.sqrt(tX*tX+tY*tY);this.m_impulse=0.0;},PrepareVelocitySolver:function(){var" tmat;tmat="this.m_body1.m_R;var" r1x="tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y;var" r1y="tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y;tMat=this.m_body2.m_R;var" r2x="tMat.col1.x*this.m_localAnchor2.x+tMat.col2.x*this.m_localAnchor2.y;var" r2y="tMat.col1.y*this.m_localAnchor2.x+tMat.col2.y*this.m_localAnchor2.y;this.m_u.x=this.m_body2.m_position.x+r2X-this.m_body1.m_position.x-r1X;this.m_u.y=this.m_body2.m_position.y+r2Y-this.m_body1.m_position.y-r1Y;var" length="Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);if(length">b2Settings.b2_linearSlop)
{this.m_u.Multiply(1.0/length);}
else
{this.m_u.SetZero();}
var cr1u=(r1X*this.m_u.y-r1Y*this.m_u.x);var cr2u=(r2X*this.m_u.y-r2Y*this.m_u.x);this.m_mass=this.m_body1.m_invMass+this.m_body1.m_invI*cr1u*cr1u+this.m_body2.m_invMass+this.m_body2.m_invI*cr2u*cr2u;this.m_mass=1.0/this.m_mass;if(b2World.s_enableWarmStarting)
{var PX=this.m_impulse*this.m_u.x;var PY=this.m_impulse*this.m_u.y;this.m_body1.m_linearVelocity.x-=this.m_body1.m_invMass*PX;this.m_body1.m_linearVelocity.y-=this.m_body1.m_invMass*PY;this.m_body1.m_angularVelocity-=this.m_body1.m_invI*(r1X*PY-r1Y*PX);this.m_body2.m_linearVelocity.x+=this.m_body2.m_invMass*PX;this.m_body2.m_linearVelocity.y+=this.m_body2.m_invMass*PY;this.m_body2.m_angularVelocity+=this.m_body2.m_invI*(r2X*PY-r2Y*PX);}
else
{this.m_impulse=0.0;}},SolveVelocityConstraints:function(step){var tMat;tMat=this.m_body1.m_R;var r1X=tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y;var r1Y=tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y;tMat=this.m_body2.m_R;var r2X=tMat.col1.x*this.m_localAnchor2.x+tMat.col2.x*this.m_localAnchor2.y;var r2Y=tMat.col1.y*this.m_localAnchor2.x+tMat.col2.y*this.m_localAnchor2.y;var v1X=this.m_body1.m_linearVelocity.x+(-this.m_body1.m_angularVelocity*r1Y);var v1Y=this.m_body1.m_linearVelocity.y+(this.m_body1.m_angularVelocity*r1X);var v2X=this.m_body2.m_linearVelocity.x+(-this.m_body2.m_angularVelocity*r2Y);var v2Y=this.m_body2.m_linearVelocity.y+(this.m_body2.m_angularVelocity*r2X);var Cdot=(this.m_u.x*(v2X-v1X)+this.m_u.y*(v2Y-v1Y));var impulse=-this.m_mass*Cdot;this.m_impulse+=impulse;var PX=impulse*this.m_u.x;var PY=impulse*this.m_u.y;this.m_body1.m_linearVelocity.x-=this.m_body1.m_invMass*PX;this.m_body1.m_linearVelocity.y-=this.m_body1.m_invMass*PY;this.m_body1.m_angularVelocity-=this.m_body1.m_invI*(r1X*PY-r1Y*PX);this.m_body2.m_linearVelocity.x+=this.m_body2.m_invMass*PX;this.m_body2.m_linearVelocity.y+=this.m_body2.m_invMass*PY;this.m_body2.m_angularVelocity+=this.m_body2.m_invI*(r2X*PY-r2Y*PX);},SolvePositionConstraints:function(){var tMat;tMat=this.m_body1.m_R;var r1X=tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y;var r1Y=tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y;tMat=this.m_body2.m_R;var r2X=tMat.col1.x*this.m_localAnchor2.x+tMat.col2.x*this.m_localAnchor2.y;var r2Y=tMat.col1.y*this.m_localAnchor2.x+tMat.col2.y*this.m_localAnchor2.y;var dX=this.m_body2.m_position.x+r2X-this.m_body1.m_position.x-r1X;var dY=this.m_body2.m_position.y+r2Y-this.m_body1.m_position.y-r1Y;var length=Math.sqrt(dX*dX+dY*dY);dX/=length;dY/=length;var C=length-this.m_length;C=b2Math.b2Clamp(C,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection);var impulse=-this.m_mass*C;this.m_u.Set(dX,dY);var PX=impulse*this.m_u.x;var PY=impulse*this.m_u.y;this.m_body1.m_position.x-=this.m_body1.m_invMass*PX;this.m_body1.m_position.y-=this.m_body1.m_invMass*PY;this.m_body1.m_rotation-=this.m_body1.m_invI*(r1X*PY-r1Y*PX);this.m_body2.m_position.x+=this.m_body2.m_invMass*PX;this.m_body2.m_position.y+=this.m_body2.m_invMass*PY;this.m_body2.m_rotation+=this.m_body2.m_invI*(r2X*PY-r2Y*PX);this.m_body1.m_R.Set(this.m_body1.m_rotation);this.m_body2.m_R.Set(this.m_body2.m_rotation);return b2Math.b2Abs(C)<b2settings.b2_linearslop;},getanchor1:function(){return b2math.addvv(this.m_body1.m_position,b2math.b2mulmv(this.m_body1.m_r,this.m_localanchor1));},getanchor2:function(){return="" b2math.addvv(this.m_body2.m_position,b2math.b2mulmv(this.m_body2.m_r,this.m_localanchor2));},getreactionforce:function(invtimestep)="" {var="" f="new" b2vec2();f.setv(this.m_u);f.multiply(this.m_impulse*invtimestep);return="" f;},getreactiontorque:function(invtimestep)="" {return="" 0.0;},m_localanchor1:new="" b2vec2(),m_localanchor2:new="" b2vec2(),m_u:new="" b2vec2(),m_impulse:null,m_mass:null,m_length:null});="" var="" b2distancejointdef="Class.create();Object.extend(b2DistanceJointDef.prototype,b2JointDef.prototype);Object.extend(b2DistanceJointDef.prototype,{initialize:function()" {this.type="b2Joint.e_unknownJoint;this.userData=null;this.body1=null;this.body2=null;this.collideConnected=false;this.anchorPoint1=new" b2vec2();this.anchorpoint2="new" b2vec2();this.type="b2Joint.e_distanceJoint;},anchorPoint1:new" b2vec2(),anchorpoint2:new="" b2vec2()});="" b2jacobian="Class.create();b2Jacobian.prototype={linear1:new" b2vec2(),angular1:null,linear2:new="" b2vec2(),angular2:null,setzero:function(){this.linear1.setzero();this.angular1="0.0;this.linear2.SetZero();this.angular2=0.0;},Set:function(x1,a1,x2,a2){this.linear1.SetV(x1);this.angular1=a1;this.linear2.SetV(x2);this.angular2=a2;},Compute:function(x1,a1,x2,a2){return(this.linear1.x*x1.x+this.linear1.y*x1.y)+this.angular1*a1+(this.linear2.x*x2.x+this.linear2.y*x2.y)+this.angular2*a2;},initialize:function(){this.linear1=new" b2vec2();this.linear2="new" b2vec2();}};="" b2gearjoint="Class.create();Object.extend(b2GearJoint.prototype,b2Joint.prototype);Object.extend(b2GearJoint.prototype,{GetAnchor1:function(){var" tmat="this.m_body1.m_R;return" new="" b2vec2(this.m_body1.m_position.x+(tmat.col1.x*this.m_localanchor1.x+tmat.col2.x*this.m_localanchor1.y),this.m_body1.m_position.y+(tmat.col1.y*this.m_localanchor1.x+tmat.col2.y*this.m_localanchor1.y));},getanchor2:function(){var="" b2vec2(this.m_body2.m_position.x+(tmat.col1.x*this.m_localanchor2.x+tmat.col2.x*this.m_localanchor2.y),this.m_body2.m_position.y+(tmat.col1.y*this.m_localanchor2.x+tmat.col2.y*this.m_localanchor2.y));},getreactionforce:function(invtimestep){return="" b2vec2();},getreactiontorque:function(invtimestep){return="" 0.0;},getratio:function(){return="" this.m_ratio;},initialize:function(def){this.m_node1="new" b2jointnode();this.m_node2="new" b2jointnode();this.m_type="def.type;this.m_prev=null;this.m_next=null;this.m_body1=def.body1;this.m_body2=def.body2;this.m_collideConnected=def.collideConnected;this.m_islandFlag=false;this.m_userData=def.userData;this.m_groundAnchor1=new" b2vec2();this.m_groundanchor2="new" b2vec2();this.m_localanchor1="new" b2vec2();this.m_localanchor2="new" b2vec2();this.m_j="new" b2jacobian();this.m_revolute1="null;this.m_prismatic1=null;this.m_revolute2=null;this.m_prismatic2=null;var" coordinate1;var="" coordinate2;this.m_ground1="def.joint1.m_body1;this.m_body1=def.joint1.m_body2;if(def.joint1.m_type==b2Joint.e_revoluteJoint)" {this.m_revolute1="def.joint1;this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1);this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2);coordinate1=this.m_revolute1.GetJointAngle();}" else="" {this.m_prismatic1="def.joint1;this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1);this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2);coordinate1=this.m_prismatic1.GetJointTranslation();}" this.m_ground2="def.joint2.m_body1;this.m_body2=def.joint2.m_body2;if(def.joint2.m_type==b2Joint.e_revoluteJoint)" {this.m_revolute2="def.joint2;this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1);this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2);coordinate2=this.m_revolute2.GetJointAngle();}" {this.m_prismatic2="def.joint2;this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1);this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2);coordinate2=this.m_prismatic2.GetJointTranslation();}" this.m_ratio="def.ratio;this.m_constant=coordinate1+this.m_ratio*coordinate2;this.m_impulse=0.0;},PrepareVelocitySolver:function(){var" g1="this.m_ground1;var" g2="this.m_ground2;var" b1="this.m_body1;var" b2="this.m_body2;var" ugx;var="" ugy;var="" rx;var="" ry;var="" tmat;var="" tvec;var="" crug;var="" k="0.0;this.m_J.SetZero();if(this.m_revolute1)" {this.m_j.angular1="-1.0;K+=b1.m_invI;}" {tmat="g1.m_R;tVec=this.m_prismatic1.m_localXAxis1;ugX=tMat.col1.x*tVec.x+tMat.col2.x*tVec.y;ugY=tMat.col1.y*tVec.x+tMat.col2.y*tVec.y;tMat=b1.m_R;rX=tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y;rY=tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y;crug=rX*ugY-rY*ugX;this.m_J.linear1.Set(-ugX,-ugY);this.m_J.angular1=-crug;K+=b1.m_invMass+b1.m_invI*crug*crug;}" if(this.m_revolute2)="" {this.m_j.angular2="-this.m_ratio;K+=this.m_ratio*this.m_ratio*b2.m_invI;}" this.m_mass="1.0/K;b1.m_linearVelocity.x+=b1.m_invMass*this.m_impulse*this.m_J.linear1.x;b1.m_linearVelocity.y+=b1.m_invMass*this.m_impulse*this.m_J.linear1.y;b1.m_angularVelocity+=b1.m_invI*this.m_impulse*this.m_J.angular1;b2.m_linearVelocity.x+=b2.m_invMass*this.m_impulse*this.m_J.linear2.x;b2.m_linearVelocity.y+=b2.m_invMass*this.m_impulse*this.m_J.linear2.y;b2.m_angularVelocity+=b2.m_invI*this.m_impulse*this.m_J.angular2;},SolveVelocityConstraints:function(step){var" cdot="this.m_J.Compute(b1.m_linearVelocity,b1.m_angularVelocity,b2.m_linearVelocity,b2.m_angularVelocity);var" impulse="-this.m_mass*Cdot;this.m_impulse+=impulse;b1.m_linearVelocity.x+=b1.m_invMass*impulse*this.m_J.linear1.x;b1.m_linearVelocity.y+=b1.m_invMass*impulse*this.m_J.linear1.y;b1.m_angularVelocity+=b1.m_invI*impulse*this.m_J.angular1;b2.m_linearVelocity.x+=b2.m_invMass*impulse*this.m_J.linear2.x;b2.m_linearVelocity.y+=b2.m_invMass*impulse*this.m_J.linear2.y;b2.m_angularVelocity+=b2.m_invI*impulse*this.m_J.angular2;},SolvePositionConstraints:function(){var" linearerror="0.0;var" coordinate2;if(this.m_revolute1)="" {coordinate1="this.m_revolute1.GetJointAngle();}" {coordinate2="this.m_revolute2.GetJointAngle();}" c="this.m_constant-(coordinate1+this.m_ratio*coordinate2);var" linearerror<b2settings.b2_linearslop;},m_ground1:null,m_ground2:null,m_revolute1:null,m_prismatic1:null,m_revolute2:null,m_prismatic2:null,m_groundanchor1:new="" b2vec2(),m_groundanchor2:new="" b2vec2(),m_localanchor1:new="" b2vec2(),m_j:new="" b2jacobian(),m_constant:null,m_ratio:null,m_mass:null,m_impulse:null});="" b2gearjointdef="Class.create();Object.extend(b2GearJointDef.prototype,b2JointDef.prototype);Object.extend(b2GearJointDef.prototype,{initialize:function()" b2mousejoint="Class.create();Object.extend(b2MouseJoint.prototype,b2Joint.prototype);Object.extend(b2MouseJoint.prototype,{GetAnchor1:function(){return" this.m_target;},getanchor2:function(){var="" tvec="b2Math.b2MulMV(this.m_body2.m_R,this.m_localAnchor);tVec.Add(this.m_body2.m_position);return" tvec;},getreactionforce:function(invtimestep)="" b2vec2();f.setv(this.m_impulse);f.multiply(invtimestep);return="" 0.0;},settarget:function(target){this.m_body2.wakeup();this.m_target="target;},initialize:function(def){this.m_node1=new" b2mat22();this.k1="new" b2mat22();this.k2="new" b2mat22();this.m_localanchor="new" b2vec2();this.m_target="new" b2vec2();this.m_impulse="new" b2vec2();this.m_ptpmass="new" b2mat22();this.m_c="new" b2vec2();this.m_target.setv(def.target);var="" tx="this.m_target.x-this.m_body2.m_position.x;var" ty="this.m_target.y-this.m_body2.m_position.y;this.m_localAnchor.x=(tX*this.m_body2.m_R.col1.x+tY*this.m_body2.m_R.col1.y);this.m_localAnchor.y=(tX*this.m_body2.m_R.col2.x+tY*this.m_body2.m_R.col2.y);this.m_maxForce=def.maxForce;this.m_impulse.SetZero();var" mass="this.m_body2.m_mass;var" omega="2.0*b2Settings.b2_pi*def.frequencyHz;var" d="2.0*mass*def.dampingRatio*omega;var" b2mat22(),k1:new="" b2mat22(),k2:new="" b2mat22(),preparevelocitysolver:function(){var="" b="this.m_body2;var" tmat;tmat="b.m_R;var" rx="tMat.col1.x*this.m_localAnchor.x+tMat.col2.x*this.m_localAnchor.y;var" ry="tMat.col1.y*this.m_localAnchor.x+tMat.col2.y*this.m_localAnchor.y;var" invmass="b.m_invMass;var" invi="b.m_invI;this.K1.col1.x=invMass;this.K1.col2.x=0.0;this.K1.col1.y=0.0;this.K1.col2.y=invMass;this.K2.col1.x=invI*rY*rY;this.K2.col2.x=-invI*rX*rY;this.K2.col1.y=-invI*rX*rY;this.K2.col2.y=invI*rX*rX;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.col1.x+=this.m_gamma;this.K.col2.y+=this.m_gamma;this.K.Invert(this.m_ptpMass);this.m_C.x=b.m_position.x+rX-this.m_target.x;this.m_C.y=b.m_position.y+rY-this.m_target.y;b.m_angularVelocity*=0.98;var" px="this.m_impulse.x;var" py="this.m_impulse.y;b.m_linearVelocity.x+=invMass*PX;b.m_linearVelocity.y+=invMass*PY;b.m_angularVelocity+=invI*(rX*PY-rY*PX);},SolveVelocityConstraints:function(step){var" body="this.m_body2;var" cdotx="body.m_linearVelocity.x+(-body.m_angularVelocity*rY);var" cdoty="body.m_linearVelocity.y+(body.m_angularVelocity*rX);tMat=this.m_ptpMass;var" impulsex="-(tMat.col1.x*tX+tMat.col2.x*tY);var" impulsey="-(tMat.col1.y*tX+tMat.col2.y*tY);var" oldimpulsex="this.m_impulse.x;var" oldimpulsey="this.m_impulse.y;this.m_impulse.x+=impulseX;this.m_impulse.y+=impulseY;var" length="this.m_impulse.Length();if(length">step.dt*this.m_maxForce)
{this.m_impulse.Multiply(step.dt*this.m_maxForce/length);}
impulseX=this.m_impulse.x-oldImpulseX;impulseY=this.m_impulse.y-oldImpulseY;body.m_linearVelocity.x+=body.m_invMass*impulseX;body.m_linearVelocity.y+=body.m_invMass*impulseY;body.m_angularVelocity+=body.m_invI*(rX*impulseY-rY*impulseX);},SolvePositionConstraints:function(){return true;},m_localAnchor:new b2Vec2(),m_target:new b2Vec2(),m_impulse:new b2Vec2(),m_ptpMass:new b2Mat22(),m_C:new b2Vec2(),m_maxForce:null,m_beta:null,m_gamma:null});
var b2MouseJointDef=Class.create();Object.extend(b2MouseJointDef.prototype,b2JointDef.prototype);Object.extend(b2MouseJointDef.prototype,{initialize:function()
{this.type=b2Joint.e_unknownJoint;this.userData=null;this.body1=null;this.body2=null;this.collideConnected=false;this.target=new b2Vec2();this.type=b2Joint.e_mouseJoint;this.maxForce=0.0;this.frequencyHz=5.0;this.dampingRatio=0.7;this.timeStep=1.0/60.0;},target:new b2Vec2(),maxForce:null,frequencyHz:null,dampingRatio:null,timeStep:null});
var b2PrismaticJoint=Class.create();Object.extend(b2PrismaticJoint.prototype,b2Joint.prototype);Object.extend(b2PrismaticJoint.prototype,{GetAnchor1:function(){var b1=this.m_body1;var tVec=new b2Vec2();tVec.SetV(this.m_localAnchor1);tVec.MulM(b1.m_R);tVec.Add(b1.m_position);return tVec;},GetAnchor2:function(){var b2=this.m_body2;var tVec=new b2Vec2();tVec.SetV(this.m_localAnchor2);tVec.MulM(b2.m_R);tVec.Add(b2.m_position);return tVec;},GetJointTranslation:function(){var b1=this.m_body1;var b2=this.m_body2;var tMat;tMat=b1.m_R;var r1X=tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y;var r1Y=tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y;tMat=b2.m_R;var r2X=tMat.col1.x*this.m_localAnchor2.x+tMat.col2.x*this.m_localAnchor2.y;var r2Y=tMat.col1.y*this.m_localAnchor2.x+tMat.col2.y*this.m_localAnchor2.y;var p1X=b1.m_position.x+r1X;var p1Y=b1.m_position.y+r1Y;var p2X=b2.m_position.x+r2X;var p2Y=b2.m_position.y+r2Y;var dX=p2X-p1X;var dY=p2Y-p1Y;tMat=b1.m_R;var ax1X=tMat.col1.x*this.m_localXAxis1.x+tMat.col2.x*this.m_localXAxis1.y;var ax1Y=tMat.col1.y*this.m_localXAxis1.x+tMat.col2.y*this.m_localXAxis1.y;var translation=ax1X*dX+ax1Y*dY;return translation;},GetJointSpeed:function(){var b1=this.m_body1;var b2=this.m_body2;var tMat;tMat=b1.m_R;var r1X=tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y;var r1Y=tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y;tMat=b2.m_R;var r2X=tMat.col1.x*this.m_localAnchor2.x+tMat.col2.x*this.m_localAnchor2.y;var r2Y=tMat.col1.y*this.m_localAnchor2.x+tMat.col2.y*this.m_localAnchor2.y;var p1X=b1.m_position.x+r1X;var p1Y=b1.m_position.y+r1Y;var p2X=b2.m_position.x+r2X;var p2Y=b2.m_position.y+r2Y;var dX=p2X-p1X;var dY=p2Y-p1Y;tMat=b1.m_R;var ax1X=tMat.col1.x*this.m_localXAxis1.x+tMat.col2.x*this.m_localXAxis1.y;var ax1Y=tMat.col1.y*this.m_localXAxis1.x+tMat.col2.y*this.m_localXAxis1.y;var v1=b1.m_linearVelocity;var v2=b2.m_linearVelocity;var w1=b1.m_angularVelocity;var w2=b2.m_angularVelocity;var speed=(dX*(-w1*ax1Y)+dY*(w1*ax1X))+(ax1X*(((v2.x+(-w2*r2Y))-v1.x)-(-w1*r1Y))+ax1Y*(((v2.y+(w2*r2X))-v1.y)-(w1*r1X)));return speed;},GetMotorForce:function(invTimeStep){return invTimeStep*this.m_motorImpulse;},SetMotorSpeed:function(speed)
{this.m_motorSpeed=speed;},SetMotorForce:function(force)
{this.m_maxMotorForce=force;},GetReactionForce:function(invTimeStep)
{var tImp=invTimeStep*this.m_limitImpulse;var tMat;tMat=this.m_body1.m_R;var ax1X=tImp*(tMat.col1.x*this.m_localXAxis1.x+tMat.col2.x*this.m_localXAxis1.y);var ax1Y=tImp*(tMat.col1.y*this.m_localXAxis1.x+tMat.col2.y*this.m_localXAxis1.y);var ay1X=tImp*(tMat.col1.x*this.m_localYAxis1.x+tMat.col2.x*this.m_localYAxis1.y);var ay1Y=tImp*(tMat.col1.y*this.m_localYAxis1.x+tMat.col2.y*this.m_localYAxis1.y);return new b2Vec2(ax1X+ay1X,ax1Y+ay1Y);},GetReactionTorque:function(invTimeStep)
{return invTimeStep*this.m_angularImpulse;},initialize:function(def){this.m_node1=new b2JointNode();this.m_node2=new b2JointNode();this.m_type=def.type;this.m_prev=null;this.m_next=null;this.m_body1=def.body1;this.m_body2=def.body2;this.m_collideConnected=def.collideConnected;this.m_islandFlag=false;this.m_userData=def.userData;this.m_localAnchor1=new b2Vec2();this.m_localAnchor2=new b2Vec2();this.m_localXAxis1=new b2Vec2();this.m_localYAxis1=new b2Vec2();this.m_linearJacobian=new b2Jacobian();this.m_motorJacobian=new b2Jacobian();var tMat;var tX;var tY;tMat=this.m_body1.m_R;tX=(def.anchorPoint.x-this.m_body1.m_position.x);tY=(def.anchorPoint.y-this.m_body1.m_position.y);this.m_localAnchor1.Set((tX*tMat.col1.x+tY*tMat.col1.y),(tX*tMat.col2.x+tY*tMat.col2.y));tMat=this.m_body2.m_R;tX=(def.anchorPoint.x-this.m_body2.m_position.x);tY=(def.anchorPoint.y-this.m_body2.m_position.y);this.m_localAnchor2.Set((tX*tMat.col1.x+tY*tMat.col1.y),(tX*tMat.col2.x+tY*tMat.col2.y));tMat=this.m_body1.m_R;tX=def.axis.x;tY=def.axis.y;this.m_localXAxis1.Set((tX*tMat.col1.x+tY*tMat.col1.y),(tX*tMat.col2.x+tY*tMat.col2.y));this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_initialAngle=this.m_body2.m_rotation-this.m_body1.m_rotation;this.m_linearJacobian.SetZero();this.m_linearMass=0.0;this.m_linearImpulse=0.0;this.m_angularMass=0.0;this.m_angularImpulse=0.0;this.m_motorJacobian.SetZero();this.m_motorMass=0.0;this.m_motorImpulse=0.0;this.m_limitImpulse=0.0;this.m_limitPositionImpulse=0.0;this.m_lowerTranslation=def.lowerTranslation;this.m_upperTranslation=def.upperTranslation;this.m_maxMotorForce=def.motorForce;this.m_motorSpeed=def.motorSpeed;this.m_enableLimit=def.enableLimit;this.m_enableMotor=def.enableMotor;},PrepareVelocitySolver:function(){var b1=this.m_body1;var b2=this.m_body2;var tMat;tMat=b1.m_R;var r1X=tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y;var r1Y=tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y;tMat=b2.m_R;var r2X=tMat.col1.x*this.m_localAnchor2.x+tMat.col2.x*this.m_localAnchor2.y;var r2Y=tMat.col1.y*this.m_localAnchor2.x+tMat.col2.y*this.m_localAnchor2.y;var invMass1=b1.m_invMass;var invMass2=b2.m_invMass;var invI1=b1.m_invI;var invI2=b2.m_invI;tMat=b1.m_R;var ay1X=tMat.col1.x*this.m_localYAxis1.x+tMat.col2.x*this.m_localYAxis1.y;var ay1Y=tMat.col1.y*this.m_localYAxis1.x+tMat.col2.y*this.m_localYAxis1.y;var eX=b2.m_position.x+r2X-b1.m_position.x;var eY=b2.m_position.y+r2Y-b1.m_position.y;this.m_linearJacobian.linear1.x=-ay1X;this.m_linearJacobian.linear1.y=-ay1Y;this.m_linearJacobian.linear2.x=ay1X;this.m_linearJacobian.linear2.y=ay1Y;this.m_linearJacobian.angular1=-(eX*ay1Y-eY*ay1X);this.m_linearJacobian.angular2=r2X*ay1Y-r2Y*ay1X;this.m_linearMass=invMass1+invI1*this.m_linearJacobian.angular1*this.m_linearJacobian.angular1+
invMass2+invI2*this.m_linearJacobian.angular2*this.m_linearJacobian.angular2;this.m_linearMass=1.0/this.m_linearMass;this.m_angularMass=1.0/(invI1+invI2);if(this.m_enableLimit||this.m_enableMotor)
{tMat=b1.m_R;var ax1X=tMat.col1.x*this.m_localXAxis1.x+tMat.col2.x*this.m_localXAxis1.y;var ax1Y=tMat.col1.y*this.m_localXAxis1.x+tMat.col2.y*this.m_localXAxis1.y;this.m_motorJacobian.linear1.x=-ax1X;this.m_motorJacobian.linear1.y=-ax1Y;this.m_motorJacobian.linear2.x=ax1X;this.m_motorJacobian.linear2.y=ax1Y;this.m_motorJacobian.angular1=-(eX*ax1Y-eY*ax1X);this.m_motorJacobian.angular2=r2X*ax1Y-r2Y*ax1X;this.m_motorMass=invMass1+invI1*this.m_motorJacobian.angular1*this.m_motorJacobian.angular1+
invMass2+invI2*this.m_motorJacobian.angular2*this.m_motorJacobian.angular2;this.m_motorMass=1.0/this.m_motorMass;if(this.m_enableLimit)
{var dX=eX-r1X;var dY=eY-r1Y;var jointTranslation=ax1X*dX+ax1Y*dY;if(b2Math.b2Abs(this.m_upperTranslation-this.m_lowerTranslation)<2.0*b2settings.b2_linearslop) {this.m_limitstate="b2Joint.e_equalLimits;}" else="" if(jointtranslation<="this.m_lowerTranslation)" {if(this.m_limitstate!="b2Joint.e_atLowerLimit)" {this.m_limitimpulse="0.0;}" this.m_limitstate="b2Joint.e_atLowerLimit;}" if(jointtranslation="">=this.m_upperTranslation)
{if(this.m_limitState!=b2Joint.e_atUpperLimit)
{this.m_limitImpulse=0.0;}
this.m_limitState=b2Joint.e_atUpperLimit;}
else
{this.m_limitState=b2Joint.e_inactiveLimit;this.m_limitImpulse=0.0;}}}
if(this.m_enableMotor==false)
{this.m_motorImpulse=0.0;}
if(this.m_enableLimit==false)
{this.m_limitImpulse=0.0;}
if(b2World.s_enableWarmStarting)
{var P1X=this.m_linearImpulse*this.m_linearJacobian.linear1.x+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.linear1.x;var P1Y=this.m_linearImpulse*this.m_linearJacobian.linear1.y+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.linear1.y;var P2X=this.m_linearImpulse*this.m_linearJacobian.linear2.x+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.linear2.x;var P2Y=this.m_linearImpulse*this.m_linearJacobian.linear2.y+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.linear2.y;var L1=this.m_linearImpulse*this.m_linearJacobian.angular1-this.m_angularImpulse+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.angular1;var L2=this.m_linearImpulse*this.m_linearJacobian.angular2+this.m_angularImpulse+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.angular2;b1.m_linearVelocity.x+=invMass1*P1X;b1.m_linearVelocity.y+=invMass1*P1Y;b1.m_angularVelocity+=invI1*L1;b2.m_linearVelocity.x+=invMass2*P2X;b2.m_linearVelocity.y+=invMass2*P2Y;b2.m_angularVelocity+=invI2*L2;}
else
{this.m_linearImpulse=0.0;this.m_angularImpulse=0.0;this.m_limitImpulse=0.0;this.m_motorImpulse=0.0;}
this.m_limitPositionImpulse=0.0;},SolveVelocityConstraints:function(step){var b1=this.m_body1;var b2=this.m_body2;var invMass1=b1.m_invMass;var invMass2=b2.m_invMass;var invI1=b1.m_invI;var invI2=b2.m_invI;var oldLimitImpulse;var linearCdot=this.m_linearJacobian.Compute(b1.m_linearVelocity,b1.m_angularVelocity,b2.m_linearVelocity,b2.m_angularVelocity);var linearImpulse=-this.m_linearMass*linearCdot;this.m_linearImpulse+=linearImpulse;b1.m_linearVelocity.x+=(invMass1*linearImpulse)*this.m_linearJacobian.linear1.x;b1.m_linearVelocity.y+=(invMass1*linearImpulse)*this.m_linearJacobian.linear1.y;b1.m_angularVelocity+=invI1*linearImpulse*this.m_linearJacobian.angular1;b2.m_linearVelocity.x+=(invMass2*linearImpulse)*this.m_linearJacobian.linear2.x;b2.m_linearVelocity.y+=(invMass2*linearImpulse)*this.m_linearJacobian.linear2.y;b2.m_angularVelocity+=invI2*linearImpulse*this.m_linearJacobian.angular2;var angularCdot=b2.m_angularVelocity-b1.m_angularVelocity;var angularImpulse=-this.m_angularMass*angularCdot;this.m_angularImpulse+=angularImpulse;b1.m_angularVelocity-=invI1*angularImpulse;b2.m_angularVelocity+=invI2*angularImpulse;if(this.m_enableMotor&&this.m_limitState!=b2Joint.e_equalLimits)
{var motorCdot=this.m_motorJacobian.Compute(b1.m_linearVelocity,b1.m_angularVelocity,b2.m_linearVelocity,b2.m_angularVelocity)-this.m_motorSpeed;var motorImpulse=-this.m_motorMass*motorCdot;var oldMotorImpulse=this.m_motorImpulse;this.m_motorImpulse=b2Math.b2Clamp(this.m_motorImpulse+motorImpulse,-step.dt*this.m_maxMotorForce,step.dt*this.m_maxMotorForce);motorImpulse=this.m_motorImpulse-oldMotorImpulse;b1.m_linearVelocity.x+=(invMass1*motorImpulse)*this.m_motorJacobian.linear1.x;b1.m_linearVelocity.y+=(invMass1*motorImpulse)*this.m_motorJacobian.linear1.y;b1.m_angularVelocity+=invI1*motorImpulse*this.m_motorJacobian.angular1;b2.m_linearVelocity.x+=(invMass2*motorImpulse)*this.m_motorJacobian.linear2.x;b2.m_linearVelocity.y+=(invMass2*motorImpulse)*this.m_motorJacobian.linear2.y;b2.m_angularVelocity+=invI2*motorImpulse*this.m_motorJacobian.angular2;}
if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit)
{var limitCdot=this.m_motorJacobian.Compute(b1.m_linearVelocity,b1.m_angularVelocity,b2.m_linearVelocity,b2.m_angularVelocity);var limitImpulse=-this.m_motorMass*limitCdot;if(this.m_limitState==b2Joint.e_equalLimits)
{this.m_limitImpulse+=limitImpulse;}
else if(this.m_limitState==b2Joint.e_atLowerLimit)
{oldLimitImpulse=this.m_limitImpulse;this.m_limitImpulse=b2Math.b2Max(this.m_limitImpulse+limitImpulse,0.0);limitImpulse=this.m_limitImpulse-oldLimitImpulse;}
else if(this.m_limitState==b2Joint.e_atUpperLimit)
{oldLimitImpulse=this.m_limitImpulse;this.m_limitImpulse=b2Math.b2Min(this.m_limitImpulse+limitImpulse,0.0);limitImpulse=this.m_limitImpulse-oldLimitImpulse;}
b1.m_linearVelocity.x+=(invMass1*limitImpulse)*this.m_motorJacobian.linear1.x;b1.m_linearVelocity.y+=(invMass1*limitImpulse)*this.m_motorJacobian.linear1.y;b1.m_angularVelocity+=invI1*limitImpulse*this.m_motorJacobian.angular1;b2.m_linearVelocity.x+=(invMass2*limitImpulse)*this.m_motorJacobian.linear2.x;b2.m_linearVelocity.y+=(invMass2*limitImpulse)*this.m_motorJacobian.linear2.y;b2.m_angularVelocity+=invI2*limitImpulse*this.m_motorJacobian.angular2;}},SolvePositionConstraints:function(){var limitC;var oldLimitImpulse;var b1=this.m_body1;var b2=this.m_body2;var invMass1=b1.m_invMass;var invMass2=b2.m_invMass;var invI1=b1.m_invI;var invI2=b2.m_invI;var tMat;tMat=b1.m_R;var r1X=tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y;var r1Y=tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y;tMat=b2.m_R;var r2X=tMat.col1.x*this.m_localAnchor2.x+tMat.col2.x*this.m_localAnchor2.y;var r2Y=tMat.col1.y*this.m_localAnchor2.x+tMat.col2.y*this.m_localAnchor2.y;var p1X=b1.m_position.x+r1X;var p1Y=b1.m_position.y+r1Y;var p2X=b2.m_position.x+r2X;var p2Y=b2.m_position.y+r2Y;var dX=p2X-p1X;var dY=p2Y-p1Y;tMat=b1.m_R;var ay1X=tMat.col1.x*this.m_localYAxis1.x+tMat.col2.x*this.m_localYAxis1.y;var ay1Y=tMat.col1.y*this.m_localYAxis1.x+tMat.col2.y*this.m_localYAxis1.y;var linearC=ay1X*dX+ay1Y*dY;linearC=b2Math.b2Clamp(linearC,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection);var linearImpulse=-this.m_linearMass*linearC;b1.m_position.x+=(invMass1*linearImpulse)*this.m_linearJacobian.linear1.x;b1.m_position.y+=(invMass1*linearImpulse)*this.m_linearJacobian.linear1.y;b1.m_rotation+=invI1*linearImpulse*this.m_linearJacobian.angular1;b2.m_position.x+=(invMass2*linearImpulse)*this.m_linearJacobian.linear2.x;b2.m_position.y+=(invMass2*linearImpulse)*this.m_linearJacobian.linear2.y;b2.m_rotation+=invI2*linearImpulse*this.m_linearJacobian.angular2;var positionError=b2Math.b2Abs(linearC);var angularC=b2.m_rotation-b1.m_rotation-this.m_initialAngle;angularC=b2Math.b2Clamp(angularC,-b2Settings.b2_maxAngularCorrection,b2Settings.b2_maxAngularCorrection);var angularImpulse=-this.m_angularMass*angularC;b1.m_rotation-=b1.m_invI*angularImpulse;b1.m_R.Set(b1.m_rotation);b2.m_rotation+=b2.m_invI*angularImpulse;b2.m_R.Set(b2.m_rotation);var angularError=b2Math.b2Abs(angularC);if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit)
{tMat=b1.m_R;r1X=tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y;r1Y=tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y;tMat=b2.m_R;r2X=tMat.col1.x*this.m_localAnchor2.x+tMat.col2.x*this.m_localAnchor2.y;r2Y=tMat.col1.y*this.m_localAnchor2.x+tMat.col2.y*this.m_localAnchor2.y;p1X=b1.m_position.x+r1X;p1Y=b1.m_position.y+r1Y;p2X=b2.m_position.x+r2X;p2Y=b2.m_position.y+r2Y;dX=p2X-p1X;dY=p2Y-p1Y;tMat=b1.m_R;var ax1X=tMat.col1.x*this.m_localXAxis1.x+tMat.col2.x*this.m_localXAxis1.y;var ax1Y=tMat.col1.y*this.m_localXAxis1.x+tMat.col2.y*this.m_localXAxis1.y;var translation=(ax1X*dX+ax1Y*dY);var limitImpulse=0.0;if(this.m_limitState==b2Joint.e_equalLimits)
{limitC=b2Math.b2Clamp(translation,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection);limitImpulse=-this.m_motorMass*limitC;positionError=b2Math.b2Max(positionError,b2Math.b2Abs(angularC));}
else if(this.m_limitState==b2Joint.e_atLowerLimit)
{limitC=translation-this.m_lowerTranslation;positionError=b2Math.b2Max(positionError,-limitC);limitC=b2Math.b2Clamp(limitC+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0.0);limitImpulse=-this.m_motorMass*limitC;oldLimitImpulse=this.m_limitPositionImpulse;this.m_limitPositionImpulse=b2Math.b2Max(this.m_limitPositionImpulse+limitImpulse,0.0);limitImpulse=this.m_limitPositionImpulse-oldLimitImpulse;}
else if(this.m_limitState==b2Joint.e_atUpperLimit)
{limitC=translation-this.m_upperTranslation;positionError=b2Math.b2Max(positionError,limitC);limitC=b2Math.b2Clamp(limitC-b2Settings.b2_linearSlop,0.0,b2Settings.b2_maxLinearCorrection);limitImpulse=-this.m_motorMass*limitC;oldLimitImpulse=this.m_limitPositionImpulse;this.m_limitPositionImpulse=b2Math.b2Min(this.m_limitPositionImpulse+limitImpulse,0.0);limitImpulse=this.m_limitPositionImpulse-oldLimitImpulse;}
b1.m_position.x+=(invMass1*limitImpulse)*this.m_motorJacobian.linear1.x;b1.m_position.y+=(invMass1*limitImpulse)*this.m_motorJacobian.linear1.y;b1.m_rotation+=invI1*limitImpulse*this.m_motorJacobian.angular1;b1.m_R.Set(b1.m_rotation);b2.m_position.x+=(invMass2*limitImpulse)*this.m_motorJacobian.linear2.x;b2.m_position.y+=(invMass2*limitImpulse)*this.m_motorJacobian.linear2.y;b2.m_rotation+=invI2*limitImpulse*this.m_motorJacobian.angular2;b2.m_R.Set(b2.m_rotation);}
return positionError<=b2settings.b2_linearslop&&angularerror<=b2settings.b2_angularslop;},m_localanchor1:new b2vec2(),m_localanchor2:new="" b2vec2(),m_localxaxis1:new="" b2vec2(),m_localyaxis1:new="" b2vec2(),m_initialangle:null,m_linearjacobian:new="" b2jacobian(),m_linearmass:null,m_linearimpulse:null,m_angularmass:null,m_angularimpulse:null,m_motorjacobian:new="" b2jacobian(),m_motormass:null,m_motorimpulse:null,m_limitimpulse:null,m_limitpositionimpulse:null,m_lowertranslation:null,m_uppertranslation:null,m_maxmotorforce:null,m_motorspeed:null,m_enablelimit:null,m_enablemotor:null,m_limitstate:0});="" var="" b2prismaticjointdef="Class.create();Object.extend(b2PrismaticJointDef.prototype,b2JointDef.prototype);Object.extend(b2PrismaticJointDef.prototype,{initialize:function()" {this.type="b2Joint.e_unknownJoint;this.userData=null;this.body1=null;this.body2=null;this.collideConnected=false;this.type=b2Joint.e_prismaticJoint;this.anchorPoint=new" b2vec2(0.0,0.0);this.axis="new" b2vec2(0.0,0.0);this.lowertranslation="0.0;this.upperTranslation=0.0;this.motorForce=0.0;this.motorSpeed=0.0;this.enableLimit=false;this.enableMotor=false;},anchorPoint:null,axis:null,lowerTranslation:null,upperTranslation:null,motorForce:null,motorSpeed:null,enableLimit:null,enableMotor:null});" b2pulleyjoint="Class.create();Object.extend(b2PulleyJoint.prototype,b2Joint.prototype);Object.extend(b2PulleyJoint.prototype,{GetAnchor1:function(){var" tmat="this.m_body1.m_R;return" new="" b2vec2(this.m_body1.m_position.x+(tmat.col1.x*this.m_localanchor1.x+tmat.col2.x*this.m_localanchor1.y),this.m_body1.m_position.y+(tmat.col1.y*this.m_localanchor1.x+tmat.col2.y*this.m_localanchor1.y));},getanchor2:function(){var="" b2vec2(this.m_body2.m_position.x+(tmat.col1.x*this.m_localanchor2.x+tmat.col2.x*this.m_localanchor2.y),this.m_body2.m_position.y+(tmat.col1.y*this.m_localanchor2.x+tmat.col2.y*this.m_localanchor2.y));},getgroundpoint1:function(){return="" b2vec2(this.m_ground.m_position.x+this.m_groundanchor1.x,this.m_ground.m_position.y+this.m_groundanchor1.y);},getgroundpoint2:function(){return="" b2vec2(this.m_ground.m_position.x+this.m_groundanchor2.x,this.m_ground.m_position.y+this.m_groundanchor2.y);},getreactionforce:function(invtimestep){return="" b2vec2();},getreactiontorque:function(invtimestep){return="" 0.0;},getlength1:function(){var="" tmat;tmat="this.m_body1.m_R;var" px="this.m_body1.m_position.x+(tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y);var" py="this.m_body1.m_position.y+(tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y);var" dx="pX-(this.m_ground.m_position.x+this.m_groundAnchor1.x);var" dy="pY-(this.m_ground.m_position.y+this.m_groundAnchor1.y);return" math.sqrt(dx*dx+dy*dy);},getlength2:function(){var="" math.sqrt(dx*dx+dy*dy);},getratio:function(){return="" this.m_ratio;},initialize:function(def){this.m_node1="new" b2jointnode();this.m_node2="new" b2jointnode();this.m_type="def.type;this.m_prev=null;this.m_next=null;this.m_body1=def.body1;this.m_body2=def.body2;this.m_collideConnected=def.collideConnected;this.m_islandFlag=false;this.m_userData=def.userData;this.m_groundAnchor1=new" b2vec2();this.m_groundanchor2="new" b2vec2();this.m_localanchor1="new" b2vec2();this.m_localanchor2="new" b2vec2();this.m_u1="new" b2vec2();this.m_u2="new" b2vec2();var="" tmat;var="" tx;var="" ty;this.m_ground="this.m_body1.m_world.m_groundBody;this.m_groundAnchor1.x=def.groundPoint1.x-this.m_ground.m_position.x;this.m_groundAnchor1.y=def.groundPoint1.y-this.m_ground.m_position.y;this.m_groundAnchor2.x=def.groundPoint2.x-this.m_ground.m_position.x;this.m_groundAnchor2.y=def.groundPoint2.y-this.m_ground.m_position.y;tMat=this.m_body1.m_R;tX=def.anchorPoint1.x-this.m_body1.m_position.x;tY=def.anchorPoint1.y-this.m_body1.m_position.y;this.m_localAnchor1.x=tX*tMat.col1.x+tY*tMat.col1.y;this.m_localAnchor1.y=tX*tMat.col2.x+tY*tMat.col2.y;tMat=this.m_body2.m_R;tX=def.anchorPoint2.x-this.m_body2.m_position.x;tY=def.anchorPoint2.y-this.m_body2.m_position.y;this.m_localAnchor2.x=tX*tMat.col1.x+tY*tMat.col1.y;this.m_localAnchor2.y=tX*tMat.col2.x+tY*tMat.col2.y;this.m_ratio=def.ratio;tX=def.groundPoint1.x-def.anchorPoint1.x;tY=def.groundPoint1.y-def.anchorPoint1.y;var" d1len="Math.sqrt(tX*tX+tY*tY);tX=def.groundPoint2.x-def.anchorPoint2.x;tY=def.groundPoint2.y-def.anchorPoint2.y;var" d2len="Math.sqrt(tX*tX+tY*tY);var" length1="b2Math.b2Max(0.5*b2PulleyJoint.b2_minPulleyLength,d1Len);var" length2="b2Math.b2Max(0.5*b2PulleyJoint.b2_minPulleyLength,d2Len);this.m_constant=length1+this.m_ratio*length2;this.m_maxLength1=b2Math.b2Clamp(def.maxLength1,length1,this.m_constant-this.m_ratio*b2PulleyJoint.b2_minPulleyLength);this.m_maxLength2=b2Math.b2Clamp(def.maxLength2,length2,(this.m_constant-b2PulleyJoint.b2_minPulleyLength)/this.m_ratio);this.m_pulleyImpulse=0.0;this.m_limitImpulse1=0.0;this.m_limitImpulse2=0.0;},PrepareVelocitySolver:function(){var" b1="this.m_body1;var" b2="this.m_body2;var" r1x="tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y;var" r1y="tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y;tMat=b2.m_R;var" r2x="tMat.col1.x*this.m_localAnchor2.x+tMat.col2.x*this.m_localAnchor2.y;var" r2y="tMat.col1.y*this.m_localAnchor2.x+tMat.col2.y*this.m_localAnchor2.y;var" p1x="b1.m_position.x+r1X;var" p1y="b1.m_position.y+r1Y;var" p2x="b2.m_position.x+r2X;var" p2y="b2.m_position.y+r2Y;var" s1x="this.m_ground.m_position.x+this.m_groundAnchor1.x;var" s1y="this.m_ground.m_position.y+this.m_groundAnchor1.y;var" s2x="this.m_ground.m_position.x+this.m_groundAnchor2.x;var" s2y="this.m_ground.m_position.y+this.m_groundAnchor2.y;this.m_u1.Set(p1X-s1X,p1Y-s1Y);this.m_u2.Set(p2X-s2X,p2Y-s2Y);var">b2Settings.b2_linearSlop)
{this.m_u1.Multiply(1.0/length1);}
else
{this.m_u1.SetZero();}
if(length2>b2Settings.b2_linearSlop)
{this.m_u2.Multiply(1.0/length2);}
else
{this.m_u2.SetZero();}
if(length1<this.m_maxlength1) {this.m_limitstate1="b2Joint.e_inactiveLimit;this.m_limitImpulse1=0.0;}" else="" if(length2<this.m_maxlength2)="" {this.m_limitstate2="b2Joint.e_inactiveLimit;this.m_limitImpulse2=0.0;}" var="" cr1u1="r1X*this.m_u1.y-r1Y*this.m_u1.x;var" cr2u2="r2X*this.m_u2.y-r2Y*this.m_u2.x;this.m_limitMass1=b1.m_invMass+b1.m_invI*cr1u1*cr1u1;this.m_limitMass2=b2.m_invMass+b2.m_invI*cr2u2*cr2u2;this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2;this.m_limitMass1=1.0/this.m_limitMass1;this.m_limitMass2=1.0/this.m_limitMass2;this.m_pulleyMass=1.0/this.m_pulleyMass;var" p1x="(-this.m_pulleyImpulse-this.m_limitImpulse1)*this.m_u1.x;var" p1y="(-this.m_pulleyImpulse-this.m_limitImpulse1)*this.m_u1.y;var" p2x="(-this.m_ratio*this.m_pulleyImpulse-this.m_limitImpulse2)*this.m_u2.x;var" p2y="(-this.m_ratio*this.m_pulleyImpulse-this.m_limitImpulse2)*this.m_u2.y;b1.m_linearVelocity.x+=b1.m_invMass*P1X;b1.m_linearVelocity.y+=b1.m_invMass*P1Y;b1.m_angularVelocity+=b1.m_invI*(r1X*P1Y-r1Y*P1X);b2.m_linearVelocity.x+=b2.m_invMass*P2X;b2.m_linearVelocity.y+=b2.m_invMass*P2Y;b2.m_angularVelocity+=b2.m_invI*(r2X*P2Y-r2Y*P2X);},SolveVelocityConstraints:function(step){var" b1="this.m_body1;var" b2="this.m_body2;var" tmat;tmat="b1.m_R;var" r1x="tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y;var" r1y="tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y;tMat=b2.m_R;var" r2x="tMat.col1.x*this.m_localAnchor2.x+tMat.col2.x*this.m_localAnchor2.y;var" r2y="tMat.col1.y*this.m_localAnchor2.x+tMat.col2.y*this.m_localAnchor2.y;var" v1x;var="" v1y;var="" v2x;var="" v2y;var="" p1x;var="" p1y;var="" p2x;var="" p2y;var="" cdot;var="" impulse;var="" oldlimitimpulse;v1x="b1.m_linearVelocity.x+(-b1.m_angularVelocity*r1Y);v1Y=b1.m_linearVelocity.y+(b1.m_angularVelocity*r1X);v2X=b2.m_linearVelocity.x+(-b2.m_angularVelocity*r2Y);v2Y=b2.m_linearVelocity.y+(b2.m_angularVelocity*r2X);Cdot=-(this.m_u1.x*v1X+this.m_u1.y*v1Y)-this.m_ratio*(this.m_u2.x*v2X+this.m_u2.y*v2Y);impulse=-this.m_pulleyMass*Cdot;this.m_pulleyImpulse+=impulse;P1X=-impulse*this.m_u1.x;P1Y=-impulse*this.m_u1.y;P2X=-this.m_ratio*impulse*this.m_u2.x;P2Y=-this.m_ratio*impulse*this.m_u2.y;b1.m_linearVelocity.x+=b1.m_invMass*P1X;b1.m_linearVelocity.y+=b1.m_invMass*P1Y;b1.m_angularVelocity+=b1.m_invI*(r1X*P1Y-r1Y*P1X);b2.m_linearVelocity.x+=b2.m_invMass*P2X;b2.m_linearVelocity.y+=b2.m_invMass*P2Y;b2.m_angularVelocity+=b2.m_invI*(r2X*P2Y-r2Y*P2X);if(this.m_limitState1==b2Joint.e_atUpperLimit)" {v1x="b1.m_linearVelocity.x+(-b1.m_angularVelocity*r1Y);v1Y=b1.m_linearVelocity.y+(b1.m_angularVelocity*r1X);Cdot=-(this.m_u1.x*v1X+this.m_u1.y*v1Y);impulse=-this.m_limitMass1*Cdot;oldLimitImpulse=this.m_limitImpulse1;this.m_limitImpulse1=b2Math.b2Max(0.0,this.m_limitImpulse1+impulse);impulse=this.m_limitImpulse1-oldLimitImpulse;P1X=-impulse*this.m_u1.x;P1Y=-impulse*this.m_u1.y;b1.m_linearVelocity.x+=b1.m_invMass*P1X;b1.m_linearVelocity.y+=b1.m_invMass*P1Y;b1.m_angularVelocity+=b1.m_invI*(r1X*P1Y-r1Y*P1X);}" if(this.m_limitstate2="=b2Joint.e_atUpperLimit)" {v2x="b2.m_linearVelocity.x+(-b2.m_angularVelocity*r2Y);v2Y=b2.m_linearVelocity.y+(b2.m_angularVelocity*r2X);Cdot=-(this.m_u2.x*v2X+this.m_u2.y*v2Y);impulse=-this.m_limitMass2*Cdot;oldLimitImpulse=this.m_limitImpulse2;this.m_limitImpulse2=b2Math.b2Max(0.0,this.m_limitImpulse2+impulse);impulse=this.m_limitImpulse2-oldLimitImpulse;P2X=-impulse*this.m_u2.x;P2Y=-impulse*this.m_u2.y;b2.m_linearVelocity.x+=b2.m_invMass*P2X;b2.m_linearVelocity.y+=b2.m_invMass*P2Y;b2.m_angularVelocity+=b2.m_invI*(r2X*P2Y-r2Y*P2X);}},SolvePositionConstraints:function(){var" tmat;var="" s1x="this.m_ground.m_position.x+this.m_groundAnchor1.x;var" s1y="this.m_ground.m_position.y+this.m_groundAnchor1.y;var" s2x="this.m_ground.m_position.x+this.m_groundAnchor2.x;var" s2y="this.m_ground.m_position.y+this.m_groundAnchor2.y;var" r1x;var="" r1y;var="" r2x;var="" r2y;var="" length1;var="" length2;var="" c;var="" oldlimitpositionimpulse;var="" linearerror="0.0;{tMat=b1.m_R;r1X=tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y;r1Y=tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y;tMat=b2.m_R;r2X=tMat.col1.x*this.m_localAnchor2.x+tMat.col2.x*this.m_localAnchor2.y;r2Y=tMat.col1.y*this.m_localAnchor2.x+tMat.col2.y*this.m_localAnchor2.y;p1X=b1.m_position.x+r1X;p1Y=b1.m_position.y+r1Y;p2X=b2.m_position.x+r2X;p2Y=b2.m_position.y+r2Y;this.m_u1.Set(p1X-s1X,p1Y-s1Y);this.m_u2.Set(p2X-s2X,p2Y-s2Y);length1=this.m_u1.Length();length2=this.m_u2.Length();if(length1">b2Settings.b2_linearSlop)
{this.m_u1.Multiply(1.0/length1);}
else
{this.m_u1.SetZero();}
if(length2>b2Settings.b2_linearSlop)
{this.m_u2.Multiply(1.0/length2);}
else
{this.m_u2.SetZero();}
C=this.m_constant-length1-this.m_ratio*length2;linearError=b2Math.b2Max(linearError,Math.abs(C));C=b2Math.b2Clamp(C,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection);impulse=-this.m_pulleyMass*C;p1X=-impulse*this.m_u1.x;p1Y=-impulse*this.m_u1.y;p2X=-this.m_ratio*impulse*this.m_u2.x;p2Y=-this.m_ratio*impulse*this.m_u2.y;b1.m_position.x+=b1.m_invMass*p1X;b1.m_position.y+=b1.m_invMass*p1Y;b1.m_rotation+=b1.m_invI*(r1X*p1Y-r1Y*p1X);b2.m_position.x+=b2.m_invMass*p2X;b2.m_position.y+=b2.m_invMass*p2Y;b2.m_rotation+=b2.m_invI*(r2X*p2Y-r2Y*p2X);b1.m_R.Set(b1.m_rotation);b2.m_R.Set(b2.m_rotation);}
if(this.m_limitState1==b2Joint.e_atUpperLimit)
{tMat=b1.m_R;r1X=tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y;r1Y=tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y;p1X=b1.m_position.x+r1X;p1Y=b1.m_position.y+r1Y;this.m_u1.Set(p1X-s1X,p1Y-s1Y);length1=this.m_u1.Length();if(length1>b2Settings.b2_linearSlop)
{this.m_u1.x*=1.0/length1;this.m_u1.y*=1.0/length1;}
else
{this.m_u1.SetZero();}
C=this.m_maxLength1-length1;linearError=b2Math.b2Max(linearError,-C);C=b2Math.b2Clamp(C+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0.0);impulse=-this.m_limitMass1*C;oldLimitPositionImpulse=this.m_limitPositionImpulse1;this.m_limitPositionImpulse1=b2Math.b2Max(0.0,this.m_limitPositionImpulse1+impulse);impulse=this.m_limitPositionImpulse1-oldLimitPositionImpulse;p1X=-impulse*this.m_u1.x;p1Y=-impulse*this.m_u1.y;b1.m_position.x+=b1.m_invMass*p1X;b1.m_position.y+=b1.m_invMass*p1Y;b1.m_rotation+=b1.m_invI*(r1X*p1Y-r1Y*p1X);b1.m_R.Set(b1.m_rotation);}
if(this.m_limitState2==b2Joint.e_atUpperLimit)
{tMat=b2.m_R;r2X=tMat.col1.x*this.m_localAnchor2.x+tMat.col2.x*this.m_localAnchor2.y;r2Y=tMat.col1.y*this.m_localAnchor2.x+tMat.col2.y*this.m_localAnchor2.y;p2X=b2.m_position.x+r2X;p2Y=b2.m_position.y+r2Y;this.m_u2.Set(p2X-s2X,p2Y-s2Y);length2=this.m_u2.Length();if(length2>b2Settings.b2_linearSlop)
{this.m_u2.x*=1.0/length2;this.m_u2.y*=1.0/length2;}
else
{this.m_u2.SetZero();}
C=this.m_maxLength2-length2;linearError=b2Math.b2Max(linearError,-C);C=b2Math.b2Clamp(C+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0.0);impulse=-this.m_limitMass2*C;oldLimitPositionImpulse=this.m_limitPositionImpulse2;this.m_limitPositionImpulse2=b2Math.b2Max(0.0,this.m_limitPositionImpulse2+impulse);impulse=this.m_limitPositionImpulse2-oldLimitPositionImpulse;p2X=-impulse*this.m_u2.x;p2Y=-impulse*this.m_u2.y;b2.m_position.x+=b2.m_invMass*p2X;b2.m_position.y+=b2.m_invMass*p2Y;b2.m_rotation+=b2.m_invI*(r2X*p2Y-r2Y*p2X);b2.m_R.Set(b2.m_rotation);}
return linearError<b2settings.b2_linearslop;},m_ground:null,m_groundanchor1:new b2vec2(),m_groundanchor2:new="" b2vec2(),m_localanchor1:new="" b2vec2(),m_localanchor2:new="" b2vec2(),m_u1:new="" b2vec2(),m_u2:new="" b2vec2(),m_constant:null,m_ratio:null,m_maxlength1:null,m_maxlength2:null,m_pulleymass:null,m_limitmass1:null,m_limitmass2:null,m_pulleyimpulse:null,m_limitimpulse1:null,m_limitimpulse2:null,m_limitpositionimpulse1:null,m_limitpositionimpulse2:null,m_limitstate1:0,m_limitstate2:0});b2pulleyjoint.b2_minpulleylength="b2Settings.b2_lengthUnitsPerMeter;" var="" b2pulleyjointdef="Class.create();Object.extend(b2PulleyJointDef.prototype,b2JointDef.prototype);Object.extend(b2PulleyJointDef.prototype,{initialize:function()" {this.type="b2Joint.e_unknownJoint;this.userData=null;this.body1=null;this.body2=null;this.collideConnected=false;this.groundPoint1=new" b2vec2();this.groundpoint2="new" b2vec2();this.anchorpoint1="new" b2vec2();this.anchorpoint2="new" b2vec2();this.type="b2Joint.e_pulleyJoint;this.groundPoint1.Set(-1.0,1.0);this.groundPoint2.Set(1.0,1.0);this.anchorPoint1.Set(-1.0,0.0);this.anchorPoint2.Set(1.0,0.0);this.maxLength1=0.5*b2PulleyJoint.b2_minPulleyLength;this.maxLength2=0.5*b2PulleyJoint.b2_minPulleyLength;this.ratio=1.0;this.collideConnected=true;},groundPoint1:new" b2vec2(),groundpoint2:new="" b2vec2(),anchorpoint1:new="" b2vec2(),anchorpoint2:new="" b2vec2(),maxlength1:null,maxlength2:null,ratio:null});="" b2revolutejoint="Class.create();Object.extend(b2RevoluteJoint.prototype,b2Joint.prototype);Object.extend(b2RevoluteJoint.prototype,{GetAnchor1:function(){var" tmat="this.m_body1.m_R;return" new="" b2vec2(this.m_body1.m_position.x+(tmat.col1.x*this.m_localanchor1.x+tmat.col2.x*this.m_localanchor1.y),this.m_body1.m_position.y+(tmat.col1.y*this.m_localanchor1.x+tmat.col2.y*this.m_localanchor1.y));},getanchor2:function(){var="" b2vec2(this.m_body2.m_position.x+(tmat.col1.x*this.m_localanchor2.x+tmat.col2.x*this.m_localanchor2.y),this.m_body2.m_position.y+(tmat.col1.y*this.m_localanchor2.x+tmat.col2.y*this.m_localanchor2.y));},getjointangle:function(){return="" this.m_body2.m_rotation-this.m_body1.m_rotation;},getjointspeed:function(){return="" this.m_body2.m_angularvelocity-this.m_body1.m_angularvelocity;},getmotortorque:function(invtimestep){return="" invtimestep*this.m_motorimpulse;},setmotorspeed:function(speed)="" {this.m_motorspeed="speed;},SetMotorTorque:function(torque)" {this.m_maxmotortorque="torque;},GetReactionForce:function(invTimeStep)" {var="" tvec="this.m_ptpImpulse.Copy();tVec.Multiply(invTimeStep);return" tvec;},getreactiontorque:function(invtimestep)="" {return="" invtimestep*this.m_limitimpulse;},initialize:function(def){this.m_node1="new" b2jointnode();this.m_node2="new" b2jointnode();this.m_type="def.type;this.m_prev=null;this.m_next=null;this.m_body1=def.body1;this.m_body2=def.body2;this.m_collideConnected=def.collideConnected;this.m_islandFlag=false;this.m_userData=def.userData;this.K=new" b2mat22();this.k1="new" b2mat22();this.k2="new" b2mat22();this.k3="new" b2mat22();this.m_localanchor1="new" b2vec2();this.m_localanchor2="new" b2vec2();this.m_ptpimpulse="new" b2vec2();this.m_ptpmass="new" b2mat22();var="" tmat;var="" tx;var="" ty;tmat="this.m_body1.m_R;tX=def.anchorPoint.x-this.m_body1.m_position.x;tY=def.anchorPoint.y-this.m_body1.m_position.y;this.m_localAnchor1.x=tX*tMat.col1.x+tY*tMat.col1.y;this.m_localAnchor1.y=tX*tMat.col2.x+tY*tMat.col2.y;tMat=this.m_body2.m_R;tX=def.anchorPoint.x-this.m_body2.m_position.x;tY=def.anchorPoint.y-this.m_body2.m_position.y;this.m_localAnchor2.x=tX*tMat.col1.x+tY*tMat.col1.y;this.m_localAnchor2.y=tX*tMat.col2.x+tY*tMat.col2.y;this.m_intialAngle=this.m_body2.m_rotation-this.m_body1.m_rotation;this.m_ptpImpulse.Set(0.0,0.0);this.m_motorImpulse=0.0;this.m_limitImpulse=0.0;this.m_limitPositionImpulse=0.0;this.m_lowerAngle=def.lowerAngle;this.m_upperAngle=def.upperAngle;this.m_maxMotorTorque=def.motorTorque;this.m_motorSpeed=def.motorSpeed;this.m_enableLimit=def.enableLimit;this.m_enableMotor=def.enableMotor;},K:new" b2mat22(),k1:new="" b2mat22(),k2:new="" b2mat22(),k3:new="" b2mat22(),preparevelocitysolver:function(){var="" b1="this.m_body1;var" b2="this.m_body2;var" tmat;tmat="b1.m_R;var" r1x="tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y;var" r1y="tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y;tMat=b2.m_R;var" r2x="tMat.col1.x*this.m_localAnchor2.x+tMat.col2.x*this.m_localAnchor2.y;var" r2y="tMat.col1.y*this.m_localAnchor2.x+tMat.col2.y*this.m_localAnchor2.y;var" invmass1="b1.m_invMass;var" invmass2="b2.m_invMass;var" invi1="b1.m_invI;var" invi2="b2.m_invI;this.K1.col1.x=invMass1+invMass2;this.K1.col2.x=0.0;this.K1.col1.y=0.0;this.K1.col2.y=invMass1+invMass2;this.K2.col1.x=invI1*r1Y*r1Y;this.K2.col2.x=-invI1*r1X*r1Y;this.K2.col1.y=-invI1*r1X*r1Y;this.K2.col2.y=invI1*r1X*r1X;this.K3.col1.x=invI2*r2Y*r2Y;this.K3.col2.x=-invI2*r2X*r2Y;this.K3.col1.y=-invI2*r2X*r2Y;this.K3.col2.y=invI2*r2X*r2X;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Invert(this.m_ptpMass);this.m_motorMass=1.0/(invI1+invI2);if(this.m_enableMotor==false)" {this.m_motorimpulse="0.0;}" if(this.m_enablelimit)="" jointangle="b2.m_rotation-b1.m_rotation-this.m_intialAngle;if(b2Math.b2Abs(this.m_upperAngle-this.m_lowerAngle)<2.0*b2Settings.b2_angularSlop)" {this.m_limitstate="b2Joint.e_equalLimits;}" else="" if(jointangle<="this.m_lowerAngle)" {if(this.m_limitstate!="b2Joint.e_atLowerLimit)" {this.m_limitimpulse="0.0;}" this.m_limitstate="b2Joint.e_atLowerLimit;}" if(jointangle="">=this.m_upperAngle)
{if(this.m_limitState!=b2Joint.e_atUpperLimit)
{this.m_limitImpulse=0.0;}
this.m_limitState=b2Joint.e_atUpperLimit;}
else
{this.m_limitState=b2Joint.e_inactiveLimit;this.m_limitImpulse=0.0;}}
else
{this.m_limitImpulse=0.0;}
if(b2World.s_enableWarmStarting)
{b1.m_linearVelocity.x-=invMass1*this.m_ptpImpulse.x;b1.m_linearVelocity.y-=invMass1*this.m_ptpImpulse.y;b1.m_angularVelocity-=invI1*((r1X*this.m_ptpImpulse.y-r1Y*this.m_ptpImpulse.x)+this.m_motorImpulse+this.m_limitImpulse);b2.m_linearVelocity.x+=invMass2*this.m_ptpImpulse.x;b2.m_linearVelocity.y+=invMass2*this.m_ptpImpulse.y;b2.m_angularVelocity+=invI2*((r2X*this.m_ptpImpulse.y-r2Y*this.m_ptpImpulse.x)+this.m_motorImpulse+this.m_limitImpulse);}
else{this.m_ptpImpulse.SetZero();this.m_motorImpulse=0.0;this.m_limitImpulse=0.0;}
this.m_limitPositionImpulse=0.0;},SolveVelocityConstraints:function(step){var b1=this.m_body1;var b2=this.m_body2;var tMat;tMat=b1.m_R;var r1X=tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y;var r1Y=tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y;tMat=b2.m_R;var r2X=tMat.col1.x*this.m_localAnchor2.x+tMat.col2.x*this.m_localAnchor2.y;var r2Y=tMat.col1.y*this.m_localAnchor2.x+tMat.col2.y*this.m_localAnchor2.y;var oldLimitImpulse;var ptpCdotX=b2.m_linearVelocity.x+(-b2.m_angularVelocity*r2Y)-b1.m_linearVelocity.x-(-b1.m_angularVelocity*r1Y);var ptpCdotY=b2.m_linearVelocity.y+(b2.m_angularVelocity*r2X)-b1.m_linearVelocity.y-(b1.m_angularVelocity*r1X);var ptpImpulseX=-(this.m_ptpMass.col1.x*ptpCdotX+this.m_ptpMass.col2.x*ptpCdotY);var ptpImpulseY=-(this.m_ptpMass.col1.y*ptpCdotX+this.m_ptpMass.col2.y*ptpCdotY);this.m_ptpImpulse.x+=ptpImpulseX;this.m_ptpImpulse.y+=ptpImpulseY;b1.m_linearVelocity.x-=b1.m_invMass*ptpImpulseX;b1.m_linearVelocity.y-=b1.m_invMass*ptpImpulseY;b1.m_angularVelocity-=b1.m_invI*(r1X*ptpImpulseY-r1Y*ptpImpulseX);b2.m_linearVelocity.x+=b2.m_invMass*ptpImpulseX;b2.m_linearVelocity.y+=b2.m_invMass*ptpImpulseY;b2.m_angularVelocity+=b2.m_invI*(r2X*ptpImpulseY-r2Y*ptpImpulseX);if(this.m_enableMotor&&this.m_limitState!=b2Joint.e_equalLimits)
{var motorCdot=b2.m_angularVelocity-b1.m_angularVelocity-this.m_motorSpeed;var motorImpulse=-this.m_motorMass*motorCdot;var oldMotorImpulse=this.m_motorImpulse;this.m_motorImpulse=b2Math.b2Clamp(this.m_motorImpulse+motorImpulse,-step.dt*this.m_maxMotorTorque,step.dt*this.m_maxMotorTorque);motorImpulse=this.m_motorImpulse-oldMotorImpulse;b1.m_angularVelocity-=b1.m_invI*motorImpulse;b2.m_angularVelocity+=b2.m_invI*motorImpulse;}
if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit)
{var limitCdot=b2.m_angularVelocity-b1.m_angularVelocity;var limitImpulse=-this.m_motorMass*limitCdot;if(this.m_limitState==b2Joint.e_equalLimits)
{this.m_limitImpulse+=limitImpulse;}
else if(this.m_limitState==b2Joint.e_atLowerLimit)
{oldLimitImpulse=this.m_limitImpulse;this.m_limitImpulse=b2Math.b2Max(this.m_limitImpulse+limitImpulse,0.0);limitImpulse=this.m_limitImpulse-oldLimitImpulse;}
else if(this.m_limitState==b2Joint.e_atUpperLimit)
{oldLimitImpulse=this.m_limitImpulse;this.m_limitImpulse=b2Math.b2Min(this.m_limitImpulse+limitImpulse,0.0);limitImpulse=this.m_limitImpulse-oldLimitImpulse;}
b1.m_angularVelocity-=b1.m_invI*limitImpulse;b2.m_angularVelocity+=b2.m_invI*limitImpulse;}},SolvePositionConstraints:function(){var oldLimitImpulse;var limitC;var b1=this.m_body1;var b2=this.m_body2;var positionError=0.0;var tMat;tMat=b1.m_R;var r1X=tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y;var r1Y=tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y;tMat=b2.m_R;var r2X=tMat.col1.x*this.m_localAnchor2.x+tMat.col2.x*this.m_localAnchor2.y;var r2Y=tMat.col1.y*this.m_localAnchor2.x+tMat.col2.y*this.m_localAnchor2.y;var p1X=b1.m_position.x+r1X;var p1Y=b1.m_position.y+r1Y;var p2X=b2.m_position.x+r2X;var p2Y=b2.m_position.y+r2Y;var ptpCX=p2X-p1X;var ptpCY=p2Y-p1Y;positionError=Math.sqrt(ptpCX*ptpCX+ptpCY*ptpCY);var invMass1=b1.m_invMass;var invMass2=b2.m_invMass;var invI1=b1.m_invI;var invI2=b2.m_invI;this.K1.col1.x=invMass1+invMass2;this.K1.col2.x=0.0;this.K1.col1.y=0.0;this.K1.col2.y=invMass1+invMass2;this.K2.col1.x=invI1*r1Y*r1Y;this.K2.col2.x=-invI1*r1X*r1Y;this.K2.col1.y=-invI1*r1X*r1Y;this.K2.col2.y=invI1*r1X*r1X;this.K3.col1.x=invI2*r2Y*r2Y;this.K3.col2.x=-invI2*r2X*r2Y;this.K3.col1.y=-invI2*r2X*r2Y;this.K3.col2.y=invI2*r2X*r2X;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Solve(b2RevoluteJoint.tImpulse,-ptpCX,-ptpCY);var impulseX=b2RevoluteJoint.tImpulse.x;var impulseY=b2RevoluteJoint.tImpulse.y;b1.m_position.x-=b1.m_invMass*impulseX;b1.m_position.y-=b1.m_invMass*impulseY;b1.m_rotation-=b1.m_invI*(r1X*impulseY-r1Y*impulseX);b1.m_R.Set(b1.m_rotation);b2.m_position.x+=b2.m_invMass*impulseX;b2.m_position.y+=b2.m_invMass*impulseY;b2.m_rotation+=b2.m_invI*(r2X*impulseY-r2Y*impulseX);b2.m_R.Set(b2.m_rotation);var angularError=0.0;if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit)
{var angle=b2.m_rotation-b1.m_rotation-this.m_intialAngle;var limitImpulse=0.0;if(this.m_limitState==b2Joint.e_equalLimits)
{limitC=b2Math.b2Clamp(angle,-b2Settings.b2_maxAngularCorrection,b2Settings.b2_maxAngularCorrection);limitImpulse=-this.m_motorMass*limitC;angularError=b2Math.b2Abs(limitC);}
else if(this.m_limitState==b2Joint.e_atLowerLimit)
{limitC=angle-this.m_lowerAngle;angularError=b2Math.b2Max(0.0,-limitC);limitC=b2Math.b2Clamp(limitC+b2Settings.b2_angularSlop,-b2Settings.b2_maxAngularCorrection,0.0);limitImpulse=-this.m_motorMass*limitC;oldLimitImpulse=this.m_limitPositionImpulse;this.m_limitPositionImpulse=b2Math.b2Max(this.m_limitPositionImpulse+limitImpulse,0.0);limitImpulse=this.m_limitPositionImpulse-oldLimitImpulse;}
else if(this.m_limitState==b2Joint.e_atUpperLimit)
{limitC=angle-this.m_upperAngle;angularError=b2Math.b2Max(0.0,limitC);limitC=b2Math.b2Clamp(limitC-b2Settings.b2_angularSlop,0.0,b2Settings.b2_maxAngularCorrection);limitImpulse=-this.m_motorMass*limitC;oldLimitImpulse=this.m_limitPositionImpulse;this.m_limitPositionImpulse=b2Math.b2Min(this.m_limitPositionImpulse+limitImpulse,0.0);limitImpulse=this.m_limitPositionImpulse-oldLimitImpulse;}
b1.m_rotation-=b1.m_invI*limitImpulse;b1.m_R.Set(b1.m_rotation);b2.m_rotation+=b2.m_invI*limitImpulse;b2.m_R.Set(b2.m_rotation);}
return positionError</b2settings.b2_linearslop;},m_ground:null,m_groundanchor1:new></this.m_maxlength1)></=b2settings.b2_linearslop&&angularerror<=b2settings.b2_angularslop;},m_localanchor1:new></2.0*b2settings.b2_linearslop)></b2settings.b2_linearslop;},getanchor1:function(){return></island.m_bodycount;++i)></this.m_bodycount;k++)></def.body2.m_shapecount?def.body1:def.body2;for(var></tmani.pointcount;++i)></tmani.pointcount;k++){var></maxiterations;++iter)></this.m_constraintcount;++i)></-b2settings.b2_velocitythreshold)></b2settings.b2_maxmanifoldpoints;i++){this.points[i]=new></this.m_bodycount;++i)></bodycapacity;i++)></this.m_shapecount;++i)></this.m_shapecount;++i)></b2settings.b2_maxshapesperbody;i++){massdatas[i]=new></this.m_vertexcount;++i)></this.m_vertexcount;++i)></pointcount;++i)></=0.0&&tn></=0.0||length<number.min_value)></8)&0x0000ff00)},get_incidentedge:function(){return></=0.0)></number.min_value)></number.min_value)></count1?vert1s[edge1+1]:vert1s[0];var></count2;++i)></count1?bestedge+1:0;s=b2collision.edgeseparation(poly1,edge,poly2);if(s></count1?edge+1:0;var></count2;++i)></value)></=proxy.upperbounds[axis])></bounds[p.lowerbounds[axis]].value)></bounds[p2.lowerbounds[axis]].value)></bounds[index-1].value)></boundcount-1&&bounds[index+1].value<=lowervalue)></boundcount-1&&bounds[index+1].value<=uppervalue)></bounds[index-1].value)></b2settings.b2_maxproxies;i++){this.m_queryresults[i]=0;}></2)&0xfffffffc);key=key^((key></16)&0xffff0000)|proxyid1;key=~key+((key<<15)&0xffff8000);key=key^((key></b2pair.b2_tablecapacity;++i)></b?a:b;};b2math.b2minv=function(a,b)></number.min_value)></b.x?this.x:b.x;this.y=this.y<b.y?this.y:b.y;},maxv:function(b)>