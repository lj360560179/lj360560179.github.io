<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>切切切切切切图的</title>
  <icon>https://www.gravatar.com/avatar/ff917445fde41fbd56275e774264cc67</icon>
  <subtitle>\(•ิ_•ิ\) (/•ิ_•ิ)/</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://lj360560179.github.io/"/>
  <updated>2018-09-06T09:35:14.865Z</updated>
  <id>http://lj360560179.github.io/</id>
  
  <author>
    <name>顶顶</name>
    <email>360560179@qq.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>mysql 索引结构</title>
    <link href="http://lj360560179.github.io/2018/07/19/mysql%E7%B4%A2%E5%BC%95/"/>
    <id>http://lj360560179.github.io/2018/07/19/mysql索引/</id>
    <published>2018-07-19T04:34:14.000Z</published>
    <updated>2018-09-06T09:35:14.865Z</updated>
    
    <content type="html"><![CDATA[<p>mysql 索引结构<br><a id="more"></a></p><h3 id="Inoodb"><a href="#Inoodb" class="headerlink" title="Inoodb"></a>Inoodb</h3><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/Inoodb.jpg" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>优化原则：</p><ul><li>永远用小结果集驱动大结果集</li><li>只取出自己需要的字段(1.数据量 2.排序占用)</li><li>使用最有效的过滤条件</li><li>避免复杂的查询</li></ul><h3 id="MyISAM"><a href="#MyISAM" class="headerlink" title="MyISAM"></a>MyISAM</h3><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/MyISAM.jpg" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h3 id="Join"><a href="#Join" class="headerlink" title="Join"></a>Join</h3><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/mysqljoin.jpg" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*查看join buffer 大小*/</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">VARIABLES</span> <span class="keyword">LIKE</span> <span class="string">'%join%'</span></span><br></pre></td></tr></table></figure><p>优化原则：</p><ul><li>永远用小结果集驱动大结果集</li><li>保证驱动表上的join条件字段已经被索引</li><li>调整Join Buffer(join_buffer_size)大小(空间换时间)</li></ul><h3 id="OrderBy"><a href="#OrderBy" class="headerlink" title="OrderBy"></a>OrderBy</h3><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/orderby.jpg" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*查看join buffer 大小*/</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">VARIABLES</span> <span class="keyword">LIKE</span> <span class="string">'%sort%'</span> </span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">VARIABLES</span> <span class="keyword">LIKE</span> <span class="string">'%max_length_for_sort_data%'</span></span><br></pre></td></tr></table></figure><p>优化原则：</p><ul><li>索引顺序一致的话不需要在排序</li><li>加大max_length_for_sort_data,把数据跟需要排序的字段放到内存中处理后一起返回。</li><li>加大innodb_sort_buffer_size(空间换时间)</li></ul><h3 id="GroupBy"><a href="#GroupBy" class="headerlink" title="GroupBy"></a>GroupBy</h3><p>GroupBy是在OrderBy的基础上进行的 所以优化与OrderBy同理</p><h3 id="Distinct"><a href="#Distinct" class="headerlink" title="Distinct"></a>Distinct</h3><p>Distinct是在GroupBy的基础上进行的 所以优化与OrderBy同理</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;mysql 索引结构&lt;br&gt;
    
    </summary>
    
      <category term="db" scheme="http://lj360560179.github.io/categories/db/"/>
    
    
      <category term="mysql" scheme="http://lj360560179.github.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>dubbo 调用流程</title>
    <link href="http://lj360560179.github.io/2018/06/25/dubbo/"/>
    <id>http://lj360560179.github.io/2018/06/25/dubbo/</id>
    <published>2018-06-25T07:44:14.000Z</published>
    <updated>2018-09-06T09:35:14.861Z</updated>
    
    <content type="html"><![CDATA[<p>dubbo调用简要流程图 </p><a id="more"></a><h3 id="dubbo的十个层"><a href="#dubbo的十个层" class="headerlink" title="dubbo的十个层"></a>dubbo的十个层</h3><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/dubbo.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h3 id="大致流程"><a href="#大致流程" class="headerlink" title="大致流程"></a>大致流程</h3><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/dubbo.jpg" alt="" title="">                </div>                <div class="image-caption"></div>            </figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;dubbo调用简要流程图 &lt;/p&gt;
    
    </summary>
    
    
      <category term="java" scheme="http://lj360560179.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>线程按顺序执行</title>
    <link href="http://lj360560179.github.io/2018/06/12/%E7%BA%BF%E7%A8%8B%E6%8C%89%E9%A1%BA%E5%BA%8F%E6%89%A7%E8%A1%8C/"/>
    <id>http://lj360560179.github.io/2018/06/12/线程按顺序执行/</id>
    <published>2018-06-12T07:25:00.000Z</published>
    <updated>2018-09-06T09:35:14.871Z</updated>
    
    <content type="html"><![CDATA[<h3 id="线程按顺序执行"><a href="#线程按顺序执行" class="headerlink" title="线程按顺序执行"></a>线程按顺序执行</h3><a id="more"></a><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> lj</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2018/6/11 20:18</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Thread1</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Thread2</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Thread3</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="number">3</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        ThreadSx();</span><br><span class="line">        ThreadSx2();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ThreadSx</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ExecutorService service = Executors.newSingleThreadExecutor();</span><br><span class="line">        service.submit(()-&gt;System.out.println(<span class="number">1</span>));</span><br><span class="line">        service.submit(()-&gt;System.out.println(<span class="number">2</span>));</span><br><span class="line">        service.submit(()-&gt;System.out.println(<span class="number">3</span>));</span><br><span class="line">        service.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ThreadSx2</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Thread1 t1 = <span class="keyword">new</span> Thread1();</span><br><span class="line">        Thread2 t2 = <span class="keyword">new</span> Thread2();</span><br><span class="line">        Thread3 t3 = <span class="keyword">new</span> Thread3();</span><br><span class="line">        t1.start();</span><br><span class="line">        t1.join();</span><br><span class="line">        t2.start();</span><br><span class="line">        t2.join();</span><br><span class="line">        t3.start();</span><br><span class="line">        t3.join();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="线程按顺序循环执行"><a href="#线程按顺序循环执行" class="headerlink" title="线程按顺序循环执行"></a>线程按顺序循环执行</h3><h4 id="synchronized"><a href="#synchronized" class="headerlink" title="synchronized"></a>synchronized</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> lj</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2018/6/12 11:04</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keyword">int</span> s = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Thread1</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (ThreadTest2.class) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>;) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (s == <span class="number">1</span>) &#123;</span><br><span class="line">                        System.out.println(<span class="number">1</span>);</span><br><span class="line">                        s = <span class="number">2</span>;</span><br><span class="line">                        i++;</span><br><span class="line">                        ThreadTest2.class.notifyAll();</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            ThreadTest2.class.wait();</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line"></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Thread2</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (ThreadTest2.class) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>;) &#123;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (s == <span class="number">2</span>) &#123;</span><br><span class="line">                        System.out.println(<span class="number">2</span>);</span><br><span class="line">                        s = <span class="number">3</span>;</span><br><span class="line">                        i++;</span><br><span class="line">                        ThreadTest2.class.notifyAll();</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            ThreadTest2.class.wait();</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line"></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Thread3</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (ThreadTest2.class) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">11</span>;) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (s == <span class="number">3</span>) &#123;</span><br><span class="line">                        System.out.println(<span class="number">3</span>);</span><br><span class="line">                        s = <span class="number">1</span>;</span><br><span class="line">                        i++;</span><br><span class="line">                        ThreadTest2.class.notifyAll();</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            ThreadTest2.class.wait();</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span><span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Thread1 t1 = <span class="keyword">new</span> Thread1();</span><br><span class="line">        Thread2 t2 = <span class="keyword">new</span> Thread2();</span><br><span class="line">        Thread3 t3 = <span class="keyword">new</span> Thread3();</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t3.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ReentrantLock"><a href="#ReentrantLock" class="headerlink" title="ReentrantLock"></a>ReentrantLock</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> lj</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2018/6/12 13:44</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest3</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ReentrantLock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keyword">int</span> s = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Thread1</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ) &#123;</span><br><span class="line">                lock.lock();</span><br><span class="line">                <span class="keyword">if</span> (s == <span class="number">1</span>) &#123;</span><br><span class="line">                    System.out.println(<span class="number">1</span>);</span><br><span class="line">                    s = <span class="number">2</span>;</span><br><span class="line">                    i++;</span><br><span class="line">                &#125;</span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Thread2</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>;) &#123;</span><br><span class="line">                lock.lock();</span><br><span class="line">                <span class="keyword">if</span> (s == <span class="number">2</span>) &#123;</span><br><span class="line">                    System.out.println(<span class="number">2</span>);</span><br><span class="line">                    s = <span class="number">3</span>;</span><br><span class="line">                    i++;</span><br><span class="line">                &#125;</span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Thread3</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ) &#123;</span><br><span class="line">                lock.lock();</span><br><span class="line">                <span class="keyword">if</span> (s == <span class="number">3</span>) &#123;</span><br><span class="line">                    System.out.println(<span class="number">3</span>);</span><br><span class="line">                    s = <span class="number">1</span>;</span><br><span class="line">                    i++;</span><br><span class="line">                &#125;</span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span><span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Thread1().start();</span><br><span class="line">        <span class="keyword">new</span> Thread2().start();</span><br><span class="line">        <span class="keyword">new</span> Thread3().start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Condition"><a href="#Condition" class="headerlink" title="Condition"></a>Condition</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> lj</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2018/6/12 14:10</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest4</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keyword">int</span> s = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ReentrantLock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Condition condition1 = lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Condition condition2 = lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Condition condition3 = lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Thread1</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (s != <span class="number">1</span>) &#123;</span><br><span class="line">                        condition1.await();</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        System.out.println(<span class="number">1</span>);</span><br><span class="line">                        s=<span class="number">2</span>;</span><br><span class="line">                        i++;</span><br><span class="line">                        condition2.signal();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Thread2</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (s != <span class="number">2</span>) &#123;</span><br><span class="line">                        condition2.await();</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        System.out.println(<span class="number">2</span>);</span><br><span class="line">                        s=<span class="number">3</span>;</span><br><span class="line">                        i++;</span><br><span class="line">                        condition3.signal();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Thread3</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (s != <span class="number">3</span>) &#123;</span><br><span class="line">                        condition3.await();</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        System.out.println(<span class="number">3</span>);</span><br><span class="line">                        s=<span class="number">1</span>;</span><br><span class="line">                        i++;</span><br><span class="line">                        condition1.signal();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Thread1().start();</span><br><span class="line">        <span class="keyword">new</span> Thread2().start();</span><br><span class="line">        <span class="keyword">new</span> Thread3().start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Semaphore"><a href="#Semaphore" class="headerlink" title="Semaphore"></a>Semaphore</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> lj</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2018/6/12 14:26</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest5</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Semaphore semaphore1 = <span class="keyword">new</span> Semaphore(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Semaphore semaphore2 = <span class="keyword">new</span> Semaphore(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Semaphore semaphore3 = <span class="keyword">new</span> Semaphore(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Thread1</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">                    semaphore1.acquire();</span><br><span class="line">                    System.out.println(<span class="number">1</span>);</span><br><span class="line">                    semaphore2.release();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Thread2</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">                    semaphore2.acquire();</span><br><span class="line">                    System.out.println(<span class="number">2</span>);</span><br><span class="line">                    semaphore3.release();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Thread3</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">                    semaphore3.acquire();</span><br><span class="line">                    System.out.println(<span class="number">3</span>);</span><br><span class="line">                    semaphore1.release();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        semaphore2.acquire();</span><br><span class="line">        semaphore3.acquire();</span><br><span class="line">        <span class="keyword">new</span> Thread1().start();</span><br><span class="line">        <span class="keyword">new</span> Thread2().start();</span><br><span class="line">        <span class="keyword">new</span> Thread3().start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;线程按顺序执行&quot;&gt;&lt;a href=&quot;#线程按顺序执行&quot; class=&quot;headerlink&quot; title=&quot;线程按顺序执行&quot;&gt;&lt;/a&gt;线程按顺序执行&lt;/h3&gt;
    
    </summary>
    
      <category term="java" scheme="http://lj360560179.github.io/categories/java/"/>
    
    
      <category term="java" scheme="http://lj360560179.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>线程模型</title>
    <link href="http://lj360560179.github.io/2018/04/25/%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B/"/>
    <id>http://lj360560179.github.io/2018/04/25/线程模型/</id>
    <published>2018-04-25T07:44:14.000Z</published>
    <updated>2018-09-06T09:35:14.872Z</updated>
    
    <content type="html"><![CDATA[<p>线程模型简单记录</p><a id="more"></a><h3 id="用户级线程模型-（1-N）"><a href="#用户级线程模型-（1-N）" class="headerlink" title="用户级线程模型 （1-N）"></a>用户级线程模型 （1-N）</h3><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/os.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h3 id="内核级线程-（1-1）"><a href="#内核级线程-（1-1）" class="headerlink" title="内核级线程 （1-1）"></a>内核级线程 （1-1）</h3><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/os1.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>对于官方JDK来说，因为Windwos和Linux操作系统（主流）只提供一对一线程模型 ，所以SUN JDK采用了一对一线程模型 。其它JDK可以有不同实现（如Solaris JDK可以采用N对M模型）。</p><h3 id="组合方式-（N-M）"><a href="#组合方式-（N-M）" class="headerlink" title="组合方式 （N-M）"></a>组合方式 （N-M）</h3><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/os2.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h3 id="golang线程模型MPG"><a href="#golang线程模型MPG" class="headerlink" title="golang线程模型MPG"></a>golang线程模型MPG</h3><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/goos.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h4 id="M-P-G三者关系"><a href="#M-P-G三者关系" class="headerlink" title="M-P-G三者关系"></a>M-P-G三者关系</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/goos1.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h4 id="M-P-G模型"><a href="#M-P-G模型" class="headerlink" title="M-P-G模型"></a>M-P-G模型</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/goos.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h4 id="M-P-G切换"><a href="#M-P-G切换" class="headerlink" title="M-P-G切换"></a>M-P-G切换</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/goos2.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h4 id="M-P-G均衡的分配工作"><a href="#M-P-G均衡的分配工作" class="headerlink" title="M-P-G均衡的分配工作"></a>M-P-G均衡的分配工作</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/goos3.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;线程模型简单记录&lt;/p&gt;
    
    </summary>
    
    
      <category term="go" scheme="http://lj360560179.github.io/tags/go/"/>
    
  </entry>
  
  <entry>
    <title>ES写入查询流程</title>
    <link href="http://lj360560179.github.io/2018/04/23/ES%E5%86%99%E5%85%A5%E6%9F%A5%E8%AF%A2%E6%B5%81%E7%A8%8B%E5%9B%BE/"/>
    <id>http://lj360560179.github.io/2018/04/23/ES写入查询流程图/</id>
    <published>2018-04-23T07:44:14.000Z</published>
    <updated>2018-09-06T09:35:14.855Z</updated>
    
    <content type="html"><![CDATA[<p>简单记录下ES写入查询流程</p><a id="more"></a><h3 id="流程图"><a href="#流程图" class="headerlink" title="流程图"></a>流程图</h3><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/ES.jpg" alt="" title="">                </div>                <div class="image-caption"></div>            </figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;简单记录下ES写入查询流程&lt;/p&gt;
    
    </summary>
    
    
      <category term="java" scheme="http://lj360560179.github.io/tags/java/"/>
    
      <category term="ES" scheme="http://lj360560179.github.io/tags/ES/"/>
    
  </entry>
  
  <entry>
    <title>Docker搭建ELK</title>
    <link href="http://lj360560179.github.io/2018/03/25/docker%E6%90%AD%E5%BB%BAelk/"/>
    <id>http://lj360560179.github.io/2018/03/25/docker搭建elk/</id>
    <published>2018-03-25T07:44:14.000Z</published>
    <updated>2018-09-06T09:35:14.860Z</updated>
    
    <content type="html"><![CDATA[<p>ELK由Elasticsearch、Logstash和Kibana三部分组件组成。 </p><a id="more"></a><h3 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a>安装docker</h3><p><a href="https://yq.aliyun.com/articles/110806?spm=5176.8351553.0.0.eea61991hgICTU" target="_blank" rel="noopener">安装docker</a></p><h3 id="elk安装前提"><a href="#elk安装前提" class="headerlink" title="elk安装前提"></a>elk安装前提</h3><ul><li>Docker至少得分配3GB的内存；</li><li>Elasticsearch至少需要单独2G的内存；</li><li><p>防火墙开放相关端口，执行以下命令开放相关端口；</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=5601/tcp --permanent;firewall-cmd --reload;</span><br><span class="line">firewall-cmd --zone=public --add-port=9200/tcp --permanent;firewall-cmd --reload;</span><br><span class="line">firewall-cmd --zone=public --add-port=5044/tcp --permanent;firewall-cmd --reload;</span><br></pre></td></tr></table></figure></li><li><p>vm.max_map_count至少需要262144，附永久修改vm.max_map_count操作以下命令更改配置：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc</span><br><span class="line">vi sysctl.conf</span><br><span class="line">   增加以下属性后退出保存：</span><br><span class="line">   vm.max_map_count=262144</span><br></pre></td></tr></table></figure></li></ul><h3 id="pull-elk镜像"><a href="#pull-elk镜像" class="headerlink" title="pull elk镜像"></a>pull elk镜像</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull sebp/elk</span><br></pre></td></tr></table></figure><p>该镜像包含了elk三个部分，比较方便，也可以单独拉起每个部分的镜像分开部署</p><h3 id="启动-elk"><a href="#启动-elk" class="headerlink" title="启动 elk"></a>启动 elk</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 5601:5601 -p 9200:9200 -p 5044:5044  -it --name elk sebp/elk</span><br></pre></td></tr></table></figure><p>启动要一会,使用命令查看容器是否正常运行<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure></p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/elk1.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>可以看到容器已经正常启动，打开浏览器，输入：http://你的ip:5601，看到如下界面说明安装成功，只是还没有数据<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/elk2.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure></p><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>使用命令以下进入容器内，并执行命令<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it elk /bin/bash </span><br><span class="line"></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">/opt/logstash/bin/logstash --path.data /tmp/logstash/data  -e <span class="string">'input &#123; stdin &#123; &#125; &#125; output &#123; elasticsearch &#123; hosts =&gt; ["localhost"] &#125; &#125;'</span></span><br></pre></td></tr></table></figure></p><p>运行后等一会，出现下图则说明成功按配置启动logstash,测试命令的意思是配置 以命令行输入logstash,然后传输到elasticsearch,然后随便输入一下测试数据<br><img src="http://ni484sha.com/images/elk3.png" alt=""><br>再次打开Kibana可以看到已经有数据，然后让你配置，按提示配置后去Discover就能看到刚才的数据<br><img src="http://ni484sha.com/images/elk4.png" alt=""><br>如果看到这样的报错信息 Logstash could not be started because there is already another instance using the configured data directory. If you wish to run multiple instances, you must change the “path.data” setting. 请执行命令：service logstash stop 然后在执行就可以了。  </p><h3 id="使用filebeat收集日志"><a href="#使用filebeat收集日志" class="headerlink" title="使用filebeat收集日志"></a>使用filebeat收集日志</h3><p>Filebeat是一个日志文件托运工具，在你的服务器上安装客户端后，filebeat会监控日志目录或者指定的日志文件，追踪读取这些文件（追踪文件的变化，不停的读），并且转发这些信息到elasticsearch或者logstarsh中存放。<br>因为项目是跑在docker中，可能不再一个虚拟机上，在一台虚拟机也不再同一个容器中，所以需要通过docker volumes将docker中的日志文件挂载到虚拟机上的一个目录，然后每台虚拟机使用filebeat来收集日志然后发送到logstash，当然logstash还有其他方式传输日志，比如redis，kafka等。如下图<br><img src="http://ni484sha.com/images/elk5.png" alt=""></p><h4 id="配置logstash"><a href="#配置logstash" class="headerlink" title="配置logstash"></a>配置logstash</h4><p>使用filebeat需要修改logstash配置文件，默认的就是使用beat输入<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/logstash/conf.d</span><br></pre></td></tr></table></figure></p><p>配置文件在容器中的conf.d目录下，修改目录下的02-beats-input.conf文件<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">input &#123;</span><br><span class="line">  beats &#123;</span><br><span class="line">    port =&gt; 5044</span><br><span class="line">    client_inactivity_timeout =&gt; 36000</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>client_inactivity_timeout为客户端连接超时时间,将证书的配置删除，如果你要配置证书，在filebeat也要配置，logstash配置还能做很多处理，比如<br><a href="http://grokdebug.herokuapp.com/patterns#" target="_blank" rel="noopener">grok解析</a><br>需要的可以去官网查看详细信息，修改成后重启docker 容器</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart elk</span><br></pre></td></tr></table></figure><h4 id="安装filebeat"><a href="#安装filebeat" class="headerlink" title="安装filebeat"></a>安装filebeat</h4><p>下载filebeat镜像<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull prima/filebeat</span><br></pre></td></tr></table></figure></p><p>启动前要配置filebeat.yml<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###################### Filebeat Configuration Example #########################</span></span><br><span class="line"><span class="comment"># You can find the full configuration reference here:</span></span><br><span class="line"><span class="comment"># https://www.elastic.co/guide/en/beats/filebeat/index.html</span></span><br><span class="line">filebeat.prospectors:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  enabled: <span class="literal">true</span></span><br><span class="line">  <span class="comment">#配置filebeat要读取的log文件路径，有多个的话可以使用通配符或者多个paths节点配置</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/lib/docker/volumes/home/logs/service/*.<span class="built_in">log</span></span><br><span class="line">  tags: [<span class="string">"service"</span>]</span><br><span class="line">  multiline:</span><br><span class="line">      pattern: ^\d&#123;4&#125;</span><br><span class="line">      negate: <span class="literal">true</span></span><br><span class="line">      match: after</span><br><span class="line">  fields:</span><br><span class="line">    doc_type: service </span><br><span class="line"></span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span> </span><br><span class="line">  enabled: <span class="literal">true</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/lib/docker/volumes/home/logs/app/*.<span class="built_in">log</span></span><br><span class="line">  tags: [<span class="string">"app"</span>]</span><br><span class="line">  multiline:</span><br><span class="line">      pattern: ^\d&#123;4&#125;</span><br><span class="line">      negate: <span class="literal">true</span></span><br><span class="line">      match: after</span><br><span class="line">  fields:</span><br><span class="line">    doc_type: app  </span><br><span class="line"></span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span> </span><br><span class="line">  enabled: <span class="literal">true</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/lib/docker/volumes/home/logs/center/*.<span class="built_in">log</span></span><br><span class="line">  tags: [<span class="string">"center"</span>]</span><br><span class="line">  multiline:</span><br><span class="line">      pattern: ^\d&#123;4&#125;</span><br><span class="line">      negate: <span class="literal">true</span></span><br><span class="line">      match: after</span><br><span class="line">  fields:</span><br><span class="line">    doc_type: center    </span><br><span class="line"></span><br><span class="line">setup.kibana:</span><br><span class="line">output.logstash:</span><br><span class="line">  hosts: [<span class="string">"127.0.0.1:5044"</span>]</span><br><span class="line">  logging.metrics.enabled: <span class="literal">false</span></span><br></pre></td></tr></table></figure></p><p>上面是一个简单的列子，可以去<a href="https://www.elastic.co/guide/en/beats/filebeat/index.html" target="_blank" rel="noopener">官网</a>看详细配置</p><p>然后启动filebeat<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name filebeat -v /home/filebeat/filebeat.yml:/filebeat.yml -v /var/lib/docker/volumes/:/var/lib/docker/volumes/ -v /home/filebeat/module:/module --net=host  prima/filebeat</span><br></pre></td></tr></table></figure></p><p>启动成功后配置文件中的监视目录下的日志文件就会传输到logstash中</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ELK由Elasticsearch、Logstash和Kibana三部分组件组成。 &lt;/p&gt;
    
    </summary>
    
    
      <category term="docker" scheme="http://lj360560179.github.io/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>MQ使用场景</title>
    <link href="http://lj360560179.github.io/2018/02/25/mq%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF/"/>
    <id>http://lj360560179.github.io/2018/02/25/mq使用场景/</id>
    <published>2018-02-25T07:44:14.000Z</published>
    <updated>2018-09-06T09:35:14.865Z</updated>
    
    <content type="html"><![CDATA[<p>简单记录下消息队列的使用场景，以及优缺点还有使用中需要注意的问题。</p><a id="more"></a><h3 id="常见MQ对比"><a href="#常见MQ对比" class="headerlink" title="常见MQ对比"></a>常见MQ对比</h3><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/MQ1.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h3 id="MQ使用场景"><a href="#MQ使用场景" class="headerlink" title="MQ使用场景"></a>MQ使用场景</h3><h4 id="解耦"><a href="#解耦" class="headerlink" title="解耦"></a>解耦</h4><p>分布式系统时经常会有某个系统调用其他系统的情况，如下图，用户下了一个订单，会在订单系统生成记录，然后用户系统要添加积分，商品系统需要修改销量库存等一系列操作，在没引入消息队列前，各系统间耦合严重，每当修改需求，其他系统不需要订单系统的数据，或者又有新的系统需要订单系统的数据，则每次都要修改订单系统的代码。引入消息队列后，其他系统只需要订阅队列，订单系统则可以不管其他系统如何操作，从而使各系统解耦。<br><img src="http://ni484sha.com/images/MQ2.png" alt=""></p><h4 id="异步"><a href="#异步" class="headerlink" title="异步"></a>异步</h4><p>在没有引入MQ前，因为是同步的，所以用户一个请求需要等待所有系统调用成功后才能返回结果，引入MQ后，用户完成下订单操作后就可以直接返回，不用等待其他系统的操作，降低了该请求的耗时。<br><img src="http://ni484sha.com/images/MQ3.png" alt=""></p><h4 id="削峰"><a href="#削峰" class="headerlink" title="削峰"></a>削峰</h4><p>当并发量很大的时候，如果程序直接写数据库，数据库会宕机，这时候引入MQ来进行削峰，先把请求写入MQ中，当高峰期后在消费队列中的数据，以防数据库宕机。<br><img src="http://ni484sha.com/images/MQ4.png" alt=""></p><h3 id="MQ产生的问题"><a href="#MQ产生的问题" class="headerlink" title="MQ产生的问题"></a>MQ产生的问题</h3><h4 id="系统复杂度"><a href="#系统复杂度" class="headerlink" title="系统复杂度"></a>系统复杂度</h4><p>引入MQ，会使系统复杂度大大提高，要额外的维护MQ，而且一般生产环境不会只部署一个MQ服务，为了可用性，都会部署多台MQ做集群。</p><h4 id="系统可用性"><a href="#系统可用性" class="headerlink" title="系统可用性"></a>系统可用性</h4><p>引入MQ后，如果MQ服务挂了，那整个系统就挂了，所以为了防止某个MQ宕机导致系统挂掉，一般都会做MQ集群，主流的MQ都提供了集群部署模式。</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/MQ5.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h4 id="重复数据"><a href="#重复数据" class="headerlink" title="重复数据"></a>重复数据</h4><p>一般MQ都会存在出现重复数据的情况，所以要保证系统不重复消费数据，一般都要在消费方操作前查询该消息是否被消费。并且把自动提交已消费改成手动提交，例如kafka自动提交offset改成手动提交，在消息消费成功后手动提交。</p><h4 id="消息丢失"><a href="#消息丢失" class="headerlink" title="消息丢失"></a>消息丢失</h4><p>如图，生产者P向队列中生产消息，C1和C2消费队列中的消息，默认情况下，MQ会平均的分发消费给C1C2（Round-robin dispatching），假设一个任务的执行时间非常长，在执行过程中，客户端挂了（连接断开），那么，该客户端正在处理且未完成的消息，以及分配给它还没来得及执行的消息，都将丢失。因为默认情况下，MQ分发完消息后，就会从内存中把消息删除掉。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/MQ6.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><br>通常的解决办法是使用消息确认机制。基本每个MQ都用类似的机制配置。</p><h4 id="消息堆积"><a href="#消息堆积" class="headerlink" title="消息堆积"></a>消息堆积</h4><p>如果消费方出现了BUG，消息就会堆积在消息队列中，堆积到消息队列承载的极限，准备挂的时候，通常此时就应该增加机器，然后把原来队列中的数据分发到临时的队列中，然后添加多个消费方来快速消费数据。</p><h4 id="按顺序执行"><a href="#按顺序执行" class="headerlink" title="按顺序执行"></a>按顺序执行</h4><p>有时候消息需要按顺序消费，可以以某个字段来分发到同一个队列中。消费方如果需要使用多线程来消费，则可以新建临时的内存队列，同理以某个字段分组放到同一个内存队列中消费</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;简单记录下消息队列的使用场景，以及优缺点还有使用中需要注意的问题。&lt;/p&gt;
    
    </summary>
    
    
      <category term="java" scheme="http://lj360560179.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>jvm常用命令</title>
    <link href="http://lj360560179.github.io/2017/06/17/%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7/"/>
    <id>http://lj360560179.github.io/2017/06/17/性能监控/</id>
    <published>2017-06-16T16:34:14.000Z</published>
    <updated>2018-09-06T09:35:14.871Z</updated>
    
    <content type="html"><![CDATA[<h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><h5 id="系统性能监控"><a href="#系统性能监控" class="headerlink" title="系统性能监控"></a>系统性能监控</h5><ul><li>确定系统运行的整体状态，基本定位问题所在<h5 id="Java自带的工具"><a href="#Java自带的工具" class="headerlink" title="Java自带的工具"></a>Java自带的工具</h5></li><li>查看Java程序运行细节，进一步定位问题</li></ul><h4 id="系统性能监控-linux"><a href="#系统性能监控-linux" class="headerlink" title="系统性能监控 linux"></a>系统性能监控 linux</h4><h5 id="uptime"><a href="#uptime" class="headerlink" title="uptime"></a>uptime</h5><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/xn1.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h5 id="连接数"><a href="#连接数" class="headerlink" title="连接数"></a>连接数</h5><ul><li>每一个终端算一个连接<h5 id="1，5，15分钟内的系统平均负载"><a href="#1，5，15分钟内的系统平均负载" class="headerlink" title="1，5，15分钟内的系统平均负载"></a>1，5，15分钟内的系统平均负载</h5></li><li>运行队列中的平均进程数</li></ul><h5 id="top"><a href="#top" class="headerlink" title="top"></a>top</h5><h5 id="vmstat"><a href="#vmstat" class="headerlink" title="vmstat"></a>vmstat</h5><ul><li>可以统计系统的CPU，内存，swap，io等情况</li></ul><h5 id="pidstat"><a href="#pidstat" class="headerlink" title="pidstat"></a>pidstat</h5><ul><li>细致观察进程</li><li>需要安装( sudo apt-get install sysstat)</li><li>监控CPU</li><li>监控IO</li><li>监控内存</li></ul><p>-p 指定进程 –u 监控CPU 每秒采样 一共3次</p><h4 id="Java自带的工具-1"><a href="#Java自带的工具-1" class="headerlink" title="Java自带的工具"></a>Java自带的工具</h4><h5 id="jps"><a href="#jps" class="headerlink" title="jps"></a>jps</h5><ul><li>列出java进程，类似于ps命令.</li><li>参数-q可以指定jps只输出进程ID ，不输出类的短名称.</li><li>参数-m可以用于输出传递给Java进程（主函数）的参数.</li><li>参数-l可以用于输出主函数的完整路径.</li><li>参数-v可以显示传递给JVM的参数.</li></ul><h5 id="jinfo"><a href="#jinfo" class="headerlink" title="jinfo"></a>jinfo</h5><ul><li>可以用来查看正在运行的Java应用程序的扩展参数，甚至支持在运行时，修改部分参数</li><li>-flag <name>：打印指定JVM的参数值</name></li><li>-flag [+|-]<name>：设置指定JVM参数的布尔值</name></li><li>-flag <name>=<value>：设置指定JVM参数的值</value></name></li></ul><h5 id="jmap"><a href="#jmap" class="headerlink" title="jmap"></a>jmap</h5><ul><li>生成Java应用程序的堆快照和对象的统计信息</li><li>jmap -histo 2972 &gt;c:\s.txt</li></ul><h5 id="Dump堆"><a href="#Dump堆" class="headerlink" title="Dump堆"></a>Dump堆</h5><ul><li>jmap -dump:format=b,file=c:\heap.hprof 2972</li></ul><h5 id="jstack"><a href="#jstack" class="headerlink" title="jstack"></a>jstack</h5><ul><li>打印线程dump</li><li>-l 打印锁信息</li><li>-m 打印java和native的帧信息</li><li>-F 强制dump，当jstack没有响应时使用</li></ul><h4 id="内存溢出-OOM-的原因"><a href="#内存溢出-OOM-的原因" class="headerlink" title="内存溢出(OOM)的原因"></a>内存溢出(OOM)的原因</h4><h5 id="在JVM中，有哪些内存区间？"><a href="#在JVM中，有哪些内存区间？" class="headerlink" title="在JVM中，有哪些内存区间？"></a>在JVM中，有哪些内存区间？</h5><ul><li>堆</li><li>永久区</li><li>线程栈</li><li>直接内存</li></ul><h5 id="堆溢出"><a href="#堆溢出" class="headerlink" title="堆溢出"></a>堆溢出</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span></span>&#123;</span><br><span class="line">    ArrayList&lt;<span class="keyword">byte</span>[]&gt; list=<span class="keyword">new</span> ArrayList&lt;<span class="keyword">byte</span>[]&gt;();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">1024</span>;i++)&#123;</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>*<span class="number">1024</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//占用大量的堆空间，直接溢出</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: Java heap space</span><br><span class="line">at geym.jvm.ch8.oom.SimpleHeapOOM.main(SimpleHeapOOM.java:14)</span><br></pre></td></tr></table></figure><blockquote><p>解决方法：增大堆空间，及时释放内存</p></blockquote><h5 id="永久区"><a href="#永久区" class="headerlink" title="永久区"></a>永久区</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//生成大量的类</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">100000</span>;i++)&#123;</span><br><span class="line">        CglibBean bean = <span class="keyword">new</span> CglibBean(<span class="string">"geym.jvm.ch3.perm.bean"</span>+i,<span class="keyword">new</span> HashMap());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>增大Perm区、允许Class回收</p></blockquote><h5 id="Java栈溢出"><a href="#Java栈溢出" class="headerlink" title="Java栈溢出"></a>Java栈溢出</h5><ul><li>这里的栈溢出指，在创建线程的时候，需要为线程分配栈空间，这个栈空间是向操作系统请求的，如果操作系统无法给出足够的空间，就会抛出OOM</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SleepThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">10000000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">1000</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> SleepThread(),<span class="string">"Thread"</span>+i).start();</span><br><span class="line">        System.out.println(<span class="string">"Thread"</span>+i+<span class="string">" created"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Xmx1g -Xss1m</span><br></pre></td></tr></table></figure><pre><code class="s">Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: unable to create new native thread</code></pre><blockquote><p>解决方法：<br>减少堆内存<br>减少线程栈大小</p></blockquote><h5 id="直接内存溢出"><a href="#直接内存溢出" class="headerlink" title="直接内存溢出"></a>直接内存溢出</h5><ul><li>ByteBuffer.allocateDirect()无法从操作系统获得足够的空间</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;常用命令&quot;&gt;&lt;a href=&quot;#常用命令&quot; class=&quot;headerlink&quot; title=&quot;常用命令&quot;&gt;&lt;/a&gt;常用命令&lt;/h3&gt;&lt;h5 id=&quot;系统性能监控&quot;&gt;&lt;a href=&quot;#系统性能监控&quot; class=&quot;headerlink&quot; title=&quot;系统性能监
      
    
    </summary>
    
      <category term="java" scheme="http://lj360560179.github.io/categories/java/"/>
    
    
      <category term="java" scheme="http://lj360560179.github.io/tags/java/"/>
    
      <category term="jvm" scheme="http://lj360560179.github.io/tags/jvm/"/>
    
  </entry>
  
  <entry>
    <title>GC相关</title>
    <link href="http://lj360560179.github.io/2017/06/14/GC%E5%8F%82%E6%95%B0/"/>
    <id>http://lj360560179.github.io/2017/06/14/GC参数/</id>
    <published>2017-06-13T16:00:00.000Z</published>
    <updated>2018-09-06T09:35:14.856Z</updated>
    
    <content type="html"><![CDATA[<h3 id="GC-参数"><a href="#GC-参数" class="headerlink" title="GC 参数"></a>GC 参数</h3><h4 id="堆的回顾"><a href="#堆的回顾" class="headerlink" title="堆的回顾"></a>堆的回顾</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/gcc1.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h4 id="GC参数-串行收集器"><a href="#GC参数-串行收集器" class="headerlink" title="GC参数 - 串行收集器"></a>GC参数 - 串行收集器</h4><ul><li>最古老，最稳定</li><li>效率高</li><li>可能会产生较长的停顿</li><li>-XX:+UseSerialGC</li><li>新生代、老年代使用串行回收</li><li>新生代复制算法  </li><li>老年代标记-压缩</li></ul><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/gcc2.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h4 id="GC参数-并行收集器"><a href="#GC参数-并行收集器" class="headerlink" title="GC参数 -并行收集器"></a>GC参数 -并行收集器</h4><h5 id="ParNew收集器"><a href="#ParNew收集器" class="headerlink" title="ParNew收集器"></a>ParNew收集器</h5><ul><li>-XX:+UseParNewGC()<ul><li>新生代并行</li><li>老年代串行</li></ul></li><li>Serial收集器新生代的并行版本</li><li>复制算法</li><li>多线程，需要多核支持</li><li>-XX:ParallelGCThreads 限制线程数量</li></ul><p>多线程不一定快哦！</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/gcc99.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><ul><li>Parallel收集器<ul><li>类似ParNew  </li><li>新生代复制算法  </li><li>老年代 标记-压缩  </li><li>更加关注吞吐量</li><li>XX:+UseParallelGC  </li></ul><ul><li>使用Parallel收集器 + 老年代串行  </li></ul><ul><li>XX:+UseParallelOldGC</li></ul><ul><li>使用Parallel收集器 + 并行老年代</li></ul></li></ul><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/gcc3.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><ul><li>-XX:MaxGCPauseMills<ul><li>最大停顿时间，单位毫秒  </li><li>GC尽力保证回收时间不超过设定值</li></ul></li><li>-XX:GCTimeRatio<ul><li>0-100的取值范围</li><li>垃圾收集时间占总时间的比</li><li>默认99，即最大允许1%时间做GC</li></ul></li><li>这两个参数是矛盾的。因为停顿时间和吞吐量不可能同时调优</li></ul><h4 id="CMS收集器"><a href="#CMS收集器" class="headerlink" title="CMS收集器"></a>CMS收集器</h4><h5 id="CMS收集器-1"><a href="#CMS收集器-1" class="headerlink" title="CMS收集器"></a>CMS收集器</h5><ul><li>Concurrent Mark Sweep 并发标(与用户线程一起执行)记清除  </li><li>标记-清除算法  </li><li>与标记-压缩相比  </li><li>并发阶段会降低吞吐量  </li><li>老年代收集器（新生代使用ParNew）  </li><li>XX:+UseConcMarkSweepGC<h5 id="CMS运行过程比较复杂，着重实现了标记的过程，可分为"><a href="#CMS运行过程比较复杂，着重实现了标记的过程，可分为" class="headerlink" title="CMS运行过程比较复杂，着重实现了标记的过程，可分为"></a>CMS运行过程比较复杂，着重实现了标记的过程，可分为</h5></li><li>初始标记<ul><li>根可以直接关联到的对象</li><li>速度快</li></ul></li><li>并发标记（和用户线程一起）</li><li>主要标记过程，标记全部对象</li><li>重新标记<ul><li>由于并发标记时，用户线程依然运行，因此在正式清理前，再做修正</li></ul></li><li>并发清除（和用户线程一起）  </li><li>基于标记结果，直接清理对象</li></ul><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/gcc4.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h5 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h5><ul><li>尽可能降低停顿</li><li>会影响系统整体吞吐量和性能<ul><li>比如，在用户线程运行过程中，分一半CPU去做GC，系统性能在GC阶段，反应速度就下降一半</li></ul></li><li>清理不彻底<ul><li>因为在清理阶段，用户线程还在运行，会产生新的垃圾，无法清理</li></ul></li><li>因为和用户线程一起运行，不能在空间快满时再清理<ul><li>-XX:CMSInitiatingOccupancyFraction设置触发GC的阈值</li><li>如果不幸内存预留空间不够，就会引起concurrent mode failure</li></ul></li></ul><p>使用串行收集器作为后备</p><ul><li>有关碎片<ul><li>标记-清除和标记-压缩</li></ul></li></ul><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/gcc5.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><ul><li>-XX:+ UseCMSCompactAtFullCollection Full GC后，进行一次整理<ul><li>整理过程是独占的，会引起停顿时间变长</li></ul></li><li>-XX:+CMSFullGCsBeforeCompaction <ul><li>设置进行几次Full GC后，进行一次碎片整理</li></ul></li><li>-XX:ParallelCMSThreads<ul><li>设定CMS的线程数量</li></ul></li></ul><h4 id="GC参数整理"><a href="#GC参数整理" class="headerlink" title="GC参数整理"></a>GC参数整理</h4><p>-XX:+UseSerialGC：在新生代和老年代使用串行收集器<br>-XX:SurvivorRatio：设置eden区大小和survivior区大小的比例 //8:1:1<br>-XX:NewRatio:新生代和老年代的比<br>-XX:+UseParNewGC：在新生代使用并行收集器<br>-XX:+UseParallelGC ：新生代使用并行回收收集器<br>-XX:+UseParallelOldGC：老年代使用并行回收收集器<br>-XX:ParallelGCThreads：设置用于垃圾回收的线程数<br>-XX:+UseConcMarkSweepGC：新生代使用并行收集器，老年代使用CMS+串行收集器(作为担保)<br>-XX:ParallelCMSThreads：设定CMS的线程数量<br>-XX:CMSInitiatingOccupancyFraction：设置CMS收集器在老年代空间被使用多少后触发<br>-XX:+UseCMSCompactAtFullCollection：设置CMS收集器在完成垃圾收集后是否要进行一次内存碎片的整理<br>-XX:CMSFullGCsBeforeCompaction：设定进行多少次CMS垃圾回收后，进行一次内存压缩<br>-XX:+CMSClassUnloadingEnabled：允许对类元数据进行回收<br>-XX:CMSInitiatingPermOccupancyFraction：当永久区占用率达到这一百分比时，启动CMS回收<br>-XX:UseCMSInitiatingOccupancyOnly：表示只在到达阀值的时候，才进行CMS回收</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;GC-参数&quot;&gt;&lt;a href=&quot;#GC-参数&quot; class=&quot;headerlink&quot; title=&quot;GC 参数&quot;&gt;&lt;/a&gt;GC 参数&lt;/h3&gt;&lt;h4 id=&quot;堆的回顾&quot;&gt;&lt;a href=&quot;#堆的回顾&quot; class=&quot;headerlink&quot; title=&quot;堆的回顾&quot;
      
    
    </summary>
    
      <category term="java" scheme="http://lj360560179.github.io/categories/java/"/>
    
    
      <category term="java" scheme="http://lj360560179.github.io/tags/java/"/>
    
      <category term="jvm" scheme="http://lj360560179.github.io/tags/jvm/"/>
    
      <category term="GC" scheme="http://lj360560179.github.io/tags/GC/"/>
    
  </entry>
  
  <entry>
    <title>GC算法与种类</title>
    <link href="http://lj360560179.github.io/2017/06/13/GC%E7%AE%97%E6%B3%95%E5%92%8C%E7%A7%8D%E7%B1%BB/"/>
    <id>http://lj360560179.github.io/2017/06/13/GC算法和种类/</id>
    <published>2017-06-12T16:34:14.000Z</published>
    <updated>2018-09-06T09:35:14.857Z</updated>
    
    <content type="html"><![CDATA[<h3 id="GC-算法与种类"><a href="#GC-算法与种类" class="headerlink" title="GC 算法与种类"></a>GC 算法与种类</h3><ul><li>GC的概念</li><li><p>GC算法</p><ul><li>引用计数法</li><li>标记清除</li><li>标记压缩</li><li>复制算法</li></ul></li><li><p>可触及性</p></li><li>Stop-The-World</li></ul><h4 id="GC的概念"><a href="#GC的概念" class="headerlink" title="GC的概念"></a>GC的概念</h4><ul><li>Garbage Collection 垃圾收集</li><li>1960年 List 使用了GC</li><li>Java中，GC的对象是堆空间和永久区</li></ul><h4 id="引用计数法"><a href="#引用计数法" class="headerlink" title="引用计数法"></a>引用计数法</h4><ul><li>老牌垃圾回收算法</li><li>通过引用计算来回收垃圾</li><li>使用者<ul><li>COM</li><li>ActionScript3</li><li>Python</li></ul></li></ul><p>引用计数器的实现很简单，对于一个对象A，只要有任何一个对象引用了A，则A的引用计数器就加1，当引用失效时，引用计数器就减1。只要对象A的引用计数器的值为0，则对象A就不可能再被使用。</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/gc1.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>引用计数法的问题</p><ul><li>引用和去引用伴随加法和减法，影响性能</li><li>很难处理循环引用</li></ul><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/gc2.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h4 id="标记-清除"><a href="#标记-清除" class="headerlink" title="标记-清除"></a>标记-清除</h4><p>标记-清除算法是现代垃圾回收算法的思想基础。标记-清除算法将垃圾回收分为两个阶段：标记阶段和清除阶段。一种可行的实现是，在标记阶段，首先通过根节点，标记所有从根节点开始的可达对象。因此，未被标记的对象就是未被引用的垃圾对象。然后，在清除阶段，清除所有未被标记的对象。</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/gc3.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h4 id="标记-压缩"><a href="#标记-压缩" class="headerlink" title="标记-压缩"></a>标记-压缩</h4><p>标记-压缩算法适合用于存活对象较多的场合，如老年代。它在标记-清除算法的基础上做了一些优化。和标记-清除算法一样，标记-压缩算法也首先需要从根节点开始，对所有可达对象做一次标记。但之后，它并不简单的清理未标记的对象，而是将所有的存活对象压缩到内存的一端。之后，<em>清理边界外所有的空间</em>。</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/gc4.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h4 id="标记压缩对标记清除而言，有什么优势呢？"><a href="#标记压缩对标记清除而言，有什么优势呢？" class="headerlink" title="标记压缩对标记清除而言，有什么优势呢？"></a>标记压缩对标记清除而言，有什么优势呢？</h4><h4 id="复制算法"><a href="#复制算法" class="headerlink" title="复制算法"></a>复制算法</h4><p>与标记-清除算法相比，复制算法是一种相对高效的回收方法<br>不适用于存活对象较多的场合 如老年代<br>将原有的内存空间分为两块，每次只使用其中一块，在垃圾回收时，将正在使用的内存中的存活对象复制到未使用的内存块中，之后，清除正在使用的内存块中的所有对象，交换两个内存的角色，完成垃圾回收</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/gc5.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>复制算法的最大问题是：空间浪费 整合标记清理思想</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/gc6.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><ul><li>-XX:+PrintGCDetails的输出</li></ul><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/gc7.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h4 id="分代思想"><a href="#分代思想" class="headerlink" title="分代思想"></a>分代思想</h4><p>依据对象的存活周期进行分类，短命对象归为新生代，长命对象归为老年代。<br>根据不同代的特点，选取合适的收集算法  </p><ul><li>少量对象存活，适合复制算法</li><li>大量对象存活，适合标记清理或者标记压缩</li></ul><h4 id="GC算法总结整理"><a href="#GC算法总结整理" class="headerlink" title="GC算法总结整理"></a>GC算法总结整理</h4><ul><li><p>引用计数</p><ul><li>没有被Java采用</li></ul></li><li><p>标记-清除</p></li><li><p>标记-压缩</p></li><li><p>复制算法</p><ul><li>新生代</li></ul></li></ul><p>所有的算法，需要能够识别一个垃圾对象，因此需要给出一个可触及性的定义</p><h4 id="可触及性"><a href="#可触及性" class="headerlink" title="可触及性"></a>可触及性</h4><ul><li><p>可触及的</p><ul><li>从根节点可以触及到这个对象</li></ul></li><li><p>可复活的</p><ul><li>一旦所有引用被释放，就是可复活状态</li><li>因为在finalize()中可能复活该对象</li></ul></li><li><p>不可触及的</p><ul><li>在finalize()后，可能会进入不可触及状态</li><li>不可触及的对象不可能复活</li><li>可以回收</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CanReliveObj</span> </span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> CanReliveObj obj;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">finalize</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line"><span class="keyword">super</span>.finalize();</span><br><span class="line">System.out.println(<span class="string">"CanReliveObj finalize called"</span>);</span><br><span class="line">obj = <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"I am CanReliveObj"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">obj = <span class="keyword">new</span> CanReliveObj();</span><br><span class="line">obj = <span class="keyword">null</span>; <span class="comment">// 可复活</span></span><br><span class="line">System.gc();</span><br><span class="line">Thread.sleep(<span class="number">1000</span>);</span><br><span class="line"><span class="keyword">if</span> (obj == <span class="keyword">null</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">"obj 是 null"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">System.out.println(<span class="string">"obj 可用"</span>);</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">"第二次gc"</span>);</span><br><span class="line">obj = <span class="keyword">null</span>; <span class="comment">// 不可复活</span></span><br><span class="line">System.gc();</span><br><span class="line">Thread.sleep(<span class="number">1000</span>);</span><br><span class="line"><span class="keyword">if</span> (obj == <span class="keyword">null</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">"obj 是 null"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">System.out.println(<span class="string">"obj 可用"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>经验：避免使用finalize()，操作不慎可能导致错误。  </li><li><p>优先级低，何时被调用， 不确定  </p><ul><li>何时发生GC不确定  </li><li>可以使用try-catch-finally来替代它</li></ul></li><li><p>根</p><ul><li>栈中引用的对象</li><li>方法区中静态成员或者常量引用的对象（全局对象）</li><li>JNI方法栈中引用对象</li></ul></li></ul><h4 id="Stop-The-World"><a href="#Stop-The-World" class="headerlink" title="Stop-The-World"></a>Stop-The-World</h4><ul><li><p>Java中一种全局暂停的现象</p><ul><li>全局停顿，所有Java代码停止，native代码可以执行，但不能和JVM交互</li><li>多半由于GC引起(Dump线程、死锁检查、堆Dump)</li></ul></li><li><p>GC时为什么会有全局停顿？</p><ul><li>类比在聚会时打扫房间，聚会时很乱，又有新的垃圾产生，房间永远打扫不干净，只有让大家停止活动了，才能将房间打扫干净。</li></ul></li><li><p>危害</p><ul><li>长时间服务停止，没有响应</li><li>遇到HA系统，可能引起主备切换，严重危害生产环境。</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PrintThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> starttime=System.currentTimeMillis();</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line"><span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line"><span class="keyword">long</span> t=System.currentTimeMillis()-starttime;</span><br><span class="line">System.out.println(<span class="string">"time:"</span>+t);</span><br><span class="line">Thread.sleep(<span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Xmx512M -Xms512M -XX:+UseSerialGC -Xloggc:gc.log -XX:+PrintGCDetails  -Xmn1m -XX:PretenureSizeThreshold=50 -XX:MaxTenuringThreshold=1</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">HashMap&lt;Long,<span class="keyword">byte</span>[]&gt; map=<span class="keyword">new</span> HashMap&lt;Long,<span class="keyword">byte</span>[]&gt;();</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line"><span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(map.size()*<span class="number">512</span>/<span class="number">1024</span>/<span class="number">1024</span>&gt;=<span class="number">450</span>)&#123;<span class="comment">//大于450M时，清理内存</span></span><br><span class="line">System.out.println(<span class="string">"=====准备清理=====:"</span> +map.size());</span><br><span class="line">map.clear();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//工作线程，消耗内存</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">1024</span>;i++)&#123;</span><br><span class="line">map.put(System.nanoTime(), <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">512</span>]);</span><br><span class="line">&#125;</span><br><span class="line">Thread.sleep(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/gc8.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;GC-算法与种类&quot;&gt;&lt;a href=&quot;#GC-算法与种类&quot; class=&quot;headerlink&quot; title=&quot;GC 算法与种类&quot;&gt;&lt;/a&gt;GC 算法与种类&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;GC的概念&lt;/li&gt;
&lt;li&gt;&lt;p&gt;GC算法&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;引用计数
      
    
    </summary>
    
      <category term="java" scheme="http://lj360560179.github.io/categories/java/"/>
    
    
      <category term="java" scheme="http://lj360560179.github.io/tags/java/"/>
    
      <category term="jvm" scheme="http://lj360560179.github.io/tags/jvm/"/>
    
      <category term="GC" scheme="http://lj360560179.github.io/tags/GC/"/>
    
  </entry>
  
  <entry>
    <title>常用JVM配置参数</title>
    <link href="http://lj360560179.github.io/2017/06/12/jvm%E5%8F%82%E6%95%B0%E8%AE%BE%E7%BD%AE/"/>
    <id>http://lj360560179.github.io/2017/06/12/jvm参数设置/</id>
    <published>2017-06-11T16:34:14.000Z</published>
    <updated>2018-09-06T09:35:14.863Z</updated>
    
    <content type="html"><![CDATA[<h3 id="常用JVM配置参数"><a href="#常用JVM配置参数" class="headerlink" title="常用JVM配置参数"></a>常用JVM配置参数</h3><h4 id="Trace跟踪参数"><a href="#Trace跟踪参数" class="headerlink" title="Trace跟踪参数"></a>Trace跟踪参数</h4><ul><li><p>-verbose:gc</p></li><li><p>-XX:+printGC</p></li><li><p>可以打印GC的简要信息</p></li></ul><blockquote><p>[GC 4790K-&gt;374K(15872K), 0.0001606 secs]<br>[GC 4790K-&gt;374K(15872K), 0.0001474 secs]<br>[GC 4790K-&gt;374K(15872K), 0.0001563 secs]<br>[GC 4790K-&gt;374K(15872K), 0.0001682 secs]</p></blockquote><ul><li><p>-XX:+PrintGCDetails</p><p>打印GC详细信息</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/jvm_1_1.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure></li><li><p>-XX:+PrintGCTimeStamps</p><p>打印CG发生的时间戳</p></li></ul><blockquote><p>例：[GC[DefNew: 4416K-&gt;0K(4928K), 0.0001897 secs] 4790K-&gt;374K(15872K), 0.0002232 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] </p></blockquote><ul><li><p>-XX:+PrintGCDetails的输出</p></li><li><p>-Xloggc:log/gc.log</p></li></ul><p>指定GC log的位置，以文件输出<br>帮助开发人员分析问题</p><ul><li>-XX:+PrintHeapAtGC</li></ul><p>每次一次GC后，都打印堆信息</p><ul><li>-XX:+TraceClassLoading<br>监控类的加载</li></ul><blockquote><p>[Loaded java.lang.Object from shared objects file]<br>[Loaded java.io.Serializable from shared objects file]<br>[Loaded java.lang.Comparable from shared objects file]<br>[Loaded java.lang.CharSequence from shared objects file]<br>[Loaded java.lang.String from shared objects file]<br>[Loaded java.lang.reflect.GenericDeclaration from shared objects file]<br>[Loaded java.lang.reflect.Type from shared objects file]</p></blockquote><ul><li>-XX:+PrintClassHistogram</li></ul><p>按下Ctrl+Break后，打印类的信息：</p><p>分别显示：序号、实例数量、总大小、类型</p><h4 id="堆的分配参数"><a href="#堆的分配参数" class="headerlink" title="堆的分配参数"></a>堆的分配参数</h4><ul><li>-Xmx –Xms<br>指定最大堆和最小堆<br>-Xmx20m -Xms5m  运行代码：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">System.out.print(<span class="string">"Xmx="</span>);</span><br><span class="line">System.out.println(Runtime.getRuntime().maxMemory()/<span class="number">1024.0</span>/<span class="number">1024</span>+<span class="string">"M"</span>);</span><br><span class="line"></span><br><span class="line">System.out.print(<span class="string">"free mem="</span>);</span><br><span class="line">System.out.println(Runtime.getRuntime().freeMemory()/<span class="number">1024.0</span>/<span class="number">1024</span>+<span class="string">"M"</span>);</span><br><span class="line"></span><br><span class="line">System.out.print(<span class="string">"total mem="</span>);</span><br><span class="line">System.out.println(Runtime.getRuntime().totalMemory()/<span class="number">1024.0</span>/<span class="number">1024</span>+<span class="string">"M"</span>);</span><br></pre></td></tr></table></figure><p>Xmx=19.375M<br>free mem=4.342750549316406M<br>total mem=4.875M  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">byte</span>[] b=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1</span>*<span class="number">1024</span>*<span class="number">1024</span>];</span><br><span class="line">System.out.println(<span class="string">"分配了1M空间给数组"</span>);</span><br><span class="line"></span><br><span class="line">System.out.print(<span class="string">"Xmx="</span>);</span><br><span class="line">System.out.println(Runtime.getRuntime().maxMemory()/<span class="number">1024.0</span>/<span class="number">1024</span>+<span class="string">"M"</span>);</span><br><span class="line"></span><br><span class="line">System.out.print(<span class="string">"free mem="</span>);</span><br><span class="line">System.out.println(Runtime.getRuntime().freeMemory()/<span class="number">1024.0</span>/<span class="number">1024</span>+<span class="string">"M"</span>);<span class="comment">//Java会尽可能维持在最小堆</span></span><br><span class="line"></span><br><span class="line">System.out.print(<span class="string">"total mem="</span>);</span><br><span class="line">System.out.println(Runtime.getRuntime().totalMemory()/<span class="number">1024.0</span>/<span class="number">1024</span>+<span class="string">"M"</span>);</span><br></pre></td></tr></table></figure><p>分配了1M空间给数组<br>Xmx=19.375M<br>free mem=3.4791183471679688M<br>total mem=4.875M  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">b=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">4</span>*<span class="number">1024</span>*<span class="number">1024</span>];</span><br><span class="line">System.out.println(<span class="string">"分配了4M空间给数组"</span>);</span><br><span class="line"></span><br><span class="line">System.out.print(<span class="string">"Xmx="</span>);</span><br><span class="line">System.out.println(Runtime.getRuntime().maxMemory()/<span class="number">1024.0</span>/<span class="number">1024</span>+<span class="string">"M"</span>);</span><br><span class="line"></span><br><span class="line">System.out.print(<span class="string">"free mem="</span>);</span><br><span class="line">System.out.println(Runtime.getRuntime().freeMemory()/<span class="number">1024.0</span>/<span class="number">1024</span>+<span class="string">"M"</span>);</span><br><span class="line"></span><br><span class="line">System.out.print(<span class="string">"total mem="</span>);</span><br><span class="line">System.out.println(Runtime.getRuntime().totalMemory()/<span class="number">1024.0</span>/<span class="number">1024</span>+<span class="string">"M"</span>);</span><br></pre></td></tr></table></figure><p>分配了4M空间给数组<br>Xmx=19.375M<br>free mem=3.5899810791015625M<br>total mem=9.00390625M &lt;– 可以看到总内存变多了</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">System.gc();  </span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"回收内存"</span>);</span><br><span class="line">System.out.print(<span class="string">"Xmx="</span>);</span><br><span class="line">System.out.println(Runtime.getRuntime().maxMemory()/<span class="number">1024.0</span>/<span class="number">1024</span>+<span class="string">"M"</span>);</span><br><span class="line"></span><br><span class="line">System.out.print(<span class="string">"free mem="</span>);</span><br><span class="line">System.out.println(Runtime.getRuntime().freeMemory()/<span class="number">1024.0</span>/<span class="number">1024</span>+<span class="string">"M"</span>);</span><br><span class="line"></span><br><span class="line">System.out.print(<span class="string">"total mem="</span>);</span><br><span class="line">System.out.println(Runtime.getRuntime().totalMemory()/<span class="number">1024.0</span>/<span class="number">1024</span>+<span class="string">"M"</span>);</span><br></pre></td></tr></table></figure><p>回收内存<br>Xmx=19.375M<br>free mem=6.354591369628906M  &lt;—可以看到空闲内存增加<br>total mem=10.75390625M</p><p>-Xmn</p><ul><li>设置新生代大小</li></ul><p>-XX:NewRatio</p><ul><li>新生代（eden+2*s）和老年代（不包含永久区）的比值</li><li>4 表示 新生代:老年代=1:4，即年轻代占堆的1/5</li></ul><p>-XX:SurvivorRatio</p><ul><li>设置两个Survivor区和eden的比</li><li>8表示 两个Survivor :eden=2:8，即一个Survivor占年轻代的1/10</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">byte</span>[] b=<span class="keyword">null</span>;</span><br><span class="line">   <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)</span><br><span class="line">       b=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1</span>*<span class="number">1024</span>*<span class="number">1024</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Xmx20m -Xms20m -Xmn1m  -XX:+PrintGCDetails</span><br></pre></td></tr></table></figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/jvm_1_2.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>1.没有触发GC<br>2.全部分配在老年代</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Xmx20m -Xms20m -Xmn15m  -XX:+PrintGCDetails</span><br></pre></td></tr></table></figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/jvm_1_3.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>1.没有触发GC<br>2.全部分配在eden<br>3.老年代没有使用  </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Xmx20m -Xms20m –Xmn7m  -XX:+PrintGCDetails</span><br></pre></td></tr></table></figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/jvm_1_4.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>1.进行了2次新生代GC<br>2.s0 s1 太小需要老年代担保</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Xmx20m -Xms20m -Xmn7m   -XX:SurvivorRatio=2 -XX:+PrintGCDetails</span><br></pre></td></tr></table></figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/jvm_1_5.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>1.进行了3次新生代GC<br>2.s0 s1 增大</p><ul><li><p>-XX:+HeapDumpOnOutOfMemoryError<br>OOM时导出堆到文件</p></li><li><p>-XX:+HeapDumpPath<br>导出OOM的路径</p></li><li><p>-Xmx20m -Xms5m -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=d:/a.dump</p></li><li><p>-XX:OnOutOfMemoryError<br>在OOM时，执行一个脚本<br>“-XX:OnOutOfMemoryError=D:/tools/jdk1.7_40/bin/printstack.bat %p“<br>当程序OOM时，在D:/a.txt中将会生成线程的dump<br>可以在OOM时，发送邮件，甚至是重启程序</p></li></ul><h4 id="堆的分配参数-–-总结"><a href="#堆的分配参数-–-总结" class="headerlink" title="堆的分配参数 – 总结"></a>堆的分配参数 – 总结</h4><ul><li>根据实际事情调整新生代和幸存代的大小</li><li>官方推荐新生代占堆的3/8</li><li>幸存代占新生代的1/10</li><li>在OOM时，记得Dump出堆，确保可以排查现场问题</li></ul><h4 id="永久区分配参数"><a href="#永久区分配参数" class="headerlink" title="永久区分配参数"></a>永久区分配参数</h4><p>-XX:PermSize  -XX:MaxPermSize</p><p>设置永久区的初始空间和最大空间<br>他们表示，一个系统可以容纳多少个类型</p><p>使用CGLIB等库的时候，可能会产生大量的类，这些类，有可能撑爆永久区导致OOM</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//不断产生新的类</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">100000</span>;i++)&#123;</span><br><span class="line">    CglibBean bean = <span class="keyword">new</span> CglibBean(<span class="string">"geym.jvm.ch3.perm.bean"</span>+i,<span class="keyword">new</span> HashMap());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/jvm_1_6.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>打开堆的Dump  </p><p>-堆空间实际占用非常少<br>-但是永久区溢出 一样抛出OOM</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/jvm_1_7.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>如果堆空间没有用完也抛出了OOM，有可能是永久区导致的</p><h4 id="栈大小分配"><a href="#栈大小分配" class="headerlink" title="栈大小分配"></a>栈大小分配</h4><ul><li>-Xss</li></ul><ul><li>通常只有几百K  </li><li>决定了函数调用的深度  </li><li>每个线程都有独立的栈空间  </li><li>局部变量、参数 分配在栈上  </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestStackDeep</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> count=<span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">recursion</span><span class="params">(<span class="keyword">long</span> a,<span class="keyword">long</span> b,<span class="keyword">long</span> c)</span></span>&#123;</span><br><span class="line"><span class="keyword">long</span> e=<span class="number">1</span>,f=<span class="number">2</span>,g=<span class="number">3</span>,h=<span class="number">4</span>,i=<span class="number">5</span>,k=<span class="number">6</span>,q=<span class="number">7</span>,x=<span class="number">8</span>,y=<span class="number">9</span>,z=<span class="number">10</span>;</span><br><span class="line">count++;</span><br><span class="line">recursion(a,b,c);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span></span>&#123;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">recursion(<span class="number">0L</span>,<span class="number">0L</span>,<span class="number">0L</span>);</span><br><span class="line">&#125;<span class="keyword">catch</span>(Throwable e)&#123;</span><br><span class="line">System.out.println(<span class="string">"deep of calling = "</span>+count);</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//递归调用</span></span><br><span class="line"><span class="comment">//-Xss128K</span></span><br><span class="line"><span class="comment">//deep of calling = 701</span></span><br><span class="line">java.lang.StackOverflowError</span><br><span class="line"></span><br><span class="line">-Xss256K</span><br><span class="line"><span class="comment">//deep of calling = 1817</span></span><br><span class="line">java.lang.StackOverflowError</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;常用JVM配置参数&quot;&gt;&lt;a href=&quot;#常用JVM配置参数&quot; class=&quot;headerlink&quot; title=&quot;常用JVM配置参数&quot;&gt;&lt;/a&gt;常用JVM配置参数&lt;/h3&gt;&lt;h4 id=&quot;Trace跟踪参数&quot;&gt;&lt;a href=&quot;#Trace跟踪参数&quot; class
      
    
    </summary>
    
      <category term="java" scheme="http://lj360560179.github.io/categories/java/"/>
    
    
      <category term="java" scheme="http://lj360560179.github.io/tags/java/"/>
    
      <category term="jvm" scheme="http://lj360560179.github.io/tags/jvm/"/>
    
  </entry>
  
  <entry>
    <title>JVM机制运行原理</title>
    <link href="http://lj360560179.github.io/2017/06/11/jvm%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6/"/>
    <id>http://lj360560179.github.io/2017/06/11/jvm运行机制/</id>
    <published>2017-06-10T16:34:14.000Z</published>
    <updated>2018-09-06T09:35:14.864Z</updated>
    
    <content type="html"><![CDATA[<h3 id="jvm启动流程"><a href="#jvm启动流程" class="headerlink" title="jvm启动流程"></a>jvm启动流程</h3><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/jvm1.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h3 id="jvm基本结构"><a href="#jvm基本结构" class="headerlink" title="jvm基本结构"></a>jvm基本结构</h3><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/jvm2.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h4 id="PC寄存器"><a href="#PC寄存器" class="headerlink" title="PC寄存器"></a>PC寄存器</h4><ul><li>每个线程拥有一个PC寄存器</li><li>在线程创建时 创建</li><li>指向下一条指令的地址</li><li>执行本地方法时，PC的值为undefined</li></ul><h4 id="方法区"><a href="#方法区" class="headerlink" title="方法区"></a>方法区</h4><p>保存装载的类信息 </p><ul><li>类型的常量池 </li><li>字段，方法信息</li><li>方法字节码</li></ul><p>类的全限定名(类的全路径名)<br>类的直接超类的全限定名(如果这个类是Object,则它没有超类)<br>这个类是类型(类)还是接口<br>类的访问修饰符,如public、abstract、final等<br>所有的直接接口全限定名的有序列表(假如它实现了多个接口)<br>常量池：字段、方法信息、类变量信息(静态变量)<br>装载该类的装载器的引用(classLoader)、类型引用(class)<br>通常和永久区(Perm)关联在一起</p><h4 id="Java堆"><a href="#Java堆" class="headerlink" title="Java堆"></a>Java堆</h4><ul><li>和程序开发密切相关</li><li>应用系统对象都保存在Java堆中</li><li>所有线程共享Java堆</li><li>对分代GC来说，堆也是分代的</li><li>GC的主要工作区间</li></ul><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/jvm3.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>eden : s0 : s1 = 8 : 1 : 1</p><h4 id="Java栈"><a href="#Java栈" class="headerlink" title="Java栈"></a>Java栈</h4><ul><li>线程私有</li><li>栈由一系列帧组成（因此Java栈也叫做帧栈）</li><li>帧保存一个方法的局部变量、操作数栈、常量池指针</li><li>每一次方法调用创建一个帧，并压栈</li></ul><h5 id="操作数栈"><a href="#操作数栈" class="headerlink" title="操作数栈"></a>操作数栈</h5><p>Java没有寄存器，所有参数传递使用操作数栈</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> c=<span class="number">0</span>;</span><br><span class="line">    c=a+b;</span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">0:   iconst_0 // 0压栈</span><br><span class="line">1:   istore_2 // 弹出int，存放于局部变量2</span><br><span class="line">2:   iload_0  // 把局部变量0压栈</span><br><span class="line">3:   iload_1 // 局部变量1压栈</span><br><span class="line">4:   iadd      //弹出2个变量，求和，结果压栈</span><br><span class="line">5:   istore_2 //弹出结果，放于局部变量2</span><br><span class="line">6:   iload_2  //局部变量2压栈</span><br><span class="line">7:   ireturn   //返回</span><br></pre></td></tr></table></figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/jvm4.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h5 id="栈上分配"><a href="#栈上分配" class="headerlink" title="栈上分配"></a>栈上分配</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OnStackTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">alloc</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] b=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">2</span>];</span><br><span class="line">        b[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> b=System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">100000000</span>;i++)&#123;</span><br><span class="line">            alloc();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">long</span> e=System.currentTimeMillis();</span><br><span class="line">        System.out.println(e-b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-server -Xmx10m -Xms10m</span><br><span class="line">-XX:+DoEscapeAnalysis -XX:+PrintGC</span><br></pre></td></tr></table></figure><p>输出结果 5</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-server -Xmx10m -Xms10m  </span><br><span class="line">-XX:-DoEscapeAnalysis -XX:+PrintGC</span><br></pre></td></tr></table></figure><p>……<br>[GC 3550K-&gt;478K(10240K), 0.0000977 secs]<br>[GC 3550K-&gt;478K(10240K), 0.0001361 secs]<br>[GC 3550K-&gt;478K(10240K), 0.0000963 secs]<br>564</p><ul><li>小对象（一般几十个bytes），在没有逃逸的情况下，可以直接分配在栈上</li><li>直接分配在栈上，可以自动回收，减轻GC压力</li><li>大对象或者逃逸对象无法栈上分配</li></ul><h4 id="栈、堆、方法区交互"><a href="#栈、堆、方法区交互" class="headerlink" title="栈、堆、方法区交互"></a>栈、堆、方法区交互</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/jvm5.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppMain</span> </span>&#123;</span><br><span class="line">    <span class="comment">//运行时, jvm 把appmain的信息都放入方法区 </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        <span class="comment">//main 方法本身放入方法区。</span></span><br><span class="line">        Sample test1 = <span class="keyword">new</span> Sample(<span class="string">" 测试 1"</span>);</span><br><span class="line">        <span class="comment">//test1是引用，所以放到栈区里， Sample是自定义对象应该放到堆里面</span></span><br><span class="line">        Sample test2 = <span class="keyword">new</span> Sample(<span class="string">" 测试 2"</span>);</span><br><span class="line"></span><br><span class="line">        test1.printName();</span><br><span class="line">        test2.printName();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sample</span></span>&#123;</span><br><span class="line">    <span class="comment">//运行时, jvm 把appmain的信息都放入方法区 </span></span><br><span class="line">    <span class="keyword">private</span> name;</span><br><span class="line">    <span class="comment">//new Sample实例后，name 引用放入栈区里，name 对象放入堆里 </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Sample</span><span class="params">(String nam)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//print方法本身放入 方法区里。</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printName</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.print(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="内存模型"><a href="#内存模型" class="headerlink" title="内存模型"></a>内存模型</h4><ul><li>每一个线程有一个工作内存和主存独立</li><li>工作内存存放主存中变量的值的拷贝</li></ul><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/jvm6.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><blockquote><p>当数据从主内存复制到工作存储时，必须出现两个动作：</p><ul><li>第一，由主内存执行的读（read）操作；</li><li>第二，由工作内存执行的相应的load操作；当数据从工作内存拷贝到主内存时，也出现两个操作：第一个，由工作内存执行的存储（store）操作；第二，由主内存执行的相应的写（write）操作</li></ul></blockquote><blockquote><p>每一个操作都是原子的，即执行期间不会被中断</p></blockquote><blockquote><p>对于普通变量，一个线程中更新的值，不能马上反应在其他变量中,如果需要在其他线程中立即可见，需要使用 volatile 关键字</p></blockquote><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/jvm7.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h5 id="可见性"><a href="#可见性" class="headerlink" title="可见性"></a>可见性</h5><ul><li>一个线程修改了变量，其他线程可以立即知道</li><li>保证可见性的方法<ul><li>volatile</li><li>synchronized （unlock之前，写变量值回主存）</li><li>final(一旦初始化完成，其他线程就可见)</li></ul></li></ul><h5 id="有序性"><a href="#有序性" class="headerlink" title="有序性"></a>有序性</h5><ul><li>在本线程内，操作都是有序的</li><li>在线程外观察，操作都是无序的。（指令重排 或 主内存同步延时）</li></ul><h5 id="指令重排"><a href="#指令重排" class="headerlink" title="指令重排"></a>指令重排</h5><ul><li>线程内串行语义</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">写后读a = 1;b = a;写一个变量之后，再读这个位置。</span><br><span class="line">写后写a = 1;a = 2;写一个变量之后，再写这个变量。</span><br><span class="line">读后写a = b;b = 1;读一个变量之后，再写这个变量。</span><br><span class="line">以上语句不可重排</span><br><span class="line">编译器不考虑多线程间的语义</span><br><span class="line">可重排： a=1;b=2;</span><br></pre></td></tr></table></figure><h5 id="指令重排的基本原则-happen-before"><a href="#指令重排的基本原则-happen-before" class="headerlink" title="指令重排的基本原则 (happen-before)"></a>指令重排的基本原则 (happen-before)</h5><ul><li>程序顺序原则：一个线程内保证语义的串行性</li><li>volatile规则：volatile变量的写，先发生于读</li><li>锁规则：解锁(unlock)必然发生在随后的加锁(lock)前</li><li>传递性：A先于B，B先于C 那么A必然先于C</li><li>线程的start方法先于它的每一个动作</li><li>线程的所有操作先于线程的终结（Thread.join()）</li><li>线程的中断（interrupt()）先于被中断线程的代码</li><li>对象的构造函数执行结束先于finalize()方法</li></ul><h5 id="解释运行"><a href="#解释运行" class="headerlink" title="解释运行"></a>解释运行</h5><ul><li>解释执行以解释方式运行字节码</li><li>解释执行的意思是：读一句执行一句</li></ul><h5 id="编译运行（JIT）"><a href="#编译运行（JIT）" class="headerlink" title="编译运行（JIT）"></a>编译运行（JIT）</h5><ul><li>将字节码编译成机器码</li><li>直接执行机器码</li><li>运行时编译</li><li>编译后性能有数量级的提升</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;jvm启动流程&quot;&gt;&lt;a href=&quot;#jvm启动流程&quot; class=&quot;headerlink&quot; title=&quot;jvm启动流程&quot;&gt;&lt;/a&gt;jvm启动流程&lt;/h3&gt;&lt;figure class=&quot;image-bubble&quot;&gt;
                &lt;div cl
      
    
    </summary>
    
      <category term="java" scheme="http://lj360560179.github.io/categories/java/"/>
    
    
      <category term="java" scheme="http://lj360560179.github.io/tags/java/"/>
    
      <category term="jvm" scheme="http://lj360560179.github.io/tags/jvm/"/>
    
  </entry>
  
  <entry>
    <title>锁优化</title>
    <link href="http://lj360560179.github.io/2017/06/07/%E9%94%81%E4%BC%98%E5%8C%96/"/>
    <id>http://lj360560179.github.io/2017/06/07/锁优化/</id>
    <published>2017-06-06T16:34:14.000Z</published>
    <updated>2018-09-06T09:35:14.873Z</updated>
    
    <content type="html"><![CDATA[<h1 id="锁优化的思路和方法"><a href="#锁优化的思路和方法" class="headerlink" title="锁优化的思路和方法"></a>锁优化的思路和方法</h1><h3 id="锁优化的思路和方法-1"><a href="#锁优化的思路和方法-1" class="headerlink" title="锁优化的思路和方法"></a>锁优化的思路和方法</h3><ul><li>减少锁持有时间</li><li>减小锁粒度</li><li>锁分离</li><li>锁粗化</li><li>锁消除<a id="more"></a></li></ul><h4 id="减少锁持有时间"><a href="#减少锁持有时间" class="headerlink" title="减少锁持有时间"></a>减少锁持有时间</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">syncMethod</span><span class="params">()</span></span>&#123;</span><br><span class="line">othercode1();</span><br><span class="line">mutextMethod();</span><br><span class="line">othercode2();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">syncMethod2</span><span class="params">()</span></span>&#123;</span><br><span class="line">othercode1();</span><br><span class="line"><span class="keyword">synchronized</span>(<span class="keyword">this</span>)&#123;</span><br><span class="line">mutextMethod();</span><br><span class="line">&#125;</span><br><span class="line">othercode2();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="减小锁粒度"><a href="#减小锁粒度" class="headerlink" title="减小锁粒度"></a>减小锁粒度</h4><ul><li>将大对象，拆成小对象，大大增加并行度，降低锁竞争</li><li>偏向锁，轻量级锁成功率提高</li><li>例子：ConcurrentHashMap 与 HashMap的同步实现</li></ul><p>HashMap的同步实现<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Collections.synchronizedMap(Map&lt;K,V&gt; m</span><br><span class="line"><span class="comment">//返回SynchronizedMap对象</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line"> <span class="keyword">synchronized</span> (mutex) &#123;<span class="keyword">return</span> m.get(key);&#125;</span><br><span class="line"> &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line"> <span class="keyword">synchronized</span> (mutex) &#123;<span class="keyword">return</span> m.put(key, value);&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ConcurrentHashMap</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">若干个Segment ：Segment&lt;K,V&gt;[] segments</span><br><span class="line">Segment中维护HashEntry&lt;K,V&gt;</span><br><span class="line">put操作时,先定位到Segment，锁定一个Segment，执行put</span><br></pre></td></tr></table></figure><p>在减小锁粒度后， ConcurrentHashMap允许若干个线程同时进入</p><h4 id="锁分离"><a href="#锁分离" class="headerlink" title="锁分离"></a>锁分离</h4><ul><li>根据功能进行锁分离</li><li>ReadWriteLock</li><li>读多写少的情况，可以提高性能</li></ul><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/suo1.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>读写分离思想可以延伸，只要操作互不影响，锁就可以分离，例如：</p><ul><li>LinkedBlockingQueue 队列 链表</li></ul><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/suo2.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h4 id="锁粗化"><a href="#锁粗化" class="headerlink" title="锁粗化"></a>锁粗化</h4><p>通常情况下，为了保证多线程间的有效并发，会要求每个线程持有锁的时间尽量短，即在使用完<br>公共资源后，应该立即释放锁。只有这样，等待在这个锁上的其他线程才能尽早的获得资源执行<br>任务。但是，凡事都有一个度，如果对同一个锁不停的进行请求、同步和释放，其本身也会消耗<br>系统宝贵的资源，反而不利于性能的优化</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demoMethod</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">synchronized</span>(lock)&#123;</span><br><span class="line"><span class="comment">//do sth.</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//做其他不需要的同步的工作，但能很快执行完毕</span></span><br><span class="line"><span class="keyword">synchronized</span>(lock)&#123;</span><br><span class="line"><span class="comment">//do sth.</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>==&gt;修改后</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demoMethod</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//整合成一次锁请求</span></span><br><span class="line"><span class="keyword">synchronized</span>(lock)&#123;</span><br><span class="line"><span class="comment">//do sth.</span></span><br><span class="line"><span class="comment">//做其他不需要的同步的工作，但能很快执行完毕</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;CIRCLE;i++)&#123;</span><br><span class="line"><span class="keyword">synchronized</span>(lock)&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>==&gt;修改后</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span>(lock)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;CIRCLE;i++)&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="锁消除"><a href="#锁消除" class="headerlink" title="锁消除"></a>锁消除</h4><p>在即时编译器时，如果发现不可能被共享的对象，则可以消除这些对象的锁操作</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line"><span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; CIRCLE; i++) &#123;</span><br><span class="line">craeteStringBuffer(<span class="string">"JVM"</span>, <span class="string">"Diagnosis"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">long</span> bufferCost = System.currentTimeMillis() - start;</span><br><span class="line">System.out.println(<span class="string">"craeteStringBuffer: "</span> + bufferCost + <span class="string">" ms"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">craeteStringBuffer</span><span class="params">(String s1, String s2)</span> </span>&#123;</span><br><span class="line">StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">sb.append(s1);<span class="comment">//同步操作</span></span><br><span class="line">sb.append(s2);<span class="comment">//同步操作</span></span><br><span class="line"><span class="keyword">return</span> sb.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>CIRCLE= 2000000</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-server -XX:+DoEscapeAnalysis -XX:+EliminateLocks //craeteStringBuffer: 187 ms</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-server -XX:+DoEscapeAnalysis -XX:-EliminateLocks //craeteStringBuffer: 254 ms</span><br></pre></td></tr></table></figure><h3 id="虚拟机内的锁优化"><a href="#虚拟机内的锁优化" class="headerlink" title="虚拟机内的锁优化"></a>虚拟机内的锁优化</h3><h4 id="对象头Mark"><a href="#对象头Mark" class="headerlink" title="对象头Mark"></a>对象头Mark</h4><p>Mark Word，对象头的标记，32位<br>描述对象的hash、锁信息，垃圾回收标记，年龄</p><ul><li>指向锁记录的指针</li><li>指向monitor的指针</li><li>GC标记</li><li>偏向锁线程ID</li></ul><h4 id="偏向锁"><a href="#偏向锁" class="headerlink" title="偏向锁"></a>偏向锁</h4><ul><li>大部分情况是没有竞争的，所以可以通过偏向来提高性能</li><li>所谓的偏向，就是偏心，即锁会偏向于当前已经占有锁的线程</li><li>将对象头Mark的标记设置为偏向，并将线程ID写入对象头Mark</li><li>只要没有竞争，获得偏向锁的线程，在将来进入同步块，不需要做同步</li><li>当其他线程请求相同的锁时，偏向模式结束</li><li>-XX:+UseBiasedLocking -默认启用</li><li>在竞争激烈的场合，偏向锁会增加系统负担</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Integer&gt; numberList =<span class="keyword">new</span> Vector&lt;Integer&gt;();</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line"><span class="keyword">long</span> begin=System.currentTimeMillis();</span><br><span class="line"><span class="keyword">int</span> count=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> startnum=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(count&lt;<span class="number">10000000</span>)&#123;</span><br><span class="line">numberList.add(startnum);</span><br><span class="line">startnum+=<span class="number">2</span>;</span><br><span class="line">count++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">long</span> end=System.currentTimeMillis();</span><br><span class="line">System.out.println(end-begin);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-XX:+UseBiasedLocking -XX:BiasedLockingStartupDelay=0 //启用偏向锁</span><br><span class="line"></span><br><span class="line">-XX:-UseBiasedLocking //禁用</span><br></pre></td></tr></table></figure><h4 id="轻量级锁"><a href="#轻量级锁" class="headerlink" title="轻量级锁"></a>轻量级锁</h4><p>BasicObjectLock – 嵌入在线程栈中的对象</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/suo3.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><p>普通的锁处理性能不够理想，轻量级锁是一种快速的锁定方法。<br>如果对象没有被锁定</p><ul><li>将对象头的Mark指针保存到锁对象中</li><li>将对象头设置为指向锁的指针（在线程栈空间中）</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">lock-&gt;set_displaced_header(mark);</span><br><span class="line"><span class="comment">//lock位于线程栈中</span></span><br><span class="line"><span class="keyword">if</span> (mark == (markOop) Atomic::cmpxchg_ptr(lock, obj()-&gt;mark_addr(), mark))</span><br><span class="line">&#123;</span><br><span class="line"> TEVENT (slow_enter: release stacklock) ;</span><br><span class="line"> <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果轻量级锁失败，表示存在竞争，升级为重量级锁（常规锁）<br>在没有锁竞争的前提下，减少传统锁使用OS互斥量产生的性能损耗<br>在竞争激烈时，轻量级锁会多做很多额外操作，导致性能下降</p><h4 id="自旋锁"><a href="#自旋锁" class="headerlink" title="自旋锁"></a>自旋锁</h4><ul><li>当竞争存在时，如果线程可以很快获得锁，那么可以不在OS层挂起线程，让线程做几个空操作（<br>自旋）</li><li>JDK1.6中-XX:+UseSpinning开启</li><li>JDK1.7中，去掉此参数，改为内置实现</li><li>如果同步块很长，自旋失败，会降低系统性能</li><li>如果同步块很短，自旋成功，节省线程挂起切换时间，提升系统性能</li></ul><h4 id="偏向锁，轻量级锁，自旋锁总结"><a href="#偏向锁，轻量级锁，自旋锁总结" class="headerlink" title="偏向锁，轻量级锁，自旋锁总结"></a>偏向锁，轻量级锁，自旋锁总结</h4><p>不是Java语言层面的锁优化方法<br>内置于JVM中的获取锁的优化方法和获取锁的步骤</p><ul><li>偏向锁可用会先尝试偏向锁</li><li>轻量级锁可用会先尝试轻量级锁</li><li>以上都失败，尝试自旋锁</li><li>再失败，尝试普通锁，使用OS互斥量在操作系统层挂起</li></ul><h3 id="一个错误使用锁的案例"><a href="#一个错误使用锁的案例" class="headerlink" title="一个错误使用锁的案例"></a>一个错误使用锁的案例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IntegerLock</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> Integer i=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AddThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>;k&lt;<span class="number">100000</span>;k++)&#123;</span><br><span class="line">                <span class="keyword">synchronized</span>(i)&#123;</span><br><span class="line">                    i++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        AddThread t1=<span class="keyword">new</span> AddThread();</span><br><span class="line">        AddThread t2=<span class="keyword">new</span> AddThread();</span><br><span class="line">        t1.start();t2.start();</span><br><span class="line">        t1.join();t2.join();</span><br><span class="line">        System.out.println(i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;锁优化的思路和方法&quot;&gt;&lt;a href=&quot;#锁优化的思路和方法&quot; class=&quot;headerlink&quot; title=&quot;锁优化的思路和方法&quot;&gt;&lt;/a&gt;锁优化的思路和方法&lt;/h1&gt;&lt;h3 id=&quot;锁优化的思路和方法-1&quot;&gt;&lt;a href=&quot;#锁优化的思路和方法-1&quot; class=&quot;headerlink&quot; title=&quot;锁优化的思路和方法&quot;&gt;&lt;/a&gt;锁优化的思路和方法&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;减少锁持有时间&lt;/li&gt;
&lt;li&gt;减小锁粒度&lt;/li&gt;
&lt;li&gt;锁分离&lt;/li&gt;
&lt;li&gt;锁粗化&lt;/li&gt;
&lt;li&gt;锁消除
    
    </summary>
    
      <category term="java" scheme="http://lj360560179.github.io/categories/java/"/>
    
    
      <category term="java" scheme="http://lj360560179.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>NIO</title>
    <link href="http://lj360560179.github.io/2017/06/06/NIO/"/>
    <id>http://lj360560179.github.io/2017/06/06/NIO/</id>
    <published>2017-06-05T16:34:14.000Z</published>
    <updated>2018-09-06T09:35:14.858Z</updated>
    
    <content type="html"><![CDATA[<h1 id="NIO"><a href="#NIO" class="headerlink" title="NIO"></a>NIO</h1><h3 id="什么是NIO"><a href="#什么是NIO" class="headerlink" title="什么是NIO"></a>什么是NIO</h3><p>NIO是New I/O的简称，与旧式的基于流的I/O方法相对，从名字看，它表示新的一套Java I/O标准。它是在Java 1.4中被纳入到JDK中的，并具有以下特性：</p><ul><li>NIO是基于块（Block）的，它以块为基本单位处理数据</li><li>为所有的原始类型提供（Buffer）缓存支持</li><li>增加通道（Channel）对象，作为新的原始 I/O 抽象</li><li>支持锁和内存映射文件的文件访问接口</li><li>提供了基于Selector的异步网络I/O<a id="more"></a></li></ul><h3 id="Buffer-and-Channel"><a href="#Buffer-and-Channel" class="headerlink" title="Buffer and Channel"></a>Buffer and Channel</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Nio</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">nioCopyFile</span><span class="params">(String resource, String destination)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        FileInputStream fis = <span class="keyword">new</span> FileInputStream(resource);</span><br><span class="line">        FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(destination);</span><br><span class="line">        FileChannel readChannel = fis.getChannel(); <span class="comment">//读文件通道</span></span><br><span class="line">        FileChannel writeChannel = fos.getChannel(); <span class="comment">//写文件通道</span></span><br><span class="line">        ByteBuffer buffer = ByteBuffer.allocate(<span class="number">1024</span>); <span class="comment">//读入数据缓存</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            buffer.clear();</span><br><span class="line">            <span class="keyword">int</span> len = readChannel.read(buffer); <span class="comment">//读入数据</span></span><br><span class="line">            <span class="keyword">if</span> (len == -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                <span class="comment">//读取完毕</span></span><br><span class="line">            &#125;</span><br><span class="line">            buffer.flip();</span><br><span class="line">            writeChannel.write(buffer);</span><br><span class="line">            <span class="comment">//写入文件</span></span><br><span class="line">        &#125;</span><br><span class="line">        readChannel.close();</span><br><span class="line">        writeChannel.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span> <span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        NioAndAio demo = <span class="keyword">new</span> NioAndAio();</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            demo.nioCopyFile(<span class="string">"E:\\git\\blog\\blog\\README.md"</span>,<span class="string">"E:\\git\\blog\\blog\\README2.md"</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> ( IOException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Buffer <span class="title">rewind</span><span class="params">()</span></span></span><br><span class="line"><span class="function">``` </span></span><br><span class="line"><span class="function"> 将position置零，并清除标志位（mark）</span></span><br><span class="line"><span class="function">```java</span></span><br><span class="line"><span class="function"> <span class="keyword">public</span> <span class="keyword">final</span> Buffer <span class="title">clear</span><span class="params">()</span></span></span><br><span class="line"><span class="function">``` </span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> 将position置零，同时将limit设置为capacity的大小，并清除了标志mark</span></span><br><span class="line"><span class="function">```java</span></span><br><span class="line"><span class="function"> <span class="keyword">public</span> <span class="keyword">final</span> Buffer <span class="title">flip</span><span class="params">()</span></span></span><br><span class="line"><span class="function">``` </span></span><br><span class="line"><span class="function"> 先将limit设置到position所在位置，然后将position置零，并清除标志位mark</span></span><br><span class="line"><span class="function">通常在读写转换时使用</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">### nio socket</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">```java</span></span><br><span class="line"><span class="function"><span class="comment">/**</span></span></span><br><span class="line"><span class="function"><span class="comment"> * @Author lj</span></span></span><br><span class="line"><span class="function"><span class="comment"> * @Date 2018/8/15 14:50</span></span></span><br><span class="line"><span class="function"><span class="comment"> */</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> class NioSocketServer </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Selector selector;</span><br><span class="line">    <span class="keyword">private</span> Charset charset = Charset.forName(<span class="string">"UTF-8"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        selector = Selector.open();</span><br><span class="line">        ServerSocketChannel server = ServerSocketChannel.open();</span><br><span class="line">        InetSocketAddress isa = <span class="keyword">new</span> InetSocketAddress(<span class="string">"127.0.0.1"</span>, <span class="number">3000</span>);</span><br><span class="line">        server.socket().bind(isa);</span><br><span class="line">        server.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">        server.register(selector, SelectionKey.OP_ACCEPT);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (selector.select() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (SelectionKey key : selector.selectedKeys()) &#123;</span><br><span class="line">                selector.selectedKeys().remove(key);</span><br><span class="line">                <span class="keyword">if</span> (key.isAcceptable()) &#123;</span><br><span class="line">                    SocketChannel sc = server.accept();</span><br><span class="line">                    sc.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">                    <span class="comment">//将选择器注册到连接到的客户端信道，</span></span><br><span class="line">                    <span class="comment">//并指定该信道key值的属性为OP_READ，</span></span><br><span class="line">                    <span class="comment">//同时为该信道指定关联的附件</span></span><br><span class="line">                    sc.register(selector, SelectionKey.OP_READ);</span><br><span class="line">                    key.interestOps(SelectionKey.OP_ACCEPT);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (key.isReadable()) &#123;</span><br><span class="line">                    SocketChannel sc      = (SocketChannel) key.channel();</span><br><span class="line">                    ByteBuffer    buff    = ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">                    String        content = <span class="string">""</span>;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">while</span> (sc.read(buff) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                            buff.flip();</span><br><span class="line">                            content += charset.decode(buff);</span><br><span class="line">                            buff.clear();</span><br><span class="line">                        &#125;</span><br><span class="line">                        System.out.println(<span class="string">"====="</span> + content);</span><br><span class="line">                        key.interestOps(SelectionKey.OP_READ);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                        key.cancel();</span><br><span class="line">                        <span class="keyword">if</span> (key.channel() != <span class="keyword">null</span>)&#123;</span><br><span class="line">                            key.channel().close();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (content.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="keyword">for</span> (SelectionKey sk : selector.keys()) &#123;</span><br><span class="line">                            Channel targetChannel = sk.channel();</span><br><span class="line">                            <span class="keyword">if</span> (targetChannel <span class="keyword">instanceof</span> SocketChannel) &#123;</span><br><span class="line">                                SocketChannel dest = (SocketChannel) targetChannel;</span><br><span class="line">                                dest.write(charset.encode(content));</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        sc.close();</span><br><span class="line">                        key.cancel();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> NioSocketServer().init();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;NIO&quot;&gt;&lt;a href=&quot;#NIO&quot; class=&quot;headerlink&quot; title=&quot;NIO&quot;&gt;&lt;/a&gt;NIO&lt;/h1&gt;&lt;h3 id=&quot;什么是NIO&quot;&gt;&lt;a href=&quot;#什么是NIO&quot; class=&quot;headerlink&quot; title=&quot;什么是NIO&quot;&gt;&lt;/a&gt;什么是NIO&lt;/h3&gt;&lt;p&gt;NIO是New I/O的简称，与旧式的基于流的I/O方法相对，从名字看，它表示新的一套Java I/O标准。它是在Java 1.4中被纳入到JDK中的，并具有以下特性：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;NIO是基于块（Block）的，它以块为基本单位处理数据&lt;/li&gt;
&lt;li&gt;为所有的原始类型提供（Buffer）缓存支持&lt;/li&gt;
&lt;li&gt;增加通道（Channel）对象，作为新的原始 I/O 抽象&lt;/li&gt;
&lt;li&gt;支持锁和内存映射文件的文件访问接口&lt;/li&gt;
&lt;li&gt;提供了基于Selector的异步网络I/O
    
    </summary>
    
      <category term="java" scheme="http://lj360560179.github.io/categories/java/"/>
    
    
      <category term="java" scheme="http://lj360560179.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>并发设计模式</title>
    <link href="http://lj360560179.github.io/2017/06/04/%E5%B9%B6%E5%8F%91%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    <id>http://lj360560179.github.io/2017/06/04/并发设计模式/</id>
    <published>2017-06-03T16:34:14.000Z</published>
    <updated>2018-09-06T09:35:14.870Z</updated>
    
    <content type="html"><![CDATA[<h2 id="并发设计模式"><a href="#并发设计模式" class="headerlink" title="并发设计模式"></a>并发设计模式</h2><h3 id="什么是设计模式"><a href="#什么是设计模式" class="headerlink" title="什么是设计模式"></a>什么是设计模式</h3><blockquote><p>在软件工程中，设计模式（design pattern）是对软件设计中普遍存在（反复出现）的各种问题<br>，所提出的解决方案。<br><a id="more"></a></p></blockquote><h3 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h3><blockquote><p>单例对象的类必须保证只有一个实例存在。许多时候整个系统只需要拥有一个的全局对象，这样<br>有利于我们协调系统整体的行为<br>比如：全局信息配置<br>最简单的单例模式（饿汉式）<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span></span>&#123;</span><br><span class="line">    <span class="comment">//单例的构造函数都是private</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Singlenton is create"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//static</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance = <span class="keyword">new</span> Singleton();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></blockquote><p>只有当访问到该类的时候才会产生实例，所以何时产生实例 不好控制。（懒汉式-加锁）<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LazySingleton</span></span>&#123;</span><br><span class="line">    <span class="comment">//单例的构造函数都是private</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">LazySingleton</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"LazySingleton is create"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> LazySingleton instance = <span class="keyword">null</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> LazySingleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(instance == <span class="keyword">null</span>)&#123;</span><br><span class="line">            instance = <span class="keyword">new</span> LazySingleton();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>双重检验锁<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LazySingleton</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> volative LazySingleton instance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//单例的构造函数都是private</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">LazySingleton</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"LazySingleton is create"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> LazySingleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(instance == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">synchronized</span>(LazySingleton.class)&#123;</span><br><span class="line">                <span class="keyword">if</span>(instance == <span class="keyword">null</span>)&#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> LazySingleton();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>当有访问的时候，先判断是否有实例，如果没有再new实例，在getInstance方法加锁，防止多线程进入而创建多个实例。但是高并发的时候会有性能的问题。(线程安全-静态内部类)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StaticSingleton</span> </span>&#123;</span><br><span class="line">    <span class="comment">//单例的构造函数都是private</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">StaticSingleton</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"StaticSingleton is create"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonHolder</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> StaticSingleton instance = <span class="keyword">new</span> StaticSingleton();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> StaticSingleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>枚举<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EnumSingleton</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">EnumSingleton</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> EnumSingleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Singleton.INSTANCE.getInstance();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">enum</span> Singleton&#123;</span><br><span class="line">        INSTANCE;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">private</span> EnumSingleton singleton;</span><br><span class="line">        <span class="comment">//JVM会保证此方法绝对只调用一次</span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;</span><br><span class="line">            singleton = <span class="keyword">new</span> EnumSingleton();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> EnumSingleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> singleton;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="不变模式"><a href="#不变模式" class="headerlink" title="不变模式"></a>不变模式</h3><blockquote><p>一个类的内部状态创建后，在整个生命期间都不会发生变化时，就是不变类<br>不变模式不需要同步<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line">    <span class="comment">//确保无子类</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String no;</span><br><span class="line">    <span class="comment">//私有属性，不会被其他对象获取</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">    <span class="comment">//final保证属性不会被2次赋值</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">double</span> price;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Product</span><span class="params">(String no, String name, <span class="keyword">double</span> price)</span> </span>&#123;                           <span class="comment">//在创建对象时，必须指定数据</span></span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">       <span class="comment">//因为创建之后，无法进行修改</span></span><br><span class="line">        <span class="keyword">this</span>.no = no;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.price = price;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getNo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> no;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> price;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">java.lang.String</span><br><span class="line">java.lang.Boolean</span><br><span class="line">java.lang.Byte</span><br><span class="line">java.lang.Character</span><br><span class="line">java.lang.Double</span><br><span class="line">java.lang.Float</span><br><span class="line">java.lang.Integer</span><br><span class="line">java.lang.Long</span><br><span class="line">java.lang.Short</span><br></pre></td></tr></table></figure><p>以上的类都是不变模式的例子。“改变”都是新生成的！</p><h3 id="Future模式"><a href="#Future模式" class="headerlink" title="Future模式"></a>Future模式</h3><p>核心思想是异步调用<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RealData</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String para;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RealData</span><span class="params">(String para)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.para=para;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        StringBuffer sb=<span class="keyword">new</span> StringBuffer();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            sb.append(para);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FutureMain</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException, ExecutionException</span>&#123;</span><br><span class="line">        <span class="comment">//构造FutureTask</span></span><br><span class="line">        FutureTask&lt;String&gt; future = <span class="keyword">new</span> FutureTask&lt;String&gt;(<span class="keyword">new</span> RealData(<span class="string">"a"</span>));</span><br><span class="line">        ExecutorService executor = Executors.newFixedThreadPool(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//执行FutureTask，相当于上例中的 client.request("a") 发送请求</span></span><br><span class="line">        <span class="comment">//在这里开启线程进行RealData的call()执行</span></span><br><span class="line">        executor.submit(future);</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">"请求完毕"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//这里依然可以做额外的数据操作，这里使用sleep代替其他业务逻辑的处理</span></span><br><span class="line">            Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//相当于data.getResult ()，取得call()方法的返回值</span></span><br><span class="line">        <span class="comment">//如果此时call()方法没有执行完成，则依然会等待</span></span><br><span class="line">        System.out.println(<span class="string">"数据 = "</span> + future.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FutureMain2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException, ExecutionException </span>&#123;</span><br><span class="line">        ExecutorService executor = Executors.newFixedThreadPool(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//执行FutureTask，相当于上例中的 client.request("a") 发送请求</span></span><br><span class="line">        <span class="comment">//在这里开启线程进行RealData的call()执行</span></span><br><span class="line">        Future&lt;String&gt; future=executor.submit(<span class="keyword">new</span> RealData(<span class="string">"a"</span>));</span><br><span class="line">        System.out.println(<span class="string">"请求完毕"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//这里依然可以做额外的数据操作，这里使用sleep代替其他业务逻辑的处理</span></span><br><span class="line">            Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//相当于data.getResult ()，取得call()方法的返回值</span></span><br><span class="line">        <span class="comment">//如果此时call()方法没有执行完成，则依然会等待</span></span><br><span class="line">        System.out.println(<span class="string">"数据 = "</span> + future.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="生产者消费者模式"><a href="#生产者消费者模式" class="headerlink" title="生产者消费者模式"></a>生产者消费者模式</h3><blockquote><p>生产者-消费者模式是一个经典的多线程设计模式。它为多线程间的协作提供了良好的解决方案。<br>在生产者-消费者模式中，通常由两类线程，即若干个生产者线程和若干个消费者线程。生产者线<br>程负责提交用户请求，消费者线程则负责具体处理生产者提交的任务。生产者和消费者之间则通<br>过共享内存缓冲区进行通信。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/cpic1.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;并发设计模式&quot;&gt;&lt;a href=&quot;#并发设计模式&quot; class=&quot;headerlink&quot; title=&quot;并发设计模式&quot;&gt;&lt;/a&gt;并发设计模式&lt;/h2&gt;&lt;h3 id=&quot;什么是设计模式&quot;&gt;&lt;a href=&quot;#什么是设计模式&quot; class=&quot;headerlink&quot; title=&quot;什么是设计模式&quot;&gt;&lt;/a&gt;什么是设计模式&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;在软件工程中，设计模式（design pattern）是对软件设计中普遍存在（反复出现）的各种问题&lt;br&gt;，所提出的解决方案。&lt;br&gt;
    
    </summary>
    
      <category term="java" scheme="http://lj360560179.github.io/categories/java/"/>
    
    
      <category term="java" scheme="http://lj360560179.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>并发工具类</title>
    <link href="http://lj360560179.github.io/2017/06/02/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7%E7%B1%BB/"/>
    <id>http://lj360560179.github.io/2017/06/02/并发工具类/</id>
    <published>2017-06-01T16:34:14.000Z</published>
    <updated>2018-09-06T09:35:14.869Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Condition"><a href="#Condition" class="headerlink" title="Condition"></a>Condition</h1><p>类似于 Object.wait()和Object.notify()，与ReentrantLock结合使用<br>简单列子<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">await</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">awaitUninterruptibly</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">awaitNanos</span><span class="params">(<span class="keyword">long</span> nanosTimeout)</span> <span class="keyword">throws</span> InterruptedException</span>;</span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">await</span><span class="params">(<span class="keyword">long</span> time, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException</span>;</span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">awaitUntil</span><span class="params">(Date deadline)</span> <span class="keyword">throws</span> InterruptedException</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">signal</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">signalAll</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure></p><p>await()方法会使当前线程等待，同时释放当前锁，当其他线程中使用signal()时或者signalAll()方法时，线<br>程会重新获得锁并继续执行。或者当线程被中断时，也能跳出等待。这和Object.wait()方法很相似。<br>awaitUninterruptibly()方法与await()方法基本相同，但是它并不会再等待过程中响应中断。<br>singal()方法用于唤醒一个在等待中的线程。相对的singalAll()方法会唤醒所有在等待中的线程。这和Obejct.notify()方法很类似。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReenterLockCondition</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ReentrantLock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Condition condition =  lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            lock.lock();<span class="comment">//与object.wait()一样 需要先拿到锁</span></span><br><span class="line">            condition.await();</span><br><span class="line">            System.out.print(<span class="string">"await"</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (InterruptedException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException</span>&#123;</span><br><span class="line">         ReenterLockCondition tl =  <span class="keyword">new</span> ReenterLockCondition();</span><br><span class="line">         Thread t1 = <span class="keyword">new</span> Thread(tl);</span><br><span class="line">         t1.start();</span><br><span class="line">         Thread.sleep(<span class="number">5000</span>);<span class="comment">//延迟五秒后唤醒现成T1</span></span><br><span class="line">         lock.lock();</span><br><span class="line">         condition.signal();</span><br><span class="line">         lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Semaphore"><a href="#Semaphore" class="headerlink" title="Semaphore"></a>Semaphore</h1><p>共享锁，运行多个线程同时临界区<br>主要接口<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">acquire</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">acquireUninterruptibly</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryAcquire</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryAcquire</span><span class="params">(<span class="keyword">long</span> timeout, TimeUnit unit)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">release</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure></p><p>简单列子<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SemaphoreDemo</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Semaphore semap = <span class="keyword">new</span> Semaphore(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            semap.acquire();</span><br><span class="line">            <span class="comment">//模拟耗时操作</span></span><br><span class="line">            Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">            System.out.print(Thread.currentThread().getId() + <span class="string">":done!"</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (InterruptedException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            semap.release();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span> <span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        ExecutorService executorService = Executors.newFixedThreadPool(<span class="number">20</span>);</span><br><span class="line">        <span class="keyword">final</span>  SemaphoreDemo demo = <span class="keyword">new</span> SemaphoreDemo();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">20</span>;i++)&#123;</span><br><span class="line">            executorService.submit(demo);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="ReadWriteLock"><a href="#ReadWriteLock" class="headerlink" title="ReadWriteLock"></a>ReadWriteLock</h1><p>ReadWriteLock是JDK5中提供的读写分离锁,使用与ReentrantLock相似。</p><p>读-读不互斥：读读之间不阻塞。<br>读-写互斥：读阻塞写，写也会阻塞读。<br>写-写互斥：写写阻塞。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> ReentrantReadWriteLock readWriteLock=<span class="keyword">new</span> ReentrantReadWriteLock();</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Lock readLock = readWriteLock.readLock();</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Lock writeLock = readWriteLock.writeLock();</span><br></pre></td></tr></table></figure><h1 id="CountDownLatch"><a href="#CountDownLatch" class="headerlink" title="CountDownLatch"></a>CountDownLatch</h1><p>倒数计时器<br>主线程等待检查任务线程全部完成后执行。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> CountDownLatch end = <span class="keyword">new</span> CountDownLatch(<span class="number">10</span>);</span><br><span class="line">end.countDown();</span><br><span class="line">end.await();</span><br></pre></td></tr></table></figure><p>简单例子<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountDownLatchDemo</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> CountDownLatch end =  <span class="keyword">new</span> CountDownLatch(<span class="number">10</span>);</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span>  CountDownLatchDemo demo =<span class="keyword">new</span> CountDownLatchDemo();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//模拟检查任务</span></span><br><span class="line">            Thread.sleep(<span class="keyword">new</span> Random().nextInt(<span class="number">10</span>)*<span class="number">1000</span>);</span><br><span class="line">            System.out.println(<span class="string">"check complete"</span>);</span><br><span class="line">            end.countDown();<span class="comment">//表示这个线程已经完成</span></span><br><span class="line">        &#125;<span class="keyword">catch</span> (InterruptedException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException</span>&#123;</span><br><span class="line">        ExecutorService executorService = Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i= <span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">            executorService.submit(demo);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//等待检查</span></span><br><span class="line">        end.await();</span><br><span class="line">        <span class="comment">//执行主线程</span></span><br><span class="line">        System.out.print(<span class="string">"main Thread"</span>);</span><br><span class="line">        executorService.shutdown();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="CyclicBarrier"><a href="#CyclicBarrier" class="headerlink" title="CyclicBarrier"></a>CyclicBarrier</h1><p>循环栅栏<br>Cyclic意为循环，也就是说这个计数器可以反复使用。比如，假设我们将计数器设置为10。那么凑齐第一批1<br>0个线程后，计数器就会归零，然后接着凑齐下一批10个线程</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">CyclicBarrier</span><span class="params">(<span class="keyword">int</span> parties, Runnable barrierAction)</span><span class="comment">//barrierAction就是当计数器一次计数完成后，系统会执行的动作</span></span></span><br><span class="line"><span class="function"><span class="title">await</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure><p>简单例子<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CyclicBarrierDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Soldier</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String solder;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> CyclicBarrier cyclic;</span><br><span class="line">        Soldier(CyclicBarrier cyclic,String solderName)&#123;</span><br><span class="line">            <span class="keyword">this</span>.cyclic = cyclic;</span><br><span class="line">            <span class="keyword">this</span>.solder=solderName;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                cyclic.await();</span><br><span class="line">                doWork();</span><br><span class="line">                cyclic.await();</span><br><span class="line">            &#125;<span class="keyword">catch</span> (InterruptedException e)&#123;<span class="comment">//某个线程中断后会抛异常</span></span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;<span class="keyword">catch</span> (BrokenBarrierException e)&#123;<span class="comment">//其他线程也不会一直等待，会抛BrokenBarrierException</span></span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">doWork</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                Thread.sleep(Math.abs(<span class="keyword">new</span> Random().nextInt()%<span class="number">10000</span>));</span><br><span class="line">            &#125;<span class="keyword">catch</span> (InterruptedException e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(solder + <span class="string">":WorkEnd"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="class"><span class="keyword">class</span> <span class="title">BarrierRun</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> flag;</span><br><span class="line">        <span class="keyword">int</span> N;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">BarrierRun</span><span class="params">(<span class="keyword">boolean</span> flag,<span class="keyword">int</span> N)</span></span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.flag = flag;</span><br><span class="line">            <span class="keyword">this</span>.N = N;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">                System.out.println(<span class="string">"士兵"</span> + N + <span class="string">"个，完成"</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"士兵"</span> + N + <span class="string">"个，集合"</span>);</span><br><span class="line">                flag = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> <span class="keyword">throws</span> InterruptedException</span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> N=<span class="number">10</span>;</span><br><span class="line">        Thread[] allSoldier = <span class="keyword">new</span> Thread[N];</span><br><span class="line">        <span class="keyword">boolean</span> flag =<span class="keyword">false</span>;</span><br><span class="line">        CyclicBarrier cyclicBarrier = <span class="keyword">new</span> CyclicBarrier(N,<span class="keyword">new</span> BarrierRun(flag,N));</span><br><span class="line">        System.out.println(<span class="string">"集合队伍"</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;N;++i)&#123;</span><br><span class="line">            System.out.println(<span class="string">"士兵"</span>+ i+<span class="string">"报道！"</span>);</span><br><span class="line">            allSoldier[i]=<span class="keyword">new</span> Thread(<span class="keyword">new</span> Soldier(cyclicBarrier,<span class="string">"士兵"</span> + i));</span><br><span class="line">            allSoldier[i].start();</span><br><span class="line"><span class="comment">//            if(i == 5)&#123;</span></span><br><span class="line"><span class="comment">//                allSoldier[0].interrupt();</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="LockSupport"><a href="#LockSupport" class="headerlink" title="LockSupport"></a>LockSupport</h1><p>提供线程阻塞原语<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LockSupport.park();</span><br><span class="line">LockSupport.unpark(t1);</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Condition&quot;&gt;&lt;a href=&quot;#Condition&quot; class=&quot;headerlink&quot; title=&quot;Condition&quot;&gt;&lt;/a&gt;Condition&lt;/h1&gt;&lt;p&gt;类似于 Object.wait()和Object.notify()，与Reentra
      
    
    </summary>
    
      <category term="java" scheme="http://lj360560179.github.io/categories/java/"/>
    
    
      <category term="java" scheme="http://lj360560179.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>多线程基础</title>
    <link href="http://lj360560179.github.io/2017/06/01/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80/"/>
    <id>http://lj360560179.github.io/2017/06/01/多线程基础/</id>
    <published>2017-05-31T16:34:14.000Z</published>
    <updated>2018-09-06T09:35:14.869Z</updated>
    
    <content type="html"><![CDATA[<h2 id="多线程基础"><a href="#多线程基础" class="headerlink" title="多线程基础"></a>多线程基础</h2><a id="more"></a><h3 id="1-线程状态"><a href="#1-线程状态" class="headerlink" title="1.线程状态"></a>1.线程状态</h3><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/threadstate.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><ul><li>新建(new)：新创建了一个线程对象。</li><li>可运行(runnable)：线程对象创建后，其他线程(比如main线程）调用了该对象的start()方法。该状态的线程位于可运行线程池中，等待被线程调度选中，获取cpu 的使用权 。</li><li>运行(running)：可运行状态(runnable)的线程获得了cpu 时间片（timeslice） ，执行程序代码。</li><li>阻塞(block)：阻塞状态是指线程因为某种原因放弃了cpu 使用权，也即让出了cpu timeslice，暂时停止运行。直到线程进入可运行(runnable)状态，才有机会再次获得cpu timeslice 转到运行(running)状态。阻塞的情况分三种： <ul><li>等待阻塞：运行(running)的线程执行o.wait()方法，JVM会把该线程放入等待队列(waitting queue)中。</li><li>同步阻塞：运行(running)的线程在获取对象的同步锁时，若该同步锁被别的线程占用，则JVM会把该线程放入锁池(lock pool)中。</li><li>其他阻塞：运行(running)的线程执行Thread.sleep(long ms)或t.join()方法，或者发出了I/O请求时，JVM会把该线程置为阻塞状态。当sleep()状态超时、join()等待线程终止或者超时、或者I/O处理完毕时，线程重新转入可运行(runnable)状态。</li></ul></li><li>死亡(dead)：线程run()、main() 方法执行结束，或者因异常退出了run()方法，则该线程结束生命周期。死亡的线程不可再次复生。</li></ul><h3 id="1-实现并启动线程有两种方法"><a href="#1-实现并启动线程有两种方法" class="headerlink" title="1.实现并启动线程有两种方法"></a>1.实现并启动线程有两种方法</h3><blockquote><p>1、写一个类继承自Thread类，重写run方法。用start方法启动线程<br>2、写一个类实现Runnable接口，实现run方法。用new Thread(Runnable target).start()方法来启动</p></blockquote><h3 id="2-Thread的-start-和-run"><a href="#2-Thread的-start-和-run" class="headerlink" title="2.Thread的 start() 和 run()"></a>2.Thread的 start() 和 run()</h3><blockquote><p>1、用start方法来启动线程，真正实现了多线程运行，这时无需等待run方法体代码执行完毕而直接继续执行下面的代码。通过调用Thread类的start()方法来启动一个线程，这时此线程处于就绪（可运行）状态，并没有运行，一旦得到cpu时间片，就开始执行run()方法，这里方法run()称为线程体，它包含了要执行的这个线程的内容，Run方法运行结束，此线程随即终止。<br>2、run()方法只是类的一个普通方法而已，如果直接调用Run方法，程序中依然只有主线程这一个线程，其程序执行路径还是只有一条，还是要顺序执行，还是要等待run方法体执行完毕后才可继续执行下面的代码，这样就没有达到写线程的目的。<br>3、调用start方法方可启动线程，而run方法只是thread的一个普通方法调用，还是在主线程里执行。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> </span>&#123;</span><br><span class="line">        Thread t = <span class="keyword">new</span> Thread() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                test();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        t.start();</span><br><span class="line">        System.out.print(<span class="string">"111"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.print(<span class="string">"222"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//输出111222</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> </span>&#123;</span><br><span class="line">        Thread t = <span class="keyword">new</span> Thread() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                test();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        t.run();</span><br><span class="line">        System.out.print(<span class="string">"111"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.print(<span class="string">"222"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//输出222111</span></span><br></pre></td></tr></table></figure><blockquote><p>通过以上两个程序实例，可以很容易的区分出start()方法和run()方法的区别:<br>t.start(); 该行代码相当于是启动线程，<br>t.run(); 该行代码相当于是使用t这个类中的run方法而已.</p></blockquote><h3 id="3-stop-暴力终止线程。"><a href="#3-stop-暴力终止线程。" class="headerlink" title="3.stop() 暴力终止线程。"></a>3.stop() 暴力终止线程。</h3><blockquote><p>Thread.stop() 不推荐使用。它会释放所有monitor</p></blockquote><h3 id="4-中断线程"><a href="#4-中断线程" class="headerlink" title="4.中断线程"></a>4.中断线程</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> Thread.interrupt() <span class="comment">// 中断线程</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">boolean</span> Thread.isInterrupted() <span class="comment">// 判断是否被中断</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> Thread.interrupted() <span class="comment">// 判断是否被中断，并清除当前中断状态</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">        Thread.yield();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">t1.interrupt();</span><br></pre></td></tr></table></figure><p>t1.interrupt()后并不会终止run方法的循环。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(Thread.currentThread().isInterrupted())&#123;</span><br><span class="line">            System.out.println(<span class="string">"Interruted!"</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Thread.yield();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">t1.interrupt();</span><br></pre></td></tr></table></figure></p><p>优雅的方法应在操作数据前进行判断是否终止线程，如果已经终止则跳出循环。</p><h3 id="4-sleep"><a href="#4-sleep" class="headerlink" title="4.sleep"></a>4.sleep</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(Thread.currentThread().isInterrupted())&#123;</span><br><span class="line">            System.out.println(<span class="string">"Interruted!"</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"Interruted When Sleep"</span>);</span><br><span class="line">            <span class="comment">//设置中断状态，抛出异常后会清除中断标记位</span></span><br><span class="line">            Thread.currentThread().interrupt();</span><br><span class="line">        &#125;</span><br><span class="line">        Thread.yield();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-挂起（suspend）和继续执行（resume）线程-不推荐使用"><a href="#5-挂起（suspend）和继续执行（resume）线程-不推荐使用" class="headerlink" title="5.挂起（suspend）和继续执行（resume）线程(不推荐使用)"></a>5.挂起（suspend）和继续执行（resume）线程(不推荐使用)</h3><blockquote><p>suspend()不会释放锁<br>如果加锁发生在resume()之前 ，则死锁发生</p></blockquote><h3 id="6-等待线程结束（join）和谦让-yeild"><a href="#6-等待线程结束（join）和谦让-yeild" class="headerlink" title="6.等待线程结束（join）和谦让(yeild)"></a>6.等待线程结束（join）和谦让(yeild)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">join</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">join</span><span class="params">(<span class="keyword">long</span> millis)</span> <span class="keyword">throws</span> InterruptedException</span></span><br></pre></td></tr></table></figure><h3 id="7-守护线程"><a href="#7-守护线程" class="headerlink" title="7.守护线程"></a>7.守护线程</h3><blockquote><p>在后台默默地完成一些系统性的服务，比如垃圾回收线程、JIT线程就可以理解为守护线程<br>当一个Java应用内，只有守护线程时，Java虚拟机就会自然退出</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Thread t=<span class="keyword">new</span> DaemonT();</span><br><span class="line">t.setDaemon(<span class="keyword">true</span>);<span class="comment">//设置为守护线程，必须在start()之前设置</span></span><br><span class="line">t.start();</span><br></pre></td></tr></table></figure><h3 id="8-线程优先级"><a href="#8-线程优先级" class="headerlink" title="8.线程优先级"></a>8.线程优先级</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Thread t=<span class="keyword">new</span> Thread();</span><br><span class="line">t.setPriority(***) <span class="comment">//设置优先级的方法</span></span><br><span class="line">t.start();</span><br></pre></td></tr></table></figure><h3 id="9-基本的线程同步操作"><a href="#9-基本的线程同步操作" class="headerlink" title="9.基本的线程同步操作"></a>9.基本的线程同步操作</h3><blockquote><p>1、synchronized<br>– 指定加锁对象：对给定对象加锁，进入同步代码前要获得给定对象的锁。<br>– 直接作用于实例方法：相当于对当前实例加锁，进入同步代码前要获得当前实例的锁。<br>– 直接作用于静态方法：相当于对当前类加锁，进入同步代码前要获得当前类的锁。<br>2、Object.wait() Obejct.notify()</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">T1</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (object) &#123;</span><br><span class="line">            System.out.println(System.currentTimeMillis()+<span class="string">":T1 start! "</span>);</span><br><span class="line">             <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(System.currentTimeMillis()</span><br><span class="line">                +<span class="string">":T1 wait for object "</span>);</span><br><span class="line">                object.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        System.out.println(System.currentTimeMillis()+<span class="string">":T1 end!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">T2</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (object) &#123;</span><br><span class="line">                System.out.println(System.currentTimeMillis()</span><br><span class="line">                +<span class="string">":T2 start! notify one thread"</span>);</span><br><span class="line">                object.notify();</span><br><span class="line">                System.out.println(System.currentTimeMillis()+<span class="string">":T2 end!"</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>synchronized (object)必须拿到锁才可以wait()、notify()，<br>object.notify()后不会马上执行T1，需要等到object释放锁后才会继续执行。则上输出为：<br>T1 start!<br>T1 wait for object<br>T2 start! notify one thread<br>T2 end!<br>T1 end!//sleep(2000)后才会输出</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;多线程基础&quot;&gt;&lt;a href=&quot;#多线程基础&quot; class=&quot;headerlink&quot; title=&quot;多线程基础&quot;&gt;&lt;/a&gt;多线程基础&lt;/h2&gt;
    
    </summary>
    
      <category term="java" scheme="http://lj360560179.github.io/categories/java/"/>
    
    
      <category term="java" scheme="http://lj360560179.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>【转】常用Linux命令</title>
    <link href="http://lj360560179.github.io/2017/05/25/linux/"/>
    <id>http://lj360560179.github.io/2017/05/25/linux/</id>
    <published>2017-05-25T07:44:14.000Z</published>
    <updated>2018-09-06T09:35:14.865Z</updated>
    
    <content type="html"><![CDATA[<p><a href="http://blog.csdn.net/u013970991/article/details/52036304" target="_blank" rel="noopener">【转】Java开发必会的Linux命令</a></p><h3 id="1-查找文件"><a href="#1-查找文件" class="headerlink" title="1.查找文件"></a>1.查找文件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">find / -name filename.txt 根据名称查找/目录下的filename.txt文件。</span><br><span class="line"></span><br><span class="line">find . -name <span class="string">"*.xml"</span> 递归查找所有的xml文件</span><br><span class="line"></span><br><span class="line">find . -name <span class="string">"*.xml"</span> |xargs grep <span class="string">"hello world"</span> 递归查找所有文件内容中包含hello world的xml文件</span><br><span class="line"></span><br><span class="line">grep -H <span class="string">'spring'</span> *.xml 查找所以有的包含spring的xml文件</span><br><span class="line"></span><br><span class="line">find ./ -size 0 | xargs rm -f &amp;amp; 删除文件大小为零的文件</span><br><span class="line"></span><br><span class="line">ls -l | grep <span class="string">'.jar'</span> 查找当前目录中的所有jar文件</span><br><span class="line"></span><br><span class="line">grep <span class="string">'test'</span> d* 显示所有以d开头的文件中包含<span class="built_in">test</span>的行。</span><br><span class="line"></span><br><span class="line">grep <span class="string">'test'</span> aa bb cc 显示在aa，bb，cc文件中匹配<span class="built_in">test</span>的行。</span><br><span class="line"></span><br><span class="line">grep <span class="string">'[a-z]\&#123;5\&#125;'</span> aa 显示所有包含每个字符串至少有5个连续小写字符的字符串的行。</span><br></pre></td></tr></table></figure><h3 id="2-查看一个程序是否运行"><a href="#2-查看一个程序是否运行" class="headerlink" title="2.查看一个程序是否运行"></a>2.查看一个程序是否运行</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps –ef|grep tomcat 查看所有有关tomcat的进程</span><br></pre></td></tr></table></figure><h3 id="3-终止线程"><a href="#3-终止线程" class="headerlink" title="3.终止线程"></a>3.终止线程</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> -9 19979 终止线程号位19979的进程</span><br></pre></td></tr></table></figure><h3 id="4-查看文件，包含隐藏文件"><a href="#4-查看文件，包含隐藏文件" class="headerlink" title="4.查看文件，包含隐藏文件"></a>4.查看文件，包含隐藏文件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -al</span><br></pre></td></tr></table></figure><h3 id="5-当前工作目录"><a href="#5-当前工作目录" class="headerlink" title="5.当前工作目录"></a>5.当前工作目录</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">pwd</span></span><br></pre></td></tr></table></figure><h3 id="6-复制文件"><a href="#6-复制文件" class="headerlink" title="6.复制文件"></a>6.复制文件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cp <span class="built_in">source</span> dest 复制文件</span><br><span class="line"></span><br><span class="line">cp -r sourceFolder targetFolder 递归复制整个文件夹</span><br><span class="line"></span><br><span class="line">scp sourecFile romoteUserName@remoteIp:remoteAddr 远程拷贝</span><br></pre></td></tr></table></figure><h3 id="7-创建目录"><a href="#7-创建目录" class="headerlink" title="7.创建目录"></a>7.创建目录</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir newfolder</span><br></pre></td></tr></table></figure><h3 id="8-删除目录"><a href="#8-删除目录" class="headerlink" title="8.删除目录"></a>8.删除目录</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rmdir deleteEmptyFolder 删除空目录 </span><br><span class="line"></span><br><span class="line">rm -rf deleteFile 递归删除目录中所有内容</span><br></pre></td></tr></table></figure><h3 id="9-移动文件"><a href="#9-移动文件" class="headerlink" title="9.移动文件"></a>9.移动文件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /temp/movefile /targetFolder</span><br></pre></td></tr></table></figure><h3 id="10-重命令"><a href="#10-重命令" class="headerlink" title="10.重命令"></a>10.重命令</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv oldNameFile newNameFile</span><br></pre></td></tr></table></figure><h3 id="11-切换用户"><a href="#11-切换用户" class="headerlink" title="11.切换用户"></a>11.切换用户</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su -username</span><br></pre></td></tr></table></figure><h3 id="12-修改文件权限"><a href="#12-修改文件权限" class="headerlink" title="12.修改文件权限"></a>12.修改文件权限</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 file.java //file.java的权限-rwxrwxrwx，r表示读、w表示写、x表示可执行</span><br></pre></td></tr></table></figure><h3 id="13-压缩文件"><a href="#13-压缩文件" class="headerlink" title="13.压缩文件"></a>13.压缩文件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -czf test.tar.gz /test1 /test2</span><br></pre></td></tr></table></figure><h3 id="14-列出压缩文件列表"><a href="#14-列出压缩文件列表" class="headerlink" title="14.列出压缩文件列表"></a>14.列出压缩文件列表</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -tzf test.tar.gz</span><br></pre></td></tr></table></figure><h3 id="15-解压文件表"><a href="#15-解压文件表" class="headerlink" title="15.解压文件表"></a>15.解压文件表</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xvzf test.tar.gz</span><br></pre></td></tr></table></figure><h3 id="16-查看文件头10行"><a href="#16-查看文件头10行" class="headerlink" title="16.查看文件头10行"></a>16.查看文件头10行</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">head -n 10 example.txt</span><br></pre></td></tr></table></figure><h3 id="17-查看文件尾10行"><a href="#17-查看文件尾10行" class="headerlink" title="17.查看文件尾10行"></a>17.查看文件尾10行</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -n 10 example.txt</span><br></pre></td></tr></table></figure><h3 id="18-查看日志类型文件"><a href="#18-查看日志类型文件" class="headerlink" title="18.查看日志类型文件"></a>18.查看日志类型文件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -f exmaple.log //这个命令会自动显示新增内容，屏幕只显示10行内容的（可设置）。</span><br></pre></td></tr></table></figure><h3 id="19-使用超级管理员身份执行命令"><a href="#19-使用超级管理员身份执行命令" class="headerlink" title="19.使用超级管理员身份执行命令"></a>19.使用超级管理员身份执行命令</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo rm a.txt 使用管理员身份删除文件</span><br></pre></td></tr></table></figure><h3 id="20-查看端口占用情况"><a href="#20-查看端口占用情况" class="headerlink" title="20.查看端口占用情况"></a>20.查看端口占用情况</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -tln | grep 8080 查看端口8080的使用情况</span><br></pre></td></tr></table></figure><h3 id="21-查看端口属于哪个程序"><a href="#21-查看端口属于哪个程序" class="headerlink" title="21.查看端口属于哪个程序"></a>21.查看端口属于哪个程序</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof -i :8080</span><br></pre></td></tr></table></figure><h3 id="22-查看进程"><a href="#22-查看进程" class="headerlink" title="22.查看进程"></a>22.查看进程</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ps aux|grep java 查看java进程</span><br><span class="line"></span><br><span class="line">ps aux 查看所有进程</span><br></pre></td></tr></table></figure><h3 id="23-文件下载"><a href="#23-文件下载" class="headerlink" title="23. 文件下载"></a>23. 文件下载</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget http://file.tgz</span><br><span class="line"></span><br><span class="line">curl http://file.tgz</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;a href=&quot;http://blog.csdn.net/u013970991/article/details/52036304&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;【转】Java开发必会的Linux命令&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;1-查
      
    
    </summary>
    
    
      <category term="linux" scheme="http://lj360560179.github.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>github 上传</title>
    <link href="http://lj360560179.github.io/2017/05/25/git/"/>
    <id>http://lj360560179.github.io/2017/05/25/git/</id>
    <published>2017-05-25T04:34:14.000Z</published>
    <updated>2018-09-06T09:36:30.436Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SSH-key"><a href="#SSH-key" class="headerlink" title="SSH key"></a>SSH key</h1><h3 id="1-建立git仓库"><a href="#1-建立git仓库" class="headerlink" title="1.建立git仓库"></a>1.建立git仓库</h3><p>cd到你的本地项目根目录下，执行git命令<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br></pre></td></tr></table></figure></p><h3 id="2-将项目的所有文件添加到仓库中"><a href="#2-将项目的所有文件添加到仓库中" class="headerlink" title="2.将项目的所有文件添加到仓库中"></a>2.将项目的所有文件添加到仓库中</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br></pre></td></tr></table></figure><p>如果想添加某个特定的文件，只需把.换成特定的文件名即可</p><h3 id="3、将add的文件commit到仓库"><a href="#3、将add的文件commit到仓库" class="headerlink" title="3、将add的文件commit到仓库"></a>3、将add的文件commit到仓库</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -m <span class="string">"注释语句"</span></span><br></pre></td></tr></table></figure><h3 id="4、去github上创建自己的Repository："><a href="#4、去github上创建自己的Repository：" class="headerlink" title="4、去github上创建自己的Repository："></a>4、去github上创建自己的Repository：</h3><p>去github上创建自己的Repository,拿到项目url</p><h3 id="5、将本地的仓库关联到github上"><a href="#5、将本地的仓库关联到github上" class="headerlink" title="5、将本地的仓库关联到github上"></a>5、将本地的仓库关联到github上</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin https://github.com/lj360560179/xxRepository</span><br></pre></td></tr></table></figure><h3 id="6-上传github之前，要先pull一下，执行如下命令："><a href="#6-上传github之前，要先pull一下，执行如下命令：" class="headerlink" title="6.上传github之前，要先pull一下，执行如下命令："></a>6.上传github之前，要先pull一下，执行如下命令：</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git pull origin master</span><br><span class="line">git pull origin master --allow-unrelated-histories</span><br></pre></td></tr></table></figure><h3 id="7-也就是最后一步，上传代码到github远程仓库"><a href="#7-也就是最后一步，上传代码到github远程仓库" class="headerlink" title="7.也就是最后一步，上传代码到github远程仓库"></a>7.也就是最后一步，上传代码到github远程仓库</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure><p>执行完后，如果没有异常，等待执行完就上传成功了，中间可能会让你输入Username和Password，你只要输入github的账号和密码就行了</p><p><a href="http://www.jianshu.com/p/5ee9897b6b65?utm_source=desktop&amp;utm_medium=timeline" target="_blank" rel="noopener">Git常用命令速查手册</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;SSH-key&quot;&gt;&lt;a href=&quot;#SSH-key&quot; class=&quot;headerlink&quot; title=&quot;SSH key&quot;&gt;&lt;/a&gt;SSH key&lt;/h1&gt;&lt;h3 id=&quot;1-建立git仓库&quot;&gt;&lt;a href=&quot;#1-建立git仓库&quot; class=&quot;header
      
    
    </summary>
    
      <category term="git" scheme="http://lj360560179.github.io/categories/git/"/>
    
    
      <category term="github" scheme="http://lj360560179.github.io/tags/github/"/>
    
  </entry>
  
  <entry>
    <title>vue cli</title>
    <link href="http://lj360560179.github.io/2017/04/25/vue-cli/"/>
    <id>http://lj360560179.github.io/2017/04/25/vue-cli/</id>
    <published>2017-04-25T07:44:14.000Z</published>
    <updated>2018-09-06T09:35:14.867Z</updated>
    
    <content type="html"><![CDATA[<h1 id="vue-cli"><a href="#vue-cli" class="headerlink" title="vue-cli"></a>vue-cli</h1><h3 id="1-安装vue-cli"><a href="#1-安装vue-cli" class="headerlink" title="1.安装vue-cli"></a>1.安装vue-cli</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g vue-cli</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="2-使用vue-cli初始化项目"><a href="#2-使用vue-cli初始化项目" class="headerlink" title="2.使用vue-cli初始化项目"></a>2.使用vue-cli初始化项目</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue init webpack-simple my-project-name</span><br></pre></td></tr></table></figure><h3 id="3、进到目录"><a href="#3、进到目录" class="headerlink" title="3、进到目录"></a>3、进到目录</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> my-project</span><br></pre></td></tr></table></figure><h3 id="4、安装依赖"><a href="#4、安装依赖" class="headerlink" title="4、安装依赖"></a>4、安装依赖</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br></pre></td></tr></table></figure><h3 id="5、开始运行"><a href="#5、开始运行" class="headerlink" title="5、开始运行"></a>5、开始运行</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></table></figure><h3 id="6、测试项目–访问"><a href="#6、测试项目–访问" class="headerlink" title="6、测试项目–访问"></a>6、测试项目–访问</h3><p>localhost:8080</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;vue-cli&quot;&gt;&lt;a href=&quot;#vue-cli&quot; class=&quot;headerlink&quot; title=&quot;vue-cli&quot;&gt;&lt;/a&gt;vue-cli&lt;/h1&gt;&lt;h3 id=&quot;1-安装vue-cli&quot;&gt;&lt;a href=&quot;#1-安装vue-cli&quot; class=&quot;headerlink&quot; title=&quot;1.安装vue-cli&quot;&gt;&lt;/a&gt;1.安装vue-cli&lt;/h3&gt;&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;npm install -g vue-cli&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="前端" scheme="http://lj360560179.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="node.js" scheme="http://lj360560179.github.io/tags/node-js/"/>
    
      <category term="vue.js" scheme="http://lj360560179.github.io/tags/vue-js/"/>
    
  </entry>
  
  <entry>
    <title>单例模式</title>
    <link href="http://lj360560179.github.io/2016/12/19/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"/>
    <id>http://lj360560179.github.io/2016/12/19/单例模式/</id>
    <published>2016-12-18T16:34:14.000Z</published>
    <updated>2018-09-06T09:35:14.868Z</updated>
    
    <content type="html"><![CDATA[<p>单例模式Singleton，应用场景一般是有些对象只需要一个就够了，用来保证项目应用程序中只有一个实例，例如项目中的配置对象。<br><a id="more"></a></p><h5 id="饿汉模式"><a href="#饿汉模式" class="headerlink" title="饿汉模式"></a>饿汉模式</h5><p>类加载的时候，就会创建类的唯一实例。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span></span>&#123;</span><br><span class="line">    <span class="comment">//将构造方法私有化，不允许外部直接创建对象</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//创建类的唯一实例</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance=<span class="keyword">new</span> Singleton();</span><br><span class="line">    <span class="comment">//返回</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h5 id="懒汉模式"><a href="#懒汉模式" class="headerlink" title="懒汉模式"></a>懒汉模式</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton2</span></span>&#123;</span><br><span class="line">    <span class="comment">//将构造方法私有化，不允许外部直接创建对象</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton2</span><span class="params">()</span></span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//创建类的唯一实例</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton2 instance;</span><br><span class="line">    <span class="comment">//返回</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton2 <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(instance==<span class="keyword">null</span>)&#123;</span><br><span class="line">           instance=<span class="keyword">new</span> Singleton2();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="区别："><a href="#区别：" class="headerlink" title="区别："></a>区别：</h6><p>饿汉模式的特点是加载类时比较慢，但运行时获取对象的速度比较快，线程安全的<br>懒汉模式的特点是加载类时比较快，但运行时获取对象的速度比较慢，线程不安全的</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;单例模式Singleton，应用场景一般是有些对象只需要一个就够了，用来保证项目应用程序中只有一个实例，例如项目中的配置对象。&lt;br&gt;
    
    </summary>
    
      <category term="java" scheme="http://lj360560179.github.io/categories/java/"/>
    
    
      <category term="java" scheme="http://lj360560179.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>2016-9-11.JS</title>
    <link href="http://lj360560179.github.io/2016/09/11/JS/"/>
    <id>http://lj360560179.github.io/2016/09/11/JS/</id>
    <published>2016-09-11T07:44:14.000Z</published>
    <updated>2018-09-06T09:35:14.857Z</updated>
    
    <content type="html"><![CDATA[<h2 id="2016-9-11-JS"><a href="#2016-9-11-JS" class="headerlink" title="2016-9-11.JS"></a>2016-9-11.JS</h2><h3 id="1-typeof"><a href="#1-typeof" class="headerlink" title="1.typeof"></a>1.typeof</h3><p>typeof 运算符<br>返回一个用来表示表达式的数据类型的字符串。<br>typeof 运算符把类型信息当作字符串返回。<br>typeof 返回值有六种可能： “number,” “string,” “boolean,” “object,” “function,” 和 “undefined.”<br>其中圆括号可以加可以不加。<br><a id="more"></a><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typeof</span>(<span class="number">1</span>);<span class="comment">//"number"</span></span><br><span class="line"><span class="keyword">typeof</span>(<span class="literal">NaN</span>);<span class="comment">//"number"</span></span><br><span class="line"><span class="keyword">typeof</span>(<span class="built_in">Number</span>.MIN_VALUE);<span class="comment">//"number"</span></span><br><span class="line"><span class="keyword">typeof</span>(<span class="literal">Infinity</span>);<span class="comment">//Infinity 属性用于存放表示正无穷大的数值。"number"</span></span><br><span class="line"><span class="keyword">typeof</span>(<span class="string">"123"</span>);<span class="comment">//"string"</span></span><br><span class="line"><span class="keyword">typeof</span>(<span class="literal">true</span>);<span class="comment">//"boolean"</span></span><br><span class="line"><span class="keyword">typeof</span>(<span class="built_in">window</span>);<span class="comment">//"object"</span></span><br><span class="line"><span class="keyword">typeof</span>(<span class="built_in">document</span>);<span class="comment">//"object"</span></span><br><span class="line"><span class="keyword">typeof</span>(<span class="literal">null</span>);<span class="comment">//"object"</span></span><br><span class="line"><span class="keyword">typeof</span>(<span class="built_in">eval</span>);<span class="comment">//"function"</span></span><br><span class="line"><span class="keyword">typeof</span>(<span class="built_in">Date</span>);<span class="comment">//"function"</span></span><br><span class="line"><span class="keyword">typeof</span>(sss);<span class="comment">//"undefined"</span></span><br><span class="line"><span class="keyword">typeof</span>(<span class="literal">undefined</span>);<span class="comment">//"undefined"</span></span><br></pre></td></tr></table></figure></p><p>使用typeof主要用来判断变量是否被定义、测试变量是否是方法。</p><h3 id="2-confirm"><a href="#2-confirm" class="headerlink" title="2.confirm"></a>2.confirm</h3><p>confirm() 方法用于显示一个带有指定消息和 OK 及取消按钮的对话框。但是不太好看.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 弹框消息</span></span><br><span class="line">gwwg.h_pop_confirm = <span class="function"><span class="keyword">function</span>(<span class="params">content,onOk</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> settings = &#123;</span><br><span class="line">        width: <span class="number">260</span>,</span><br><span class="line">        height: <span class="number">120</span>,</span><br><span class="line">        modal: <span class="literal">true</span>,</span><br><span class="line">        ok: <span class="string">"确认"</span>,</span><br><span class="line">        cancel: <span class="string">"取消"</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">"undefined"</span> == <span class="keyword">typeof</span> content) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">"undefined"</span> == <span class="keyword">typeof</span> onOk) &#123;</span><br><span class="line">        <span class="keyword">var</span> onOk = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> $dialog = $(<span class="string">'&lt;div class="xxDialog"&gt;&lt;\/div&gt;'</span>);</span><br><span class="line">    <span class="keyword">var</span> $dialogTitle;</span><br><span class="line">    <span class="keyword">var</span> $dialogClose = $(<span class="string">'&lt;div class="dialogClose"&gt;&lt;\/div&gt;'</span>).appendTo($dialog);</span><br><span class="line">    <span class="keyword">var</span> $dialogContent;</span><br><span class="line">    <span class="keyword">var</span> $dialogBottom;</span><br><span class="line">    <span class="keyword">var</span> $dialogOk;</span><br><span class="line">    <span class="keyword">var</span> $dialogCancel;</span><br><span class="line">    <span class="keyword">var</span> $dialogOverlay;</span><br><span class="line"></span><br><span class="line">    $dialogContent = $(<span class="string">'&lt;div class="dialogContent"&gt;&lt;\/div&gt;'</span>).appendTo($dialog);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (settings.ok != <span class="literal">null</span> || settings.cancel != <span class="literal">null</span>) &#123;</span><br><span class="line">        $dialogBottom = $(<span class="string">'&lt;div class="dialogBottom"&gt;&lt;\/div&gt;'</span>).appendTo($dialog);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (settings.ok != <span class="literal">null</span>) &#123;</span><br><span class="line">        $dialogOk = $(<span class="string">'&lt;input type="button" class="button" value="'</span> + settings.ok + <span class="string">'" \/&gt;'</span>).appendTo($dialogBottom);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (settings.cancel != <span class="literal">null</span>) &#123;</span><br><span class="line">        $dialogCancel = $(<span class="string">'&lt;input type="button" class="button" value="'</span> + settings.cancel + <span class="string">'" \/&gt;'</span>).appendTo($dialogBottom);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">window</span>.XMLHttpRequest) &#123;</span><br><span class="line">        $dialog.append(<span class="string">'&lt;iframe class="dialogIframe"&gt;&lt;\/iframe&gt;'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $dialog.appendTo(<span class="string">"body"</span>);</span><br><span class="line">    <span class="keyword">if</span> (settings.modal) &#123;</span><br><span class="line">        $dialogOverlay = $(<span class="string">'&lt;div class="dialogOverlay"&gt;&lt;\/div&gt;'</span>).insertAfter($dialog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> dialogX;</span><br><span class="line">    <span class="keyword">var</span> dialogY;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (settings.title != <span class="literal">null</span>) &#123;</span><br><span class="line">        $dialogTitle.text(settings.title);</span><br><span class="line">    &#125;</span><br><span class="line">    $dialogContent.html(content);</span><br><span class="line">    $dialog.css(&#123;<span class="string">"width"</span>: settings.width, <span class="string">"height"</span>: settings.height, <span class="string">"margin-left"</span>:<span class="built_in">parseInt</span>(-settings.width / <span class="number">2</span>), <span class="string">"z-index"</span>: <span class="number">1000</span>&#125;);</span><br><span class="line">    dialogShow();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($dialogTitle != <span class="literal">null</span>) &#123;</span><br><span class="line">        $dialogTitle.mousedown(<span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">            $dialog.css(&#123;<span class="string">"z-index"</span>: zIndex ++&#125;);</span><br><span class="line">            <span class="keyword">var</span> offset = $(<span class="keyword">this</span>).offset();</span><br><span class="line">            <span class="keyword">if</span> (!<span class="built_in">window</span>.XMLHttpRequest) &#123;</span><br><span class="line">                dialogX = event.clientX - offset.left;</span><br><span class="line">                dialogY = event.clientY - offset.top;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                dialogX = event.pageX - offset.left;</span><br><span class="line">                dialogY = event.pageY - offset.top;</span><br><span class="line">            &#125;</span><br><span class="line">            $(<span class="string">"body"</span>).bind(<span class="string">"mousemove"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">                $dialog.css(&#123;<span class="string">"top"</span>: event.clientY - dialogY, <span class="string">"left"</span>: event.clientX - dialogX, <span class="string">"margin"</span>: <span class="number">0</span>&#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;).mouseup(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            $(<span class="string">"body"</span>).unbind(<span class="string">"mousemove"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($dialogClose != <span class="literal">null</span>) &#123;</span><br><span class="line">        $dialogClose.bind(<span class="string">"click"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            dialogClose();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($dialogOk != <span class="literal">null</span>) &#123;</span><br><span class="line">        $dialogOk.bind(<span class="string">"click"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (onOk &amp;&amp; <span class="keyword">typeof</span> onOk == <span class="string">"function"</span>) &#123;</span><br><span class="line">                dialogClose();</span><br><span class="line">                onOk();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                dialogClose();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($dialogCancel != <span class="literal">null</span>) &#123;</span><br><span class="line">        $dialogCancel.bind(<span class="string">"click"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            dialogClose();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">dialogShow</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $dialog.show();</span><br><span class="line">        $dialogOverlay.show();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">dialogClose</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $dialogOverlay.remove();</span><br><span class="line">        $dialog.remove();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $dialog;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>大致就是画一个弹框，确认跟取消按钮，调用的时候把弹框插入body中，点击确认执行传入的回调方法。</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;2016-9-11-JS&quot;&gt;&lt;a href=&quot;#2016-9-11-JS&quot; class=&quot;headerlink&quot; title=&quot;2016-9-11.JS&quot;&gt;&lt;/a&gt;2016-9-11.JS&lt;/h2&gt;&lt;h3 id=&quot;1-typeof&quot;&gt;&lt;a href=&quot;#1-typeof&quot; class=&quot;headerlink&quot; title=&quot;1.typeof&quot;&gt;&lt;/a&gt;1.typeof&lt;/h3&gt;&lt;p&gt;typeof 运算符&lt;br&gt;返回一个用来表示表达式的数据类型的字符串。&lt;br&gt;typeof 运算符把类型信息当作字符串返回。&lt;br&gt;typeof 返回值有六种可能： “number,” “string,” “boolean,” “object,” “function,” 和 “undefined.”&lt;br&gt;其中圆括号可以加可以不加。&lt;br&gt;
    
    </summary>
    
      <category term="javascript" scheme="http://lj360560179.github.io/categories/javascript/"/>
    
    
      <category term="javascript" scheme="http://lj360560179.github.io/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>Druid简单配置</title>
    <link href="http://lj360560179.github.io/2016/08/19/Druid%E7%AE%80%E5%8D%95%E9%85%8D%E7%BD%AE/"/>
    <id>http://lj360560179.github.io/2016/08/19/Druid简单配置/</id>
    <published>2016-08-19T04:34:14.000Z</published>
    <updated>2018-09-06T09:35:14.855Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Druid简单配置"><a href="#Druid简单配置" class="headerlink" title="Druid简单配置"></a>Druid简单配置</h3><p>这里只是最简单的配置，更多详细的配置可以去<a href="https://github.com/alibaba/druid/wiki/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98" target="_blank" rel="noopener">druid</a>查看。<br><a id="more"></a></p><h5 id="1-maven依赖"><a href="#1-maven依赖" class="headerlink" title="1.maven依赖"></a>1.maven依赖</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.20<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="2-spring-dao-xml-中dataSource配置"><a href="#2-spring-dao-xml-中dataSource配置" class="headerlink" title="2.spring-dao.xml 中dataSource配置"></a>2.spring-dao.xml 中dataSource配置</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.alibaba.druid.pool.DruidDataSource"</span> <span class="attr">init-method</span>=<span class="string">"init"</span> <span class="attr">destroy-method</span>=<span class="string">"close"</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 数据源驱动类可不写，Druid默认会自动根据URL识别DriverClass --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">&lt;!-- 基本属性 url、user、password --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">&lt;!-- 配置初始化大小、最小、最大 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"initialSize"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.pool.init&#125;"</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minIdle"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.pool.minIdle&#125;"</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxActive"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.pool.maxActive&#125;"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">&lt;!-- 配置获取连接等待超时的时间 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxWait"</span> <span class="attr">value</span>=<span class="string">"60000"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">&lt;!-- 配置间隔多久才进行一次检测，检测需要关闭的空闲连接，单位是毫秒 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"timeBetweenEvictionRunsMillis"</span> <span class="attr">value</span>=<span class="string">"60000"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">&lt;!-- 配置一个连接在池中最小生存的时间，单位是毫秒 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minEvictableIdleTimeMillis"</span> <span class="attr">value</span>=<span class="string">"300000"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"validationQuery"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.testSql&#125;"</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"testWhileIdle"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"testOnBorrow"</span> <span class="attr">value</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"testOnReturn"</span> <span class="attr">value</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">&lt;!-- 打开PSCache，并且指定每个连接上PSCache的大小（Oracle使用）</span></span><br><span class="line"><span class="comment">     &lt;property name="poolPreparedStatements" value="true" /&gt;</span></span><br><span class="line"><span class="comment">     &lt;property name="maxPoolPreparedStatementPerConnectionSize" value="20" /&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">&lt;!-- 配置监控统计拦截的filters --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"filters"</span> <span class="attr">value</span>=<span class="string">"stat"</span> /&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="3-在web-xml中配置监控页面"><a href="#3-在web-xml中配置监控页面" class="headerlink" title="3.在web.xml中配置监控页面"></a>3.在web.xml中配置监控页面</h5><pre><code class="xml"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span>    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DruidStatView<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span>    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.alibaba.druid.support.http.StatViewServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span>    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DruidStatView<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span>    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/druid/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></code></pre><p>最后打开<a href="http://localhost:8080/{youwebname}/druid/index.html" target="_blank" rel="noopener">http://localhost:8080/{youwebname}/druid/index.html</a> 就可以看到内置监控页面。如下图。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/druid.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Druid简单配置&quot;&gt;&lt;a href=&quot;#Druid简单配置&quot; class=&quot;headerlink&quot; title=&quot;Druid简单配置&quot;&gt;&lt;/a&gt;Druid简单配置&lt;/h3&gt;&lt;p&gt;这里只是最简单的配置，更多详细的配置可以去&lt;a href=&quot;https://github.com/alibaba/druid/wiki/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;druid&lt;/a&gt;查看。&lt;br&gt;
    
    </summary>
    
      <category term="java" scheme="http://lj360560179.github.io/categories/java/"/>
    
    
      <category term="java" scheme="http://lj360560179.github.io/tags/java/"/>
    
      <category term="数据库" scheme="http://lj360560179.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>2016.8.19</title>
    <link href="http://lj360560179.github.io/2016/08/19/%E9%9D%A2%E8%AF%95%E8%AE%B0%E5%BD%952/"/>
    <id>http://lj360560179.github.io/2016/08/19/面试记录2/</id>
    <published>2016-08-19T04:34:14.000Z</published>
    <updated>2018-09-06T09:35:14.874Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1-索引的优缺点"><a href="#1-索引的优缺点" class="headerlink" title="1.索引的优缺点"></a>1.索引的优缺点</h3><p>优点：  </p><ul><li>通过创建唯一性索引，可以保证数据库表中每一行数据的唯一性。   </li><li>可以大大加快数据的检索速度，这也是创建索引的最主要的原因。   </li><li>可以加速表和表之间的连接，特别是在实现数据的参考完整性方面特别有意义。   </li><li>在使用分组和排序 子句进行数据检索时，同样可以显著减少查询中分组和排序的时间。  </li><li>通过使用索引，可以在查询的过程中，使用优化隐藏器，提高系统的性能。    <a id="more"></a>缺点：</li><li>创建索引和维护索引要耗费时间，这种时间随着数据量的增加而增加。  </li><li>索引需要占物理空间，除了数据表占数据空间之外，每一个索引还要占一定的物理空间，如果要建立聚簇索引，那么需要的空间就会更大。 </li><li>当对表中的数据进行增加、删除和修改的时候，索引也要动态的维护，这样就降低了数据的维护速度。 </li></ul><p>&ensp;&ensp;索引是建立在数据库表中的某些列的上面。因此，在创建索引的时候，应该仔细考虑在哪些列上可以创建索引，在哪些列上不能创建索引。一般来说，应该在这些列上创建索引，例如： </p><ul><li>在经常需要搜索的列上，可以加快搜索的速度； </li><li>在作为主键的列上，强制该列的唯一性和组织表中数据的排列结构； </li><li>在经常用在连接的列上，这些列主要是一些外键，可以加快连接的速度；</li><li>在经常需要根据范围进行搜索的列上创建索引，因为索引已经排序，其指定的范围是连续的；  </li><li>在经常需要排序的列上创建索引，因为索引已经排序，这样查询可以利用索引的排序，加快排序查询时间； </li><li>在经常使用在WHERE子句中的列上面创建索引，加快条件的判断速度。</li></ul><h3 id="2-int-跟-Ingter"><a href="#2-int-跟-Ingter" class="headerlink" title="2.int 跟 Ingter"></a>2.int 跟 Ingter</h3><p>&ensp;&ensp;int与integer的区别从大的方面来说就是基本数据类型与其包装类的区别：<br>int 是基本类型，直接存数值，而integer是对象，用一个引用指向这个对象;</p><ul><li>Java 中的数据类型分为基本数据类型和复杂数据类型,int 是前者而integer 是后者（也就是一个类）；因此在类进行初始化时int类的变量初始为0.而Integer的变量则初始化为null.</li><li>初始化的时候<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> i =<span class="number">1</span>；</span><br><span class="line">Integer i= <span class="keyword">new</span> Integer(<span class="number">1</span>);<span class="comment">//(要把integer当做一个类看)；</span></span><br></pre></td></tr></table></figure></li></ul><p>&ensp;&ensp;但由于有了自动装箱和拆箱，int 是基本数据类型（面向过程留下的痕迹，不过是对java的有益补充），Integer 是一个类，是int的扩展，定义了很多的转换方法，类似的还有：float Float;double Double;string String等，而且还提供了处理 int 类型时非常有用的其他一些常量和方法。<br>举个例子：当需要往ArrayList，HashMap中放东西时，像int，double这种内建类型是放不进去的，因为容器都是装 object的，这是就需要这些内建类型的外覆类了。Java中每种内建类型都有相应的外覆类。<br>Java中int和Integer关系是比较微妙的。关系如下：</p><ul><li>int是基本的数据类型；</li><li>Integer是int的封装类；</li><li>int和Integer都可以表示某一个数值；</li><li>int和Integer不能够互用，因为他们两种不同的数据类型；</li><li>并且泛型定义时也不支持int: 如：List<integer> list = new ArrayList<integer>();可以  而List<int> list = new ArrayList<int>();则不行</int></int></integer></integer></li></ul><h3 id="3-时间日期格式"><a href="#3-时间日期格式" class="headerlink" title="3.时间日期格式"></a>3.时间日期格式</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yyyy-MM-dd HH:mm:ss &gt;&gt;&gt; yyyy年MM月dd日HH时mm分ss秒</span><br></pre></td></tr></table></figure><h3 id="4-JDK-JRE-JVM"><a href="#4-JDK-JRE-JVM" class="headerlink" title="4.JDK,JRE,JVM"></a>4.JDK,JRE,JVM</h3><h4 id="JDK"><a href="#JDK" class="headerlink" title="JDK"></a>JDK</h4><p>&ensp;&ensp;JDK是Java开发工具包，是Sun Microsystems针对Java开发员的产品。<br>&ensp;&ensp;JDK中包含JRE，在JDK的安装目录下有一个名为jre的目录，里面有两个文件夹bin和lib，在这里可以认为bin里的就是jvm，lib中则是<br>&ensp;&ensp;jvm工作所需要的类库，而jvm和 lib和起来就称为jre。<br>JDK是整个JAVA的核心，包括了Java运行环境JRE（Java Runtime Envirnment）、一堆Java工具（javac/java/jdb等）和Java基础的类库（即Java API 包括rt.jar）。  </p><h4 id="Java-Runtime-Environment（JRE）"><a href="#Java-Runtime-Environment（JRE）" class="headerlink" title="Java Runtime Environment（JRE）"></a>Java Runtime Environment（JRE）</h4><p>&ensp;&ensp;是运行基于Java语言编写的程序所不可缺少的运行环境。也是通过它，Java的开发者才得以将自己开发的程序发布到用户手中，让用户使用。<br>&ensp;&ensp;RE中包含了Java virtual machine（JVM），runtime class libraries和Java application    launcher，这些是运行Java程序的必要组件。<br>&ensp;&ensp;与大家熟知的JDK不同，JRE是Java运行环境，并不是一个开发环境，所以没有包含任何开发工具（如编译器和调试器），只是针对于使用Java程序的用户。   </p><h4 id="JVM（java-virtual-machine）"><a href="#JVM（java-virtual-machine）" class="headerlink" title="JVM（java virtual machine）"></a>JVM（java virtual machine）</h4><p>&ensp;&ensp;就是我们常说的java虚拟机，它是整个java实现跨平台的最核心的部分，所有的java程序会首先被编译为.class的类文件，这种类文件可以在虚拟机上执行。</p><h3 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h3><p>&ensp;&ensp;上面的答案都是百度来的！</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;1-索引的优缺点&quot;&gt;&lt;a href=&quot;#1-索引的优缺点&quot; class=&quot;headerlink&quot; title=&quot;1.索引的优缺点&quot;&gt;&lt;/a&gt;1.索引的优缺点&lt;/h3&gt;&lt;p&gt;优点：  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;通过创建唯一性索引，可以保证数据库表中每一行数据的唯一性。   &lt;/li&gt;
&lt;li&gt;可以大大加快数据的检索速度，这也是创建索引的最主要的原因。   &lt;/li&gt;
&lt;li&gt;可以加速表和表之间的连接，特别是在实现数据的参考完整性方面特别有意义。   &lt;/li&gt;
&lt;li&gt;在使用分组和排序 子句进行数据检索时，同样可以显著减少查询中分组和排序的时间。  &lt;/li&gt;
&lt;li&gt;通过使用索引，可以在查询的过程中，使用优化隐藏器，提高系统的性能。
    
    </summary>
    
      <category term="java" scheme="http://lj360560179.github.io/categories/java/"/>
    
    
      <category term="java" scheme="http://lj360560179.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>2016.8.17</title>
    <link href="http://lj360560179.github.io/2016/08/17/%E9%9D%A2%E8%AF%95%E8%AE%B0%E5%BD%95/"/>
    <id>http://lj360560179.github.io/2016/08/17/面试记录/</id>
    <published>2016-08-16T16:34:14.000Z</published>
    <updated>2018-09-06T09:35:14.873Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1-事务"><a href="#1-事务" class="headerlink" title="1.事务"></a>1.事务</h3><p>&ensp;&ensp;&ensp;&ensp;事务(Transaction)是访问并可能更新数据库中各种数据项的一个程序执行单元(unit)。事务通常由高级数据库操纵语言或编程语言（如SQL，C++或Java）书写的用户程序的执行所引起，并用形如begin transaction和end transaction语句（或函数调用）来界定。事务由事务开始(begin transaction)和事务结束(end transaction)之间执行的全体操作组成。（抄百度的）<br>事务是恢复和并发控制的基本单位。<br><a id="more"></a><br>四个特性<br>&ensp;&ensp;&ensp;&ensp;事务应该具有4个属性：原子性、一致性、隔离性、持续性。这四个属性通常称为ACID特性。<br>&ensp;&ensp;&ensp;&ensp;原子性（atomicity）。一个事务是一个不可分割的工作单位，事务中包括的诸操作要么都做，要么都不做。<br>&ensp;&ensp;&ensp;&ensp;一致性（consistency）。事务必须是使数据库从一个一致性状态变到另一个一致性状态。一致性与原子性是密切相关的。<br>&ensp;&ensp;&ensp;&ensp;隔离性（isolation）。一个事务的执行不能被其他事务干扰。即一个事务内部的操作及使用的数据对并发的其他事务是隔离的，并发执行的各个事务之间不能互相干扰。<br>&ensp;&ensp;&ensp;&ensp;持久性（durability）。持续性也称永久性（permanence），指一个事务一旦提交，它对数据库中数据的改变就应该是永久性的。接下来的其他操作或故障不应该对其有任何影响。</p><h3 id="2-乐观锁和悲观锁"><a href="#2-乐观锁和悲观锁" class="headerlink" title="2.乐观锁和悲观锁"></a>2.乐观锁和悲观锁</h3><p>&ensp;&ensp;&ensp;&ensp;悲观锁(Pessimistic Lock), 顾名思义，就是很悲观，每次去拿数据的时候都认为别人会修改，所以每次在拿数据的时候都会上锁，这样别人想拿这个数据就会block直到它拿到锁。传统的关系型数据库里边就用到了很多这种锁机制，比如行锁，表锁等，读锁，写锁等，都是在做操作之前先上锁。<br>&ensp;&ensp;&ensp;&ensp;乐观锁(Optimistic Lock), 顾名思义，就是很乐观，每次去拿数据的时候都认为别人不会修改，所以不会上锁，但是在更新的时候会判断一下在此期间别人有没有去更新这个数据，可以使用版本号等机制。乐观锁适用于多读的应用类型，这样可以提高吞吐量，像数据库如果提供类似于write_condition机制的其实都是提供的乐观锁。  </p><h3 id="init-method-destroy-method"><a href="#init-method-destroy-method" class="headerlink" title="init-method/destroy-method"></a>init-method/destroy-method</h3><p>&ensp;&ensp;&ensp;&ensp;在spring  容器初始化 bean 和销毁前所做的操作。定义方式有三种。<br>&ensp;&ensp;&ensp;&ensp;第一种：通过@PostConstruct 和 @PreDestroy 方法 实现初始化和销毁bean之前进行的操作<br>&ensp;&ensp;&ensp;&ensp;第二种是：通过 在xml中定义init-method 和  destory-method方法<br>&ensp;&ensp;&ensp;&ensp;第三种是： 通过bean实现InitializingBean和 DisposableBean接口   </p><p>&ensp;&ensp;&ensp;&ensp;在xml中配置 init-method和 destory-method方法<br>&ensp;&ensp;&ensp;&ensp;只是定义spring 容器在初始化bean 和容器销毁之前的所做的操作<br>&ensp;&ensp;&ensp;&ensp;基于xml的配置只是一种方式：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"XXXXXXService"</span> <span class="attr">class</span>=<span class="string">"com.XXX.XXXService"</span> <span class="attr">scope</span>=<span class="string">"singleton"</span>  <span class="attr">init-method</span>=<span class="string">"初始方法"</span>  <span class="attr">destroy-method</span>=<span class="string">"销毁方法"</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>&ensp;&ensp;&ensp;&ensp;其中如果在<bean>中指定Bean的作用范围为scope=”prototype”,将Bean返回给调用者,调用者负责Bean后续生命的管理,spring不再管理这些Bean的生命周期.如果作用范围设置为scope=”singleton”,则将Bean放入SpringIOC容器的缓存池中,并将Bean引用返回给调用者,spring继续对这些Bean进行后续的生命管理.默认属性是singleton。<br>&ensp;&ensp;&ensp;&ensp;Bean以两种形态存在：singletons形式和prototypes形式。当bean以singletons形态存在时，BeanFactory只管理一个共享的实例。所有对这个特定bean的实例请求，都导致返回这个唯一bean实例的引用。当bean以prototype形态存在时，每次对这个bean的实例请求都会导致一个新的实例的创建。当用户需要不受其他用户对象影响的对象或有类似的需求时，这是一个较理想的解决办法。Bean默认是以singleton形态存在的，除非你另外显式加以指定。留神，当把bean的设置改为prototype模式时，每次对这个bean的实例请求都会导致一个新的bean实例被创建，而这可能并不是你所期望的。所以，只应该在确实需要的情况下把bean设置为prototype模式</bean></p><h3 id="4-给你一个字段，怎么查找是数据库中的那张表"><a href="#4-给你一个字段，怎么查找是数据库中的那张表" class="headerlink" title="4.给你一个字段，怎么查找是数据库中的那张表"></a>4.给你一个字段，怎么查找是数据库中的那张表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> table_name <span class="keyword">from</span> dba_tab_columns <span class="keyword">where</span> column_name=<span class="string">'字段名（大写）'</span></span><br></pre></td></tr></table></figure><h3 id="5-springMVC中controller是不是单例的，怎么变成多例"><a href="#5-springMVC中controller是不是单例的，怎么变成多例" class="headerlink" title="5.springMVC中controller是不是单例的，怎么变成多例"></a>5.springMVC中controller是不是单例的，怎么变成多例</h3><p>&ensp;&ensp;&ensp;&ensp;为了性能，Spring Mvc默认是单例的。但是也可以设置成多例，在controller添加@Scope(“prototype”)注解。<br>因此不要在controller中定义成员变量，万一必须要定义一个非静态成员变量时候，则通过注解@Scope(“prototype”)，将其设置为多例模式。</p><h3 id="6-Spring什么时候实例化bean"><a href="#6-Spring什么时候实例化bean" class="headerlink" title="6.Spring什么时候实例化bean"></a>6.Spring什么时候实例化bean</h3><p>首先要分2种情况<br>&ensp;&ensp;&ensp;&ensp;第一：如果你使用BeanFactory作为Spring Bean的工厂类，则所有的bean都是在第一次使用该Bean的时候实例化<br>&ensp;&ensp;&ensp;&ensp;第二：如果你使用ApplicationContext作为Spring Bean的工厂类，则又分为以下几种情况：<br>&ensp;&ensp;&ensp;&ensp;（1）：如果bean的scope是singleton的，并且lazy-init为false（默认是false，所以可以不用设置），则ApplicationContext启动的时候就实例化该Bean，并且将实例化的Bean放在一个map结构的缓存中，下次再使用该Bean的时候，直接从这个缓存中取<br>&ensp;&ensp;&ensp;&ensp;（2）：如果bean的scope是singleton的，并且lazy-init为true，则该Bean的实例化是在第一次使用该Bean的时候进行实例化<br>&ensp;&ensp;&ensp;&ensp;（3）：如果bean的scope是prototype的，则该Bean的实例化是在第一次使用该Bean的时候进行实例化<br><img src="http://ni484sha.com/images/basedata.png" alt=""> </p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;1-事务&quot;&gt;&lt;a href=&quot;#1-事务&quot; class=&quot;headerlink&quot; title=&quot;1.事务&quot;&gt;&lt;/a&gt;1.事务&lt;/h3&gt;&lt;p&gt;&amp;ensp;&amp;ensp;&amp;ensp;&amp;ensp;事务(Transaction)是访问并可能更新数据库中各种数据项的一个程序执行单元(unit)。事务通常由高级数据库操纵语言或编程语言（如SQL，C++或Java）书写的用户程序的执行所引起，并用形如begin transaction和end transaction语句（或函数调用）来界定。事务由事务开始(begin transaction)和事务结束(end transaction)之间执行的全体操作组成。（抄百度的）&lt;br&gt;事务是恢复和并发控制的基本单位。&lt;br&gt;
    
    </summary>
    
      <category term="java" scheme="http://lj360560179.github.io/categories/java/"/>
    
    
      <category term="java" scheme="http://lj360560179.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>Spring Boot + Spring-data-jpa简单例子</title>
    <link href="http://lj360560179.github.io/2016/07/25/SpringBoot+Spring-data-jpa/"/>
    <id>http://lj360560179.github.io/2016/07/25/SpringBoot+Spring-data-jpa/</id>
    <published>2016-07-25T07:44:14.000Z</published>
    <updated>2018-09-06T09:35:14.859Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Spring-Boot-Spring-data-jpa"><a href="#Spring-Boot-Spring-data-jpa" class="headerlink" title="Spring Boot + Spring-data-jpa"></a>Spring Boot + Spring-data-jpa</h3><p>这两个框架都没用过，平时上网查资料听的也比较多，有时间就自己整合一下，关于Spring Boot，<a href="https://github.com/spring-projects/spring-boot/tree/master/spring-boot-samples" target="_blank" rel="noopener">这里</a>有很多跟其他框架整合的例子。<br><a id="more"></a></p><h5 id="1-SpringBoot基础项目"><a href="#1-SpringBoot基础项目" class="headerlink" title="1.SpringBoot基础项目"></a>1.SpringBoot基础项目</h5><p>先把Spring boot的基础项目跑起来。参考两个大神的博客<a href="http://www.bysocket.com/?p=1124" target="_blank" rel="noopener">这里1</a>和<a href="http://blog.didispace.com/tag/spring-boot/page/4/" target="_blank" rel="noopener">这里2</a>,第二个大神的博客里面有很多关于springboot的文章，包括<a href="http://blog.didispace.com/springbootdata2/" target="_blank" rel="noopener">Spring Boot + Spring-data-jpa</a><br>首先新建一个maven基础项目，可以通过idea也可以通过命令新建<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn archetype:generate -DgroupId=springboot -DartifactId=springboot-example -DarchetypeArtifactId=maven-archetype-quickstart -DinteractiveMode=false</span><br></pre></td></tr></table></figure></p><h5 id="2-SpringBoot-pom-xml"><a href="#2-SpringBoot-pom-xml" class="headerlink" title="2.SpringBoot pom.xml"></a>2.SpringBoot pom.xml</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>springboot-example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springboot-example<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>springboot-example Maven Webapp<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.apache.org<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- Inherit defaults from Spring Boot --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Spring Boot web依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 单元测试 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>springboot-example<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="3-新建一个实体entity"><a href="#3-新建一个实体entity" class="headerlink" title="3.新建一个实体entity"></a>3.新建一个实体entity</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lj.entity;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by LJ on 2016/8/2.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String name, Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="4-controller"><a href="#4-controller" class="headerlink" title="4.controller"></a>4.controller</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lj.controller;</span><br><span class="line"><span class="keyword">import</span> com.lj.entity.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by LJ on 2016/8/2.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/user"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试添加用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">view</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Long id) </span>&#123;</span><br><span class="line">        Integer i = <span class="keyword">new</span> Integer(Long.toString(id));</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setName(<span class="string">"zhang"</span>);</span><br><span class="line">        user.setAge(i);</span><br><span class="line">        userRepository.save(user);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="5-启动应用类Application-java"><a href="#5-启动应用类Application-java" class="headerlink" title="5.启动应用类Application.java"></a>5.启动应用类Application.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lj;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.EnableAutoConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by LJ on 2016/8/2.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(Application.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此时 右键运行Application，在浏览器中输入localhost:8080/user/1就可以看到返回的user。</p><h5 id="6-加入Spring-data-jpa"><a href="#6-加入Spring-data-jpa" class="headerlink" title="6.加入Spring-data-jpa"></a>6.加入Spring-data-jpa</h5><p>修改pom.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>springboot-example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springboot-example<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>springboot-example Maven Webapp<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.apache.org<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- Inherit defaults from Spring Boot --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Spring Boot web依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>springboot-example<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>修改user.java。添加注解<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lj.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.Column;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by LJ on 2016/8/2.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(nullable = <span class="keyword">false</span>)</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(nullable = <span class="keyword">false</span>)</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String name, Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>修改controller方便测试。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lj.controller;</span><br><span class="line"><span class="keyword">import</span> com.lj.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.lj.entity.UserRepository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by LJ on 2016/8/2.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/user"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试添加用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">view</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Long id) </span>&#123;</span><br><span class="line">        Integer i = <span class="keyword">new</span> Integer(Long.toString(id));</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setName(<span class="string">"zhang"</span>);</span><br><span class="line">        user.setAge(i);</span><br><span class="line">        userRepository.save(user);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试查找所有用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/list"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;User&gt; list = <span class="keyword">new</span> ArrayList&lt;User&gt;();</span><br><span class="line">        list = userRepository.findAll();</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试通过名字查找用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/name/&#123;name&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">name</span><span class="params">(@PathVariable(<span class="string">"name"</span>)</span> String name)</span>&#123;</span><br><span class="line">        User user = userRepository.findByName(name);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h5 id="7-resources下新建配置文件application-properties"><a href="#7-resources下新建配置文件application-properties" class="headerlink" title="7.resources下新建配置文件application.properties"></a>7.resources下新建配置文件application.properties</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">spring.datasource.url=jdbc:mysql://localhost:3306/springboot</span><br><span class="line">spring.datasource.username=root</span><br><span class="line">spring.datasource.password=110110</span><br><span class="line">spring.datasource.driver-class-name=com.mysql.jdbc.Driver</span><br><span class="line"></span><br><span class="line">spring.jpa.properties.hibernate.hbm2ddl.auto=create-drop</span><br></pre></td></tr></table></figure><p>根据自己情况修改帐号密码  spring.jpa.properties.hibernate.hbm2ddl.auto=create-drop是hibernate的配置参数<br>create：表示启动的时候先drop，再create<br>create-drop: 也表示创建，只不过再系统关闭前执行一下drop<br>update: 这个操作启动的时候会去检查schema是否一致，如果不一致会做scheme更新<br>更多详细的可以去网上查找资料</p><h5 id="8-JpaRepository"><a href="#8-JpaRepository" class="headerlink" title="8.JpaRepository"></a>8.JpaRepository</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lj.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.Query;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.repository.query.Param;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by LJ on 2016/8/3.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">User</span>, <span class="title">Long</span>&gt;</span>&#123;</span><br><span class="line">    <span class="function">User <span class="title">findByName</span><span class="params">(String name)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function">User <span class="title">findByNameAndAge</span><span class="params">(String name, Integer age)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"from User u where u.name=:name"</span>)</span><br><span class="line">    <span class="function">User <span class="title">findUser</span><span class="params">(@Param(<span class="string">"name"</span>)</span> String name)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样就完成了，启动Application，打开controller相应的连接就能看到返回结果。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/springboot1.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/springboot2.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/springboot3.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><br><a href="https://github.com/lj360560179/springboot-example" target="_blank" rel="noopener">最后放上源码地址</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Spring-Boot-Spring-data-jpa&quot;&gt;&lt;a href=&quot;#Spring-Boot-Spring-data-jpa&quot; class=&quot;headerlink&quot; title=&quot;Spring Boot + Spring-data-jpa&quot;&gt;&lt;/a&gt;Spring Boot + Spring-data-jpa&lt;/h3&gt;&lt;p&gt;这两个框架都没用过，平时上网查资料听的也比较多，有时间就自己整合一下，关于Spring Boot，&lt;a href=&quot;https://github.com/spring-projects/spring-boot/tree/master/spring-boot-samples&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;这里&lt;/a&gt;有很多跟其他框架整合的例子。&lt;br&gt;
    
    </summary>
    
      <category term="java" scheme="http://lj360560179.github.io/categories/java/"/>
    
    
      <category term="java" scheme="http://lj360560179.github.io/tags/java/"/>
    
      <category term="Spring Boot" scheme="http://lj360560179.github.io/tags/Spring-Boot/"/>
    
      <category term="Spring-data-jpa" scheme="http://lj360560179.github.io/tags/Spring-data-jpa/"/>
    
  </entry>
  
  <entry>
    <title>Spring+activemq</title>
    <link href="http://lj360560179.github.io/2016/07/25/spring+activemq/"/>
    <id>http://lj360560179.github.io/2016/07/25/spring+activemq/</id>
    <published>2016-07-25T07:44:14.000Z</published>
    <updated>2018-09-06T09:35:14.867Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-新建项目"><a href="#1-新建项目" class="headerlink" title="1.新建项目"></a>1.新建项目</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn archetype:generate -DgroupId=springboot -DartifactId=springboot-example -DarchetypeArtifactId=maven-archetype-quickstart -DinteractiveMode=false</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="2-pom-xml"><a href="#2-pom-xml" class="headerlink" title="2.pom.xml"></a>2.pom.xml</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>spring-acticemq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-acticemq<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>spring-acticemq Maven Webapp<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.apache.org<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 使用junit4.0 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--Spring--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--spring test--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- activemq --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.activemq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activemq-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.activemq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activemq-pool<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jms<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>spring-acticemq<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="3-spring-activemq-xml"><a href="#3-spring-activemq-xml" class="headerlink" title="3.spring-activemq.xml"></a>3.spring-activemq.xml</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:amq</span>=<span class="string">"http://activemq.apache.org/schema/core"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://activemq.apache.org/schema/core http://activemq.apache.org/schema/core/activemq-core-5.8.0.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Activemq 连接工厂 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"activeMQConnectionFactory"</span> <span class="attr">class</span>=<span class="string">"org.apache.activemq.ActiveMQConnectionFactory"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"system1"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"manager1"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"failover:(tcp://localhost:61616)?timeout=10000"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ConnectionFactory Definition --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"connectionFactory"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">"org.springframework.jms.connection.CachingConnectionFactory"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">"activeMQConnectionFactory"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Default Destination Queue Definition --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 测试配置多个Destination --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- P2P START--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"queueDestination"</span> <span class="attr">class</span>=<span class="string">"org.apache.activemq.command.ActiveMQQueue"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 设置消息队列的名字 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>testSpringQueue<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--  topic--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"topicDestination"</span> <span class="attr">class</span>=<span class="string">"org.apache.activemq.command.ActiveMQTopic"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 设置消息队列的名字 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>testSpringTopic<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置JMS模板（Queue），Spring提供的JMS工具类，它发送、接收消息。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jmsTemplateQueue"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jms.core.JmsTemplate"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectionFactory"</span> <span class="attr">ref</span>=<span class="string">"connectionFactory"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultDestination"</span> <span class="attr">ref</span>=<span class="string">"queueDestination"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"receiveTimeout"</span> <span class="attr">value</span>=<span class="string">"10000"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置JMS模板（Topic），Spring提供的JMS工具类，它发送、接收消息。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jmsTemplateTopic"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jms.core.JmsTemplate"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectionFactory"</span> <span class="attr">ref</span>=<span class="string">"connectionFactory"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultDestination"</span> <span class="attr">ref</span>=<span class="string">"topicDestination"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"receiveTimeout"</span> <span class="attr">value</span>=<span class="string">"10000"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Message Sender Definition --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Queue--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"messageSender"</span> <span class="attr">class</span>=<span class="string">"com.lj.activemq.publisher.MessageSender"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">ref</span>=<span class="string">"jmsTemplateQueue"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"1"</span> <span class="attr">ref</span>=<span class="string">"queueDestination"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Message Sender Definition --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Topic--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"messageSenderTopic"</span> <span class="attr">class</span>=<span class="string">"com.lj.activemq.publisher.MessageSenderTopic"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">ref</span>=<span class="string">"jmsTemplateTopic"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"1"</span> <span class="attr">ref</span>=<span class="string">"topicDestination"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置消息消费监听者 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Queue--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"consumerMessageListenerQueue"</span> <span class="attr">class</span>=<span class="string">"com.lj.activemq.consumer.MessageReceiver"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 消息监听容器，配置连接工厂,监听器是上面定义的监听器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jmsContainerQueue"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jms.listener.DefaultMessageListenerContainer"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectionFactory"</span> <span class="attr">ref</span>=<span class="string">"connectionFactory"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"destination"</span> <span class="attr">ref</span>=<span class="string">"queueDestination"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--主题（Topic）和队列消息的主要差异体现在JmsTemplate中"pubSubDomain"是否设置为True。如果为True，则是Topic；如果是false或者默认，则是queue--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"pubSubDomain"</span> <span class="attr">value</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"messageListener"</span> <span class="attr">ref</span>=<span class="string">"consumerMessageListenerQueue"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置消息消费监听者 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Topic--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"consumerMessageListenerTopic"</span> <span class="attr">class</span>=<span class="string">"com.lj.activemq.consumer.MessageReceiverTopic1"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"consumerMessageListenerTopic2"</span> <span class="attr">class</span>=<span class="string">"com.lj.activemq.consumer.MessageReceiverTopic2"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 消息监听容器，配置连接工厂,监听器是上面定义的监听器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jmsContainer"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jms.listener.DefaultMessageListenerContainer"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectionFactory"</span> <span class="attr">ref</span>=<span class="string">"connectionFactory"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"destination"</span> <span class="attr">ref</span>=<span class="string">"topicDestination"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--主题（Topic）和队列消息的主要差异体现在JmsTemplate中"pubSubDomain"是否设置为True。如果为True，则是Topic；如果是false或者默认，则是queue--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"pubSubDomain"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"messageListener"</span> <span class="attr">ref</span>=<span class="string">"consumerMessageListenerTopic"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jmsContainer2"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jms.listener.DefaultMessageListenerContainer"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectionFactory"</span> <span class="attr">ref</span>=<span class="string">"connectionFactory"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"destination"</span> <span class="attr">ref</span>=<span class="string">"topicDestination"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--主题（Topic）和队列消息的主要差异体现在JmsTemplate中"pubSubDomain"是否设置为True。如果为True，则是Topic；如果是false或者默认，则是queue--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"pubSubDomain"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"messageListener"</span> <span class="attr">ref</span>=<span class="string">"consumerMessageListenerTopic2"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="4-publisher"><a href="#4-publisher" class="headerlink" title="4.publisher"></a>4.publisher</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lj.activemq.publisher;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jms.core.JmsTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.jms.Destination;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by LJ on 2016/8/27.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by LJ on 2016/8/25.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageSender</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JmsTemplate jmsTemplate;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Destination destination;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MessageSender</span><span class="params">(<span class="keyword">final</span> JmsTemplate jmsTemplate, <span class="keyword">final</span> Destination destination)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.jmsTemplate = jmsTemplate;</span><br><span class="line">        <span class="keyword">this</span>.destination = destination;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(<span class="keyword">final</span> String text)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            jmsTemplate.setDefaultDestination(destination);</span><br><span class="line">            jmsTemplate.convertAndSend(text);</span><br><span class="line">            System.out.println(<span class="string">"发送消息 : "</span> + text);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-consumer"><a href="#5-consumer" class="headerlink" title="5.consumer"></a>5.consumer</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lj.activemq.consumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.jms.JMSException;</span><br><span class="line"><span class="keyword">import</span> javax.jms.Message;</span><br><span class="line"><span class="keyword">import</span> javax.jms.MessageListener;</span><br><span class="line"><span class="keyword">import</span> javax.jms.TextMessage;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by LJ on 2016/8/27.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageReceiver</span> <span class="keyword">implements</span> <span class="title">MessageListener</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(Message message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (message <span class="keyword">instanceof</span> TextMessage) &#123;</span><br><span class="line">            TextMessage textMessage = (TextMessage) message;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                String text = textMessage.getText();</span><br><span class="line">                System.out.println(<span class="string">"点对点消费者接收到消息: "</span> + text);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="地址"><a href="#地址" class="headerlink" title="地址"></a>地址</h2><p><a href="https://github.com/lj360560179/spring-activemq" target="_blank" rel="noopener">地址</a>  </p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;1-新建项目&quot;&gt;&lt;a href=&quot;#1-新建项目&quot; class=&quot;headerlink&quot; title=&quot;1.新建项目&quot;&gt;&lt;/a&gt;1.新建项目&lt;/h2&gt;&lt;figure class=&quot;highlight cmd&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;mvn archetype:generate -DgroupId=springboot -DartifactId=springboot-example -DarchetypeArtifactId=maven-archetype-quickstart -DinteractiveMode=false&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="java" scheme="http://lj360560179.github.io/categories/java/"/>
    
    
      <category term="java" scheme="http://lj360560179.github.io/tags/java/"/>
    
      <category term="Spring" scheme="http://lj360560179.github.io/tags/Spring/"/>
    
      <category term="activemq" scheme="http://lj360560179.github.io/tags/activemq/"/>
    
  </entry>
  
  <entry>
    <title>百度推送连接</title>
    <link href="http://lj360560179.github.io/2016/07/19/Baidu/"/>
    <id>http://lj360560179.github.io/2016/07/19/Baidu/</id>
    <published>2016-07-19T04:34:14.000Z</published>
    <updated>2018-09-06T09:35:14.854Z</updated>
    
    <content type="html"><![CDATA[<p>很久前 参考 网上列子 写的一个把连接推送到百度东西<br><a id="more"></a></p><h3 id="相关代码"><a href="#相关代码" class="headerlink" title="相关代码"></a>相关代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> args </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Curlpost</span><span class="params">(String path)</span> </span>&#123;  </span><br><span class="line">    String url = <span class="string">"http://data.zz.baidu.com/urls?site=www.example.com&amp;token=xxxxxxxxx&amp;type=original"</span>;<span class="comment">//网站的服务器连接  </span></span><br><span class="line">    String[] param = &#123;  </span><br><span class="line">            <span class="string">"http://www.example.com/"</span>+path+<span class="string">""</span><span class="comment">//需要推送的网址  </span></span><br><span class="line">    &#125;;  </span><br><span class="line">    String json = Post(url, param);<span class="comment">//执行推送方法  </span></span><br><span class="line">    System.out.println(<span class="string">"结果是"</span>+json);  <span class="comment">//打印推送结果   </span></span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * 百度链接实时推送 </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> PostUrl </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> Parameters </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">Post</span><span class="params">(String PostUrl,String[] Parameters)</span></span>&#123;  </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">null</span> == PostUrl || <span class="keyword">null</span> == Parameters || Parameters.length ==<span class="number">0</span>)&#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    String result=<span class="string">""</span>;  </span><br><span class="line">    PrintWriter out=<span class="keyword">null</span>;  </span><br><span class="line">    BufferedReader in=<span class="keyword">null</span>;  </span><br><span class="line">    <span class="keyword">try</span> &#123;  </span><br><span class="line">        <span class="comment">//建立URL之间的连接  </span></span><br><span class="line">        URLConnection conn=<span class="keyword">new</span> URL(PostUrl).openConnection();  </span><br><span class="line">        <span class="comment">//设置通用的请求属性  </span></span><br><span class="line">        conn.setRequestProperty(<span class="string">"Host"</span>,<span class="string">"data.zz.baidu.com"</span>);  </span><br><span class="line">        conn.setRequestProperty(<span class="string">"User-Agent"</span>, <span class="string">"curl/7.12.1"</span>);  </span><br><span class="line">        conn.setRequestProperty(<span class="string">"Content-Length"</span>, <span class="string">"83"</span>);  </span><br><span class="line">        conn.setRequestProperty(<span class="string">"Content-Type"</span>, <span class="string">"text/plain"</span>);  </span><br><span class="line">           </span><br><span class="line">        <span class="comment">//发送POST请求必须设置如下两行  </span></span><br><span class="line">        conn.setDoInput(<span class="keyword">true</span>);  </span><br><span class="line">        conn.setDoOutput(<span class="keyword">true</span>);  </span><br><span class="line">           </span><br><span class="line">        <span class="comment">//获取conn对应的输出流  </span></span><br><span class="line">        out=<span class="keyword">new</span> PrintWriter(conn.getOutputStream());  </span><br><span class="line">        <span class="comment">//发送请求参数  </span></span><br><span class="line">        String param = <span class="string">""</span>;  </span><br><span class="line">        <span class="keyword">for</span>(String s : Parameters)&#123;  </span><br><span class="line">            param += s+<span class="string">"\n"</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        out.print(param.trim());  </span><br><span class="line">        <span class="comment">//进行输出流的缓冲  </span></span><br><span class="line">        out.flush();  </span><br><span class="line">        <span class="comment">//通过BufferedReader输入流来读取Url的响应  </span></span><br><span class="line">        in=<span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(conn.getInputStream()));  </span><br><span class="line">        String line;  </span><br><span class="line">        <span class="keyword">while</span>((line=in.readLine())!= <span class="keyword">null</span>)&#123;  </span><br><span class="line">            result += line;  </span><br><span class="line">        &#125;  </span><br><span class="line">           </span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">    </span><br><span class="line">        System.out.println(<span class="string">"发送post请求出现异常！"</span>+e);  </span><br><span class="line">        e.printStackTrace();  </span><br><span class="line">    &#125; <span class="keyword">finally</span>&#123;  </span><br><span class="line">        <span class="keyword">try</span>&#123;  </span><br><span class="line">            <span class="keyword">if</span>(out != <span class="keyword">null</span>)&#123;  </span><br><span class="line">                out.close();  </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="keyword">if</span>(in!= <span class="keyword">null</span>)&#123;  </span><br><span class="line">                in.close();  </span><br><span class="line">            &#125;  </span><br><span class="line">               </span><br><span class="line">        &#125;<span class="keyword">catch</span>(IOException ex)&#123;  </span><br><span class="line">            ex.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> result;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;很久前 参考 网上列子 写的一个把连接推送到百度东西&lt;br&gt;
    
    </summary>
    
      <category term="java" scheme="http://lj360560179.github.io/categories/java/"/>
    
    
      <category term="java" scheme="http://lj360560179.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>quartz 使用spring @Scheduled注解执行定时任务</title>
    <link href="http://lj360560179.github.io/2016/06/25/quartz%20%E4%BD%BF%E7%94%A8spring%20@Scheduled%E6%B3%A8%E8%A7%A3%E6%89%A7%E8%A1%8C%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/"/>
    <id>http://lj360560179.github.io/2016/06/25/quartz 使用spring @Scheduled注解执行定时任务/</id>
    <published>2016-06-25T07:44:14.000Z</published>
    <updated>2018-09-06T09:35:14.866Z</updated>
    
    <content type="html"><![CDATA[<h3 id="quartz-使用spring-Scheduled注解执行定时任务"><a href="#quartz-使用spring-Scheduled注解执行定时任务" class="headerlink" title="quartz 使用spring @Scheduled注解执行定时任务"></a>quartz 使用spring @Scheduled注解执行定时任务</h3><h5 id="1-maven依赖"><a href="#1-maven依赖" class="headerlink" title="1.maven依赖"></a>1.maven依赖</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.quartz-scheduler<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>quartz<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.8.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><a id="more"></a><h5 id="2-spring配置"><a href="#2-spring配置" class="headerlink" title="2.spring配置"></a>2.spring配置</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> </span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:task</span>=<span class="string">"http://www.springframework.org/schema/task"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context  </span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/task </span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/task/spring-task.xsd "</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;<span class="name">task:annotation-driven</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:annotation-config</span> /&gt;</span></span><br><span class="line">//配置扫描位置</span><br><span class="line"> <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"org.seckill.quartz"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>xsi:schemaLocation下要加上<br><a href="http://www.springframework.org/schema/task" target="_blank" rel="noopener">http://www.springframework.org/schema/task</a><br><a href="http://www.springframework.org/schema/task/spring-task-3.1.xsd" target="_blank" rel="noopener">http://www.springframework.org/schema/task/spring-task-3.1.xsd</a> </p><h5 id="3-org-seckill-quartz包下的实现类"><a href="#3-org-seckill-quartz包下的实现类" class="headerlink" title="3.org.seckill.quartz包下的实现类"></a>3.org.seckill.quartz包下的实现类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.seckill.quartz;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 业务相关的作业调度</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment">           字段               允许值                           允许的特殊字符</span></span><br><span class="line"><span class="comment">秒 0-59 , - * /</span></span><br><span class="line"><span class="comment">分 0-59 , - * /</span></span><br><span class="line"><span class="comment">小时 0-23 , - * /</span></span><br><span class="line"><span class="comment">日期 1-31 , - * ? / L W C</span></span><br><span class="line"><span class="comment">月份 1-12 或者 JAN-DEC , - * /</span></span><br><span class="line"><span class="comment">星期 1-7 或者 SUN-SAT , - * ? / L C #</span></span><br><span class="line"><span class="comment">年（可选） 留空, 1970-2099 , - * /</span></span><br><span class="line"><span class="comment">*  字符代表所有可能的值</span></span><br><span class="line"><span class="comment">/  字符用来指定数值的增量</span></span><br><span class="line"><span class="comment">L  字符仅被用于天（月）和天（星期）两个子表达式，表示一个月的最后一天或者一个星期的最后一天</span></span><br><span class="line"><span class="comment">6L 可以表示倒数第６天</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BizQuartz</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 每天9点到17点每过1分钟执行</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Scheduled</span>(cron = <span class="string">"0 0/1 9-17 * * ? "</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addUserScore</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.print(<span class="string">"每天9点到17点每过1分钟执行一次"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;quartz-使用spring-Scheduled注解执行定时任务&quot;&gt;&lt;a href=&quot;#quartz-使用spring-Scheduled注解执行定时任务&quot; class=&quot;headerlink&quot; title=&quot;quartz 使用spring @Scheduled注解执行定时任务&quot;&gt;&lt;/a&gt;quartz 使用spring @Scheduled注解执行定时任务&lt;/h3&gt;&lt;h5 id=&quot;1-maven依赖&quot;&gt;&lt;a href=&quot;#1-maven依赖&quot; class=&quot;headerlink&quot; title=&quot;1.maven依赖&quot;&gt;&lt;/a&gt;1.maven依赖&lt;/h5&gt;&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;org.quartz-scheduler&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;quartz&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;1.8.4&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="java" scheme="http://lj360560179.github.io/categories/java/"/>
    
    
      <category term="java" scheme="http://lj360560179.github.io/tags/java/"/>
    
      <category term="quartz" scheme="http://lj360560179.github.io/tags/quartz/"/>
    
  </entry>
  
  <entry>
    <title>node</title>
    <link href="http://lj360560179.github.io/2016/05/25/Node.js%E5%AD%A6%E4%B9%A0%EF%BC%881%EF%BC%89/"/>
    <id>http://lj360560179.github.io/2016/05/25/Node.js学习（1）/</id>
    <published>2016-05-25T07:44:14.000Z</published>
    <updated>2018-09-06T09:35:14.859Z</updated>
    
    <content type="html"><![CDATA[<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><h5 id="单线程"><a href="#单线程" class="headerlink" title="单线程"></a>单线程</h5><p>&ensp;&ensp;&ensp;&ensp;node.js不为每个客户连接创建一个新的线程，仅仅使用一个线程，当有用户连接，就促发一个内部事件，通过费阻塞I/O、事件驱动机制，让Node.js程序宏观上也是并行的。而且没有线程创建、销毁的时间开销。<br><a id="more"></a></p><h5 id="非阻塞I-O"><a href="#非阻塞I-O" class="headerlink" title="非阻塞I/O"></a>非阻塞I/O</h5><p>&ensp;&ensp;&ensp;&ensp;不会等I/O语句结束，而会执行后面的语句。</p><h5 id="事件驱动"><a href="#事件驱动" class="headerlink" title="事件驱动"></a>事件驱动</h5><p>&ensp;&ensp;&ensp;&ensp;不管是新用户的请求，还是老用户的I/O完成，都将以事件方式加入事件环，等待调度。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/node_1.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure></p><h3 id="适合做什么"><a href="#适合做什么" class="headerlink" title="适合做什么"></a>适合做什么</h3><p>&ensp;&ensp;&ensp;&ensp;善于I/O，不善于计算。因为Node.js最擅长的就是任务调度，如果你的业务有很多的CPU计算，实际上也相当于这个计算阻塞了这个单线程，就不适合Node开发。</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;特点&quot;&gt;&lt;a href=&quot;#特点&quot; class=&quot;headerlink&quot; title=&quot;特点&quot;&gt;&lt;/a&gt;特点&lt;/h3&gt;&lt;h5 id=&quot;单线程&quot;&gt;&lt;a href=&quot;#单线程&quot; class=&quot;headerlink&quot; title=&quot;单线程&quot;&gt;&lt;/a&gt;单线程&lt;/h5&gt;&lt;p&gt;&amp;ensp;&amp;ensp;&amp;ensp;&amp;ensp;node.js不为每个客户连接创建一个新的线程，仅仅使用一个线程，当有用户连接，就促发一个内部事件，通过费阻塞I/O、事件驱动机制，让Node.js程序宏观上也是并行的。而且没有线程创建、销毁的时间开销。&lt;br&gt;
    
    </summary>
    
      <category term="前端" scheme="http://lj360560179.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="node.js" scheme="http://lj360560179.github.io/tags/node-js/"/>
    
  </entry>
  
  <entry>
    <title>网站icon图标</title>
    <link href="http://lj360560179.github.io/2016/05/25/icon/"/>
    <id>http://lj360560179.github.io/2016/05/25/icon/</id>
    <published>2016-05-25T04:34:14.000Z</published>
    <updated>2018-09-06T09:35:14.863Z</updated>
    
    <content type="html"><![CDATA[<h2 id="网站icon图标"><a href="#网站icon图标" class="headerlink" title="网站icon图标"></a>网站icon图标</h2><p>之前在学习webpack打包的时候，发现可以将网站ICON图标转化为Base64编码规范的文本字符，然后引入当做背景图片，以前只知道CSS Sprites这种方法来减少网页请求。后来上网了解了一下，原来现在对网站icon已经有了很多优化方法，如：</p><ul><li>CSS Sprites</li><li>字体图标(Icon Font)</li><li>DataURI</li><li>SVG Sprites</li></ul><a id="more"></a><p>其核心依然是减少HTPP请求数。</p><h3 id="CSS-Sprites-雪碧图"><a href="#CSS-Sprites-雪碧图" class="headerlink" title="CSS Sprites(雪碧图)"></a>CSS Sprites(雪碧图)</h3><p>现在大部分网站还是使用这种方法优化网站icon，使用方法也非常简单，网上工具很多。这里列举下这种方式的优缺点，不详细说明。<br>优势：</p><ul><li>减少HTTP请求数</li><li>可以是任意图形，也可以是任意色彩</li><li>兼容性极好</li></ul><p>劣势：</p><ul><li>增加开发时间，增加维护成本，当做好一张图后，想修改是非常麻烦的。</li><li>图片尺寸固定</li></ul><h3 id="字体图标-Icon-Font"><a href="#字体图标-Icon-Font" class="headerlink" title="字体图标(Icon Font)"></a>字体图标(Icon Font)</h3><p>为了解决屏幕分辨率对图标影响的问题，字体图标(Icon Font)就顺势而生了。字体图标是一种全新的设计方式，更为重要的是相比位图而言，使用字体图标可以不受限于屏幕分辨率，冲着这一点就具有非常强的优势，而且字体图标还具有一个优势是，只要适合字体相关的CSS属性都适合字体图标，比如说使用font-size修改图标大小、使用color修改图标颜色、使用text-shadow给图标增加阴影等等。<br>基于这些原因，这种方式用的越来越多。<br>优势：</p><ul><li>减少HTTP请求数</li><li>很容易任意地缩放、改变颜色、产生阴影、可以拥有透明效果、等CSS的支持。</li><li>体积小</li></ul><p>劣势：</p><ul><li>它们只能被渲染成单色或CSS3的渐变色</li><li>使用限制性很大，除非你想花时间去创作你自己的字体图标，</li><li>字体文件体积过大，直接影响页面加载性能，特别是加载一个包含数百图标的Fonts，却只使用其中几个图标</li><li>在不同的设备浏览器字体的渲染会略有差别，在不同的浏览器或系统中对文字的渲染不同，其显示的位置和大小可能会受到font-size、line-height、word-spacing等CSS属性的影响，而且这种影响调整起来较为困难</li><li>为了实现最大程度的浏览器支持，可能要提供至少四种不同类型的字体文件。包括.ttf、.woff、.eot和.svg格式字体</li><li>不兼容旧的手机浏览器：Opera mini，Android 2.1，Windows Phone 7.5-7.8</li><li>在手机上可能与系统字体冲突</li></ul><p>下面来尝试用这种方法来制作网站ICON。一般字体库都是在网上找现成的用。如<a href="http://www.iconfont.cn" target="_blank" rel="noopener">阿里的图标库</a>，还有国外的<a href="https://icomoon.io/app/#/select" target="_blank" rel="noopener">icomoon.io</a>。</p><h4 id="1-从网上下载字体库"><a href="#1-从网上下载字体库" class="headerlink" title="1.从网上下载字体库"></a>1.从网上下载字体库</h4><p>打开<a href="https://icomoon.io/app/#/select" target="_blank" rel="noopener">icomoon.io</a>。然后如图<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/icon1.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><br>接着<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/icon2.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/icon3.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure></p><h4 id="2-下载解压后得到以下文件"><a href="#2-下载解压后得到以下文件" class="headerlink" title="2.下载解压后得到以下文件"></a>2.下载解压后得到以下文件</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/icon4.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/icon5.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure>  <h4 id="3-然后我们新建一个HTML文件"><a href="#3-然后我们新建一个HTML文件" class="headerlink" title="3.然后我们新建一个HTML文件"></a>3.然后我们新建一个HTML文件</h4><p>要引入下载的style.css</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>font-icon<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"style.css"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--[if lt IE 8]&gt;&lt;!--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"ie7/ie7.css"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;![endif]--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"clearfix mhl ptl"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"clearfix bshadow0 pbs"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon icon-home"</span>&gt;</span>          </span><br><span class="line">                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon"</span>&gt;</span>&amp;#xe900;         </span><br><span class="line">                <span class="tag">&lt;/<span class="name">span</span>&gt;</span>                 </span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"clearfix bshadow0 pbs"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon icon-office"</span>&gt;</span>              </span><br><span class="line">                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon"</span>&gt;</span>&amp;#xe903;         </span><br><span class="line">                <span class="tag">&lt;/<span class="name">span</span>&gt;</span>   </span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span>     </span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"clearfix bshadow0 pbs"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon icon-newspaper"</span>&gt;</span>  </span><br><span class="line">                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon"</span>&gt;</span>&amp;#xe904;         </span><br><span class="line">                <span class="tag">&lt;/<span class="name">span</span>&gt;</span>                                </span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span>    </span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"clearfix bshadow0 pbs"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon icon-pencil"</span>&gt;</span>     </span><br><span class="line">                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon"</span>&gt;</span>&amp;#xe905;         </span><br><span class="line">                <span class="tag">&lt;/<span class="name">span</span>&gt;</span>                   </span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="4-style-css如下"><a href="#4-style-css如下" class="headerlink" title="4.style.css如下"></a>4.style.css如下</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">font-face</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">'icomoon'</span>;</span><br><span class="line">  <span class="attribute">src</span>:  <span class="built_in">url</span>(<span class="string">'fonts/icomoon.eot?ri2p4y'</span>);</span><br><span class="line">  <span class="attribute">src</span>:  <span class="built_in">url</span>(<span class="string">'fonts/icomoon.eot?ri2p4y#iefix'</span>) <span class="built_in">format</span>(<span class="string">'embedded-opentype'</span>),</span><br><span class="line">    <span class="built_in">url</span>(<span class="string">'fonts/icomoon.ttf?ri2p4y'</span>) <span class="built_in">format</span>(<span class="string">'truetype'</span>),</span><br><span class="line">    <span class="built_in">url</span>(<span class="string">'fonts/icomoon.woff?ri2p4y'</span>) <span class="built_in">format</span>(<span class="string">'woff'</span>),</span><br><span class="line">    <span class="built_in">url</span>(<span class="string">'fonts/icomoon.svg?ri2p4y#icomoon'</span>) <span class="built_in">format</span>(<span class="string">'svg'</span>);</span><br><span class="line">  <span class="attribute">font-weight</span>: normal;</span><br><span class="line">  <span class="attribute">font-style</span>: normal;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.icon</span> &#123;</span><br><span class="line">  <span class="comment">/* use !important to prevent issues with browser extensions that change fonts */</span></span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">'icomoon'</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">speak</span>: none;</span><br><span class="line">  <span class="attribute">font-style</span>: normal;</span><br><span class="line">  <span class="attribute">font-weight</span>: normal;</span><br><span class="line">  <span class="attribute">font-variant</span>: normal;</span><br><span class="line">  <span class="attribute">text-transform</span>: none;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Better Font Rendering =========== */</span></span><br><span class="line">  <span class="attribute">-webkit-font-smoothing</span>: antialiased;</span><br><span class="line">  <span class="attribute">-moz-osx-font-smoothing</span>: grayscale;</span><br><span class="line">  <span class="comment">/* 为演示添加 =========== */</span></span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">40px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.icon-home</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  content: "\e900";//加入字体编号</span><br><span class="line">  font-size: 50px;//修改字体大小</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.icon-office</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">"\e903"</span>;</span><br><span class="line">  color: #564813;//修改字体颜色</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.icon-newspaper</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">"\e904"</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.icon-pencil</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">"\e905"</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#444444</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上用了两种方式来引用字体文件，一种是通过Html直接写字体编号，另一种通过CSS伪类添加内容。相应的字体编号在下载下来的demo.html中可以查看。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/icon6.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><br>而最终效果如下图，可以在CSS中对相应的字体修改其样式，缩放、改变颜色、产生阴影、可以拥有透明效果、等CSS样式都可以<br><img src="http://ni484sha.com/images/icon7.png" alt="">  </p><h3 id="SVG-Sprites-雪碧图"><a href="#SVG-Sprites-雪碧图" class="headerlink" title="SVG Sprites(雪碧图)"></a>SVG Sprites(雪碧图)</h3><p>SVG Sprites原理跟CSS Sprites一样，把多个SVG 图标放到一张SVG中，然后通过坐标或者ID获取其中的图标。Icon Font功能的网站<a href="https://icomoon.io/app/#/select" target="_blank" rel="noopener">icomoon.io</a>已经提供输出 SVG Sprites 功能了。</p><h4 id="1-照例从网上下载SVG-Sprites"><a href="#1-照例从网上下载SVG-Sprites" class="headerlink" title="1.照例从网上下载SVG Sprites"></a>1.照例从网上下载SVG Sprites</h4><p>跟font一样下载SVG<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/icon8.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/icon9.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><br>点击设置，选中CSS SPRITE<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/icon10.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure></p><h4 id="2-下载解压后目录如下"><a href="#2-下载解压后目录如下" class="headerlink" title="2.下载解压后目录如下"></a>2.下载解压后目录如下</h4><p>这也提供了两种方式使用SVG icon,其中sprite文件夹中的跟CSS sprite一样，通过CSS坐标来取不同的SVG图标.<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/icon11.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="comment">&lt;!-- Generated by IcoMoon.io --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">version</span>=<span class="string">"1.1"</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/2000/svg"</span> <span class="attr">xmlns:xlink</span>=<span class="string">"http://www.w3.org/1999/xlink"</span> <span class="attr">width</span>=<span class="string">"752"</span> <span class="attr">height</span>=<span class="string">"32"</span> <span class="attr">viewBox</span>=<span class="string">"0 0 752 32"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">id</span>=<span class="string">"icon-home"</span> <span class="attr">width</span>=<span class="string">"32"</span> <span class="attr">height</span>=<span class="string">"32"</span> <span class="attr">viewBox</span>=<span class="string">"0 0 32 32"</span> <span class="attr">x</span>=<span class="string">"0"</span> <span class="attr">y</span>=<span class="string">"0"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">path</span> <span class="attr">d</span>=<span class="string">"M32 18.451l-16-12.42-16 12.42v-5.064l16-12.42 16 12.42zM28 18v12h-8v-8h-8v8h-8v-12l12-9z"</span>&gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">id</span>=<span class="string">"icon-office"</span> <span class="attr">width</span>=<span class="string">"32"</span> <span class="attr">height</span>=<span class="string">"32"</span> <span class="attr">viewBox</span>=<span class="string">"0 0 32 32"</span> <span class="attr">x</span>=<span class="string">"48"</span> <span class="attr">y</span>=<span class="string">"0"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">path</span> <span class="attr">d</span>=<span class="string">"M0 32h16v-32h-16v32zM10 4h4v4h-4v-4zM10 12h4v4h-4v-4zM10 20h4v4h-4v-4zM2 4h4v4h-4v-4zM2 12h4v4h-4v-4zM2 20h4v4h-4v-4zM18 10h14v2h-14zM18 32h4v-8h6v8h4v-18h-14z"</span>&gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">id</span>=<span class="string">"icon-newspaper"</span> <span class="attr">width</span>=<span class="string">"32"</span> <span class="attr">height</span>=<span class="string">"32"</span> <span class="attr">viewBox</span>=<span class="string">"0 0 32 32"</span> <span class="attr">x</span>=<span class="string">"96"</span> <span class="attr">y</span>=<span class="string">"0"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">path</span> <span class="attr">d</span>=<span class="string">"M28 8v-4h-28v22c0 1.105 0.895 2 2 2h27c1.657 0 3-1.343 3-3v-17h-4zM26 26h-24v-20h24v20zM4 10h20v2h-20zM16 14h8v2h-8zM16 18h8v2h-8zM16 22h6v2h-6zM4 14h10v10h-10z"</span>&gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">id</span>=<span class="string">"icon-pencil"</span> <span class="attr">width</span>=<span class="string">"32"</span> <span class="attr">height</span>=<span class="string">"32"</span> <span class="attr">viewBox</span>=<span class="string">"0 0 32 32"</span> <span class="attr">x</span>=<span class="string">"144"</span> <span class="attr">y</span>=<span class="string">"0"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">path</span> <span class="attr">d</span>=<span class="string">"M27 0c2.761 0 5 2.239 5 5 0 1.126-0.372 2.164-1 3l-2 2-7-7 2-2c0.836-0.628 1.874-1 3-1zM2 23l-2 9 9-2 18.5-18.5-7-7-18.5 18.5zM22.362 11.362l-14 14-1.724-1.724 14-14 1.724 1.724z"</span>&gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>这是将四个图标合并一起的sprite.svg文件，CSS首先根据class=”icon”引入svg背景，用background-position并根据x跟y值区分每个图标。下面是sprite.css文件以及HTML。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>CSS Sprite<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"sprite.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"clearfix mhl"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"cell fs1"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon icon-home"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            icon-home</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"cell fs1"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon icon-office"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            icon-office</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"cell fs1"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon icon-newspaper"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            icon-newspaper</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"cell fs1"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon icon-pencil"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            icon-pencil</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.icon</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">background-repeat</span>: no-repeat;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(sprite.svg);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.icon-home</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">32px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">32px</span>;</span><br><span class="line">  <span class="attribute">background-position</span>: <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.icon-office</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">32px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">32px</span>;</span><br><span class="line">  <span class="attribute">background-position</span>: -<span class="number">48px</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.icon-newspaper</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">32px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">32px</span>;</span><br><span class="line">  <span class="attribute">background-position</span>: -<span class="number">96px</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.icon-pencil</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">32px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">32px</span>;</span><br><span class="line">  <span class="attribute">background-position</span>: -<span class="number">144px</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-SVG-Sprite与symbol元素"><a href="#3-SVG-Sprite与symbol元素" class="headerlink" title="3.SVG Sprite与symbol元素"></a>3.SVG Sprite与symbol元素</h4><p>目前，SVG Sprite最佳实践是使用symbol元素。symbol元素是什么呢？单纯翻译的话，是“符号”的意思。然，这个释义并不符合这里的场景。用组件解释比较合适。SVG就是由许多个symbol组合起来的。下面就是从下载的demo中的svg，由四个symbol组合而成：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">style</span>=<span class="string">"position: absolute; width: 0; height: 0; overflow: hidden;"</span> <span class="attr">version</span>=<span class="string">"1.1"</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/2000/svg"</span> <span class="attr">xmlns:xlink</span>=<span class="string">"http://www.w3.org/1999/xlink"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">defs</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">symbol</span> <span class="attr">id</span>=<span class="string">"icon-home"</span> <span class="attr">viewBox</span>=<span class="string">"0 0 32 32"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>home<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span> <span class="attr">class</span>=<span class="string">"path1"</span> <span class="attr">d</span>=<span class="string">"M32 18.451l-16-12.42-16 12.42v-5.064l16-12.42 16 12.42zM28 18v12h-8v-8h-8v8h-8v-12l12-9z"</span>&gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">symbol</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">symbol</span> <span class="attr">id</span>=<span class="string">"icon-office"</span> <span class="attr">viewBox</span>=<span class="string">"0 0 32 32"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>office<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span> <span class="attr">class</span>=<span class="string">"path1"</span> <span class="attr">d</span>=<span class="string">"M0 32h16v-32h-16v32zM10 4h4v4h-4v-4zM10 12h4v4h-4v-4zM10 20h4v4h-4v-4zM2 4h4v4h-4v-4zM2 12h4v4h-4v-4zM2 20h4v4h-4v-4zM18 10h14v2h-14zM18 32h4v-8h6v8h4v-18h-14z"</span>&gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">symbol</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">symbol</span> <span class="attr">id</span>=<span class="string">"icon-newspaper"</span> <span class="attr">viewBox</span>=<span class="string">"0 0 32 32"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>newspaper<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span> <span class="attr">class</span>=<span class="string">"path1"</span> <span class="attr">d</span>=<span class="string">"M28 8v-4h-28v22c0 1.105 0.895 2 2 2h27c1.657 0 3-1.343 3-3v-17h-4zM26 26h-24v-20h24v20zM4 10h20v2h-20zM16 14h8v2h-8zM16 18h8v2h-8zM16 22h6v2h-6zM4 14h10v10h-10z"</span>&gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">symbol</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">symbol</span> <span class="attr">id</span>=<span class="string">"icon-pencil"</span> <span class="attr">viewBox</span>=<span class="string">"0 0 32 32"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>pencil<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span> <span class="attr">class</span>=<span class="string">"path1"</span> <span class="attr">d</span>=<span class="string">"M27 0c2.761 0 5 2.239 5 5 0 1.126-0.372 2.164-1 3l-2 2-7-7 2-2c0.836-0.628 1.874-1 3-1zM2 23l-2 9 9-2 18.5-18.5-7-7-18.5 18.5zM22.362 11.362l-14 14-1.724-1.724 14-14 1.724 1.724z"</span>&gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">symbol</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">defs</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>每一个symbol就是一个图标元件，但是，只有上面的代码，是无法呈现图标效果的,必须要配合use,也就是SVG中的<use></use>元素。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;!doctype html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>IcoMoon - SVG Icons<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">style</span>=<span class="string">"position: absolute; width: 0; height: 0; overflow: hidden;"</span> <span class="attr">version</span>=<span class="string">"1.1"</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/2000/svg"</span> <span class="attr">xmlns:xlink</span>=<span class="string">"http://www.w3.org/1999/xlink"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">defs</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">symbol</span> <span class="attr">id</span>=<span class="string">"icon-home"</span> <span class="attr">viewBox</span>=<span class="string">"0 0 32 32"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>home<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span> <span class="attr">class</span>=<span class="string">"path1"</span> <span class="attr">d</span>=<span class="string">"M32 18.451l-16-12.42-16 12.42v-5.064l16-12.42 16 12.42zM28 18v12h-8v-8h-8v8h-8v-12l12-9z"</span>&gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">symbol</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">symbol</span> <span class="attr">id</span>=<span class="string">"icon-office"</span> <span class="attr">viewBox</span>=<span class="string">"0 0 32 32"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>office<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span> <span class="attr">class</span>=<span class="string">"path1"</span> <span class="attr">d</span>=<span class="string">"M0 32h16v-32h-16v32zM10 4h4v4h-4v-4zM10 12h4v4h-4v-4zM10 20h4v4h-4v-4zM2 4h4v4h-4v-4zM2 12h4v4h-4v-4zM2 20h4v4h-4v-4zM18 10h14v2h-14zM18 32h4v-8h6v8h4v-18h-14z"</span>&gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">symbol</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">symbol</span> <span class="attr">id</span>=<span class="string">"icon-newspaper"</span> <span class="attr">viewBox</span>=<span class="string">"0 0 32 32"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>newspaper<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span> <span class="attr">class</span>=<span class="string">"path1"</span> <span class="attr">d</span>=<span class="string">"M28 8v-4h-28v22c0 1.105 0.895 2 2 2h27c1.657 0 3-1.343 3-3v-17h-4zM26 26h-24v-20h24v20zM4 10h20v2h-20zM16 14h8v2h-8zM16 18h8v2h-8zM16 22h6v2h-6zM4 14h10v10h-10z"</span>&gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">symbol</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">symbol</span> <span class="attr">id</span>=<span class="string">"icon-pencil"</span> <span class="attr">viewBox</span>=<span class="string">"0 0 32 32"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>pencil<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span> <span class="attr">class</span>=<span class="string">"path1"</span> <span class="attr">d</span>=<span class="string">"M27 0c2.761 0 5 2.239 5 5 0 1.126-0.372 2.164-1 3l-2 2-7-7 2-2c0.836-0.628 1.874-1 3-1zM2 23l-2 9 9-2 18.5-18.5-7-7-18.5 18.5zM22.362 11.362l-14 14-1.724-1.724 14-14 1.724 1.724z"</span>&gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">symbol</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">defs</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">header</span> <span class="attr">class</span>=<span class="string">"bgc1 clearfix"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"clearfix mhl ptl"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"glyph fs1"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"clearfix pbs"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">svg</span> <span class="attr">class</span>=<span class="string">"icon icon-home"</span>&gt;</span><span class="tag">&lt;<span class="name">use</span> <span class="attr">xlink:href</span>=<span class="string">"#icon-home"</span>&gt;</span><span class="tag">&lt;/<span class="name">use</span>&gt;</span><span class="tag">&lt;/<span class="name">svg</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"mls"</span>&gt;</span> icon-home<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"glyph fs1"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"clearfix pbs"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">svg</span> <span class="attr">class</span>=<span class="string">"icon icon-office"</span>&gt;</span><span class="tag">&lt;<span class="name">use</span> <span class="attr">xlink:href</span>=<span class="string">"#icon-office"</span>&gt;</span><span class="tag">&lt;/<span class="name">use</span>&gt;</span><span class="tag">&lt;/<span class="name">svg</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"mls"</span>&gt;</span> icon-office<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"glyph fs1"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"clearfix pbs"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">svg</span> <span class="attr">class</span>=<span class="string">"icon icon-newspaper"</span>&gt;</span><span class="tag">&lt;<span class="name">use</span> <span class="attr">xlink:href</span>=<span class="string">"#icon-newspaper"</span>&gt;</span><span class="tag">&lt;/<span class="name">use</span>&gt;</span><span class="tag">&lt;/<span class="name">svg</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"mls"</span>&gt;</span> icon-newspaper<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"glyph fs1"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"clearfix pbs"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">svg</span> <span class="attr">class</span>=<span class="string">"icon icon-pencil"</span>&gt;</span><span class="tag">&lt;<span class="name">use</span> <span class="attr">xlink:href</span>=<span class="string">"#icon-pencil"</span>&gt;</span><span class="tag">&lt;/<span class="name">use</span>&gt;</span><span class="tag">&lt;/<span class="name">svg</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"mls"</span>&gt;</span> icon-pencil<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">defer</span> <span class="attr">src</span>=<span class="string">"svgxuse.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>上面就是一个页面中用symbol方式使用图标的代码。效果如下图<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/icon12.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><br>SVG也可以独立出来，use的href把路径带上就可以了。</p><h4 id="4-多个SVG合成SVG-SPRITES"><a href="#4-多个SVG合成SVG-SPRITES" class="headerlink" title="4.多个SVG合成SVG SPRITES"></a>4.多个SVG合成SVG SPRITES</h4><p>如果设计师自己设计并生成了单个SVG图标，合并的方法有两种：</p><h5 id="icoMoon网站上传后一起导出"><a href="#icoMoon网站上传后一起导出" class="headerlink" title="icoMoon网站上传后一起导出"></a>icoMoon网站上传后一起导出</h5><p>如图所示，接下来操作跟之前的一样，选中图标后导出就行了。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="http://ni484sha.com/images/icon13.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure>  </p><h5 id="grunt-svgstore合并"><a href="#grunt-svgstore合并" class="headerlink" title="grunt-svgstore合并"></a>grunt-svgstore合并</h5><p>利用grunt-svgstore插件合成，有前端经验的都应该知道，grunt我也没用过，想了解的可以上网去查查，grunt是基于node的，所以要先安装node。这块我就不多说了。</p><h6 id="1-安装相关资源"><a href="#1-安装相关资源" class="headerlink" title="1.安装相关资源"></a>1.安装相关资源</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g grunt-cli</span><br></pre></td></tr></table></figure><p>首先全局安装CLI，这条命令将会把grunt命令植入系统路径，这样就能在任意目录运行他。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install grunt-svgstore --save-dev</span><br></pre></td></tr></table></figure></p><h6 id="2-package-json"><a href="#2-package-json" class="headerlink" title="2.package.json"></a>2.package.json</h6><p>新建一个文件夹放项目，然后安装grunt-svgstore插件。安装好后node_modules中就有grunt-svgstore相关包了。然后新建package.json文件。<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"svg-store"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"0.1.0"</span>,</span><br><span class="line">  <span class="attr">"private"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"grunt"</span>: <span class="string">"^0.4.5"</span>,</span><br><span class="line">    <span class="attr">"grunt-svgstore"</span>: <span class="string">"~0.5.0"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>然后install依赖。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br></pre></td></tr></table></figure></p><h6 id="3-Gruntfile-js"><a href="#3-Gruntfile-js" class="headerlink" title="3.Gruntfile.js"></a>3.Gruntfile.js</h6><p>新建配置文件Gruntfile.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">grunt</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 配置</span></span><br><span class="line">    grunt.initConfig(&#123;</span><br><span class="line">        svgstore: &#123;</span><br><span class="line">            options: &#123;</span><br><span class="line">              prefix : <span class="string">'icon-'</span>, </span><br><span class="line">              svg: &#123; </span><br><span class="line">                viewBox : <span class="string">'0 0 100 100'</span>,</span><br><span class="line">                xmlns: <span class="string">'http://www.w3.org/2000/svg'</span></span><br><span class="line">              &#125;,</span><br><span class="line">              includedemo:<span class="literal">true</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="keyword">default</span> : &#123;</span><br><span class="line">              files: &#123;</span><br><span class="line">                <span class="string">'dest/dest-svg.svg'</span>: [<span class="string">'src/*.svg'</span>],</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 载入grunt-svgstore</span></span><br><span class="line">    grunt.loadNpmTasks(<span class="string">'grunt-svgstore'</span>);</span><br><span class="line">    <span class="comment">// 注册任务</span></span><br><span class="line">    grunt.registerTask(<span class="string">'default'</span>, [<span class="string">'svgstore'</span>]);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><h6 id="4-新建src文件夹"><a href="#4-新建src文件夹" class="headerlink" title="4.新建src文件夹"></a>4.新建src文件夹</h6><p>新建src文件夹，把所有的svg文件放进去。然后运行<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grunt</span><br></pre></td></tr></table></figure></p><p>在项目目录中就会出现dest-svg.svg跟dest-svg-demo.html，dest-svg.svg就是合并后的svg文件。<a href="https://github.com/lj360560179/grunt-svgstore-test" target="_blank" rel="noopener">这里</a> 是这个简单项目的地址。</p><h3 id="DataURI"><a href="#DataURI" class="headerlink" title="DataURI"></a>DataURI</h3><p>DataURI是利用Base64编码规范将图片转换成文本字符，不仅是图片，还可以编码JS、CSS、HTML等文件。通过将图标文件编码成文本字符，从而可以直接写在HTML/CSS文件里面，不会增加任何多余的请求。  但是DataURI的劣势也是很明显的，每次都需要解码从而阻塞了CSS渲染，可以通过分离出一个专用的CSS文件，不过那就需要增加一个请求，那样与CSS Sprites、Icon Font和SVG相比没有了任何优势，也因此，在实践中不推荐这种方法。需要注意的是通过缓存CSS可以来达到缓存的目的。<br>优势：</p><ul><li>不增加请求数</li></ul><p>劣势：</p><ul><li>图片不能太大</li><li>每次加载页面都需要解码</li><li>不支持IE6/7，IE8最大支持32KB</li><li>难于维护</li></ul><p>用法很简单，将base64填入即可。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.icon</span>&#123; </span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">url</span>(data:text/svg+xml;base64,&lt;base64 encoded data&gt;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="如何选择"><a href="#如何选择" class="headerlink" title="如何选择"></a>如何选择</h2><ul><li>如果你需要信息更丰富的图片，不仅仅是图标时，可以考虑使用<img></li><li>使用的不是展示类图形，而是装饰性的图形（包括图标），而且这部分图形一般不轻意改变，可以考虑使用PNG Sprites</li><li>如果你的图标之类需要更好的适配于高分辨率设备环境之下，可以考虑使用SVG Sprites</li><li>如果仅仅是要使用Icon这些小图标，并且对Icon做一些个性化样式，可以考虑使用Icon Font</li><li>如果你需要图标更具扩展性，又不希望加载额外的图标，可以考虑在页面中直接使用SVG代码绘制的矢量图  </li></ul><p>当然配合起来用也是可以的。</p><h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>这是我参考了网上很多大神的博客写的，一下写了那么长，有错的地方大家见谅。  </p><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="http://www.cnblogs.com/yexiaochai/p/3603389.html" target="_blank" rel="noopener">【grunt整合版】30分钟学会使用grunt打包前端代码</a><br><a href="http://www.w3cplus.com/css/web-icons.html" target="_blank" rel="noopener">Web中的图标</a><br><a href="http://www.zhangxinxu.com/wordpress/2014/07/introduce-svg-sprite-technology/" target="_blank" rel="noopener">未来必热：SVG Sprite技术介绍</a><br><a href="https://io-meter.com/2014/07/20/replace-icon-fonts-with-svg/" target="_blank" rel="noopener">Web 设计新趋势: 使用 SVG 代替 Web Icon Font</a><br><a href="用字体在网页中画ICON图标">慕课网视频教程：用字体在网页中画ICON图标</a> </p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;网站icon图标&quot;&gt;&lt;a href=&quot;#网站icon图标&quot; class=&quot;headerlink&quot; title=&quot;网站icon图标&quot;&gt;&lt;/a&gt;网站icon图标&lt;/h2&gt;&lt;p&gt;之前在学习webpack打包的时候，发现可以将网站ICON图标转化为Base64编码规范的文本字符，然后引入当做背景图片，以前只知道CSS Sprites这种方法来减少网页请求。后来上网了解了一下，原来现在对网站icon已经有了很多优化方法，如：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;CSS Sprites&lt;/li&gt;
&lt;li&gt;字体图标(Icon Font)&lt;/li&gt;
&lt;li&gt;DataURI&lt;/li&gt;
&lt;li&gt;SVG Sprites&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="前端" scheme="http://lj360560179.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="css3 node" scheme="http://lj360560179.github.io/tags/css3-node/"/>
    
  </entry>
  
  <entry>
    <title>微信登录工具</title>
    <link href="http://lj360560179.github.io/2016/04/25/Wechat/"/>
    <id>http://lj360560179.github.io/2016/04/25/Wechat/</id>
    <published>2016-04-25T07:44:14.000Z</published>
    <updated>2018-09-06T09:35:14.860Z</updated>
    
    <content type="html"><![CDATA[<p>之前做微信登录的时候，看文档写的获取信息的工具类。微信登录就是传过去信息，然后返回信息，然后再根据返回的信息再传过去信息，然后再返回······，最后得到用户信息。<br><a id="more"></a></p><h3 id="相关代码"><a href="#相关代码" class="headerlink" title="相关代码"></a>相关代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 通过code获取access_token</span></span><br><span class="line"><span class="comment">  *<span class="doctag">@param</span> appId</span></span><br><span class="line"><span class="comment">  *         appId </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> appSecret</span></span><br><span class="line"><span class="comment">  *         appSecret </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span>  code</span></span><br><span class="line"><span class="comment">  *           code</span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  */</span> </span><br><span class="line"> <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, Object&gt; <span class="title">GetWexinAccessToken</span><span class="params">(String  appid,String secret,String code)</span></span>&#123;</span><br><span class="line">     </span><br><span class="line">     Map&lt;String, Object&gt; parameterMap = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">     parameterMap.put(<span class="string">"appid"</span>, appid);</span><br><span class="line">     parameterMap.put(<span class="string">"secret"</span>, secret);</span><br><span class="line">     parameterMap.put(<span class="string">"code"</span>, code);</span><br><span class="line">     parameterMap.put(<span class="string">"grant_type"</span>, <span class="string">"authorization_code"</span>);</span><br><span class="line">     String url=<span class="string">"https://api.weixin.qq.com/sns/oauth2/access_token"</span>;</span><br><span class="line">     <span class="comment">//发送请求并返回数据</span></span><br><span class="line">     String result = HttpRequest.get(url,parameterMap);</span><br><span class="line">     </span><br><span class="line">     <span class="keyword">if</span> (result.contains(<span class="string">"errcode"</span>))&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">null</span>;    </span><br><span class="line">     &#125;<span class="keyword">else</span>&#123;  </span><br><span class="line">         Map&lt;String, Object&gt; model = JsonUtils.toObject(result, Map.class);</span><br><span class="line">         <span class="keyword">return</span> model;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;   </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 根据access_token判断access_token是否过期</span></span><br><span class="line"><span class="comment">  *<span class="doctag">@param</span> access_token</span></span><br><span class="line"><span class="comment">  *         access_token</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> openid</span></span><br><span class="line"><span class="comment">  *         Opened </span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">CheckAccessToken</span><span class="params">(String access_token,String openid)</span></span>&#123;</span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">     Map&lt;String, Object&gt; parameterMap = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">     parameterMap.put(<span class="string">"access_token"</span>, access_token);</span><br><span class="line">     parameterMap.put(<span class="string">"openid"</span>, openid);</span><br><span class="line"></span><br><span class="line">     String url = <span class="string">"https://api.weixin.qq.com/sns/auth"</span>;</span><br><span class="line">     </span><br><span class="line">     String result = HttpRequest.get(url,parameterMap);</span><br><span class="line"></span><br><span class="line">     Map&lt;String, Object&gt;  model = JsonUtils.toObject(result, Map.class);</span><br><span class="line">         </span><br><span class="line">     <span class="keyword">if</span>(model.containsKey(<span class="string">"errmsg"</span>))&#123;</span><br><span class="line">             </span><br><span class="line">         <span class="keyword">if</span> (model.get(<span class="string">"errmsg"</span>).equals(<span class="string">"ok"</span>))&#123;</span><br><span class="line">                 <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">             &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                 <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">             &#125;</span><br><span class="line">     &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     </span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 刷新或续期access_token使用</span></span><br><span class="line"><span class="comment">  *<span class="doctag">@param</span> access_token</span></span><br><span class="line"><span class="comment">  *         access_token</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> openid</span></span><br><span class="line"><span class="comment">  *         Opened </span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, Object&gt;  <span class="title">GetRefreshToken</span><span class="params">(String refresh_token,String  appid)</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">     Map&lt;String, Object&gt; parameterMap = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">     parameterMap.put(<span class="string">"refresh_token"</span>, refresh_token);</span><br><span class="line">     parameterMap.put(<span class="string">"appid"</span>, appid);</span><br><span class="line">     parameterMap.put(<span class="string">"grant_type"</span>, <span class="string">"refresh_token"</span>); </span><br><span class="line">     String url = <span class="string">"https://api.weixin.qq.com/sns/oauth2/refresh_token"</span>;</span><br><span class="line">    </span><br><span class="line">     String result = HttpRequest.get(url,parameterMap);</span><br><span class="line">     <span class="keyword">if</span> (result.contains(<span class="string">"errmsg"</span>))&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">     &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">         Map&lt;String, Object&gt;  model = JsonUtils.toObject(result, Map.class);</span><br><span class="line">         <span class="keyword">return</span> model;   </span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  *获取登录信息</span></span><br><span class="line"><span class="comment">  *<span class="doctag">@param</span> access_token</span></span><br><span class="line"><span class="comment">  *         access_token</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> openid</span></span><br><span class="line"><span class="comment">  *         Opened </span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, Object&gt;  <span class="title">GetUserInfo</span><span class="params">(String access_token, String  openid)</span></span>&#123;</span><br><span class="line">     </span><br><span class="line">     Map&lt;String, Object&gt; parameterMap = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">     parameterMap.put(<span class="string">"access_token"</span>, access_token);</span><br><span class="line">     parameterMap.put(<span class="string">"openid"</span>, openid);</span><br><span class="line">     </span><br><span class="line">     String url=<span class="string">"https://api.weixin.qq.com/sns/userinfo"</span>;</span><br><span class="line">     String result = HttpRequest.get(url,parameterMap);</span><br><span class="line">     <span class="keyword">if</span> (result.contains(<span class="string">"errmsg"</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">     &#125;</span><br><span class="line">     Map&lt;String, Object&gt; model = JsonUtils.toObject(result, Map.class);</span><br><span class="line">     <span class="keyword">return</span> model;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;之前做微信登录的时候，看文档写的获取信息的工具类。微信登录就是传过去信息，然后返回信息，然后再根据返回的信息再传过去信息，然后再返回······，最后得到用户信息。&lt;br&gt;
    
    </summary>
    
      <category term="java" scheme="http://lj360560179.github.io/categories/java/"/>
    
    
      <category term="java" scheme="http://lj360560179.github.io/tags/java/"/>
    
  </entry>
  
</feed>
